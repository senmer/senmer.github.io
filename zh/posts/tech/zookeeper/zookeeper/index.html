<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Zookeeper | WZ's Blog</title>
<meta name=keywords content><meta name=description content="ä¸€ã€Zookeeper ç®€ä»‹ï¼š Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œ"><meta name=author content="wz"><link rel=canonical href=https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Zookeeper"><meta property="og:description" content="ä¸€ã€Zookeeper ç®€ä»‹ï¼š Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œ"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-29T12:09:35+08:00"><meta property="article:modified_time" content="2023-08-29T12:09:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zookeeper"><meta name=twitter:description content="ä¸€ã€Zookeeper ç®€ä»‹ï¼š Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://senmer.github.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://senmer.github.io/zh/posts/tech/"},{"@type":"ListItem","position":3,"name":"Zookeeper","item":"https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Zookeeper","name":"Zookeeper","description":"ä¸€ã€Zookeeper ç®€ä»‹ï¼š Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œ","keywords":[""],"articleBody":"ä¸€ã€Zookeeper ç®€ä»‹ï¼š Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œé€šçŸ¥æœºåˆ¶ï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°é«˜å¯ç”¨æ€§ã€ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚\nZooKeeper ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š\nåˆ†å¸ƒå¼åè°ƒï¼š ZooKeeper æä¾›äº†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„å…±äº«é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯çš„é›†ä¸­å¼å­˜å‚¨ï¼Œä»è€Œå®ç°äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„åè°ƒã€‚\né«˜å¯ç”¨æ€§ï¼š ZooKeeper çš„è®¾è®¡ç€é‡äºé«˜å¯ç”¨æ€§ï¼Œé€šè¿‡å°†æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šä»¥å®ç°å®¹é”™å’Œæ•…éšœæ¢å¤ã€‚\nä¸€è‡´æ€§ï¼š ZooKeeper æä¾›äº†å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´çš„è§†å›¾ã€‚\né¡ºåºè®¿é—®ï¼š ZooKeeper ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹ä»¶å¼•å…¥äº†é¡ºåºæ€§ï¼Œä½¿å¾—äº‹ä»¶åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­èƒ½å¤ŸæŒ‰ç…§é¡ºåºè¿›è¡Œå¤„ç†ã€‚\né€šçŸ¥æœºåˆ¶ï¼š ZooKeeper å…è®¸å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å™¨ä»¥è·å–æœ‰å…³èŠ‚ç‚¹çŠ¶æ€å˜åŒ–çš„é€šçŸ¥ï¼Œä»è€Œå®ç°äº†åˆ†å¸ƒå¼äº‹ä»¶é€šçŸ¥ã€‚\näºŒã€Zookeeper ä½¿ç”¨åœºæ™¯ï¼š åˆ†å¸ƒå¼åè°ƒï¼šZooKeeper æ˜¯æœ€å¸¸è§çš„ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­åè°ƒä»»åŠ¡çš„å·¥å…·ä¹‹ä¸€ã€‚å®ƒå¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é€‰ä¸¾ç­‰ï¼Œç¡®ä¿ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æœ‰åºæ“ä½œã€‚\né…ç½®ç®¡ç†ï¼šZooKeeper å¯ä»¥ç”¨äºç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€æœåŠ¡åœ°å€ç­‰ã€‚åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ç›‘å¬ ZooKeeper ä¸Šçš„é…ç½®èŠ‚ç‚¹æ¥å®ç°åŠ¨æ€é…ç½®æ›´æ–°ã€‚\nå‘½åæœåŠ¡ï¼šZooKeeper å¯ä»¥ç”¨ä½œåˆ†å¸ƒå¼å‘½åæœåŠ¡ï¼Œç±»ä¼¼äº DNSï¼Œç”¨äºå°†é€»è¾‘åç§°æ˜ å°„åˆ°å®é™…æœåŠ¡åœ°å€ï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è½»æ¾æŸ¥æ‰¾æœåŠ¡ã€‚\nåˆ†å¸ƒå¼é”ï¼šZooKeeper æä¾›äº†åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œç”¨äºåè°ƒä¸åŒèŠ‚ç‚¹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥è®¿é—®è¯¥èµ„æºã€‚\nåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼šZooKeeper å¯ä»¥ç”¨äºåˆ›å»ºåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œç”¨äºåœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ¶ˆæ¯æˆ–ä»»åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡çš„æœ‰åºæ‰§è¡Œã€‚\nåˆ†å¸ƒå¼é€šçŸ¥ï¼šZooKeeper å…è®¸åº”ç”¨ç¨‹åºç›‘å¬ç‰¹å®šçš„èŠ‚ç‚¹ï¼Œä»¥è·å–å…³äºé›†ç¾¤çŠ¶æ€å˜åŒ–çš„é€šçŸ¥ï¼Œä»è€Œå®ç°åŠæ—¶å“åº”å’Œå¤„ç†ã€‚\nåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼šZooKeeper æœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ä»¥ç”¨äºç®¡ç†å’Œç»´æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€çŠ¶æ€åŒæ­¥ç­‰ã€‚\nLeader é€‰ä¸¾ï¼šZooKeeper å¯ä»¥ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼Œä»¥ç¡®ä¿åœ¨èŠ‚ç‚¹æ•…éšœæ—¶èƒ½å¤Ÿå¿«é€Ÿé€‰ä¸¾æ–°çš„é¢†å¯¼è€…ã€‚\næ€»çš„æ¥è¯´ï¼ŒZooKeeper åœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶èµ·åˆ°äº†å…³é”®çš„åè°ƒå’Œç®¡ç†ä½œç”¨ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¤„ç†åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„å¤æ‚æ€§å’ŒæŒ‘æˆ˜ã€‚ç„¶è€Œï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œä¸€äº›æ›¿ä»£æ–¹æ¡ˆå¦‚ etcdã€Consul ç­‰ä¹Ÿå‡ºç°ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç±»ä¼¼çš„åˆ†å¸ƒå¼åè°ƒå’Œç®¡ç†åŠŸèƒ½ã€‚\nä¸‰ã€Zookeeper å•æœºéƒ¨ç½² 3.1 å®éªŒç¯å¢ƒ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® zookeeper 10.0.0.10 CentOS 7.6 1U 2G 3.2 é…ç½® java ç¯å¢ƒ è½¯ä»¶ä¾èµ–ï¼šZooKeeper: Because Coordinating Distributed Systems is a Zoo (apache.org)\nå®‰è£… openjdk\n[root@zookeeper ~]# yum install -y java-1.8.0-openjdk æŸ¥çœ‹ç»“æœ\n[root@zookeeper ~]# java -version openjdk version \"1.8.0_382\" OpenJDK Runtime Environment (build 1.8.0_382-b05) OpenJDK 64-Bit Server VM (build 25.382-b05, mixed mode) 3.3 éƒ¨ç½² zookeeper 3.3.1 ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ… ä¸‹è½½åœ°å€ï¼šIndex of /dist/zookeeper (apache.org)\ncd /usr/local/src wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz tar xf zookeeper-3.4.13.tar.gz ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper 3.3.2 å‡†å¤‡é…ç½®æ–‡ä»¶ è¿™é‡Œä¿æŒé»˜è®¤é…ç½®ï¼Œä¸åšä¿®æ”¹\n[root@zookeeper src]# cd zookeeper/conf/ [root@zookeeper conf]# cp zoo_sample.cfg zoo.cfg [root@zookeeper conf]# ls configuration.xsl log4j.properties zoo.cfg zoo_sample.cfg [root@zookeeper conf]# grep -v ^# zoo.cfg tickTime=2000 initLimit=10 syncLimit=5 dataDir=/tmp/zookeeper clientPort=2181 3.4 å¯åŠ¨ zookeeper æœåŠ¡ 3.4.1 å¯åŠ¨æœåŠ¡ [root@zookeeper conf]# cd /usr/local/zookeeper/ [root@zookeeper zookeeper]# bin/zkServer.sh start ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Starting zookeeper ... STARTED 3.4.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€ [root@zookeeper zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: standalone # å•æœºæ¨¡å¼ 3.4.3 æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯ [root@zookeeper zookeeper-3.4.13]# ps -ef | grep zookeeper root 8452 1 2 17:48 pts/0 00:00:00 java -Dzookeeper.log.dir=. -Dzookeeper.root.logger=INFO,CONSOLE -cp /usr/local/src/zookeeper-3.4.13/bin/../build/classes:/usr/local/src/zookeeper-3.4.13/bin/../build/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/usr/local/src/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/usr/local/src/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../conf: -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=false org.apache.zookeeper.server.quorum.QuorumPeerMain /usr/local/src/zookeeper-3.4.13/bin/../conf/zoo.cfg root 8498 8326 0 17:49 pts/0 00:00:00 grep --color=auto zookeeper å››ã€Zookeeper é›†ç¾¤éƒ¨ç½² 4.1 å®éªŒç¯å¢ƒ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® zookeeper-01 10.0.0.11 CentOS 7.6 1U 2G zookeeper-02 10.0.0.12 CentOS 7.6 1U 2G zookeeper-03 10.0.0.13 CentOS 7.6 1U 2G 4.2 é…ç½® Java ç¯å¢ƒ æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š\nyum install java-1.8.0-openjdk -y java -version 4.3 ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ… æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š\ncd /usr/local/src wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz tar xf zookeeper-3.4.13.tar.gz ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper mkdir /usr/local/zookeeper/data # æ•°æ®å­˜æ”¾ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º cd /usr/local/zookeeper/conf cp zoo_sample.cfg zoo.cfg\t# æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ cat \u003e zoo.cfg \u003c\u003c EOF tickTime=2000 initLimit=10 syncLimit=5 dataDir=/usr/local/zookeeper/data clientPort=2181 maxClientCnxns=4096 autopurge.snapRetainCount=128 autopurge.purgeInterval=1 server.1=10.0.0.11:2888:3888 server.2=10.0.0.12:2888:3888 server.3=10.0.0.13:2888:3888 EOF å‚æ•°è§£é‡Šï¼š\ntickTime=2000 #æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„å•æ¬¡å¿ƒè·³æ£€æµ‹æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ initLimit=10 #é›†ç¾¤ä¸­ leader æœåŠ¡å™¨ä¸ follower æœåŠ¡å™¨åˆå§‹è¿æ¥å¿ƒè·³æ¬¡æ•°ï¼Œå³å¤šå°‘ä¸ª 2000 æ¯«ç§’ syncLimit=5 # leader ä¸ follower ä¹‹é—´è¿æ¥å®Œæˆä¹‹åï¼ŒåæœŸæ£€æµ‹å‘é€å’Œåº”ç­”çš„å¿ƒè·³æ¬¡æ•°ï¼Œå¦‚æœè¯¥ follower åœ¨è®¾ç½®çš„æ—¶é—´å†…(5*2000)ä¸èƒ½ä¸ leader è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤follower å°†è¢«è§†ä¸ºä¸å¯ç”¨ã€‚ dataDir=/usr/local/zookeeper/data #è‡ªå®šä¹‰çš„ zookeeper ä¿å­˜æ•°æ®çš„ç›®å½• clientPort=2181 #å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚ maxClientCnxns=128 #å•ä¸ªå®¢æˆ·ç«¯ IP å¯ä»¥å’Œ zookeeper ä¿æŒçš„è¿æ¥æ•° autopurge.snapRetainCount=3 #3.4.0 ä¸­çš„æ–°å¢åŠŸèƒ½ï¼šå¯ç”¨åï¼ŒZooKeeper è‡ªåŠ¨æ¸…é™¤åŠŸèƒ½ä¼šå°†æœ€æ–°å¿«ç…§å’Œç›¸åº”çš„äº‹åŠ¡æ—¥å¿—åˆ†åˆ«ä¿ç•™åœ¨ dataDir å’Œ dataLogDir ä¸­ï¼Œå¹¶åˆ é™¤å…¶ä½™éƒ¨åˆ†ï¼Œé»˜è®¤å€¼ä¸º 3ã€‚æœ€å°å€¼ä¸º 3ã€‚ autopurge.purgeInterval=1 # 3.4.0 åŠä¹‹åç‰ˆæœ¬ï¼ŒZK æä¾›äº†è‡ªåŠ¨æ¸…ç†æ—¥å¿—å’Œå¿«ç…§æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸ª 1 æˆ–æ›´å¤§çš„æ•´æ•°ï¼Œé»˜è®¤æ˜¯ 0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ server.1=10.0.0.11:2888:3888 # server.æœåŠ¡å™¨ç¼–å·=æœåŠ¡å™¨IP:æ•°æ®åŒæ­¥ç«¯å£:é€‰ä¸¾ç«¯å£ server.2=10.0.0.12:2888:3888 server.3=10.0.0.13:2888:3888 4.4 ä¿®æ”¹é›†ç¾¤é…ç½® zookeeper-01 æ‰§è¡Œï¼š\n# é…ç½®é›†ç¾¤ ID echo 1 \u003e /usr/local/zookeeper/data/myid zookeeper-02 æ‰§è¡Œï¼š\necho 2 \u003e /usr/local/zookeeper/data/myid zookeeper-03 æ‰§è¡Œï¼š\necho 3 \u003e /usr/local/zookeeper/data/myid 4.5 å¯åŠ¨æœåŠ¡ zookeeper-01 æ‰§è¡Œï¼š\n# å¯åŠ¨æœåŠ¡ cd /usr/local/zookeeper/ bin/zkServer.sh start #æŸ¥çœ‹é›†ç¾¤è§’è‰² [root@zookeeper-01 zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: follower zookeeper-02 æ‰§è¡Œï¼š\n# å¯åŠ¨æœåŠ¡ cd /usr/local/zookeeper/ bin/zkServer.sh start [root@zookeeper-02 zookeeper]# ./bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: leader # leader é¢å¤–å¼€å¯ä¸€ä¸ª 2888 ç«¯å£ç”¨äºåŒæ­¥æ•°æ® [root@zookeeper-03 zookeeper]# ss -ntl|grep 2888 LISTEN 0 50 ::ffff:10.0.0.13:2888 :::* zookeeper-03 æ‰§è¡Œï¼š\n# å¯åŠ¨æœåŠ¡ cd /usr/local/zookeeper/ bin/zkServer.sh start [root@zookeeper-03 zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: follower äº”ã€Zookeeper æ•°æ®å¢åˆ æ”¹æŸ¥ Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œå¸¸ç”¨äºç®¡ç†å’Œç»´æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é…ç½®ä¿¡æ¯ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ç­‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼ˆç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œé€šè¿‡æ ‘çŠ¶ç»“æ„æ¥å­˜å‚¨æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„ Zookeeper å‘½ä»¤ç¤ºä¾‹ï¼Œç”¨äºå¢åˆ æ”¹æŸ¥ Zookeeper ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼š\nå¯ç”¨çš„å®¢æˆ·ç«¯å·¥å…·ï¼šzzhang5/zooinspector: An improved zookeeper inspector (github.com)\n5.1 è¯­æ³•ç®€ä»‹ è¿æ¥åˆ° Zookeeperï¼š\nåœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è¿æ¥åˆ° Zookeeper æœåŠ¡å™¨ï¼š\nzkCli.sh -server : å…¶ä¸­ï¼Œ æ˜¯ Zookeeper æœåŠ¡å™¨çš„åœ°å€ï¼Œ æ˜¯ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2181ã€‚\nåˆ›å»ºèŠ‚ç‚¹ï¼š\nåœ¨ Zookeeper ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ create å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚\ncreate /mynode \"Hello, Zookeeper!\" è·å–èŠ‚ç‚¹æ•°æ®ï¼š\nä½¿ç”¨ get å‘½ä»¤å¯ä»¥è·å–èŠ‚ç‚¹çš„æ•°æ®ã€‚\nget /mynode æ›´æ–°èŠ‚ç‚¹æ•°æ®ï¼š\nä½¿ç”¨ set å‘½ä»¤æ¥æ›´æ–°èŠ‚ç‚¹çš„æ•°æ®ã€‚\nset /mynode \"Updated data\" åˆ—å‡ºå­èŠ‚ç‚¹ï¼š\nä½¿ç”¨ ls å‘½ä»¤åˆ—å‡ºèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚\nls /path/to/parent_node åˆ é™¤èŠ‚ç‚¹ï¼š\nä½¿ç”¨ delete å‘½ä»¤æ¥åˆ é™¤èŠ‚ç‚¹ã€‚\ndelete /path/to/node 5.2 å®ä¾‹æ¼”ç¤º è¿æ¥é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œè¿™é‡Œé€‰æ‹© zookeeper-01\n[root@zookeeper-01 zookeeper]# bin/zkCli.sh -server 10.0.0.11 [zk: 10.0.0.11(CONNECTED) 2] help # help æŸ¥çœ‹å¸®åŠ© ZooKeeper -server host:port cmd args stat path [watch] set path data [version] ls path [watch] delquota [-n|-b] path ls2 path [watch] setAcl path acl setquota -n|-b val path history redo cmdno printwatches on|off delete path [version] sync path listquota path rmr path get path [watch] create [-s] [-e] path data acl addauth scheme auth quit getAcl path close connect host:port [zk: 10.0.0.11(CONNECTED) 0] create /test \"hello\" # åˆ›å»ºèŠ‚ç‚¹ Created /test [zk: 10.0.0.11(CONNECTED) 1] get /test\t# æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹ hello cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000004 mtime = Wed Aug 30 18:08:30 CST 2023 pZxid = 0x800000004 cversion = 0 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 0 [zk: 10.0.0.11(CONNECTING) 0] ls /test # æŸ¥çœ‹èŠ‚ç‚¹ [] [zk: 10.0.0.11(CONNECTED) 1] create /test/app1 # åˆ›å»ºèŠ‚ç‚¹ï¼Œä½†æœªç»™å‡ºå€¼ [zk: 10.0.0.11(CONNECTED) 2] ls /test/app1 # å®é™…æœªåˆ›å»ºæˆåŠŸ Node does not exist: /test/app1 [zk: 10.0.0.11(CONNECTED) 3] create /test/app1 \"my first app\" # å†æ¬¡åˆ›å»ºå­èŠ‚ç‚¹å¹¶èµ‹å€¼ Node already exists: /test/app1 [zk: 10.0.0.11(CONNECTED) 4] ls /test/app1 # åˆ›å»ºæˆåŠŸ [] [zk: 10.0.0.11(CONNECTED) 5] ls /test/app1/ # æŸ¥çœ‹èŠ‚ç‚¹ï¼Œæœ«å°¾ä¸èƒ½å¸¦ '/' Command failed: java.lang.IllegalArgumentException: Path must not end with / character [zk: 10.0.0.11(CONNECTED) 6] set /test \"world\" # æ›´æ–°èŠ‚ç‚¹çš„å€¼ cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000010 mtime = Wed Aug 30 18:28:38 CST 2023 pZxid = 0x80000000d cversion = 1 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 1 [zk: 10.0.0.11(CONNECTED) 7] get /test # å†æ¬¡æŸ¥çœ‹ï¼Œæ›´æ–°æˆåŠŸ world cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000012 mtime = Wed Aug 30 18:28:38 CST 2023 pZxid = 0x80000000d cversion = 1 dataVersion = 3 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 1 [zk: 10.0.0.11(CONNECTED) 8] delete /test # åˆ é™¤èŠ‚ç‚¹ï¼Œå› ä¸ºå­˜åœ¨å­—èŠ‚çš„ï¼Œæ‰€ä»¥åˆ é™¤å¤±è´¥ Node not empty: /test [zk: 10.0.0.11(CONNECTED) 9] delete /test/app1 # å…ˆåˆ é™¤å­èŠ‚ç‚¹ [zk: 10.0.0.11(CONNECTED) 10] delete /test # å†æ¬¡åˆ é™¤çˆ¶èŠ‚ç‚¹æˆåŠŸ é™„å½• å¯èƒ½æ˜¯æŠŠ ZooKeeper æ¦‚å¿µè®²çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç«  | æ–­å¿µæ¢¦ (desistdaydream.github.io)\nZooKeeperçš„åäºŒè¿é—®ï¼Œä½ é¡¶å¾—äº†å˜›ï¼Ÿ - Jay_huaxiao - åšå®¢å›­ (cnblogs.com)\nZookeeper:æ–°å¢ã€æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤èŠ‚ç‚¹ - ç§‹é£é£’é£’å¹ - åšå®¢å›­ (cnblogs.com)\nä¸€ç¯‡æ–‡ç« ææ‡‚ ZooKeeper çš„é€‰ä¸¾æœºåˆ¶ - æ˜é‡‘ (juejin.cn)\n3. zookeeper é€‰ä¸¾æœºåˆ¶ - ç®€ä¹¦ (jianshu.com)\nZookeeperé€‰ä¸¾ç®—æ³•åŸç†ï¼ˆæ‘˜é€‰ï¼‰ - ç®€ä¹¦ (jianshu.com)\nã€Zookeeperã€‘Zookeeperçš„Leaderé€‰ä¸¾æµç¨‹ - å‘¨äºŒé¸­ - åšå®¢å›­ (cnblogs.com)\nZookeeperï¼šZookeeperçš„ä¸»ä»é€‰ä¸¾æœºåˆ¶-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)\n","wordCount":"3053","inLanguage":"zh","datePublished":"2023-08-29T12:09:35+08:00","dateModified":"2023-08-29T12:09:35+08:00","author":[{"@type":"Person","name":"wz"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://senmer.github.io/zh/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/zh/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://senmer.github.io/zh/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://senmer.github.io/zh/posts/tech title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://senmer.github.io/zh/categories/ title="ğŸ§© åˆ†ç±»"><span>ğŸ§© åˆ†ç±»</span></a></li><li><a href=https://senmer.github.io/zh/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://senmer.github.io/zh/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://senmer.github.io/zh/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/zh/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/zh/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/zh/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>Zookeeper</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2023-08-29
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>3053å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>7åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>wz
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80zookeeper-%e7%ae%80%e4%bb%8b aria-label="ä¸€ã€Zookeeper ç®€ä»‹ï¼š">ä¸€ã€Zookeeper ç®€ä»‹ï¼š</a></li><li><a href=#%e4%ba%8czookeeper-%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af aria-label="äºŒã€Zookeeper ä½¿ç”¨åœºæ™¯ï¼š">äºŒã€Zookeeper ä½¿ç”¨åœºæ™¯ï¼š</a></li><li><a href=#%e4%b8%89zookeeper-%e5%8d%95%e6%9c%ba%e9%83%a8%e7%bd%b2 aria-label="ä¸‰ã€Zookeeper å•æœºéƒ¨ç½²">ä¸‰ã€Zookeeper å•æœºéƒ¨ç½²</a><ul><li><a href=#31-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83 aria-label="3.1 å®éªŒç¯å¢ƒ">3.1 <strong>å®éªŒç¯å¢ƒ</strong></a></li><li><a href=#32-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="3.2 é…ç½® java ç¯å¢ƒ">3.2 é…ç½® java ç¯å¢ƒ</a></li><li><a href=#33-%e9%83%a8%e7%bd%b2-zookeeper aria-label="3.3 éƒ¨ç½² zookeeper">3.3 éƒ¨ç½² zookeeper</a><ul><li><a href=#331-%e4%b8%8b%e8%bd%bd%e5%b9%b6%e8%a7%a3%e5%8e%8b%e8%bd%af%e4%bb%b6%e5%8c%85 aria-label="3.3.1 ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ…">3.3.1 ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ…</a></li><li><a href=#332-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="3.3.2 å‡†å¤‡é…ç½®æ–‡ä»¶">3.3.2 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li></ul></li><li><a href=#34-%e5%90%af%e5%8a%a8-zookeeper-%e6%9c%8d%e5%8a%a1 aria-label="3.4 å¯åŠ¨ zookeeper æœåŠ¡">3.4 å¯åŠ¨ zookeeper æœåŠ¡</a><ul><li><a href=#341-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label="3.4.1 å¯åŠ¨æœåŠ¡">3.4.1 å¯åŠ¨æœåŠ¡</a></li><li><a href=#342-%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81 aria-label="3.4.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€">3.4.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€</a></li><li><a href=#343-%e6%9f%a5%e7%9c%8b%e8%bf%9b%e7%a8%8b%e4%bf%a1%e6%81%af aria-label="3.4.3 æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯">3.4.3 æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯</a></li></ul></li></ul></li><li><a href=#%e5%9b%9bzookeeper-%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2 aria-label="å››ã€Zookeeper é›†ç¾¤éƒ¨ç½²">å››ã€Zookeeper é›†ç¾¤éƒ¨ç½²</a><ul><li><a href=#41-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83 aria-label="4.1 å®éªŒç¯å¢ƒ">4.1 å®éªŒç¯å¢ƒ</a></li><li><a href=#42-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="4.2 é…ç½® Java ç¯å¢ƒ">4.2 é…ç½® Java ç¯å¢ƒ</a></li><li><a href=#43-%e4%b8%8b%e8%bd%bd%e5%b9%b6%e8%a7%a3%e5%8e%8b%e5%ae%89%e8%a3%85%e5%8c%85 aria-label="4.3 ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…">4.3 ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…</a></li><li><a href=#44-%e4%bf%ae%e6%94%b9%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae aria-label="4.4 ä¿®æ”¹é›†ç¾¤é…ç½®">4.4 ä¿®æ”¹é›†ç¾¤é…ç½®</a></li><li><a href=#45-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label="4.5 å¯åŠ¨æœåŠ¡">4.5 å¯åŠ¨æœåŠ¡</a></li></ul></li><li><a href=#%e4%ba%94zookeeper-%e6%95%b0%e6%8d%ae%e5%a2%9e%e5%88%a0%e6%94%b9%e6%9f%a5 aria-label="äº”ã€Zookeeper æ•°æ®å¢åˆ æ”¹æŸ¥">äº”ã€Zookeeper æ•°æ®å¢åˆ æ”¹æŸ¥</a><ul><li><a href=#51-%e8%af%ad%e6%b3%95%e7%ae%80%e4%bb%8b aria-label="5.1 è¯­æ³•ç®€ä»‹">5.1 è¯­æ³•ç®€ä»‹</a></li><li><a href=#52-%e5%ae%9e%e4%be%8b%e6%bc%94%e7%a4%ba aria-label="5.2 å®ä¾‹æ¼”ç¤º">5.2 å®ä¾‹æ¼”ç¤º</a></li></ul></li><li><a href=#%e9%99%84%e5%bd%95 aria-label=é™„å½•>é™„å½•</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=ä¸€zookeeper-ç®€ä»‹>ä¸€ã€Zookeeper ç®€ä»‹ï¼š<a hidden class=anchor aria-hidden=true href=#ä¸€zookeeper-ç®€ä»‹>#</a></h2><p>Apache ZooKeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œæ—¨åœ¨å¸®åŠ©æ„å»ºåˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªé«˜åº¦å¯é çš„ã€å±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼Œç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå­˜å‚¨å’Œç®¡ç†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„é…ç½®ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ã€å‘½åæœåŠ¡ç­‰ã€‚ZooKeeper çš„è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæä¾›å¼ºå¤§çš„åè°ƒã€åŒæ­¥å’Œé€šçŸ¥æœºåˆ¶ï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°é«˜å¯ç”¨æ€§ã€ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚</p><p>ZooKeeper ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><p><strong>åˆ†å¸ƒå¼åè°ƒï¼š</strong> ZooKeeper æä¾›äº†åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­çš„å…±äº«é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯çš„é›†ä¸­å¼å­˜å‚¨ï¼Œä»è€Œå®ç°äº†åˆ†å¸ƒå¼ç³»ç»Ÿçš„åè°ƒã€‚</p></li><li><p><strong>é«˜å¯ç”¨æ€§ï¼š</strong> ZooKeeper çš„è®¾è®¡ç€é‡äºé«˜å¯ç”¨æ€§ï¼Œé€šè¿‡å°†æ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šä»¥å®ç°å®¹é”™å’Œæ•…éšœæ¢å¤ã€‚</p></li><li><p><strong>ä¸€è‡´æ€§ï¼š</strong> ZooKeeper æä¾›äº†å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œç¡®ä¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¿æŒä¸€è‡´çš„è§†å›¾ã€‚</p></li><li><p><strong>é¡ºåºè®¿é—®ï¼š</strong> ZooKeeper ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹ä»¶å¼•å…¥äº†é¡ºåºæ€§ï¼Œä½¿å¾—äº‹ä»¶åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­èƒ½å¤ŸæŒ‰ç…§é¡ºåºè¿›è¡Œå¤„ç†ã€‚</p></li><li><p><strong>é€šçŸ¥æœºåˆ¶ï¼š</strong> ZooKeeper å…è®¸å®¢æˆ·ç«¯æ³¨å†Œç›‘å¬å™¨ä»¥è·å–æœ‰å…³èŠ‚ç‚¹çŠ¶æ€å˜åŒ–çš„é€šçŸ¥ï¼Œä»è€Œå®ç°äº†åˆ†å¸ƒå¼äº‹ä»¶é€šçŸ¥ã€‚</p></li></ol><h2 id=äºŒzookeeper-ä½¿ç”¨åœºæ™¯>äºŒã€Zookeeper ä½¿ç”¨åœºæ™¯ï¼š<a hidden class=anchor aria-hidden=true href=#äºŒzookeeper-ä½¿ç”¨åœºæ™¯>#</a></h2><ol><li><p><strong>åˆ†å¸ƒå¼åè°ƒ</strong>ï¼šZooKeeper æ˜¯æœ€å¸¸è§çš„ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­åè°ƒä»»åŠ¡çš„å·¥å…·ä¹‹ä¸€ã€‚å®ƒå¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ã€åˆ†å¸ƒå¼é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é€‰ä¸¾ç­‰ï¼Œç¡®ä¿ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„æœ‰åºæ“ä½œã€‚</p></li><li><p><strong>é…ç½®ç®¡ç†</strong>ï¼šZooKeeper å¯ä»¥ç”¨äºç®¡ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€æœåŠ¡åœ°å€ç­‰ã€‚åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ç›‘å¬ ZooKeeper ä¸Šçš„é…ç½®èŠ‚ç‚¹æ¥å®ç°åŠ¨æ€é…ç½®æ›´æ–°ã€‚</p></li><li><p><strong>å‘½åæœåŠ¡</strong>ï¼šZooKeeper å¯ä»¥ç”¨ä½œåˆ†å¸ƒå¼å‘½åæœåŠ¡ï¼Œç±»ä¼¼äº DNSï¼Œç”¨äºå°†é€»è¾‘åç§°æ˜ å°„åˆ°å®é™…æœåŠ¡åœ°å€ï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è½»æ¾æŸ¥æ‰¾æœåŠ¡ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼é”</strong>ï¼šZooKeeper æä¾›äº†åˆ†å¸ƒå¼é”çš„å®ç°ï¼Œç”¨äºåè°ƒä¸åŒèŠ‚ç‚¹å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥è®¿é—®è¯¥èµ„æºã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼é˜Ÿåˆ—</strong>ï¼šZooKeeper å¯ä»¥ç”¨äºåˆ›å»ºåˆ†å¸ƒå¼é˜Ÿåˆ—ï¼Œç”¨äºåœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ¶ˆæ¯æˆ–ä»»åŠ¡ï¼Œç¡®ä¿ä»»åŠ¡çš„æœ‰åºæ‰§è¡Œã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼é€šçŸ¥</strong>ï¼šZooKeeper å…è®¸åº”ç”¨ç¨‹åºç›‘å¬ç‰¹å®šçš„èŠ‚ç‚¹ï¼Œä»¥è·å–å…³äºé›†ç¾¤çŠ¶æ€å˜åŒ–çš„é€šçŸ¥ï¼Œä»è€Œå®ç°åŠæ—¶å“åº”å’Œå¤„ç†ã€‚</p></li><li><p><strong>åˆ†å¸ƒå¼åè°ƒæœåŠ¡</strong>ï¼šZooKeeper æœ¬èº«å°±æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå¯ä»¥ç”¨äºç®¡ç†å’Œç»´æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ä¸€è‡´æ€§ã€çŠ¶æ€åŒæ­¥ç­‰ã€‚</p></li><li><p><strong>Leader é€‰ä¸¾</strong>ï¼šZooKeeper å¯ä»¥ç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºé¢†å¯¼è€…ï¼ˆLeaderï¼‰ï¼Œä»¥ç¡®ä¿åœ¨èŠ‚ç‚¹æ•…éšœæ—¶èƒ½å¤Ÿå¿«é€Ÿé€‰ä¸¾æ–°çš„é¢†å¯¼è€…ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼ŒZooKeeper åœ¨æ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿæ—¶èµ·åˆ°äº†å…³é”®çš„åè°ƒå’Œç®¡ç†ä½œç”¨ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¤„ç†åˆ†å¸ƒå¼ç¯å¢ƒä¸­çš„å¤æ‚æ€§å’ŒæŒ‘æˆ˜ã€‚ç„¶è€Œï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼Œä¸€äº›æ›¿ä»£æ–¹æ¡ˆå¦‚ etcdã€Consul ç­‰ä¹Ÿå‡ºç°ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç±»ä¼¼çš„åˆ†å¸ƒå¼åè°ƒå’Œç®¡ç†åŠŸèƒ½ã€‚</p><h2 id=ä¸‰zookeeper-å•æœºéƒ¨ç½²>ä¸‰ã€Zookeeper å•æœºéƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#ä¸‰zookeeper-å•æœºéƒ¨ç½²>#</a></h2><h3 id=31-å®éªŒç¯å¢ƒ>3.1 <strong>å®éªŒç¯å¢ƒ</strong><a hidden class=anchor aria-hidden=true href=#31-å®éªŒç¯å¢ƒ>#</a></h3><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>zookeeper</td><td>10.0.0.10</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><h3 id=32-é…ç½®-java-ç¯å¢ƒ>3.2 é…ç½® java ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#32-é…ç½®-java-ç¯å¢ƒ>#</a></h3><p>è½¯ä»¶ä¾èµ–ï¼š<a href=https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_requiredSoftw>ZooKeeper: Because Coordinating Distributed Systems is a Zoo (apache.org)</a></p><p>å®‰è£… openjdk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper ~<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y java-1.8.0-openjdk</span>
</span></span></code></pre></div><p>æŸ¥çœ‹ç»“æœ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper ~<span style=color:#f92672>]</span><span style=color:#75715e># java -version</span>
</span></span><span style=display:flex><span>openjdk version <span style=color:#e6db74>&#34;1.8.0_382&#34;</span>
</span></span><span style=display:flex><span>OpenJDK Runtime Environment <span style=color:#f92672>(</span>build 1.8.0_382-b05<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>OpenJDK 64-Bit Server VM <span style=color:#f92672>(</span>build 25.382-b05, mixed mode<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=33-éƒ¨ç½²-zookeeper>3.3 éƒ¨ç½² zookeeper<a hidden class=anchor aria-hidden=true href=#33-éƒ¨ç½²-zookeeper>#</a></h3><h4 id=331-ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ…>3.3.1 ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ…<a hidden class=anchor aria-hidden=true href=#331-ä¸‹è½½å¹¶è§£å‹è½¯ä»¶åŒ…>#</a></h4><p>ä¸‹è½½åœ°å€ï¼š<a href=https://archive.apache.org/dist/zookeeper/>Index of /dist/zookeeper (apache.org)</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /usr/local/src
</span></span><span style=display:flex><span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>tar xf zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper
</span></span></code></pre></div><h4 id=332-å‡†å¤‡é…ç½®æ–‡ä»¶>3.3.2 å‡†å¤‡é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#332-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h4><p>è¿™é‡Œä¿æŒé»˜è®¤é…ç½®ï¼Œä¸åšä¿®æ”¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper src<span style=color:#f92672>]</span><span style=color:#75715e># cd zookeeper/conf/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># cp zoo_sample.cfg zoo.cfg</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># ls</span>
</span></span><span style=display:flex><span>configuration.xsl  log4j.properties  zoo.cfg  zoo_sample.cfg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># grep -v ^# zoo.cfg </span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/tmp/zookeeper
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span></code></pre></div><h3 id=34-å¯åŠ¨-zookeeper-æœåŠ¡>3.4 å¯åŠ¨ zookeeper æœåŠ¡<a hidden class=anchor aria-hidden=true href=#34-å¯åŠ¨-zookeeper-æœåŠ¡>#</a></h3><h4 id=341-å¯åŠ¨æœåŠ¡>3.4.1 å¯åŠ¨æœåŠ¡<a hidden class=anchor aria-hidden=true href=#341-å¯åŠ¨æœåŠ¡>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># cd /usr/local/zookeeper/   </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh start</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Starting zookeeper ... STARTED
</span></span></code></pre></div><h4 id=342-æŸ¥çœ‹æœåŠ¡çŠ¶æ€>3.4.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€<a hidden class=anchor aria-hidden=true href=#342-æŸ¥çœ‹æœåŠ¡çŠ¶æ€>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: standalone <span style=color:#75715e># å•æœºæ¨¡å¼</span>
</span></span></code></pre></div><h4 id=343-æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯>3.4.3 æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯<a hidden class=anchor aria-hidden=true href=#343-æŸ¥çœ‹è¿›ç¨‹ä¿¡æ¯>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper-3.4.13<span style=color:#f92672>]</span><span style=color:#75715e># ps -ef | grep zookeeper</span>
</span></span><span style=display:flex><span>root       <span style=color:#ae81ff>8452</span>      <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>2</span> 17:48 pts/0    00:00:00 java -Dzookeeper.log.dir<span style=color:#f92672>=</span>. -Dzookeeper.root.logger<span style=color:#f92672>=</span>INFO,CONSOLE -cp /usr/local/src/zookeeper-3.4.13/bin/../build/classes:/usr/local/src/zookeeper-3.4.13/bin/../build/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/usr/local/src/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/usr/local/src/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../conf: -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only<span style=color:#f92672>=</span>false org.apache.zookeeper.server.quorum.QuorumPeerMain /usr/local/src/zookeeper-3.4.13/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>root       <span style=color:#ae81ff>8498</span>   <span style=color:#ae81ff>8326</span>  <span style=color:#ae81ff>0</span> 17:49 pts/0    00:00:00 grep --color<span style=color:#f92672>=</span>auto zookeeper
</span></span></code></pre></div><h2 id=å››zookeeper-é›†ç¾¤éƒ¨ç½²>å››ã€Zookeeper é›†ç¾¤éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#å››zookeeper-é›†ç¾¤éƒ¨ç½²>#</a></h2><h3 id=41-å®éªŒç¯å¢ƒ>4.1 å®éªŒç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#41-å®éªŒç¯å¢ƒ>#</a></h3><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>zookeeper-01</td><td>10.0.0.11</td><td>CentOS 7.6</td><td>1U 2G</td></tr><tr><td>zookeeper-02</td><td>10.0.0.12</td><td>CentOS 7.6</td><td>1U 2G</td></tr><tr><td>zookeeper-03</td><td>10.0.0.13</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><h3 id=42-é…ç½®-java-ç¯å¢ƒ>4.2 é…ç½® Java ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#42-é…ç½®-java-ç¯å¢ƒ>#</a></h3><p><strong>æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install java-1.8.0-openjdk -y
</span></span><span style=display:flex><span>java -version
</span></span></code></pre></div><h3 id=43-ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…>4.3 ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…<a hidden class=anchor aria-hidden=true href=#43-ä¸‹è½½å¹¶è§£å‹å®‰è£…åŒ…>#</a></h3><p><strong>æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /usr/local/src
</span></span><span style=display:flex><span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>tar xf zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper
</span></span><span style=display:flex><span>mkdir /usr/local/zookeeper/data <span style=color:#75715e># æ•°æ®å­˜æ”¾ç›®å½•ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/conf
</span></span><span style=display:flex><span>cp zoo_sample.cfg zoo.cfg	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>cat &gt; zoo.cfg <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tickTime=2000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>initLimit=10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>syncLimit=5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dataDir=/usr/local/zookeeper/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>clientPort=2181
</span></span></span><span style=display:flex><span><span style=color:#e6db74>maxClientCnxns=4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autopurge.snapRetainCount=128
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autopurge.purgeInterval=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.1=10.0.0.11:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.2=10.0.0.12:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.3=10.0.0.13:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>å‚æ•°è§£é‡Šï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>tickTime</span><span style=color:#f92672>=</span><span style=color:#e6db74>2000 	#æœåŠ¡å™¨ä¸æœåŠ¡å™¨ä¹‹é—´çš„å•æ¬¡å¿ƒè·³æ£€æµ‹æ—¶é—´é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>initLimit</span><span style=color:#f92672>=</span><span style=color:#e6db74>10 	#é›†ç¾¤ä¸­ leader æœåŠ¡å™¨ä¸ follower æœåŠ¡å™¨åˆå§‹è¿æ¥å¿ƒè·³æ¬¡æ•°ï¼Œå³å¤šå°‘ä¸ª 2000 æ¯«ç§’</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>syncLimit</span><span style=color:#f92672>=</span><span style=color:#e6db74>5 	# leader ä¸ follower ä¹‹é—´è¿æ¥å®Œæˆä¹‹åï¼ŒåæœŸæ£€æµ‹å‘é€å’Œåº”ç­”çš„å¿ƒè·³æ¬¡æ•°ï¼Œå¦‚æœè¯¥ follower åœ¨è®¾ç½®çš„æ—¶é—´å†…(5*2000)ä¸èƒ½ä¸ leader è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆæ­¤follower å°†è¢«è§†ä¸ºä¸å¯ç”¨ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dataDir</span><span style=color:#f92672>=</span><span style=color:#e6db74>/usr/local/zookeeper/data #è‡ªå®šä¹‰çš„ zookeeper ä¿å­˜æ•°æ®çš„ç›®å½•</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>clientPort</span><span style=color:#f92672>=</span><span style=color:#e6db74>2181 #å®¢æˆ·ç«¯è¿æ¥ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼ŒZookeeper ä¼šç›‘å¬è¿™ä¸ªç«¯å£ï¼Œæ¥å—å®¢æˆ·ç«¯çš„è®¿é—®è¯·æ±‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>maxClientCnxns</span><span style=color:#f92672>=</span><span style=color:#e6db74>128 	#å•ä¸ªå®¢æˆ·ç«¯ IP å¯ä»¥å’Œ zookeeper ä¿æŒçš„è¿æ¥æ•°</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autopurge.snapRetainCount</span><span style=color:#f92672>=</span><span style=color:#e6db74>3 #3.4.0 ä¸­çš„æ–°å¢åŠŸèƒ½ï¼šå¯ç”¨åï¼ŒZooKeeper è‡ªåŠ¨æ¸…é™¤åŠŸèƒ½ä¼šå°†æœ€æ–°å¿«ç…§å’Œç›¸åº”çš„äº‹åŠ¡æ—¥å¿—åˆ†åˆ«ä¿ç•™åœ¨ dataDir å’Œ dataLogDir ä¸­ï¼Œå¹¶åˆ é™¤å…¶ä½™éƒ¨åˆ†ï¼Œé»˜è®¤å€¼ä¸º 3ã€‚æœ€å°å€¼ä¸º 3ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autopurge.purgeInterval</span><span style=color:#f92672>=</span><span style=color:#e6db74>1 # 3.4.0 åŠä¹‹åç‰ˆæœ¬ï¼ŒZK æä¾›äº†è‡ªåŠ¨æ¸…ç†æ—¥å¿—å’Œå¿«ç…§æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸ª 1 æˆ–æ›´å¤§çš„æ•´æ•°ï¼Œé»˜è®¤æ˜¯ 0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªåŠ¨æ¸…ç†åŠŸèƒ½</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.1</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.11:2888:3888 # server.æœåŠ¡å™¨ç¼–å·=æœåŠ¡å™¨IP:æ•°æ®åŒæ­¥ç«¯å£:é€‰ä¸¾ç«¯å£</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.2</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.12:2888:3888</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.3</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.13:2888:3888</span>
</span></span></code></pre></div><h3 id=44-ä¿®æ”¹é›†ç¾¤é…ç½®>4.4 ä¿®æ”¹é›†ç¾¤é…ç½®<a hidden class=anchor aria-hidden=true href=#44-ä¿®æ”¹é›†ç¾¤é…ç½®>#</a></h3><p><strong>zookeeper-01 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># é…ç½®é›†ç¾¤ ID</span>
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>1</span> &gt; /usr/local/zookeeper/data/myid 
</span></span></code></pre></div><p><strong>zookeeper-02 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /usr/local/zookeeper/data/myid
</span></span></code></pre></div><p><strong>zookeeper-03 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>3</span> &gt; /usr/local/zookeeper/data/myid
</span></span></code></pre></div><h3 id=45-å¯åŠ¨æœåŠ¡>4.5 å¯åŠ¨æœåŠ¡<a hidden class=anchor aria-hidden=true href=#45-å¯åŠ¨æœåŠ¡>#</a></h3><p><strong>zookeeper-01 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#æŸ¥çœ‹é›†ç¾¤è§’è‰²</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-01 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: follower
</span></span></code></pre></div><p><strong>zookeeper-02 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-02 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># ./bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: leader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># leader é¢å¤–å¼€å¯ä¸€ä¸ª 2888 ç«¯å£ç”¨äºåŒæ­¥æ•°æ®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-03 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># ss -ntl|grep 2888</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>50</span>        ::ffff:10.0.0.13:2888                    :::*
</span></span></code></pre></div><p><strong>zookeeper-03 æ‰§è¡Œï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-03 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: follower
</span></span></code></pre></div><h2 id=äº”zookeeper-æ•°æ®å¢åˆ æ”¹æŸ¥>äº”ã€Zookeeper æ•°æ®å¢åˆ æ”¹æŸ¥<a hidden class=anchor aria-hidden=true href=#äº”zookeeper-æ•°æ®å¢åˆ æ”¹æŸ¥>#</a></h2><p>Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¼€æºåè°ƒæœåŠ¡ï¼Œå¸¸ç”¨äºç®¡ç†å’Œç»´æŠ¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é…ç½®ä¿¡æ¯ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼é”ç­‰ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´ï¼ˆç±»ä¼¼äºæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œé€šè¿‡æ ‘çŠ¶ç»“æ„æ¥å­˜å‚¨æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„ Zookeeper å‘½ä»¤ç¤ºä¾‹ï¼Œç”¨äºå¢åˆ æ”¹æŸ¥ Zookeeper ä¸­çš„æ•°æ®èŠ‚ç‚¹ï¼š</p><p><strong>å¯ç”¨çš„å®¢æˆ·ç«¯å·¥å…·</strong>ï¼š<a href=https://github.com/zzhang5/zooinspector>zzhang5/zooinspector: An improved zookeeper inspector (github.com)</a></p><h3 id=51-è¯­æ³•ç®€ä»‹>5.1 è¯­æ³•ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#51-è¯­æ³•ç®€ä»‹>#</a></h3><ol><li><p><strong>è¿æ¥åˆ° Zookeeperï¼š</strong></p><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è¿æ¥åˆ° Zookeeper æœåŠ¡å™¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>zkCli.sh -server &lt;ZOOKEEPER_SERVER&gt;:&lt;PORT&gt;
</span></span></code></pre></div><p>å…¶ä¸­ï¼Œ<code>&lt;ZOOKEEPER_SERVER></code> æ˜¯ Zookeeper æœåŠ¡å™¨çš„åœ°å€ï¼Œ<code>&lt;PORT></code> æ˜¯ Zookeeper æœåŠ¡å™¨çš„ç«¯å£ï¼Œé»˜è®¤ä¸º 2181ã€‚</p></li><li><p><strong>åˆ›å»ºèŠ‚ç‚¹ï¼š</strong></p><p>åœ¨ Zookeeper ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>create</code> å‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>create /mynode <span style=color:#e6db74>&#34;Hello, Zookeeper!&#34;</span>
</span></span></code></pre></div></li><li><p><strong>è·å–èŠ‚ç‚¹æ•°æ®ï¼š</strong></p><p>ä½¿ç”¨ <code>get</code> å‘½ä»¤å¯ä»¥è·å–èŠ‚ç‚¹çš„æ•°æ®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>get /mynode
</span></span></code></pre></div></li><li><p><strong>æ›´æ–°èŠ‚ç‚¹æ•°æ®ï¼š</strong></p><p>ä½¿ç”¨ <code>set</code> å‘½ä»¤æ¥æ›´æ–°èŠ‚ç‚¹çš„æ•°æ®ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>set /mynode <span style=color:#e6db74>&#34;Updated data&#34;</span>
</span></span></code></pre></div></li><li><p><strong>åˆ—å‡ºå­èŠ‚ç‚¹ï¼š</strong></p><p>ä½¿ç”¨ <code>ls</code> å‘½ä»¤åˆ—å‡ºèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ls /path/to/parent_node
</span></span></code></pre></div></li><li><p><strong>åˆ é™¤èŠ‚ç‚¹ï¼š</strong></p><p>ä½¿ç”¨ <code>delete</code> å‘½ä»¤æ¥åˆ é™¤èŠ‚ç‚¹ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>delete /path/to/node
</span></span></code></pre></div></li></ol><h3 id=52-å®ä¾‹æ¼”ç¤º>5.2 å®ä¾‹æ¼”ç¤º<a hidden class=anchor aria-hidden=true href=#52-å®ä¾‹æ¼”ç¤º>#</a></h3><p><strong>è¿æ¥é›†ç¾¤ä¸­çš„ä»»æ„èŠ‚ç‚¹ï¼Œè¿™é‡Œé€‰æ‹© zookeeper-01</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-01 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkCli.sh -server 10.0.0.11</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 2<span style=color:#f92672>]</span> help  <span style=color:#75715e># help æŸ¥çœ‹å¸®åŠ©</span>
</span></span><span style=display:flex><span>ZooKeeper -server host:port cmd args
</span></span><span style=display:flex><span>	stat path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	set path data <span style=color:#f92672>[</span>version<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	ls path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	delquota <span style=color:#f92672>[</span>-n|-b<span style=color:#f92672>]</span> path
</span></span><span style=display:flex><span>	ls2 path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	setAcl path acl
</span></span><span style=display:flex><span>	setquota -n|-b val path
</span></span><span style=display:flex><span>	history 
</span></span><span style=display:flex><span>	redo cmdno
</span></span><span style=display:flex><span>	printwatches on|off
</span></span><span style=display:flex><span>	delete path <span style=color:#f92672>[</span>version<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	sync path
</span></span><span style=display:flex><span>	listquota path
</span></span><span style=display:flex><span>	rmr path
</span></span><span style=display:flex><span>	get path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	create <span style=color:#f92672>[</span>-s<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>-e<span style=color:#f92672>]</span> path data acl
</span></span><span style=display:flex><span>	addauth scheme auth
</span></span><span style=display:flex><span>	quit 
</span></span><span style=display:flex><span>	getAcl path
</span></span><span style=display:flex><span>	close 
</span></span><span style=display:flex><span>	connect host:port
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test <span style=color:#e6db74>&#34;hello&#34;</span>  <span style=color:#75715e># åˆ›å»ºèŠ‚ç‚¹</span>
</span></span><span style=display:flex><span>Created /test
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test	<span style=color:#75715e># æŸ¥çœ‹èŠ‚ç‚¹å†…å®¹</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTING<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> ls /test <span style=color:#75715e># æŸ¥çœ‹èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> create /test/app1 <span style=color:#75715e># åˆ›å»ºèŠ‚ç‚¹ï¼Œä½†æœªç»™å‡ºå€¼</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 2<span style=color:#f92672>]</span> ls /test/app1 <span style=color:#75715e># å®é™…æœªåˆ›å»ºæˆåŠŸ</span>
</span></span><span style=display:flex><span>Node does not exist: /test/app1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 3<span style=color:#f92672>]</span> create /test/app1 <span style=color:#e6db74>&#34;my first app&#34;</span> <span style=color:#75715e># å†æ¬¡åˆ›å»ºå­èŠ‚ç‚¹å¹¶èµ‹å€¼</span>
</span></span><span style=display:flex><span>Node already exists: /test/app1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 4<span style=color:#f92672>]</span> ls /test/app1 <span style=color:#75715e># åˆ›å»ºæˆåŠŸ                  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 5<span style=color:#f92672>]</span> ls /test/app1/ <span style=color:#75715e># æŸ¥çœ‹èŠ‚ç‚¹ï¼Œæœ«å°¾ä¸èƒ½å¸¦ &#39;/&#39;</span>
</span></span><span style=display:flex><span>Command failed: java.lang.IllegalArgumentException: Path must not end with / character
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 6<span style=color:#f92672>]</span> set /test <span style=color:#e6db74>&#34;world&#34;</span> <span style=color:#75715e># æ›´æ–°èŠ‚ç‚¹çš„å€¼</span>
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000010
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:28:38 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x80000000d
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 7<span style=color:#f92672>]</span> get /test <span style=color:#75715e># å†æ¬¡æŸ¥çœ‹ï¼Œæ›´æ–°æˆåŠŸ</span>
</span></span><span style=display:flex><span>world
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000012
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:28:38 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x80000000d
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 8<span style=color:#f92672>]</span> delete /test <span style=color:#75715e># åˆ é™¤èŠ‚ç‚¹ï¼Œå› ä¸ºå­˜åœ¨å­—èŠ‚çš„ï¼Œæ‰€ä»¥åˆ é™¤å¤±è´¥</span>
</span></span><span style=display:flex><span>Node not empty: /test
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 9<span style=color:#f92672>]</span> delete /test/app1 <span style=color:#75715e># å…ˆåˆ é™¤å­èŠ‚ç‚¹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 10<span style=color:#f92672>]</span> delete /test <span style=color:#75715e># å†æ¬¡åˆ é™¤çˆ¶èŠ‚ç‚¹æˆåŠŸ</span>
</span></span></code></pre></div><h2 id=é™„å½•>é™„å½•<a hidden class=anchor aria-hidden=true href=#é™„å½•>#</a></h2><p><a href=https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/%E5%8F%AF%E8%83%BD%E6%98%AF%E6%8A%8A-ZooKeeper-%E6%A6%82%E5%BF%B5%E8%AE%B2%E7%9A%84%E6%9C%80%E6%B8%85%E6%A5%9A%E7%9A%84%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/>å¯èƒ½æ˜¯æŠŠ ZooKeeper æ¦‚å¿µè®²çš„æœ€æ¸…æ¥šçš„ä¸€ç¯‡æ–‡ç«  | æ–­å¿µæ¢¦ (desistdaydream.github.io)</a></p><p><a href=https://www.cnblogs.com/jay-huaxiao/p/13599519.html>ZooKeeperçš„åäºŒè¿é—®ï¼Œä½ é¡¶å¾—äº†å˜›ï¼Ÿ - Jay_huaxiao - åšå®¢å›­ (cnblogs.com)</a></p><p><a href=https://www.cnblogs.com/wwjj4811/p/12929807.html>Zookeeper:æ–°å¢ã€æŸ¥çœ‹ã€ä¿®æ”¹ã€åˆ é™¤èŠ‚ç‚¹ - ç§‹é£é£’é£’å¹ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href=https://juejin.cn/post/6996657348802510878>ä¸€ç¯‡æ–‡ç« ææ‡‚ ZooKeeper çš„é€‰ä¸¾æœºåˆ¶ - æ˜é‡‘ (juejin.cn)</a></p><p><a href=https://www.jianshu.com/p/4ae3bb8fd71c>3. zookeeper é€‰ä¸¾æœºåˆ¶ - ç®€ä¹¦ (jianshu.com)</a></p><p><a href=https://www.jianshu.com/p/c2ced54736aa>Zookeeperé€‰ä¸¾ç®—æ³•åŸç†ï¼ˆæ‘˜é€‰ï¼‰ - ç®€ä¹¦ (jianshu.com)</a></p><p><a href=https://www.cnblogs.com/jojop/p/14319464.html>ã€Zookeeperã€‘Zookeeperçš„Leaderé€‰ä¸¾æµç¨‹ - å‘¨äºŒé¸­ - åšå®¢å›­ (cnblogs.com)</a></p><p><a href=https://cloud.tencent.com/developer/article/2183968>Zookeeperï¼šZookeeperçš„ä¸»ä»é€‰ä¸¾æœºåˆ¶-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com)</a></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://senmer.github.io/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://senmer.github.io/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://senmer.github.io/zh/posts/tech/kafka/kafka%E7%AE%80%E4%BB%8B%E4%B8%8E%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Kafkaç®€ä»‹ä¸é›†ç¾¤éƒ¨ç½²</span>
</a><a class=next href=https://senmer.github.io/zh/posts/tech/ansible/ansible/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Ansible</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'ğŸ‘‰å±•å¼€è¯„è®º';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'ğŸ‘‡å…³é—­è¯„è®º';color:var(--content)}</style><div><details class=comments_details open><summary style=display:none></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>