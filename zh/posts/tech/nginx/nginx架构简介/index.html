<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nginx架构简介 | WZ's Blog</title><meta name=keywords content="Nginx"><meta name=description content="Nginx基础架构和功能简介"><meta name=author content="wz"><link rel=canonical href=https://senmer.github.io/zh/posts/tech/nginx/nginx%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Nginx架构简介"><meta property="og:description" content="Nginx基础架构和功能简介"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/zh/posts/tech/nginx/nginx%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-19T11:54:58+00:00"><meta property="article:modified_time" content="2022-07-19T11:54:58+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nginx架构简介"><meta name=twitter:description content="Nginx基础架构和功能简介"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://senmer.github.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"👨🏻‍💻 技术","item":"https://senmer.github.io/zh/posts/tech/"},{"@type":"ListItem","position":3,"name":"Nginx架构简介","item":"https://senmer.github.io/zh/posts/tech/nginx/nginx%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nginx架构简介","name":"Nginx架构简介","description":"Nginx基础架构和功能简介\n","keywords":["Nginx"],"articleBody":"Nginx基础架构和功能简介\nNginx架构 Nginx 概述 Nginx 介绍 **Nginx：**engine X ，2002年开发，分为社区版和商业版(nginx plus )\n2019年3月11日 F5 Networks 6.7亿美元的价格收购\nNginx是免费的、开源的、高性能的HTTP和反向代理服务器、邮件代理服务器、以及TCP/UDP代理服务器解决了C10K问题（10K Connections），参考链接: http://www.ideawu.net/blog/archives/740.html\n**Nginx官网：**http://nginx.org （社区版），https://www.nginx.com/（商业版）\nnginx的其它的二次发行版：\n**Tengine：**由淘宝网发起的Web服务器项目。它在Nginx的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如淘宝网，天猫商城等得到了很好的检验。它的最终目标是打造一个高效、稳定、安全、易用的Web平台。从2011年12月开始，Tengine成为一个开源项目，官网: http://tengine.taobao.org/\n**OpenResty：**基于 Nginx 与 Lua 语言的高性能 Web 平台， 章亦春团队开发，官网：http://openresty.org/cn/\nNginx 功能介绍 静态的web资源服务器，如 html，图片，js，css，txt 等静态资源 基于http/https协议的反向代理（七层） 结合FastCGI/uWSGI/SCGI等协议反向代理动态资源请求 基于tcp/udp协议反向代理（四层） imap4/pop3协议的反向代理（邮件服务器） Nginx 基础特性 模块化设计，较好的扩展性 高可靠性 支持热部署：不停机更新配置文件，升级版本，更换日志文件 低内存消耗：10000个keep-alive连接模式下的非活动连接，仅需2.5M内存 支持多种IO模型和零拷贝技术：event-driven, aio, mmap，sendfile Web 服务相关的功能 虚拟主机（server） 支持 keep-alive 和管道连接(利用一个连接做多次请求) 访问日志（支持基于日志缓冲提高其性能） url rewirte 路径别名 基于IP及用户的访问控制 支持速率限制及并发数限制 重新配置和在线升级而无须中断客户的工作进程 Nginx 架构和进程 Nginx 架构 Nginx 进程结构 web请求处理机制\n多进程方式：服务器每接收到一个客户端请求就有服务器的主进程生成一个子进程响应客户端，直到用户关闭连接，这样的优势是处理速度快，子进程之间相互独立，但是如果访问过大会导致服务器资源耗尽而无法提供请求。 多线程方式：与多进程方式类似，但是每收到一个客户端请求会有服务进程派生出一个线程来个客户方进行交互，一个线程的开销远远小于一个进程，因此多线程方式在很大程度减轻了web服务器对系统资源的要求，但是多线程也有自己的缺点，即当多个线程位于同一个进程内工作的时候，可以相互访问同样的内存地址空间，所以他们相互影响，一旦主进程挂掉则所有子线程都不能工作了，IIS服务器使用了多线程的方式，需要间隔一段时间就重启一次才能稳定。 Nginx是多进程组织模型，而且是一个由Master主进程和Worker工作进程组成。\n主进程(master process)的功能：\n对外接口：接收外部的操作（信号） 对内转发：根据外部的操作的不同，通过信号管理 Worker 监控：监控 worker 进程的运行状态，worker 进程异常终止后，自动重启 worker 进程 读取Nginx 配置文件并验证其有效性和正确性 建立、绑定和关闭socket连接 按照配置生成、管理和结束工作进程 接受外界指令，比如重启、升级及退出服务器等指令 不中断服务，实现平滑升级，重启服务并应用新的配置 开启日志文件，获取文件描述符 不中断服务，实现平滑升级，升级失败进行回滚处理 编译和处理perl脚本 工作进程（worker process）的功能：\n所有 Worker 进程都是平等的 实际处理：网络请求，由 Worker 进程处理 Worker进程数量：一般设置为核心数，充分利用CPU资源，同时避免进程数量过多，导致进程竞争CPU资源，增加上下文切换的损耗 接受处理客户的请求, 将请求依次送入各个功能模块进行处理 I/O调用，获取响应数据 与后端服务器通信，接收后端服务器的处理结果 缓存数据，访问缓存索引，查询和调用缓存数据 发送请求结果，响应客户的请求 接收主程序指令，比如重启、升级和退出等 Nginx 工作流程\nNginx 进程间通信 工作进程是由主进程生成的，主进程使用fork()函数，在Nginx服务器启动过程中主进程根据配置文件决定启动工作进程的数量，然后建立一张全局的工作表用于存放当前未退出的所有的工作进程，主进程生成工作进程后会将新生成的工作进程加入到工作进程表中，并建立一个单向的管道并将其传递给工作进程，该管道与普通的管道不同，它是由主进程指向工作进程的单向通道，包含了主进程向工作进程发出的指令、工作进程ID、工作进程在工作进程表中的索引和必要的文件描述符等信息。主进程与外界通过信号机制进行通信，当接收到需要处理的信号时，它通过管道向相关的工作进程发送正确的指令，每个工作进程都有能力捕获管道中的可读事件，当管道中有可读事件的时候，工作进程就会从管道中读取并解析指令，然后采取相应的执行动作，这样就完成了主进程与工作进程的交互。\nworker进程之间的通信原理基本上和主进程与worker进程之间的通信是一样的，只要worker进程之间能够取得彼此的信息，建立管道即可通信，但是由于worker进程之间是完全隔离的，因此一个进程想要知道另外一个进程的状态信息,就只能通过主进程来实现。 为了实现worker进程之间的交互，master进程在生成worker进程之后，在worker进程表中进行遍历，将该新进程的PID以及针对该进程建立的管道句柄传递给worker进程中的其他进程，为worker进程之间的通信做准备，当worker进程1向worker进程2发送指令的时候，首先在master进程给它的其他worker进程工作信息中找到2的进程PID，然后将正确的指令写入指向进程2的管道，worker进程2捕获到管道中的事件后，解析指令并进行相关操作，这样就完成了worker进程之间的通信。 此外worker进程可以通过共享内存来通讯，比如upstream中的zone，或者limit_req、limit_conn中的zone等。操作系统提供了共享内存机制。 Nginx 启动和HTTP连接建立 Nginx 启动时，Master 进程，加载配置文件 Master 进程，初始化监听的 socket Master 进程，fork 出多个 Worker 进程 Worker 进程，竞争新的连接，获胜方通过三次握手，建立 Socket 连接，并处理请求 HTTP 请求处理流程 Nginx 模块介绍 nginx 有多种模块\n核心模块：是 Nginx 服务器正常运行必不可少的模块，提供错误日志记录 、配置文件解析 、事件\n驱动机制 、进程管理等核心功能\n标准HTTP模块：提供 HTTP 协议解析相关的功能，比如： 端口配置 、 网页编码设置 、 HTTP响应\n头设置 等等\n可选HTTP模块：主要用于扩展标准的 HTTP 功能，让 Nginx 能处理一些特殊的服务，比如： Flash\n多媒体传输 、解析 GeoIP 请求、 网络传输压缩 、 安全协议 SSL 支持等\n邮件服务模块：主要用于支持 Nginx 的 邮件服务 ，包括对 POP3 协议、 IMAP 协议和 SMTP协议\n的支持\nStream服务模块: 实现反向代理功能,包括TCP协议代理\n第三方模块：是为了扩展 Nginx 服务器应用，完成开发者自定义功能，比如： Json 支持、 Lua 支\n持等\nnginx高度模块化，但其模块早期不支持DSO机制;1.9.11 版本支持动态装载和卸载\n模块分类：\n核心模块：core module 标准模块： HTTP 模块：ngx_http_* HTTP Core modules #默认功能 HTTP Optional modules #需编译时指定 Mail 模块: ngx_mail_* Stream 模块 ngx_stream_* 第三方模块 ","wordCount":"3036","inLanguage":"zh","datePublished":"2022-07-19T11:54:58Z","dateModified":"2022-07-19T11:54:58Z","author":{"@type":"Person","name":"wz"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/zh/posts/tech/nginx/nginx%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://senmer.github.io/zh/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/zh/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://senmer.github.io/zh/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://senmer.github.io/zh/posts/tech title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://senmer.github.io/zh/categories/ title="🧩 分类"><span>🧩 分类</span></a></li><li><a href=https://senmer.github.io/zh/archives/ title="⏱️ 时间轴"><span>⏱️ 时间轴</span></a></li><li><a href=https://senmer.github.io/zh/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://senmer.github.io/zh/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/zh/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/zh/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/zh/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>Nginx架构简介</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2022-07-19
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>3036字
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>7分钟
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>wz
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://senmer.github.io/zh/tags/nginx/ style=color:var(--secondary)!important>Nginx</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#nginx%e6%9e%b6%e6%9e%84 aria-label=Nginx架构>Nginx架构</a><ul><li><a href=#nginx-%e6%a6%82%e8%bf%b0 aria-label="Nginx 概述">Nginx 概述</a><ul><li><a href=#nginx-%e4%bb%8b%e7%bb%8d aria-label="Nginx 介绍">Nginx 介绍</a></li><li><a href=#nginx-%e5%8a%9f%e8%83%bd%e4%bb%8b%e7%bb%8d aria-label="Nginx 功能介绍"><strong>Nginx</strong> <strong>功能介绍</strong></a></li><li><a href=#nginx-%e5%9f%ba%e7%a1%80%e7%89%b9%e6%80%a7 aria-label="Nginx 基础特性">Nginx 基础特性</a></li><li><a href=#web--%e6%9c%8d%e5%8a%a1%e7%9b%b8%e5%85%b3%e7%9a%84%e5%8a%9f%e8%83%bd aria-label="Web 服务相关的功能"><strong>Web 服务相关的功能</strong></a></li></ul></li><li><a href=#nginx-%e6%9e%b6%e6%9e%84%e5%92%8c%e8%bf%9b%e7%a8%8b aria-label="Nginx 架构和进程">Nginx 架构和进程</a><ul><li><a href=#nginx-%e6%9e%b6%e6%9e%84 aria-label="Nginx 架构">Nginx 架构</a></li><li><a href=#nginx-%e8%bf%9b%e7%a8%8b%e7%bb%93%e6%9e%84 aria-label="Nginx 进程结构">Nginx 进程结构</a></li><li><a href=#nginx-%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1 aria-label="Nginx 进程间通信">Nginx 进程间通信</a></li><li><a href=#nginx-%e5%90%af%e5%8a%a8%e5%92%8chttp%e8%bf%9e%e6%8e%a5%e5%bb%ba%e7%ab%8b aria-label="Nginx 启动和HTTP连接建立">Nginx 启动和HTTP连接建立</a></li><li><a href=#http-%e8%af%b7%e6%b1%82%e5%a4%84%e7%90%86%e6%b5%81%e7%a8%8b aria-label="HTTP 请求处理流程">HTTP 请求处理流程</a></li></ul></li><li><a href=#nginx-%e6%a8%a1%e5%9d%97%e4%bb%8b%e7%bb%8d aria-label="Nginx 模块介绍">Nginx 模块介绍</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>Nginx基础架构和功能简介</p><h1 id=nginx架构>Nginx架构<a hidden class=anchor aria-hidden=true href=#nginx架构>#</a></h1><h2 id=nginx-概述>Nginx 概述<a hidden class=anchor aria-hidden=true href=#nginx-概述>#</a></h2><h3 id=nginx-介绍>Nginx 介绍<a hidden class=anchor aria-hidden=true href=#nginx-介绍>#</a></h3><p>**Nginx：**engine X ，2002年开发，分为社区版和商业版(nginx plus )</p><p>2019年3月11日 F5 Networks 6.7亿美元的价格收购</p><p>Nginx是免费的、开源的、高性能的HTTP和反向代理服务器、邮件代理服务器、以及TCP/UDP代理服务器解决了C10K问题（10K Connections），参考链接: <a href=http://www.ideawu.net/blog/archives/740.html>http://www.ideawu.net/blog/archives/740.html</a></p><p>**Nginx官网：**<a href=http://nginx.org>http://nginx.org</a> （社区版），https://www.nginx.com/（商业版）</p><p><strong>nginx的其它的二次发行版：</strong></p><p>**Tengine：**由淘宝网发起的Web服务器项目。它在Nginx的基础上，针对大访问量网站的需求，添加了很多高级功能和特性。Tengine的性能和稳定性已经在大型的网站如淘宝网，天猫商城等得到了很好的检验。它的最终目标是打造一个高效、稳定、安全、易用的Web平台。从2011年12月开始，Tengine成为一个开源项目，官网: <a href=http://tengine.taobao.org/>http://tengine.taobao.org/</a></p><p>**OpenResty：**基于 Nginx 与 Lua 语言的高性能 Web 平台， 章亦春团队开发，官网：http://openresty.org/cn/</p><h3 id=nginx-功能介绍><strong>Nginx</strong> <strong>功能介绍</strong><a hidden class=anchor aria-hidden=true href=#nginx-功能介绍>#</a></h3><ul><li>静态的web资源服务器，如 html，图片，js，css，txt 等静态资源</li><li>基于http/https协议的反向代理（七层）</li><li>结合FastCGI/uWSGI/SCGI等协议反向代理动态资源请求</li><li>基于tcp/udp协议反向代理（四层）</li><li>imap4/pop3协议的反向代理（邮件服务器）</li></ul><h3 id=nginx-基础特性>Nginx 基础特性<a hidden class=anchor aria-hidden=true href=#nginx-基础特性>#</a></h3><ul><li>模块化设计，较好的扩展性</li><li>高可靠性</li><li>支持热部署：不停机更新配置文件，升级版本，更换日志文件</li><li>低内存消耗：10000个keep-alive连接模式下的非活动连接，仅需2.5M内存</li><li>支持多种IO模型和零拷贝技术：event-driven, aio, mmap，sendfile</li></ul><h3 id=web--服务相关的功能><strong>Web 服务相关的功能</strong><a hidden class=anchor aria-hidden=true href=#web--服务相关的功能>#</a></h3><ul><li>虚拟主机（server）</li><li>支持 keep-alive 和管道连接(利用一个连接做多次请求)</li><li>访问日志（支持基于日志缓冲提高其性能）</li><li>url rewirte</li><li>路径别名</li><li>基于IP及用户的访问控制</li><li>支持速率限制及并发数限制</li><li>重新配置和在线升级而无须中断客户的工作进程</li></ul><h2 id=nginx-架构和进程>Nginx 架构和进程<a hidden class=anchor aria-hidden=true href=#nginx-架构和进程>#</a></h2><h3 id=nginx-架构>Nginx 架构<a hidden class=anchor aria-hidden=true href=#nginx-架构>#</a></h3><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/25.png alt=Nginx架构></p><h3 id=nginx-进程结构>Nginx 进程结构<a hidden class=anchor aria-hidden=true href=#nginx-进程结构>#</a></h3><p><strong>web请求处理机制</strong></p><ul><li>多进程方式：服务器每接收到一个客户端请求就有服务器的主进程生成一个子进程响应客户端，直到用户关闭连接，这样的优势是处理速度快，子进程之间相互独立，但是如果访问过大会导致服务器资源耗尽而无法提供请求。</li><li>多线程方式：与多进程方式类似，但是每收到一个客户端请求会有服务进程派生出一个线程来个客户方进行交互，一个线程的开销远远小于一个进程，因此多线程方式在很大程度减轻了web服务器对系统资源的要求，但是多线程也有自己的缺点，即当多个线程位于同一个进程内工作的时候，可以相互访问同样的内存地址空间，所以他们相互影响，一旦主进程挂掉则所有子线程都不能工作了，IIS服务器使用了多线程的方式，需要间隔一段时间就重启一次才能稳定。</li></ul><p><strong>Nginx是多进程组织模型，而且是一个由Master主进程和Worker工作进程组成。</strong></p><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/26.png alt=nginx进程模型></p><p><strong>主进程(master process)的功能：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>对外接口：接收外部的操作（信号）
</span></span><span style=display:flex><span>对内转发：根据外部的操作的不同，通过信号管理 Worker
</span></span><span style=display:flex><span>监控：监控 worker 进程的运行状态，worker 进程异常终止后，自动重启 worker 进程
</span></span><span style=display:flex><span>读取Nginx 配置文件并验证其有效性和正确性
</span></span><span style=display:flex><span>建立、绑定和关闭socket连接
</span></span><span style=display:flex><span>按照配置生成、管理和结束工作进程
</span></span><span style=display:flex><span>接受外界指令，比如重启、升级及退出服务器等指令
</span></span><span style=display:flex><span>不中断服务，实现平滑升级，重启服务并应用新的配置
</span></span><span style=display:flex><span>开启日志文件，获取文件描述符
</span></span><span style=display:flex><span>不中断服务，实现平滑升级，升级失败进行回滚处理
</span></span><span style=display:flex><span>编译和处理perl脚本
</span></span></code></pre></div><p><strong>工作进程（worker process）的功能：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>所有 Worker 进程都是平等的
</span></span><span style=display:flex><span>实际处理：网络请求，由 Worker 进程处理
</span></span><span style=display:flex><span>Worker进程数量：一般设置为核心数，充分利用CPU资源，同时避免进程数量过多，导致进程竞争CPU资源，增加上下文切换的损耗
</span></span><span style=display:flex><span>接受处理客户的请求, 将请求依次送入各个功能模块进行处理
</span></span><span style=display:flex><span>I/O调用，获取响应数据
</span></span><span style=display:flex><span>与后端服务器通信，接收后端服务器的处理结果
</span></span><span style=display:flex><span>缓存数据，访问缓存索引，查询和调用缓存数据
</span></span><span style=display:flex><span>发送请求结果，响应客户的请求
</span></span><span style=display:flex><span>接收主程序指令，比如重启、升级和退出等
</span></span></code></pre></div><p><strong>Nginx 工作流程</strong></p><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/27.png alt=Nginx工作流程></p><h3 id=nginx-进程间通信>Nginx 进程间通信<a hidden class=anchor aria-hidden=true href=#nginx-进程间通信>#</a></h3><p>工作进程是由主进程生成的，主进程使用fork()函数，在Nginx服务器启动过程中主进程根据配置文件决定启动工作进程的数量，然后建立一张全局的工作表用于存放当前未退出的所有的工作进程，主进程生成工作进程后会将新生成的工作进程加入到工作进程表中，并建立一个单向的管道并将其传递给工作进程，该管道与普通的管道不同，它是由主进程指向工作进程的单向通道，包含了主进程向工作进程发出的指令、工作进程ID、工作进程在工作进程表中的索引和必要的文件描述符等信息。主进程与外界通过信号机制进行通信，当接收到需要处理的信号时，它通过管道向相关的工作进程发送正确的指令，每个工作进程都有能力捕获管道中的可读事件，当管道中有可读事件的时候，工作进程就会从管道中读取并解析指令，然后采取相应的执行动作，这样就完成了主进程与工作进程的交互。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>worker进程之间的通信原理基本上和主进程与worker进程之间的通信是一样的，只要worker进程之间能够取得彼此的信息，建立管道即可通信，但是由于worker进程之间是完全隔离的，因此一个进程想要知道另外一个进程的状态信息,就只能通过主进程来实现。
</span></span><span style=display:flex><span>为了实现worker进程之间的交互，master进程在生成worker进程之后，在worker进程表中进行遍历，将该新进程的PID以及针对该进程建立的管道句柄传递给worker进程中的其他进程，为worker进程之间的通信做准备，当worker进程1向worker进程2发送指令的时候，首先在master进程给它的其他worker进程工作信息中找到2的进程PID，然后将正确的指令写入指向进程2的管道，worker进程2捕获到管道中的事件后，解析指令并进行相关操作，这样就完成了worker进程之间的通信。
</span></span><span style=display:flex><span>此外worker进程可以通过共享内存来通讯，比如upstream中的zone，或者limit_req、limit_conn中的zone等。操作系统提供了共享内存机制。
</span></span></code></pre></div><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/28.png alt=master与work的通信过程></p><h3 id=nginx-启动和http连接建立>Nginx 启动和HTTP连接建立<a hidden class=anchor aria-hidden=true href=#nginx-启动和http连接建立>#</a></h3><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/29.png alt=Nginx处理http请求></p><ul><li>Nginx 启动时，Master 进程，加载配置文件</li><li>Master 进程，初始化监听的 socket</li><li>Master 进程，fork 出多个 Worker 进程</li><li>Worker 进程，竞争新的连接，获胜方通过三次握手，建立 Socket 连接，并处理请求</li></ul><h3 id=http-请求处理流程>HTTP 请求处理流程<a hidden class=anchor aria-hidden=true href=#http-请求处理流程>#</a></h3><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/30.png alt=http请求处理流程></p><h2 id=nginx-模块介绍>Nginx 模块介绍<a hidden class=anchor aria-hidden=true href=#nginx-模块介绍>#</a></h2><p>nginx 有多种模块</p><ul><li><p>核心模块：是 Nginx 服务器正常运行必不可少的模块，提供错误日志记录 、配置文件解析 、事件</p><p>驱动机制 、进程管理等核心功能</p></li><li><p>标准HTTP模块：提供 HTTP 协议解析相关的功能，比如： 端口配置 、 网页编码设置 、 HTTP响应</p><p>头设置 等等</p></li><li><p>可选HTTP模块：主要用于扩展标准的 HTTP 功能，让 Nginx 能处理一些特殊的服务，比如： Flash</p><p>多媒体传输 、解析 GeoIP 请求、 网络传输压缩 、 安全协议 SSL 支持等</p></li><li><p>邮件服务模块：主要用于支持 Nginx 的 邮件服务 ，包括对 POP3 协议、 IMAP 协议和 SMTP协议</p><p>的支持</p></li><li><p>Stream服务模块: 实现反向代理功能,包括TCP协议代理</p></li><li><p>第三方模块：是为了扩展 Nginx 服务器应用，完成开发者自定义功能，比如： Json 支持、 Lua 支</p><p>持等</p></li></ul><p>nginx高度模块化，但其模块早期不支持DSO机制;1.9.11 版本支持动态装载和卸载</p><p><strong>模块分类：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>核心模块：core module
</span></span><span style=display:flex><span>标准模块：
</span></span><span style=display:flex><span> HTTP 模块：ngx_http_*
</span></span><span style=display:flex><span>           HTTP Core modules   #默认功能
</span></span><span style=display:flex><span>           HTTP Optional modules #需编译时指定
</span></span><span style=display:flex><span> Mail 模块: ngx_mail_*
</span></span><span style=display:flex><span> Stream 模块 ngx_stream_*
</span></span><span style=display:flex><span>第三方模块
</span></span></code></pre></div><p><img loading=lazy src=/images/Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b/31.png alt=Nginx模块分类></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://senmer.github.io/zh/posts/tech/nginx/nginx%E5%AE%89%E8%A3%85/><span class=title>« 上一页</span><br><span>Nginx安装</span></a>
<a class=next href=https://senmer.github.io/zh/posts/tech/linux/io%E6%A8%A1%E5%9E%8B%E4%B8%8E%E9%9B%B6%E6%8B%B7%E8%B4%9D/><span class=title>下一页 »</span><br><span>IO模型与零拷贝</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on twitter" href="https://twitter.com/intent/tweet/?text=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b&amp;url=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f&amp;hashtags=Nginx"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f&amp;title=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b&amp;summary=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b&amp;source=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f&title=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on whatsapp" href="https://api.whatsapp.com/send?text=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b%20-%20https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginx架构简介 on telegram" href="https://telegram.me/share/url?text=Nginx%e6%9e%b6%e6%9e%84%e7%ae%80%e4%bb%8b&amp;url=https%3a%2f%2fsenmer.github.io%2fzh%2fposts%2ftech%2fnginx%2fnginx%25E6%259E%25B6%25E6%259E%2584%25E7%25AE%2580%25E4%25BB%258B%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><style>.comments_details summary::marker{font-size:20px;content:'👉展开评论';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'👇关闭评论';color:var(--content)}</style><div><details class=comments_details open><summary style=display:none></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2023
<a href=https://senmer.github.io/zh/ style=color:#939393>WZ's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0"></a></span>
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>