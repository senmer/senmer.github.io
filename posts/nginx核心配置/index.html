<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Nginx核心配置 - Daben's Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="Nginx核心配置"><meta property="og:description" content="主要介绍Nginx核心配置文件"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-25T14:36:53+00:00"><meta property="article:modified_time" content="2022-07-25T14:36:53+00:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nginx核心配置"><meta name=twitter:description content="主要介绍Nginx核心配置文件"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/><link rel=prev href=https://senmer.github.io/posts/nginx%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7/><link rel=next href=https://senmer.github.io/posts/nginx%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Nginx核心配置","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/senmer.github.io\/posts\/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE\/"},"genre":"posts","keywords":"Nginx","wordcount":10564,"url":"https:\/\/senmer.github.io\/posts\/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE\/","datePublished":"2022-07-25T14:36:53+00:00","dateModified":"2022-07-25T14:36:53+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">My cool site</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">My cool site</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Nginx核心配置</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>作者</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/nginx/><i class="far fa-folder fa-fw" aria-hidden=true></i>Nginx</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-07-25>2022-07-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 10564 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 22 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#nginx-配置文件组成>nginx 配置文件组成：</a></li><li><a href=#nginx-配置文件格式说明>nginx 配置文件格式说明：</a></li><li><a href=#nginx-主配置文件指令格式>nginx 主配置文件指令格式：</a></li><li><a href=#主配置文件结构四部分>主配置文件结构：四部分</a></li></ul><ul><li><a href=#全局配置说明>全局配置说明</a></li></ul><ul><li><ul><li><a href=#mime>MIME</a></li><li><a href=#指定响应报文>指定响应报文</a></li></ul></li></ul><ul><li><ul><li><a href=#虚拟主机的实现>虚拟主机的实现</a></li><li><a href=#localtion-的匹配规则>localtion 的匹配规则</a></li><li><a href=#匹配案例-精确匹配>匹配案例-精确匹配</a></li><li><a href=#匹配案例-区分大小写>匹配案例-区分大小写</a></li><li><a href=#匹配案例-不区分大小写>匹配案例-不区分大小写</a></li><li><a href=#nginx-四层访问控制>nginx 四层访问控制</a></li><li><a href=#nginx-账户认证功能>nginx 账户认证功能</a></li><li><a href=#自定义错误页面>自定义错误页面</a></li><li><a href=#自定义错误日志>自定义错误日志</a></li><li><a href=#检测文件是否存在>检测文件是否存在</a></li><li><a href=#长连接配置>长连接配置</a></li><li><a href=#作为下载服务器>作为下载服务器</a></li><li><a href=#作为上传服务器>作为上传服务器</a></li><li><a href=#其他配置>其他配置</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=主要介绍nginx核心配置文件>主要介绍Nginx核心配置文件</h1><h1 id=配置文件说明>配置文件说明</h1><p>nginx 官方文档：http://nginx.org/en/docs/</p><h2 id=nginx-配置文件组成>nginx 配置文件组成：</h2><ul><li>主配置文件： nginx.conf</li><li>子配置文件： conf.d/*.conf</li><li>fastcgi,， uwsgi，scgi 等协议的相关配置文件</li><li>mime.types：支持的mime类型，MIME（Multipurpose Internet Mail Extensions）多用途互联网邮件扩展类型，MIME消息能包含文本、图像、音频、视频以及其他应用程序专用的数据，是设定某种扩展名的文件用指定应用程序来打开的方式类型，当带有某种扩展名的文件被访问的时候，浏览器会自动使用指定应用程序打开（比如：应用程序会被下载，文本文件会直接显示内容）。简单来说，MIME就是利用扩展名标识文件类型，然后根据文件的类型做响应的处理。MIME 参考文档：https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types</li></ul><h2 id=nginx-配置文件格式说明>nginx 配置文件格式说明：</h2><ul><li>配置文件由指令和指令块构成</li><li>每条指令以分号；结束，指令和值之间以空格分隔</li><li>多条指令可以放在同一行，以分号分隔。但可读性差，不推荐这样配置</li><li>指令块以{ } 括号作为开始和结束的标识，将多条指令组织在一起，且支持嵌套</li><li>可通过include引入其他配置文件内容，提升配置文件的可维护性（如子配置文件conf.d/*.conf)</li><li>配置文件使用# 作为注释符，使用$引用变量</li><li>部分指令的参数支持正则表达式</li></ul><h2 id=nginx-主配置文件指令格式>nginx 主配置文件指令格式：</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>directive value [value1 ...];
</span></span><span class=line><span class=cl>说明：
</span></span><span class=line><span class=cl>1、指令必须以分号；结束
</span></span><span class=line><span class=cl>2、支持变量：
</span></span><span class=line><span class=cl>   1）内建变量：由Nginx模块引入，可直接引用
</span></span><span class=line><span class=cl>   2）自定义变量：由用户使用set指定定义，格式： set  variable<span class=nb>_</span>name value;
</span></span><span class=line><span class=cl>   3) 引用变量的方式：<span class=s>$</span><span class=nb>variable_name
</span></span></span></code></pre></div><h2 id=主配置文件结构四部分>主配置文件结构：四部分</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>main block：主配置段，即全局配置段，对http,mail都有效
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#事件驱动相关的配置
</span></span><span class=line><span class=cl>event <span class=nb>{</span>
</span></span><span class=line><span class=cl> ...
</span></span><span class=line><span class=cl><span class=nb>}</span>   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#http/https 协议相关配置段
</span></span><span class=line><span class=cl>http <span class=nb>{</span>
</span></span><span class=line><span class=cl> ...
</span></span><span class=line><span class=cl><span class=nb>}</span>      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#默认配置文件不包括下面两个块
</span></span><span class=line><span class=cl>#mail 协议相关配置段
</span></span><span class=line><span class=cl>mail <span class=nb>{</span>
</span></span><span class=line><span class=cl> ...
</span></span><span class=line><span class=cl><span class=nb>}</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#stream 服务器相关配置段
</span></span><span class=line><span class=cl>stream <span class=nb>{</span>
</span></span><span class=line><span class=cl> ...
</span></span><span class=line><span class=cl><span class=nb>}</span>
</span></span></code></pre></div><p>默认的nginx.conf 配置文件说明</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>##全局配置块，对全局生效。主要设置nginx的启动用户/组，启动的工作进程数量，工作模式，nginx的pid文件路径等。</span>
</span></span><span class=line><span class=cl>user nginx nginx<span class=p>;</span>
</span></span><span class=line><span class=cl>worker_processes 1<span class=p>;</span> <span class=c1>#启动工作进程的数量，一般与CPU核心数一致</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##events块，主要影响nginx服务器与用户的网络连接，比如是否允许同时接受多个网络连接，使用哪种事件驱动模型，每个工作进程最大支持并发连接数，是否开启对多工作进程下的网络连接进行序列化等。</span>
</span></span><span class=line><span class=cl>events <span class=o>{</span>
</span></span><span class=line><span class=cl>	worker_connections 1024<span class=p>;</span> <span class=c1>#单个worker进程的最大并发连接数。作为web服务器时，nginx的最大并发数为：worker_connections * worker_processes。作为反向代理的时候为（worker_connections * worker_processes）/2</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##http块是nginx服务器配置中的重要组成部分，缓存、代理和日志格式定义等绝大多数功能和第三方模块都在这里配置。http块可以包含多个server块，而一个server块又可以包含多个location块，server块可以配置文件引入、MIME-Type定义、日志自定义、是否启用sendfile、连接超时时间和单个链接的请求上限等。</span>
</span></span><span class=line><span class=cl>http <span class=o>{</span>
</span></span><span class=line><span class=cl>	include			mime.types<span class=p>;</span>
</span></span><span class=line><span class=cl>	default_type 	application/ostet-stream<span class=p>;</span>
</span></span><span class=line><span class=cl>	sendfile		on<span class=p>;</span> 	<span class=c1>#作为web服务器时打开sendfile加快静态文件传输，指定是否使用sendfile系统调用传输文件。sendfile系统调用在两个文件描述符之间直接传递数据（完全在内核空间进程），从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝，效率很高，是零拷贝技术的一种。</span>
</span></span><span class=line><span class=cl>	keepalive_timeout 65<span class=p>;</span> 	<span class=c1>#长连接超时时间，单位：秒</span>
</span></span><span class=line><span class=cl>	<span class=c1>##server块可用于配置虚拟主机，有自己的全局配置，可以包含多个location块。可配置本虚拟机监听的端口，设置虚拟机名称，多个server监听同一个端口。</span>
</span></span><span class=line><span class=cl>	server <span class=o>{</span>
</span></span><span class=line><span class=cl>		listen 			80<span class=p>;</span> <span class=c1>#监听端口</span>
</span></span><span class=line><span class=cl>		server_name<span class=p>;</span>	localhost<span class=p>;</span> <span class=c1>#server的域名，配置多个虚拟主机时用到</span>
</span></span><span class=line><span class=cl>		location / <span class=o>{</span>
</span></span><span class=line><span class=cl>			root	html<span class=p>;</span>
</span></span><span class=line><span class=cl>			index	index.html index.htm<span class=p>;</span> <span class=c1>#网站默认主页</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>		error_page <span class=m>500</span> <span class=m>502</span> <span class=m>503</span> <span class=m>504</span> /50x.html<span class=p>;</span> <span class=c1>#错误页面</span>
</span></span><span class=line><span class=cl>		<span class=c1>##location处理对应的不同错误码的页面定义到50x.html，指示了50.html文件所在目录</span>
</span></span><span class=line><span class=cl>		<span class=nv>location</span> <span class=o>=</span> /50x.html <span class=o>{</span> 	
</span></span><span class=line><span class=cl>        	root	html<span class=p>;</span>   <span class=c1>#错误页面文件所在目录</span>
</span></span><span class=line><span class=cl>		<span class=o>}</span>
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=c1>##和邮件相关的配置</span>
</span></span><span class=line><span class=cl>    <span class=c1>#mail {</span>
</span></span><span class=line><span class=cl>    <span class=c1>#               ...</span>
</span></span><span class=line><span class=cl>    <span class=c1>#}         mail 协议相关配置段</span>
</span></span><span class=line><span class=cl>    <span class=c1>#tcp代理配置，1.9版本以上支持</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#stream {</span>
</span></span><span class=line><span class=cl>    <span class=c1>#               ...</span>
</span></span><span class=line><span class=cl>    <span class=c1>#}       stream 服务器相关配置段</span>
</span></span><span class=line><span class=cl>    <span class=c1>#导入其他路径的配置文件</span>
</span></span><span class=line><span class=cl>    <span class=c1>#include /apps/nginx/conf.d/*.conf</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h1 id=全局配置>全局配置</h1><p>main 全局配置块常见的配置指令分类</p><ul><li>正常运行必备的配置</li><li>优化性能相关的配置</li><li>用于调试定位问题相关的配置</li><li>事件驱动相关的配置</li></ul><h2 id=全局配置说明>全局配置说明</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>user	nginx nginx<span class=p>;</span> <span class=c1>#启动nginx工作进程的用户和组</span>
</span></span><span class=line><span class=cl>worker_processes <span class=o>[</span>number <span class=p>|</span> auto<span class=o>]</span><span class=p>;</span> <span class=c1>#启动nginx工作进程的数量，一般和CPU核心数相同</span>
</span></span><span class=line><span class=cl>worker_cpu_affinity <span class=m>00000001</span> <span class=m>00000010</span> <span class=m>00000100</span> 00001000<span class=p>;</span> <span class=c1>#将Nginx工作进程绑定到指定的CPU核心，默认Nginx是不进行进程绑定的，绑定并不是意味着当前nginx进程独占以一核心CPU，但是可以保证此进程不会运行在其他核心上，这就极大减少了nginx的工作进程在不同的cpu核心上的来回跳转，减少了CPU对进程的资源分配与回收以及内存管理等，因此可以有效的提升nginx服务器的性能。</span>
</span></span><span class=line><span class=cl>CPU MASK: 00000001：0号CPU
</span></span><span class=line><span class=cl>          00000010：1号CPU
</span></span><span class=line><span class=cl>  		  10000000：7号CPU
</span></span><span class=line><span class=cl>  		  
</span></span><span class=line><span class=cl><span class=c1>##示例:</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># egrep &#34;processes|affinity&#34; nginx.conf</span>
</span></span><span class=line><span class=cl>worker_processes 4<span class=p>;</span>	 <span class=c1>#启动四个worker进程</span>
</span></span><span class=line><span class=cl>worker_cpu_affinity <span class=m>0001</span> 0010<span class=p>;</span>   <span class=c1>#将workr进程绑定到 0号CPU和1号CPU</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># lscpu | grep CPU\(s\)   # CPU核数为2</span>
</span></span><span class=line><span class=cl>CPU<span class=o>(</span>s<span class=o>)</span>:                <span class=m>2</span>
</span></span><span class=line><span class=cl>On-line CPU<span class=o>(</span>s<span class=o>)</span> list:   0,1
</span></span><span class=line><span class=cl>NUMA node0 CPU<span class=o>(</span>s<span class=o>)</span>:     0,1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># nginx -t  #语法检查出现警告，因为worker进程数比CPU核心数多。多出的worker进程将绑定在‘上一个CPU核心‘也即0010上。对于‘上一个CPU核心’（last mask for remaining worker）的解释： processes：nginx分别将worker进程绑定到worker_cpu_affinity 指定的CPU核心上（从左至右的顺序），而从第三个work进程起并未指定对应的CPU核心，因此全部绑定到‘上一个CPU核心’ 0010这个CPU核心。</span>
</span></span><span class=line><span class=cl>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: <span class=o>[</span>warn<span class=o>]</span> the number of <span class=s2>&#34;worker_processes&#34;</span> is not equal to the number of <span class=s2>&#34;worker_cpu_affinity&#34;</span> masks, using last mask <span class=k>for</span> remaining worker processes
</span></span><span class=line><span class=cl>nginx: configuration file /apps/nginx/conf/nginx.conf <span class=nb>test</span> is successful
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># ps axo pid,cmd,psr | grep nginx</span>
</span></span><span class=line><span class=cl>   <span class=m>827</span> nginx: master process /apps   <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1226</span> nginx: worker process         <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1227</span> nginx: worker process         <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=m>1228</span> nginx: worker process         <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=m>1229</span> nginx: worker process         <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=m>1249</span> grep --color<span class=o>=</span>auto nginx       <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#将worker进程数量改为2</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># vim nginx.conf</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># egrep &#34;processes|affinity&#34; nginx.conf</span>
</span></span><span class=line><span class=cl>worker_processes 2<span class=p>;</span>
</span></span><span class=line><span class=cl>worker_cpu_affinity <span class=m>0001</span> 0010<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#语法检查不再警告</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># nginx -s reload  </span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># nginx -t</span>
</span></span><span class=line><span class=cl>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok
</span></span><span class=line><span class=cl>nginx: configuration file /apps/nginx/conf/nginx.conf <span class=nb>test</span> is successful
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># ps axo pid,cmd,psr | grep nginx</span>
</span></span><span class=line><span class=cl>   <span class=m>827</span> nginx: master process /apps   <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=m>1261</span> nginx: worker process         <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1262</span> nginx: worker process         <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=m>1265</span> grep --color<span class=o>=</span>auto nginx       <span class=m>1</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=c1>#错误日志记录配置，语法：error_log file [debug | info | notice | warn | error | crit | alert | emerg]  #括号内为日志记录详细级别（从左至右逐渐提高）</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##示例配置</span>
</span></span><span class=line><span class=cl><span class=c1>#error_log logs/error.log;</span>
</span></span><span class=line><span class=cl><span class=c1>#error_log logs/error.log notice;</span>
</span></span><span class=line><span class=cl>error_log /apps/nginx/logs/error.log error<span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#pid文件保存路径</span>
</span></span><span class=line><span class=cl>pid       /apps/nginx/logs/nginx.pid<span class=p>;</span>
</span></span><span class=line><span class=cl>worker_priority 0<span class=p>;</span> <span class=c1>#工作进程优先级，-20~20(19)</span>
</span></span><span class=line><span class=cl>worker_rlimit_nofile 65536<span class=p>;</span> <span class=c1>#所有worker进程能打开的文件数量上限,包括:Nginx的所有连接（例如与代理服务器的连接等），而不仅仅是与客户端的连接。该值最好与ulimit -n 或者limits.conf的值保持一致,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#通过pam限制文件打开数量上限</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@centos8 ~<span class=o>]</span><span class=c1>#cat /etc/security/limits.conf</span>
</span></span><span class=line><span class=cl>*               soft   nofile          <span class=m>1000000</span>
</span></span><span class=line><span class=cl>*               hard   nofile          <span class=m>1000000</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#worker进程优先级</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># grep priority nginx.conf</span>
</span></span><span class=line><span class=cl>worker_priority 0<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@test conf<span class=o>]</span><span class=c1># ps -axo pid,cmd,nice | grep nginx</span>
</span></span><span class=line><span class=cl>   <span class=m>827</span> nginx: master process /apps   <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1391</span> nginx: worker process         <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1392</span> nginx: worker process         <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=m>1449</span> grep --color<span class=o>=</span>auto nginx       <span class=m>0</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>daemon off<span class=p>;</span>  <span class=c1>#前台运行Nginx服务，通常在测试环境或者docker环境中使用</span>
</span></span><span class=line><span class=cl>master_process off<span class=p>|</span>on<span class=p>;</span> <span class=c1>#是否开启Nginx的master-worker工作模式，仅用于开发调试场景,默认为on</span>
</span></span><span class=line><span class=cl>events <span class=o>{</span>
</span></span><span class=line><span class=cl>   worker_connections  65536<span class=p>;</span>  <span class=c1>#设置单个工作进程的最大并发连接数</span>
</span></span><span class=line><span class=cl>   use epoll<span class=p>;</span> <span class=c1>#使用epoll事件驱动，Nginx支持众多的事件驱动，比如:select、poll、epoll，只能设置在events模块中设置。</span>
</span></span><span class=line><span class=cl>   accept_mutex on<span class=p>;</span> <span class=c1>#on为同一时刻一个请求轮流由work进程处理,而防止被同时唤醒所有worker,避免多个睡眠进程被唤醒的设置，默认为off，新请求会唤醒所有worker进程,此过程也称为&#34;惊群&#34;，因此nginx刚安装完以后要进行适当的优化。建议设置为on</span>
</span></span><span class=line><span class=cl>   multi_accept on<span class=p>;</span> <span class=c1>#on时Nginx服务器的每个工作进程可以同时接受多个新的网络连接，此指令默认为off，即默认为一个工作进程只能一次接受一个新的网络连接，打开后几个同时接受多个。建议设置为on</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>范例：实现nginx的高并发配置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost conf<span class=o>]</span><span class=c1># ulimit -n </span>
</span></span><span class=line><span class=cl><span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf<span class=o>]</span><span class=c1># cat /apps/nginx/conf/nginx.conf | grep rlimit</span>
</span></span><span class=line><span class=cl>worker_rlimit_nofile 100<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#默认配置不支持高并发，当worker_rlimit_nofile设置的值大于ulimit -n的值,会出现以下错误日志</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf<span class=o>]</span><span class=c1># ab -c 5000 -n 10000 http://127.0.0.1/</span>
</span></span><span class=line><span class=cl>This is ApacheBench, Version 2.3 &lt;<span class=nv>$Revision</span>: <span class=m>1430300</span> $&gt;
</span></span><span class=line><span class=cl>Copyright <span class=m>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span class=line><span class=cl>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Benchmarking 127.0.0.1 <span class=o>(</span>be patient<span class=o>)</span>
</span></span><span class=line><span class=cl>socket: Too many open files <span class=o>(</span>24<span class=o>)</span>     <span class=c1>#打开的文件描述符过多</span>
</span></span></code></pre></div><h1 id=http-配置块>http 配置块</h1><p>http 协议相关的配置结构</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http <span class=o>{</span>
</span></span><span class=line><span class=cl>	...
</span></span><span class=line><span class=cl> 	...  
</span></span><span class=line><span class=cl> 	server <span class=o>{</span>    <span class=c1>#每个server用于定义一个虚拟主机,第一个server为默认虚拟服务器</span>
</span></span><span class=line><span class=cl> 		...
</span></span><span class=line><span class=cl>	<span class=o>}</span>
</span></span><span class=line><span class=cl> 	server <span class=o>{</span>     
</span></span><span class=line><span class=cl> 		...
</span></span><span class=line><span class=cl> 		server_name   <span class=c1>#虚拟主机名</span>
</span></span><span class=line><span class=cl>        root     <span class=c1>#主目录</span>
</span></span><span class=line><span class=cl>        <span class=nb>alias</span>     <span class=c1>#路径别名</span>
</span></span><span class=line><span class=cl>        location <span class=o>[</span>OPERATOR<span class=o>]</span> URL <span class=o>{</span>     <span class=c1>#指定URL的特性</span>
</span></span><span class=line><span class=cl>         	...
</span></span><span class=line><span class=cl>            <span class=k>if</span> CONDITION <span class=o>{</span>
</span></span><span class=line><span class=cl>            ...
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl> 		<span class=o>}</span>
</span></span><span class=line><span class=cl> 	<span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>http 协议配置说明</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http <span class=o>{</span>
</span></span><span class=line><span class=cl>   include       mime.types<span class=p>;</span> <span class=c1>#导入支持的文件类型,是相对于/apps/nginx/conf目录</span>
</span></span><span class=line><span class=cl>   default_type  application/octet-stream<span class=p>;</span> <span class=c1>#除mime.types中文件类型外,设置其它文件默认类型，访问其它类型时会提示下载不匹配的类型文件</span>
</span></span><span class=line><span class=cl><span class=c1>#日志配置部分</span>
</span></span><span class=line><span class=cl>    <span class=c1>#log_format main  &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#                 &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#                 &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#access_log logs/access.log main;</span>
</span></span><span class=line><span class=cl><span class=c1>#自定义优化参数</span>
</span></span><span class=line><span class=cl>   	sendfile       on<span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=c1>#tcp_nopush    on; #在开启了sendfile的情况下，合并请求后统一发送给客户端,必须开启sendfile</span>
</span></span><span class=line><span class=cl>    <span class=c1>#tcp_nodelay   off; #在开启了keepalived模式下的连接是否启用TCP_NODELAY选项，当为off时，延迟0.2s发送，默认On时，不延迟发送，立即发送用户响应报文。</span>
</span></span><span class=line><span class=cl>    <span class=c1>#keepalive_timeout 0;</span>
</span></span><span class=line><span class=cl>  	keepalive_timeout  <span class=m>65</span> 66<span class=p>;</span> <span class=c1>#设置会话保持时间,第二个值为响应首部:keep-Alived:timeout=65,可以和第一个值不同</span>
</span></span><span class=line><span class=cl>    <span class=c1>#gzip on; #开启文件压缩</span>
</span></span><span class=line><span class=cl>    server <span class=o>{</span>
</span></span><span class=line><span class=cl>    	listen       80<span class=p>;</span> <span class=c1>#设置监听地址和端口</span>
</span></span><span class=line><span class=cl>       	server_name localhost<span class=p>;</span> <span class=c1>#设置server name，可以以空格隔开写多个并支持正则表达式，如:*.magedu.com www.magedu.* ~^www\d+\.magedu\.com$ default_server </span>
</span></span><span class=line><span class=cl>       	<span class=c1>#charset koi8-r; #设置编码格式，默认是俄语格式，建议改为utf-8</span>
</span></span><span class=line><span class=cl>       	<span class=c1>#access_log logs/host.access.log main;</span>
</span></span><span class=line><span class=cl>        location / <span class=o>{</span>
</span></span><span class=line><span class=cl>           root   html<span class=p>;</span>
</span></span><span class=line><span class=cl>           index index.html index.htm<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>#error_page 404             /404.html;</span>
</span></span><span class=line><span class=cl>        <span class=c1># redirect server error pages to the static page /50x.html</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        error_page   <span class=m>500</span> <span class=m>502</span> <span class=m>503</span> <span class=m>504</span> /50x.html<span class=p>;</span> <span class=c1>#定义错误页面</span>
</span></span><span class=line><span class=cl>        <span class=nv>location</span> <span class=o>=</span> /50x.html <span class=o>{</span>
</span></span><span class=line><span class=cl>           root   html<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=c1># proxy the PHP scripts to Apache listening on 127.0.0.1:80</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#location ~ \.php$ { #以http的方式转发php请求到指定web服务器</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   proxy_pass   http://127.0.0.1;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#}</span>
</span></span><span class=line><span class=cl>        <span class=c1># pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#location ~ \.php$ { #以fastcgi的方式转发php请求到php处理</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   root           html;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   fastcgi_pass   127.0.0.1:9000;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   fastcgi_index index.php;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   include       fastcgi_params;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#}</span>
</span></span><span class=line><span class=cl>        <span class=c1># deny access to .htaccess files, if Apache&#39;s document root</span>
</span></span><span class=line><span class=cl>        <span class=c1># concurs with nginx&#39;s one</span>
</span></span><span class=line><span class=cl>        <span class=c1>#</span>
</span></span><span class=line><span class=cl>        <span class=c1>#location ~ /\.ht { #拒绝web形式访问指定文件，如很多的网站都是通过.htaccess文件来改变自己的重定向等功能。</span>
</span></span><span class=line><span class=cl>        <span class=c1>#   deny all;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#}</span>
</span></span><span class=line><span class=cl>       location ~ /passwd.html <span class=o>{</span>
</span></span><span class=line><span class=cl>           deny all<span class=p>;</span>
</span></span><span class=line><span class=cl>       <span class=o>}</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=c1># another virtual host using mix of IP-, name-, and port-based configuration</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=c1>#server { #自定义虚拟server</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   listen       8000;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   listen       somename:8080;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   server_name somename alias another.alias;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   location / { </span>
</span></span><span class=line><span class=cl>    <span class=c1>#       root   html;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#       index index.html index.htm; #指定默认网页文件，此指令由ngx_http_index_module模块提供</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   }</span>
</span></span><span class=line><span class=cl>    <span class=c1>#}</span>
</span></span><span class=line><span class=cl>    <span class=c1># HTTPS server</span>
</span></span><span class=line><span class=cl>    <span class=c1>#</span>
</span></span><span class=line><span class=cl>    <span class=c1>#server { #https服务器配置</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   listen       443 ssl;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   server_name localhost;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_certificate     cert.pem;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_certificate_key cert.key;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_session_cache   shared:SSL:1m;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_session_timeout 5m;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_ciphers HIGH:!aNULL:!MD5;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   ssl_prefer_server_ciphers on;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   location / {</span>
</span></span><span class=line><span class=cl>    <span class=c1>#       root   html;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#       index index.html index.htm;</span>
</span></span><span class=line><span class=cl>    <span class=c1>#   }</span>
</span></span><span class=line><span class=cl>    <span class=c1>#}</span>
</span></span></code></pre></div><h3 id=mime>MIME</h3><p>MIME参考文档：
<a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types target=_blank rel="noopener noreffer">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#在响应报文中将指定的文件扩展名映射至MIME对应的类型</span>
</span></span><span class=line><span class=cl>include          mime.types<span class=p>;</span>
</span></span><span class=line><span class=cl>default_type     application/octet-stream<span class=p>;</span><span class=c1>#除mime.types中的类型外，指定其它文件的默认MIME类型，浏览器一般会提示下载</span>
</span></span><span class=line><span class=cl>types <span class=o>{</span>
</span></span><span class=line><span class=cl>	text/html html<span class=p>;</span>
</span></span><span class=line><span class=cl>    image/gif gif<span class=p>;</span>
</span></span><span class=line><span class=cl>    image/jpeg jpg<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#未定义mime.types类型</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># ll html/mime.types</span>
</span></span><span class=line><span class=cl>ls: cannot access html/mime.types: No such file or directory
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># curl localhost/test.php -I</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>28</span> Jul <span class=m>2022</span> 11:23:54 GMT
</span></span><span class=line><span class=cl>Content-Type: application/octet-stream  <span class=c1>#mime未定义的类型默认视为二进制文件处理（如果是浏览器访问，则会下载test.php文件）</span>
</span></span><span class=line><span class=cl>Content-Length: <span class=m>20</span>
</span></span><span class=line><span class=cl>Last-Modified: Thu, <span class=m>28</span> Jul <span class=m>2022</span> 11:19:48 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>  <span class=c1>#长连接显示的时长，由keepalive_timeout  65 66; 配置</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e270d4-14&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#修改默认文件类型</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># cat conf/nginx.conf | grep default_type</span>
</span></span><span class=line><span class=cl>    default_type  text/html<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># curl localhost/test.php -I</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Thu, <span class=m>28</span> Jul <span class=m>2022</span> 11:32:15 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html     <span class=c1>#将test.php识别为文本文件（如果是浏览器访问，直接显示文件内容）</span>
</span></span><span class=line><span class=cl>Content-Length: <span class=m>20</span>
</span></span><span class=line><span class=cl>Last-Modified: Thu, <span class=m>28</span> Jul <span class=m>2022</span> 11:19:48 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e270d4-14&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span></code></pre></div><h3 id=指定响应报文>指定响应报文</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#是否在响应报文中的Content-Type显示指定的字符集，默认off不显示</span>
</span></span><span class=line><span class=cl>charset charset <span class=p>|</span> off<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#示例</span>
</span></span><span class=line><span class=cl>charset utf-8<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#是否在响应报文的Server首部显示nginx版本</span>
</span></span><span class=line><span class=cl>server_tokens on <span class=p>|</span> off <span class=p>|</span> build <span class=p>|</span> string<span class=p>;</span>
</span></span></code></pre></div><p>范例：源码修改server字段</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#如果想自定义响应报文的nginx版本信息，需要修改源码文件，重新编译</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#如果server_tokens on，修改 src/core/nginx.h 修改第13-14行，如下示例</span>
</span></span><span class=line><span class=cl><span class=c1>#define NGINX_VERSION     &#34;1.68.9&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#define NGINX_VER         &#34;mynginx/&#34; NGINX_VERSION</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#如果server_tokens off，修改 src/http/ngx_http_header_filter_module.c 第49行，如下示例：</span>
</span></span><span class=line><span class=cl>static char ngx_http_server_string<span class=o>[]</span> <span class=o>=</span> <span class=s2>&#34;Server: nginx&#34;</span> CRLF<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#把其中的nginx改为自己想要的文字即可,如：mynginx</span>
</span></span></code></pre></div><h1 id=核心配置示例>核心配置示例</h1><h3 id=虚拟主机的实现>虚拟主机的实现</h3><p>基于不同的IP、不同的端口以及不用域名实现不同的虚拟主机，依赖于核心模块ngx_http_core_module实现。</p><h4 id=新建两个虚拟主机>新建两个虚拟主机</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 添加域名解析</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat /etc/hosts |grep test</span>
</span></span><span class=line><span class=cl>172.16.16.88   pc.test.org  mobile.test.org
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>## 开始新建虚拟主机</span>
</span></span><span class=line><span class=cl>root@localhost nginx<span class=o>]</span><span class=c1># mkdir /apps/nginx/conf/conf.d</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost nginx<span class=o>]</span><span class=c1># cd /apps/nginx/conf/conf.d/</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># vim /apps/nginx/conf/nginx.conf</span>
</span></span><span class=line><span class=cl>   ......
</span></span><span class=line><span class=cl>   include /apps/nginx/conf.d/*.conf<span class=p>;</span> <span class=c1>#在配置文件的最后面添加此行,注意不要放在最前面,会导致前面的配置无法生效（文件配置从上到下依次生效）</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># mkdir /apps/nginx/html/pc</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># echo pc_page &gt; /apps/nginx/html/pc/index.html</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># curl pc.test.org   #虚拟主机pc</span>
</span></span><span class=line><span class=cl>pc_page
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat mobile.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name mobile.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/mobile<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># mkdir /apps/nginx/html/mobile  #虚拟主机mobile</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># echo mobile_page &gt; /apps/nginx/html/mobile/index.html</span>
</span></span><span class=line><span class=cl>mobile_page
</span></span></code></pre></div><h4 id=root-与-alias-的区别>root 与 alias 的区别</h4><p>root：指定web的家目录，在定义location的时候，文件的绝对路径等于 root+location</p><p>范例:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location /about <span class=o>{</span>
</span></span><span class=line><span class=cl>    root /opt/html<span class=p>;</span>   <span class=c1>#实际路径为/opt/html/about/index.html</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># ll /opt/html/about/</span>
</span></span><span class=line><span class=cl>total <span class=m>4</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>11</span> Jul <span class=m>28</span> 23:24 index.html
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat /opt/html/about/index.html </span>
</span></span><span class=line><span class=cl>about_page
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># curl pc.test.org/about/</span>
</span></span><span class=line><span class=cl>about_page
</span></span></code></pre></div><p>alias：定义路径别名，会把访问的路径重新定义到其指定的路径,文档映射的另一种机制;仅能用于location上下文,此指令使用较少</p><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location /about <span class=o>{</span>
</span></span><span class=line><span class=cl>     <span class=nb>alias</span> /opt/html<span class=p>;</span>  <span class=c1>#实际路径为/opt/html/index.html</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># cat /opt/html/index.html </span>
</span></span><span class=line><span class=cl>about_page
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost conf.d<span class=o>]</span><span class=c1># curl pc.test.org/about/</span>
</span></span><span class=line><span class=cl>about_page
</span></span></code></pre></div><h3 id=localtion-的匹配规则>localtion 的匹配规则</h3><p>在一个server中location配置段可存在多个，用于实现从uri到文件系统的路径映射；ngnix会根据用户请</p><p>求的URI来检查定义的所有location，按一定的优先级找出一个最佳匹配，而后进行处理。</p><p>location 官方帮助: <a href=http://nginx.org/en/docs/http/ngx_http_core_module.html#location target=_blank rel="noopener noreffer">http://nginx.org/en/docs/http/ngx_http_core_module.html#location</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#语法规则：</span>
</span></span><span class=line><span class=cl>location <span class=o>[</span> <span class=o>=</span> <span class=p>|</span> ~ <span class=p>|</span> ~* <span class=p>|</span> ^~ <span class=o>]</span> uri <span class=o>{</span> ... <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>=</span>   <span class=c1>#用于标准uri前，需要请求字串与uri精确匹配，大小敏感,如果匹配成功就停止向下匹配并立即处理请求</span>
</span></span><span class=line><span class=cl>^~  <span class=c1>#用于标准uri前，表示包含正则表达式,并且匹配以指定的正则表达式开头,对URI的最左边部分做匹配检查，不区分字符大小写</span>
</span></span><span class=line><span class=cl>~   <span class=c1>#用于标准uri前，表示包含正则表达式,并且区分大小写</span>
</span></span><span class=line><span class=cl>~*  <span class=c1>#用于标准uri前，表示包含正则表达式,并且不区分大小写</span>
</span></span><span class=line><span class=cl>不带符号 <span class=c1>#匹配起始于此uri的所有的uri</span>
</span></span><span class=line><span class=cl><span class=se>\ </span>  <span class=c1>#用于标准uri前，表示包含正则表达式并且转义字符。可以将 . * ?等转义为普通符号</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#匹配优先级从高到低：</span>
</span></span><span class=line><span class=cl><span class=o>=</span>, ^~, ~/~*, 不带符号
</span></span></code></pre></div><p>官方范例</p><pre tabindex=0><code>location = / {
   [ configuration A ]
}
location / {
   [ configuration B ]
}
location /documents/ {
   [ configuration C ]
}
location ^~ /images/ {
   [ configuration D ]
}
location ~* \.(gif|jpg|jpeg)$ {
   [ configuration E ]
}
The “/” request will match configuration A(?), the “/index.html” request will 
match configuration B,
the “/documents/document.html” request will match configuration C, the 
“/images/1.gif” request will match configuration D, and the “/documents/1.jpg” 
request will match configuration E.
</code></pre><h3 id=匹配案例-精确匹配>匹配案例-精确匹配</h3><p>在server部分使用location配置一个web界面，例如：当访问nginx服务器的/logo.jpg的时候要显示指定html文件的内容</p><p>精确匹配一般用于匹配网站logo等相对固定的URL</p><p>范例：精确匹配</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location /logo.jpg <span class=o>{</span>
</span></span><span class=line><span class=cl>     root html/images<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># ll /apps/nginx/html/images/logo.jpg </span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>13110</span> Jul <span class=m>29</span> 15:11 /apps/nginx/html/images/logo.jpg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问成功</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># curl pc.test.org/logo.jpg -I</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 15:17:35 GMT
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>Content-Length: <span class=m>13110</span>
</span></span><span class=line><span class=cl>Last-Modified: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 07:11:49 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e38835-3336&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span></code></pre></div><h3 id=匹配案例-区分大小写>匹配案例-区分大小写</h3><p>~ 实现区分大小写的模糊匹配</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location ~ /A.?<span class=se>\.</span>jpg <span class=o>{</span>   <span class=c1>#匹配字母A开头的jpg图片，后面?表示A后面零次或一个字符</span>
</span></span><span class=line><span class=cl>     root html/images<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#确保资源存在</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># ll /apps/nginx/html/images/A.jpg </span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>13110</span> Jul <span class=m>29</span> 15:11 /apps/nginx/html/images/A.jpg
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#以大写URI访问成功</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># curl -I pc.test.org/A.jpg</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 15:27:52 GMT
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>Content-Length: <span class=m>13110</span>
</span></span><span class=line><span class=cl>Last-Modified: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 07:11:49 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e38835-3336&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#以小写URI访问失败</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># curl -I pc.test.org/a.jpg</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>404</span> Not Found
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 15:27:55 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html
</span></span><span class=line><span class=cl>Content-Length: <span class=m>153</span>
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span></code></pre></div><h3 id=匹配案例-不区分大小写>匹配案例-不区分大小写</h3><p>~* 用来对用户请求的uri做模糊匹配。</p><p>注意：尽管匹配时不区分大小写，但实际请求是仍会以用户请求的uri去寻找相应的磁盘文件，如用户访问uri为/A.jpg，在location条件通过后就在对应路径下寻找磁盘中的A.jpg文件，如果磁盘上是a.jpg，则请求是失败的（在window系统中，文件名不区分大小写，该请求会成功——受文件系统影响）。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  location ~* /A.?<span class=se>\.</span>jpg <span class=o>{</span>  <span class=c1>#匹配规则不区分大小写</span>
</span></span><span class=line><span class=cl>     root html/images<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># ll /apps/nginx/html/images/a.jpg  #磁盘中仅存在a.jpg文件</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>13110</span> Jul <span class=m>29</span> 15:11 /apps/nginx/html/images/a.jpg
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问/a.jpg成功</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># curl -I pc.test.org/a.jpg</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 15:41:25 GMT
</span></span><span class=line><span class=cl>Content-Type: image/jpeg
</span></span><span class=line><span class=cl>Content-Length: <span class=m>13110</span>
</span></span><span class=line><span class=cl>Last-Modified: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 07:11:49 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e38835-3336&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问/A.jpg失败。location匹配成功，但磁盘上并无A.jpg文件</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost images<span class=o>]</span><span class=c1># curl -I pc.test.org/A.jpg</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>404</span> Not Found
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 15:41:48 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html
</span></span><span class=line><span class=cl>Content-Length: <span class=m>153</span>
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span></code></pre></div><h3 id=nginx-四层访问控制>nginx 四层访问控制</h3><p>访问控制基于模块ngx_http_access_module实现，可以通过匹配客户端源IP地址进行限制</p><p>注意: 如果能在防火墙设备控制, 最好就不要在nginx上配置,可以更好的节约资源</p><p>官方帮助: <a href=http://nginx.org/en/docs/http/ngx_http_access_module.html target=_blank rel="noopener noreffer">http://nginx.org/en/docs/http/ngx_http_access_module.html</a></p><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>## 匹配时按从上至下的规则进行匹配，匹配到相应规则即停止———与防火墙的匹配规则类似</span>
</span></span><span class=line><span class=cl><span class=c1>#如：有客户端（IP：10.1.1.0）访问配置了以下规则的web服务器时(访问URI:/about)，触发location /about语句块，匹配到allow 10.1.1.0/16，访问控制生效，访问成功。</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>location</span> <span class=o>=</span> /login/ <span class=o>{</span>
</span></span><span class=line><span class=cl>   root /data/nginx/html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>   allow 10.0.0.0/24<span class=p>;</span>
</span></span><span class=line><span class=cl>   deny all<span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=o>}</span>
</span></span><span class=line><span class=cl>location /about <span class=o>{</span>
</span></span><span class=line><span class=cl>   <span class=nb>alias</span> /data/nginx/html/pc<span class=p>;</span>
</span></span><span class=line><span class=cl>   index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>   deny  192.168.1.1<span class=p>;</span>
</span></span><span class=line><span class=cl>   allow 192.168.1.0/24<span class=p>;</span>
</span></span><span class=line><span class=cl>   allow 10.1.1.0/16<span class=p>;</span>
</span></span><span class=line><span class=cl>   allow 2001:0db8::/32<span class=p>;</span>
</span></span><span class=line><span class=cl>   deny all<span class=p>;</span>  <span class=c1>#按先小范围到大范围排序</span>
</span></span><span class=line><span class=cl> <span class=o>}</span>
</span></span></code></pre></div><h3 id=nginx-账户认证功能>nginx 账户认证功能</h3><p>由 ngx_http_auth_basic_module 模块提供此功能</p><p>官方帮助：http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</p><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#CentOS安装包</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@centos8 ~<span class=o>]</span><span class=c1>#yum -y install httpd-tools</span>
</span></span><span class=line><span class=cl><span class=c1>#Ubuntu安装包</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@Ubuntu ~<span class=o>]</span><span class=c1>#apt -y install apache2-utils</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#创建用户</span>
</span></span><span class=line><span class=cl><span class=c1>#-b 非交互式方式提交密码</span>
</span></span><span class=line><span class=cl><span class=c1>#-c 重新生成文件，覆盖已有文件。首次创建时使用</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># htpasswd -bc /apps/nginx/conf/.htpasswd user1 passwd1</span>
</span></span><span class=line><span class=cl>Adding password <span class=k>for</span> user user1
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># htpasswd -b /apps/nginx/conf/.htpasswd user2 passwd2</span>
</span></span><span class=line><span class=cl>Adding password <span class=k>for</span> user user2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#生成了带有两个用户的验证文件</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># tail /apps/nginx/conf/.htpasswd </span>
</span></span><span class=line><span class=cl>user1:<span class=nv>$apr1$vzRe30iJ$jF8BZbra6pI8O0JBqlmiP</span>/
</span></span><span class=line><span class=cl>user2:<span class=nv>$apr1$i2ON7LYs$pxzkeH</span>.xxCdgj670m5cSW/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#网站登录页面配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/html/index.html </span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location /login <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nb>alias</span> html/<span class=p>;</span>
</span></span><span class=line><span class=cl>    index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>    auth_basic <span class=s2>&#34;login password&#34;</span><span class=p>;</span>  <span class=c1>#指定提示文本信息</span>
</span></span><span class=line><span class=cl>    auth_basic_user_file /apps/nginx/conf/.htpasswd<span class=p>;</span>  <span class=c1>#指定使用的验证文件</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#直接访问登录页，失败。未通过验证</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl pc.test.org/login/</span>
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;center&gt;&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##分别使用两种方式输入用户名和密码验证</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl http://user1:passwd1@pc.test.org/login/</span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl -u user2:passwd2 pc.test.org/login/</span>
</span></span><span class=line><span class=cl>hello
</span></span></code></pre></div><h3 id=自定义错误页面>自定义错误页面</h3><p>自定义错误页，同时也可以用指定的响应状态码进行响应, 可在如下语句块配置：http, server, location, if in</p><p>location</p><p>格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>error<span class=nb>_</span>page code ... [=[response]] uri;
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 准备站点配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  error_page <span class=m>404</span> <span class=m>400</span>  /error.html<span class=p>;</span>   <span class=c1>#访问不存在的页面，发生404错误，返回error.html错误页面</span>
</span></span><span class=line><span class=cl>  location /error.html <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#准备错误页面</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/html/error.html </span>
</span></span><span class=line><span class=cl>error-page
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问不存在的页面，触发404报错</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl -I pc.test.org/dd</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>404</span> Not Found   <span class=c1>#查看错误码</span>
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 17:02:12 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html
</span></span><span class=line><span class=cl>Content-Length: <span class=m>11</span>
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e411d9-b&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#触发404错误，返回错误页面（如果是浏览器测试，建议用google）</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl pc.test.org/dd</span>
</span></span><span class=line><span class=cl>error-page
</span></span></code></pre></div><p>范例：如果发生404 ，将错误码定义为502，且跳转到主页/index.html</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#站点配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  error_page <span class=nv>404</span> <span class=o>=</span><span class=m>502</span>  /index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>  location /index.html <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#主页配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/html/index.html </span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl pc.test.org/dd/</span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#验证错误码</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl pc.test.org/dd/ -I</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>502</span> Bad Gateway  <span class=c1>#错误码为自定义的502</span>
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 17:31:49 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html
</span></span><span class=line><span class=cl>Content-Length: <span class=m>6</span>
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e40fa4-6&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#重定向成功</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/html/index.html </span>
</span></span><span class=line><span class=cl>hello
</span></span></code></pre></div><h3 id=自定义错误日志>自定义错误日志</h3><p>错误日志格式</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Syntax: error_log file <span class=o>[</span>level<span class=o>]</span><span class=p>;</span>  <span class=c1>#格式</span>
</span></span><span class=line><span class=cl>Default: 	<span class=c1>#默认值</span>
</span></span><span class=line><span class=cl>error_log logs/error.log error<span class=p>;</span>  
</span></span><span class=line><span class=cl>Context: main, http, mail, stream, server, location  <span class=c1>#可配置的语句块</span>
</span></span><span class=line><span class=cl>level: debug, info, notice, warn, error, crit, alert, emerg  <span class=c1>#日志记录等级</span>
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#站点配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  error_page <span class=m>404</span> <span class=m>400</span>  /error.html<span class=p>;</span>
</span></span><span class=line><span class=cl>  access_log /apps/nginx/logs/test-access.log<span class=p>;</span>  <span class=c1>#自定义正常访问日志</span>
</span></span><span class=line><span class=cl>  error_log /apps/nginx/logs/test-error.log<span class=p>;</span>   <span class=c1>#自定义错误日志</span>
</span></span><span class=line><span class=cl>  location /error.html <span class=o>{</span>
</span></span><span class=line><span class=cl>    root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#当前已有日志文件</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># ls /apps/nginx/logs/</span>
</span></span><span class=line><span class=cl>access.log  error.log  nginx.pid
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#重启nginx后生成自定义的错误日志</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># ls /apps/nginx/logs/</span>
</span></span><span class=line><span class=cl>access.log  error.log  nginx.pid  test-access.log  test-error.log
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#访问站点</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># curl pc.test.org</span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#日志成功记录</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># tail /apps/nginx/logs/{test-access,test-error}.log</span>
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; /apps/nginx/logs/test-access.log &lt;<span class=o>==</span>
</span></span><span class=line><span class=cl>172.16.16.88 - - <span class=o>[</span>30/Jul/2022:01:17:55 +0800<span class=o>]</span> <span class=s2>&#34;GET / HTTP/1.1&#34;</span> <span class=m>200</span> <span class=m>6</span> <span class=s2>&#34;-&#34;</span> <span class=s2>&#34;curl/7.29.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>==</span>&gt; /apps/nginx/logs/test-error.log &lt;<span class=o>==</span>
</span></span></code></pre></div><h3 id=检测文件是否存在>检测文件是否存在</h3><p>try_files会按顺序检查文件是否存在，返回第一个找到的文件或文件夹（结尾加斜线表示为文件夹），如</p><p>果所有文件或文件夹都找不到，会进行一个内部重定向到最后一个参数。只有最后一个参数可以引起一</p><p>个内部重定向，之前的参数只设置内部URI的指向。最后一个参数是回退URI且必须存在，否则会出现内</p><p>部500错误。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Syntax: try_files file ... uri<span class=p>;</span>
</span></span><span class=line><span class=cl>try_files file ... <span class=o>=</span>code<span class=p>;</span>
</span></span><span class=line><span class=cl>Default: —
</span></span><span class=line><span class=cl>Context: server, location
</span></span></code></pre></div><p>范例: 如果不存在页面, 就转到default.html页面</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#准备站点配置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>      root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>      index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>      try_files <span class=nv>$uri</span> <span class=nv>$uri</span>.html <span class=nv>$uri</span>/index.html /about/default.html<span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#准备默认页面</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost html<span class=o>]</span><span class=c1># cat /apps/nginx/html/default.html </span>
</span></span><span class=line><span class=cl>default
</span></span><span class=line><span class=cl><span class=c1>#访问测试</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/html/about/default.html </span>
</span></span><span class=line><span class=cl>about_page
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># curl pc.test.org/xx/</span>
</span></span><span class=line><span class=cl>about_page
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># curl pc.test.org/xx.html</span>
</span></span><span class=line><span class=cl>about_page
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##自定义响应码</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  location / <span class=o>{</span>
</span></span><span class=line><span class=cl>      root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>      index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl>      try_files <span class=nv>$uri</span> <span class=nv>$uri</span>.html <span class=nv>$uri</span>/index.html <span class=o>=</span>555<span class=p>;</span>  <span class=c1>#自定义响应码为555</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=c1>#验证结果</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># curl pc.test.org/xx.html -I</span>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>555</span>   <span class=c1>#响应码为555</span>
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Mon, <span class=m>01</span> Aug <span class=m>2022</span> 10:00:03 GMT
</span></span><span class=line><span class=cl>Content-Length: <span class=m>0</span>
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>66</span>
</span></span></code></pre></div><h3 id=长连接配置>长连接配置</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>keepalive<span class=nb>_</span>timeout timeout [header<span class=nb>_</span>timeout];  #设定保持连接超时时长，0表示禁止长连接，默认为75s，通常配置在http字段作为站点全局配置
</span></span><span class=line><span class=cl>keepalive<span class=nb>_</span>requests number;  #在一次长连接上所允许请求的资源的最大数量，默认为100次,建议适
</span></span><span class=line><span class=cl>当调大,比如:500
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#站点主配置项</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/conf/nginx.conf | grep keepalive</span>
</span></span><span class=line><span class=cl>    keepalive_requests 3<span class=p>;</span>
</span></span><span class=line><span class=cl>    keepalive_timeout <span class=m>65</span> 60<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/html/index.html </span>
</span></span><span class=line><span class=cl>hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#长连接测试</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># telnet localhost 80</span>
</span></span><span class=line><span class=cl>Trying ::1...
</span></span><span class=line><span class=cl>telnet: connect to address ::1: Connection refused
</span></span><span class=line><span class=cl>Trying 127.0.0.1...
</span></span><span class=line><span class=cl>Connected to localhost.
</span></span><span class=line><span class=cl>Escape character is <span class=s1>&#39;^]&#39;</span>.
</span></span><span class=line><span class=cl>GET / HTTP/1.1      <span class=c1>#发起get请求，重复三次或者时间到达65秒后，本次链接自动终止</span>
</span></span><span class=line><span class=cl>HOST: localhost     <span class=c1>#域名为localhost</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Server: nginx/1.18.0
</span></span><span class=line><span class=cl>Date: Mon, <span class=m>01</span> Aug <span class=m>2022</span> 11:03:09 GMT
</span></span><span class=line><span class=cl>Content-Type: text/html
</span></span><span class=line><span class=cl>Content-Length: <span class=m>6</span>
</span></span><span class=line><span class=cl>Last-Modified: Fri, <span class=m>29</span> Jul <span class=m>2022</span> 16:49:40 GMT
</span></span><span class=line><span class=cl>Connection: keep-alive
</span></span><span class=line><span class=cl>Keep-Alive: <span class=nv>timeout</span><span class=o>=</span><span class=m>60</span>  <span class=c1>#显示的超时时间</span>
</span></span><span class=line><span class=cl>ETag: <span class=s2>&#34;62e40fa4-6&#34;</span>
</span></span><span class=line><span class=cl>Accept-Ranges: bytes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>hello    <span class=c1>#返回的页面内容    </span>
</span></span></code></pre></div><h3 id=作为下载服务器>作为下载服务器</h3><p>ngx_http_autoindex_module 模块处理以斜杠字符 &ldquo;/&rdquo; 结尾的请求，并生成目录列表,可以做为下载服务</p><p>配置使用</p><p>官方链接：http://nginx.org/en/docs/http/ngx_http_autoindex_module.html</p><p>相关指令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>autoindex on <span class=p>|</span> off<span class=p>;</span> <span class=c1>#自动文件索引功能，默为off</span>
</span></span><span class=line><span class=cl>autoindex_exact_size on <span class=p>|</span> off<span class=p>;</span>  <span class=c1>#计算文件精确大小（单位bytes），off 显示大概大小（单位K、M)，默认on</span>
</span></span><span class=line><span class=cl>autoindex_localtime on <span class=p>|</span> off <span class=p>;</span> <span class=c1>#显示本机时间而非GMT(格林威治)时间，默认off</span>
</span></span><span class=line><span class=cl>autoindex_format html <span class=p>|</span> xml <span class=p>|</span> json <span class=p>|</span> jsonp<span class=p>;</span> <span class=c1>#显示索引的页面文件风格，默认html</span>
</span></span><span class=line><span class=cl>limit_rate rate<span class=p>;</span> <span class=c1>#限制响应客户端传输速率(除GET和HEAD以外的所有方法)，单位B/s,即bytes/second，默认值0,表示无限制,此指令由ngx_http_core_module提供</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> <span class=nv>$limit_rate</span> 4k<span class=p>;</span> <span class=c1>#也可以通变量限速,单位B/s,同时设置,此项优级高于limit_rate</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>###Rate limit can also be set in the $limit_rate variable, however, since version 1.17.0, this method is not recommended:</span>
</span></span></code></pre></div><p>范例：将nginx作为下载服务器</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#注意:download不需要index.html文件</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@centos8 ~<span class=o>]</span><span class=c1># mkdir -p /data/nginx/html/pc/download</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># touch /apps/nginx/html/download/{t1,t2,t3}.txt</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># mkdir /apps/nginx/html/download/{d1,d2,d3}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># tree /apps/nginx/html/download</span>
</span></span><span class=line><span class=cl>/apps/nginx/html/download
</span></span><span class=line><span class=cl>├── d1
</span></span><span class=line><span class=cl>├── d2
</span></span><span class=line><span class=cl>├── d3
</span></span><span class=line><span class=cl>├── t1.txt
</span></span><span class=line><span class=cl>├── t2.txt
</span></span><span class=line><span class=cl>└── t3.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>3</span> directories, <span class=m>3</span> files
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@centos8 ~<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf</span>
</span></span><span class=line><span class=cl> location /download <span class=o>{</span>
</span></span><span class=line><span class=cl>   autoindex on<span class=p>;</span>    <span class=c1>#自动索引功能</span>
</span></span><span class=line><span class=cl>   autoindex_exact_size   off<span class=p>;</span> <span class=c1>#计算文件确切大小（单位bytes），此为默认值,off只显示大概大</span>
</span></span><span class=line><span class=cl>小（单位kb、mb、gb）  
</span></span><span class=line><span class=cl>   autoindex_localtime   off<span class=p>;</span> <span class=c1>#on表示显示本机时间而非GMT(格林威治)时间,默为为off显示GMT</span>
</span></span><span class=line><span class=cl>时间
</span></span><span class=line><span class=cl>   limit_rate 1024k<span class=p>;</span>   <span class=c1>#限速,默认不限速</span>
</span></span><span class=line><span class=cl>   root html/<span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><p><strong>结果验证</strong></p><p><img class=lazyload src=/svg/loading.min.svg data-src=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae/image-20220801113728007.png data-srcset="Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae/image-20220801113728007.png, Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae/image-20220801113728007.png 1.5x, Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae/image-20220801113728007.png 2x" data-sizes=auto alt=Nginx核心配置/image-20220801113728007.png title=image-20220801113728007></p><h3 id=作为上传服务器>作为上传服务器</h3><p>相关指令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>client_max_body_size 1m<span class=p>;</span> <span class=c1>#设置允许客户端上传单个文件大小的上限值，默认值为1m,上传文件超过此值会出413错误</span>
</span></span><span class=line><span class=cl>client_body_buffer_size size<span class=p>;</span> <span class=c1>#用于接收每个客户端请求报文的body部分的缓冲区大小;默认16k;超出此大小时，其将被暂存到磁盘上的由client_body_temp_path指令所定义的位置</span>
</span></span><span class=line><span class=cl>client_body_temp_path path <span class=o>[</span>level1 <span class=o>[</span>level2 <span class=o>[</span>level3<span class=o>]]]</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>#设定存储客户端请求报文的body部分的临时存储路径及子目录结构和数量，目录名为16进制的数字，使用hash之后的值从后往前截取1位、2位、2位作为目录名</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@centos8 ~<span class=o>]</span><span class=c1># md5sum /data/nginx/html/pc/index.html </span>
</span></span><span class=line><span class=cl>95f6f65f498c74938064851b1bb <span class=m>96</span> 3d <span class=m>4</span> /data/nginx/html/pc/index.html
</span></span><span class=line><span class=cl>1级目录占1位16进制，即2^4<span class=o>=</span>16个目录  0-f
</span></span><span class=line><span class=cl>2级目录占2位16进制，即2^8<span class=o>=</span>256个目录 00-ff
</span></span><span class=line><span class=cl>3级目录占2位16进制，即2^8<span class=o>=</span>256个目录 00-ff
</span></span><span class=line><span class=cl><span class=c1>#配置示例：</span>
</span></span><span class=line><span class=cl>client_max_body_size 100m<span class=p>;</span> <span class=c1>#如果太大，上传时会出现413错误。注意:如果php上传（如WordPress）,还需要修改/etc/php.ini的相关配置</span>
</span></span><span class=line><span class=cl>client_body_buffer_size 1024k<span class=p>;</span>
</span></span><span class=line><span class=cl>client_body_temp_path   /apps/nginx/client_body_temp/ <span class=m>1</span> <span class=m>2</span> 2<span class=p>;</span> <span class=c1>#上传时,Nginx会自动创建相关目录</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##上传文件后,会自动生成相关目录</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@wang-liyun-pc ~<span class=o>]</span><span class=c1># tree /apps/nginx/client_body_temp/</span>
</span></span><span class=line><span class=cl>/apps/nginx/client_body_temp/
</span></span><span class=line><span class=cl>├── <span class=m>5</span>
</span></span><span class=line><span class=cl>│   └── <span class=m>00</span>
</span></span><span class=line><span class=cl>│       └── <span class=m>00</span>
</span></span><span class=line><span class=cl>└── <span class=m>6</span>
</span></span><span class=line><span class=cl>   └── <span class=m>00</span>
</span></span><span class=line><span class=cl>       └── <span class=m>00</span>
</span></span></code></pre></div><h3 id=其他配置>其他配置</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>keepalive_disable none <span class=p>|</span> browser ...<span class=p>;</span>  <span class=c1>#对哪种浏览器禁用长连接</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>limit_except method ... <span class=o>{</span> ... <span class=o>}</span> <span class=c1>#仅用于location语句块，禁止客户端使用除了指定的请求方法之外的其它方法, 如果使用会出现403错误</span>
</span></span><span class=line><span class=cl>method:GET, HEAD, POST, PUT, DELETE，MKCOL, COPY, MOVE, OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##示例：除了GET之外的其它方法仅允许172.16.16.0/24网段主机使用</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># hostname -I  #本机IP</span>
</span></span><span class=line><span class=cl>172.16.16.88 
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># ll /apps/nginx/html/upload/  #新建upload目录用于存储上传的文件</span>
</span></span><span class=line><span class=cl>total <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  location /upload <span class=o>{</span>
</span></span><span class=line><span class=cl>      root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>	  index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl> 	  limit_except GET <span class=o>{</span>
</span></span><span class=line><span class=cl>      	  allow 172.16.16.88<span class=p>;</span>
</span></span><span class=line><span class=cl>	      deny all<span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># nginx -s reload</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># curl -XPUT /etc/issue pc.test.org/upload</span>
</span></span><span class=line><span class=cl>curl: <span class=o>(</span>3<span class=o>)</span> &lt;url&gt; malformed
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;  <span class=c1>#PUT方法具有访问权限，但是程序本身不支持文件上传功能</span>
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span class=line><span class=cl>server <span class=o>{</span>
</span></span><span class=line><span class=cl>  listen 80<span class=p>;</span>
</span></span><span class=line><span class=cl>  server_name pc.test.org<span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  location /upload <span class=o>{</span>
</span></span><span class=line><span class=cl>        root html/<span class=p>;</span>
</span></span><span class=line><span class=cl>	index index.html<span class=p>;</span>
</span></span><span class=line><span class=cl> 	limit_except GET <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>#allow 172.16.16.88;  #禁止所有主机使用GET以外的方法</span>
</span></span><span class=line><span class=cl>	    deny all<span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>   <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@localhost ~<span class=o>]</span><span class=c1># curl -XPUT /etc/issue pc.test.org/upload</span>
</span></span><span class=line><span class=cl>curl: <span class=o>(</span>3<span class=o>)</span> &lt;url&gt; malformed
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt; <span class=c1>#再次访问测试，nginx拒绝访问</span>
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>aio on <span class=p>|</span> off  <span class=c1>#是否启用asynchronous file I/O(AIO)功能，需要编译时添加参数开启 --with-file-aio</span>
</span></span><span class=line><span class=cl><span class=c1>#linux 2.6以上内核提供以下几个系统调用来支持aio： 1、SYS_io_setup：建立aio 的context</span>
</span></span><span class=line><span class=cl>2、SYS_io_submit: 提交I/O操作请求
</span></span><span class=line><span class=cl>3、SYS_io_getevents：获取已完成的I/O事件
</span></span><span class=line><span class=cl>4、SYS_io_cancel：取消I/O操作请求
</span></span><span class=line><span class=cl>5、SYS_io_destroy：毁销aio的context
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>directio size <span class=p>|</span> off<span class=p>;</span> <span class=c1>#操作完全和aio相反，aio是读取文件而directio是写文件到磁盘，默认为关闭，当文件大于等于给定大小时，例如:directio 4m，同步（直接）写磁盘，而非写缓存。</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>open_file_cache off<span class=p>;</span>  <span class=c1>#是否缓存打开过的文件信息</span>
</span></span><span class=line><span class=cl>open_file_cache <span class=nv>max</span><span class=o>=</span>N <span class=o>[</span><span class=nv>inactive</span><span class=o>=</span>time<span class=o>]</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#nginx可以缓存以下三种信息：</span>
</span></span><span class=line><span class=cl><span class=o>(</span>1<span class=o>)</span> 文件元数据：文件的描述符、文件大小和最近一次的修改时间
</span></span><span class=line><span class=cl><span class=o>(</span>2<span class=o>)</span> 打开的目录结构
</span></span><span class=line><span class=cl><span class=o>(</span>3<span class=o>)</span> 没有找到的或者没有权限访问的文件的相关信息 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>max</span><span class=o>=</span>N：#可缓存的缓存项上限数量<span class=p>;</span>达到上限后会使用LRU<span class=o>(</span>Least recently used，最近最少使用<span class=o>)</span>算法实现管理
</span></span><span class=line><span class=cl><span class=nv>inactive</span><span class=o>=</span>time：#缓存项的非活动时长，在此处指定的时长内未被命中的或命中的次数少于
</span></span><span class=line><span class=cl>open_file_cache_min_uses <span class=c1>#指令所指定的次数的缓存项即为非活动项，将被删除</span>
</span></span><span class=line><span class=cl>open_file_cache_valid time<span class=p>;</span> <span class=c1>#缓存项有效性的检查验证频率，默认值为60s </span>
</span></span><span class=line><span class=cl>open_file_cache_errors on <span class=p>|</span> off<span class=p>;</span> <span class=c1>#是否缓存查找时发生错误的文件一类的信息,默认值为off</span>
</span></span><span class=line><span class=cl>open_file_cache_min_uses number<span class=p>;</span> <span class=c1>#open_file_cache指令的inactive参数指定的时长内，至少被命中此处指定的次数方可被归类为活动项,默认值为1</span>
</span></span></code></pre></div><p>范例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>open_file_cache <span class=nv>max</span><span class=o>=</span><span class=m>10000</span> <span class=nv>inactive</span><span class=o>=</span>60s<span class=p>;</span> <span class=c1>#最大缓存10000个文件，非活动数据超时时长60s</span>
</span></span><span class=line><span class=cl>open_file_cache_valid   60s<span class=p>;</span>  <span class=c1>#每间隔60s检查一下缓存数据有效性</span>
</span></span><span class=line><span class=cl>open_file_cache_min_uses 5<span class=p>;</span> <span class=c1>#60秒内至少被命中访问5次才被标记为活动数据</span>
</span></span><span class=line><span class=cl>open_file_cache_errors   on<span class=p>;</span> <span class=c1>#缓存错误信息</span>
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2022-07-25</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/ data-title=Nginx核心配置 data-hashtags=Nginx><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/ data-hashtag=Nginx><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/ data-title=Nginx核心配置><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/ data-title=Nginx核心配置><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://senmer.github.io/posts/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/ data-title=Nginx核心配置><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/nginx/>Nginx</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/nginx%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7/ class=prev rel=prev title=Nginx平滑升级和回滚><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Nginx平滑升级和回滚</a>
<a href=/posts/nginx%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/ class=next rel=next title=Nginx高级配置>Nginx高级配置<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.105.0">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>