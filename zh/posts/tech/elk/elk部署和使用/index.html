<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ELKéƒ¨ç½²å’Œä½¿ç”¨ | WZ's Blog</title>
<meta name=keywords content><meta name=description content="ä¸€ã€ELK ç®€ä»‹ ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚ ä¸‹é¢"><meta name=author content="wz"><link rel=canonical href=https://senmer.github.io/zh/posts/tech/elk/elk%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BD%BF%E7%94%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="ELKéƒ¨ç½²å’Œä½¿ç”¨"><meta property="og:description" content="ä¸€ã€ELK ç®€ä»‹ ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚ ä¸‹é¢"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/zh/posts/tech/elk/elk%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BD%BF%E7%94%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-10-08T17:21:41+08:00"><meta property="article:modified_time" content="2023-10-08T17:21:41+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ELKéƒ¨ç½²å’Œä½¿ç”¨"><meta name=twitter:description content="ä¸€ã€ELK ç®€ä»‹ ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚ ä¸‹é¢"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://senmer.github.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://senmer.github.io/zh/posts/tech/"},{"@type":"ListItem","position":3,"name":"ELKéƒ¨ç½²å’Œä½¿ç”¨","item":"https://senmer.github.io/zh/posts/tech/elk/elk%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BD%BF%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ELKéƒ¨ç½²å’Œä½¿ç”¨","name":"ELKéƒ¨ç½²å’Œä½¿ç”¨","description":"ä¸€ã€ELK ç®€ä»‹ ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚ ä¸‹é¢","keywords":[""],"articleBody":"ä¸€ã€ELK ç®€ä»‹ ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚\nä¸‹é¢æ˜¯æ¯ä¸ªç»„ä»¶çš„ç®€è¦ä»‹ç»ï¼š\nElasticsearchï¼š Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒç”¨äºå­˜å‚¨å’Œç´¢å¼•å¤§é‡çš„æ•°æ®ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè¿›è¡Œå…¨æ–‡æœç´¢ã€åˆ†æå’Œèšåˆã€‚Elasticsearchçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶åˆ†å¸ƒå¼æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œå®ƒèƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ®å¹¶æä¾›é«˜æ•ˆçš„æŸ¥è¯¢å’Œåˆ†æã€‚\nLogstashï¼š Logstashæ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†ã€å¤„ç†å’Œè½¬å‘å„ç§ç±»å‹æ•°æ®çš„æ•°æ®æµå¤„ç†å¼•æ“ã€‚å®ƒå¯ä»¥ä»å¤šç§æ¥æºï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“ç­‰ï¼‰æ”¶é›†æ•°æ®ï¼Œç»è¿‡å¤„ç†åå°†æ•°æ®å‘é€åˆ°ç›®æ ‡å­˜å‚¨ï¼ˆå¦‚Elasticsearchï¼‰ã€‚Logstashå¯ä»¥ç”¨äºæ•°æ®æ¸…æ´—ã€è½¬æ¢ã€æ ‡å‡†åŒ–ç­‰ï¼Œä»¥ä¾¿å°†æ•°æ®å‡†å¤‡å¥½ä¾›åç»­çš„æœç´¢å’Œåˆ†æã€‚\nKibanaï¼š Kibanaæ˜¯ä¸€ä¸ªç”¨äºæ•°æ®å¯è§†åŒ–å’Œåˆ†æçš„å¼€æºå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„Webç•Œé¢ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ›å»ºä»ªè¡¨æ¿ã€å›¾è¡¨å’Œåœ°å›¾æ¥å±•ç¤ºElasticsearchä¸­çš„æ•°æ®ã€‚é€šè¿‡Kibanaï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡äº¤äº’å¼çš„ç•Œé¢æ·±å…¥åˆ†ææ•°æ®ã€è§‚å¯Ÿè¶‹åŠ¿ã€æ£€æµ‹å¼‚å¸¸ç­‰ã€‚\nELKçš„å·¥ä½œæµç¨‹é€šå¸¸æ˜¯è¿™æ ·çš„ï¼šLogstashæ”¶é›†å’Œå¤„ç†å„ç§æ•°æ®æºçš„æ—¥å¿—æ•°æ®ï¼Œç„¶åå°†å¤„ç†åçš„æ•°æ®å‘é€åˆ°Elasticsearchè¿›è¡Œç´¢å¼•å’Œå­˜å‚¨ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Kibanaæ¥æŸ¥è¯¢æ•°æ®ã€åˆ›å»ºå¯è§†åŒ–ä»ªè¡¨æ¿ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£æ•°æ®çš„æƒ…å†µã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒElasticsearch åœ¨æ–°ç‰ˆæœ¬ä¸­ä¹Ÿè¢«ç§°ä¸º Elastic Stackï¼Œå› ä¸ºé™¤äº†ä¸Šè¿°ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å¤–ï¼ŒElastic å…¬å¸è¿˜æä¾›äº†å…¶ä»–ä¸€äº›é™„åŠ å·¥å…·å’ŒåŠŸèƒ½ï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºæ•°æ®åˆ†æå’Œç®¡ç†çš„èƒ½åŠ›ã€‚\näºŒã€Elasticsearch é›†ç¾¤éƒ¨ç½² 2.1 ç¯å¢ƒåˆå§‹åŒ– 2.1.1 ç¯å¢ƒå‡†å¤‡ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® elasticsearch-01 10.0.0.11 CentOS 7.6 2U 4G elasticsearch-02 10.0.0.12 CentOS 7.6 1U 2G elasticsearch-03 10.0.0.13 CentOS 7.6 1U 2G 2.1.2 å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´ # å…³é—­é˜²ç«å¢™ systemctl disable firewalld --now # å…³é—­ NetworkManager systemctl disable NetworkManager --now # å…³é—­selinux setenforce 0 sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config # ä¿®æ”¹æ–‡ä»¶å¥æŸ„æ•°çš„é™åˆ¶ echo \"* soft nofile 65536\" \u003e\u003e /etc/security/limits.conf echo \"* hard nofile 65536\" \u003e\u003e /etc/security/limits.conf 2.1.3 é…ç½® hosts è§£æ # cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 10.0.0.11 elasticsearch-01 10.0.0.12 elasticsearch-02 10.0.0.13 elasticsearch-03 2.1.4 å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´ # å®‰è£…åŸºç¡€è½¯ä»¶ yum install -y epel-release net-tools vim lrzsz tree screen lsof tcpdump wget ntpdate # åŒæ­¥æ—¶é—´ cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime # å®šæ—¶åŒæ­¥ echo \"*/5 * * * * ntpdate time1.aliyun.com \u0026\u003e /dev/null \u0026\u0026 hwclock -w\" \u003e\u003e /var/spool/cron/root systemctl restart crond 2.1.5 é…ç½® java ç¯å¢ƒ æ”¯æŒä¸€è§ˆè¡¨ | Elastic\nyum install java-1.8.0-openjdk -y java -version 2.2 å®‰è£… elasticsearch 2.2.1 yum å®‰è£… elasticsearch 7.17 Download Elasticsearch | Elastic\n[Install Elasticsearch with RPM | Elasticsearch Guide 7.17] | Elastic\nrpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch cat \u003e /etc/yum.repos.d/elasticsearch-7.repo \u003c\u003c EOF [elasticsearch] name=Elasticsearch repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=0 autorefresh=1 type=rpm-md EOF yum install -y --enablerepo=elasticsearch elasticsearch 2.2.2 ä¿®æ”¹é…ç½®æ–‡ä»¶ # cat /etc/elasticsearch/elasticsearch.yml\ncluster.name: elk-cluster node.name: elk-node-01 # æ¯ä¸ªèŠ‚ç‚¹å”¯ä¸€ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹ path.data: /apps/elasticsearch/data # æ•°æ®å­˜æ”¾ç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º path.logs: /apps/elasticsearch/logs bootstrap.memory_lock: true network.host: 0.0.0.0 http.port: 9200 discovery.seed_hosts: [\"10.0.0.11\", \"10.0.0.12\", \"10.0.0.13\"] cluster.initial_master_nodes: [\"10.0.0.11\", \"10.0.0.12\", \"10.0.0.13\"] gateway.recover_after_nodes: 2 action.destructive_requires_name: true å‚æ•°è§£é‡Š\ncluster.name: elk-cluster: è®¾ç½®Elasticsearché›†ç¾¤çš„åç§°ä¸º\"elk-cluster\"ã€‚ node.name: elk-node-01: è®¾ç½®å½“å‰ElasticsearchèŠ‚ç‚¹çš„åç§°ä¸º\"elk-node-01\"ã€‚ path.data: /apps/elasticsearch/data å’Œ path.logs: /apps/elasticsearch/logs: åˆ†åˆ«æŒ‡å®šElasticsearchæ•°æ®å’Œæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚ bootstrap.memory_lock: true: è¿™ä¸ªé…ç½®è¡¨ç¤ºElasticsearchå°†å°è¯•é”å®šå†…å­˜ï¼Œä»¥æé«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ network.host: 0.0.0.0: å…è®¸Elasticsearchç»‘å®šåˆ°æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œä»¥å…è®¸æ¥è‡ªä»»ä½•IPåœ°å€çš„è¿æ¥ã€‚ http.port: 9200: è®¾ç½®Elasticsearch HTTPæœåŠ¡çš„ç›‘å¬ç«¯å£ä¸º9200ï¼Œè¿™æ˜¯é»˜è®¤çš„HTTP APIç«¯å£ã€‚ discovery.seed_hosts: [\"10.0.0.11\", \"10.0.0.12\", \"10.0.0.13\"]: æŒ‡å®šäº†Elasticsearché›†ç¾¤çš„å‘ç°èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç”¨äºå¯åŠ¨å’Œå‘ç°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ã€‚ cluster.initial_master_nodes: [\"10.0.0.11\", \"10.0.0.12\", \"10.0.0.13\"]: æŒ‡å®šäº†åˆå§‹çš„ä¸»èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºåˆå§‹åŒ–é›†ç¾¤ã€‚ gateway.recover_after_nodes: 2: é…ç½®åœ¨è‡³å°‘æœ‰2ä¸ªèŠ‚ç‚¹å¯ç”¨æ—¶æ‰å…è®¸é›†ç¾¤æ¢å¤ã€‚ action.destructive_requires_name: true: è¿™ä¸ªé…ç½®è¦æ±‚åœ¨æ‰§è¡Œç ´åæ€§æ“ä½œï¼ˆå¦‚åˆ é™¤ç´¢å¼•ï¼‰æ—¶éœ€è¦æä¾›åç§°ï¼Œä»¥é˜²æ­¢æ„å¤–çš„æ“ä½œã€‚ 2.2.3 ä¿®æ”¹å†…å­˜é™åˆ¶ LimitMEMLOCK=infinity æ˜¯SystemdæœåŠ¡çš„é…ç½®å‚æ•°ä¹‹ä¸€ï¼Œç”¨äºé™åˆ¶è¿›ç¨‹çš„å†…å­˜é”å®šï¼ˆmlockï¼‰èµ„æºã€‚è¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯å°†å†…å­˜é”å®šèµ„æºçš„é™åˆ¶è®¾ç½®ä¸ºæ— é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯å…è®¸è¿›ç¨‹é”å®šä»»æ„æ•°é‡çš„å†…å­˜ã€‚å†…å­˜é”å®šæ˜¯ä¸€ç§æ“ä½œï¼Œç”¨äºå°†å†…å­˜åˆ†é…ç»™è¿›ç¨‹ï¼Œå¹¶é˜²æ­¢æ“ä½œç³»ç»Ÿå°†å…¶äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œæé«˜äº†å¯¹å†…å­˜çš„å¿«é€Ÿè®¿é—®ã€‚\nåœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦å°†ä¸€éƒ¨åˆ†å†…å­˜é”å®šï¼Œä»¥ç¡®ä¿æ•°æ®å§‹ç»ˆä½äºç‰©ç†å†…å­˜ä¸­ï¼Œè€Œä¸ä¼šè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼Œä»¥å‡å°‘è®¿é—®å»¶è¿Ÿã€‚å°†LimitMEMLOCKè®¾ç½®ä¸ºinfinityå…è®¸è¿›ç¨‹é”å®šæ‰€éœ€çš„å†…å­˜è€Œä¸å—é™åˆ¶ã€‚\nè¯·æ³¨æ„ï¼Œä¿®æ”¹æ­¤è®¾ç½®å¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œå› ä¸ºä¸å—é™åˆ¶çš„å†…å­˜é”å®šå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºä¸è¶³ï¼Œå› æ­¤åœ¨è¿›è¡Œæ­¤ç±»é…ç½®æ›´æ”¹æ—¶éœ€è¦å°å¿ƒè°¨æ…ï¼Œå¹¶ç¡®ä¿äº†è§£åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æ¨¡å¼å’Œç³»ç»Ÿèµ„æºé™åˆ¶ã€‚\næ­¤å¤–ï¼Œä¸Šè¿°é…ç½®ç‰‡æ®µé€šå¸¸å¯ä»¥åœ¨SystemdæœåŠ¡å•å…ƒæ–‡ä»¶ï¼ˆé€šå¸¸ä½äº/etc/systemd/system/æˆ–/lib/systemd/system/ä¸­ï¼‰ä¸­æ‰¾åˆ°ï¼Œå¹¶ç”¨äºè°ƒæ•´ç‰¹å®šæœåŠ¡çš„èµ„æºé™åˆ¶ã€‚å…·ä½“çš„é…ç½®æ–‡ä»¶å¯èƒ½å› ä¸åŒçš„Linuxå‘è¡Œç‰ˆå’Œåº”ç”¨ç¨‹åºè€Œæœ‰æ‰€ä¸åŒã€‚\næ³¨æ„ï¼šè¦åœ¨Service å—ä¸­è®¾ç½®ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆ\n# grep LimitMEMLOCK=infinity /usr/lib/systemd/system/elasticsearch.service -B 1 [Service] LimitMEMLOCK=infinity # systemctl daemon-reload ä¿®æ”¹å †å†…å­˜å¤§å°\n[Heap size settings | Elasticsearch Guide 8.9] | Elastic\n# grep Xm /etc/elasticsearch/jvm.options -Xms1g -Xmx1g åˆ›å»ºæ•°æ®å­˜æ”¾ç›®å½•\nmkdir -p /apps/elasticsearch/{data,logs} chown -R elasticsearch.elasticsearch /apps/elasticsearch/ 2.3 å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ Elasticsearch é›†ç¾¤çŠ¶æ€ç”¨äºè¡¨ç¤ºé›†ç¾¤çš„æ•´ä½“å¥åº·çŠ¶å†µã€‚Elasticsearch é›†ç¾¤å¯ä»¥å¤„äºä¸åŒçš„å¥åº·çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åæ˜ äº†é›†ç¾¤ä¸­æ•°æ®åˆ†ç‰‡çš„å¯ç”¨æ€§å’Œå®Œæ•´æ€§ã€‚ä»¥ä¸‹æ˜¯ Elasticsearch é›†ç¾¤çŠ¶æ€çš„ä¸»è¦ä»‹ç»ï¼š\nGreenï¼ˆç»¿è‰²ï¼‰: é›†ç¾¤å¤„äºæœ€ä½³çŠ¶æ€ã€‚ æ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡éƒ½å¯ç”¨ã€‚ é›†ç¾¤çš„æ•°æ®å®Œæ•´æ€§å’Œå¯ç”¨æ€§éƒ½éå¸¸é«˜ã€‚ æ‰€æœ‰èŠ‚ç‚¹éƒ½æ­£å¸¸è¿è¡Œï¼Œæ²¡æœ‰æ•…éšœã€‚ æ€§èƒ½æ­£å¸¸ï¼Œæ²¡æœ‰æ€§èƒ½é—®é¢˜ã€‚ Yellowï¼ˆé»„è‰²ï¼‰: é›†ç¾¤çŠ¶æ€è¡¨ç¤ºä¸º â€œyellowâ€ æ—¶ï¼Œä¸»åˆ†ç‰‡éƒ½å¯ç”¨ï¼Œä½†å¤åˆ¶åˆ†ç‰‡ï¼ˆå‰¯æœ¬ï¼‰å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚ å¯èƒ½æœ‰ä¸€äº›å‰¯æœ¬åˆ†ç‰‡å°šæœªåˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…æŸäº›èŠ‚ç‚¹ä¸å¯ç”¨ã€‚ æ•°æ®å®Œæ•´æ€§æœ‰ä¸€å®šç¨‹åº¦çš„é£é™©ï¼Œå› ä¸ºå¤åˆ¶åˆ†ç‰‡çš„å¯ç”¨æ€§å—åˆ°å½±å“ã€‚ æ€§èƒ½é€šå¸¸è‰¯å¥½ï¼Œä½†éœ€è¦å…³æ³¨é›†ç¾¤å¥åº·çŠ¶æ€ã€‚ Redï¼ˆçº¢è‰²ï¼‰: é›†ç¾¤çŠ¶æ€è¡¨ç¤ºä¸º â€œredâ€ æ—¶ï¼Œæ„å‘³ç€ä¸»åˆ†ç‰‡ä¸å¯ç”¨ã€‚ è¿™å¯èƒ½æ˜¯ç”±äºä¸»åˆ†ç‰‡ä¸¢å¤±ã€æœªåˆ†é…æˆ–è€…èŠ‚ç‚¹æ•…éšœç­‰é—®é¢˜å¼•èµ·çš„ã€‚ æ•°æ®çš„å¯ç”¨æ€§å’Œå®Œæ•´æ€§å—åˆ°ä¸¥é‡å¨èƒï¼Œå› ä¸ºä¸»åˆ†ç‰‡æ— æ³•æä¾›æ•°æ®è®¿é—®ã€‚ æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œå…·ä½“å–å†³äºç¼ºå¤±çš„ä¸»åˆ†ç‰‡æ•°é‡å’ŒæŸ¥è¯¢çš„æ€§è´¨ã€‚ 2.3.1 å¯åŠ¨æœåŠ¡ # systemctl start elasticsearch # systemctl status elasticsearch [root@elasticsearch-01 ~]# ss -ntl State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 128 *:22 *:* LISTEN 0 100 127.0.0.1:25 *:* LISTEN 0 128 :::9200 # æœåŠ¡ç›‘å¬ç«¯å£ :::* LISTEN 0 128 :::9300 # é›†ç¾¤é€šä¿¡ç«¯å£ :::* LISTEN 0 128 :::22 :::* LISTEN 0 100 ::1:25 :::* [root@elasticsearch-01 ~]# curl localhost:9200 { \"name\" : \"elk-node-01\",\t# èŠ‚ç‚¹åç§° \"cluster_name\" : \"elk-cluster\", \"cluster_uuid\" : \"XXO_Ik9XQo2Y5Uw6UvVS-g\", \"version\" : { \"number\" : \"7.17.13\", # elasticsearch ç‰ˆæœ¬å· \"build_flavor\" : \"default\", \"build_type\" : \"rpm\", \"build_hash\" : \"2b211dbb8bfdecaf7f5b44d356bdfe54b1050c13\", \"build_date\" : \"2023-08-31T17:33:19.958690787Z\", \"build_snapshot\" : false, \"lucene_version\" : \"8.11.1\", \"minimum_wire_compatibility_version\" : \"6.8.0\", \"minimum_index_compatibility_version\" : \"6.0.0-beta1\" }, \"tagline\" : \"You Know, for Search\"\t# å®£ä¼ è¯­ } 2.3.2 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ å¯ä»¥åˆ©ç”¨æ­¤æ¥å£å¯¹ elasticseach é›†ç¾¤çŠ¶æ€è¿›è¡Œç›‘æ§\n[root@elasticsearch-01 ~]# curl localhost:9200/_cluster/health?pretty { \"cluster_name\" : \"elk-cluster\", \"status\" : \"green\",\t# é›†ç¾¤ç›‘æ§çŠ¶æ€ \"timed_out\" : false, \"number_of_nodes\" : 3, \"number_of_data_nodes\" : 3, \"active_primary_shards\" : 3, \"active_shards\" : 6, \"relocating_shards\" : 0, \"initializing_shards\" : 0, \"unassigned_shards\" : 0, \"delayed_unassigned_shards\" : 0, \"number_of_pending_tasks\" : 0, \"number_of_in_flight_fetch\" : 0, \"task_max_waiting_in_queue_millis\" : 0, \"active_shards_percent_as_number\" : 100.0 } ä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›å…³é”®å­—æ®µçš„è§£é‡Šï¼š\n\"cluster_name\" : \"elk-cluster\": é›†ç¾¤çš„åç§°ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„é›†ç¾¤åç§°ä¸º â€œelk-clusterâ€ã€‚\n\"status\" : \"green\": é›†ç¾¤çš„å¥åº·çŠ¶æ€ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­é›†ç¾¤çŠ¶æ€ä¸º â€œgreenâ€ï¼Œè¡¨ç¤ºé›†ç¾¤å¤„äºæœ€ä½³çŠ¶æ€ã€‚\n\"number_of_nodes\" : 3: é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰3ä¸ªèŠ‚ç‚¹ã€‚\n\"number_of_data_nodes\" : 3: é›†ç¾¤ä¸­çš„æ•°æ®èŠ‚ç‚¹æ•°é‡ï¼Œè¿™æ˜¯å®é™…å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹æ•°ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­ä¹Ÿæ˜¯3ä¸ªã€‚\n\"active_primary_shards\" : 3: æ´»åŠ¨ä¸»åˆ†ç‰‡çš„æ•°é‡ï¼Œè¿™æ˜¯é›†ç¾¤ä¸­ä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰3ä¸ªã€‚\n\"active_shards\" : 6: æ‰€æœ‰æ´»åŠ¨åˆ†ç‰‡çš„æ•°é‡ï¼ŒåŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰6ä¸ªã€‚\n\"relocating_shards\" : 0: æ­£åœ¨è¿ç§»çš„åˆ†ç‰‡æ•°é‡ï¼Œå¦‚æœä½ åœ¨é‡æ–°å¹³è¡¡é›†ç¾¤æˆ–è¿ç§»åˆ†ç‰‡ï¼Œåˆ™è¯¥å€¼å¯èƒ½ä¼šå¢åŠ ã€‚\n\"initializing_shards\" : 0: æ­£åœ¨åˆå§‹åŒ–çš„åˆ†ç‰‡æ•°é‡ï¼Œé€šå¸¸åœ¨æ–°åˆ†ç‰‡æˆ–èŠ‚ç‚¹åŠ å…¥æ—¶å‡ºç°ã€‚\n\"unassigned_shards\" : 0: æœªåˆ†é…çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™æ˜¯æŒ‡å°šæœªåˆ†é…åˆ°ä»»ä½•èŠ‚ç‚¹çš„åˆ†ç‰‡æ•°é‡ã€‚åœ¨é›†ç¾¤çŠ¶æ€ä¸º â€œgreenâ€ æ—¶ï¼Œè¿™åº”è¯¥æ˜¯0ã€‚\n\"delayed_unassigned_shards\" : 0: å»¶è¿Ÿæœªåˆ†é…çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™æ˜¯æŒ‡å°šæœªåˆ†é…åˆ°èŠ‚ç‚¹ï¼Œä½†ç”±äºä¸€äº›åŸå› è€Œè¢«å»¶è¿Ÿçš„åˆ†ç‰‡æ•°é‡ã€‚\n\"number_of_pending_tasks\" : 0: é›†ç¾¤ä¸­å¾…å¤„ç†ä»»åŠ¡çš„æ•°é‡ï¼Œä¾‹å¦‚ç´¢å¼•åˆ›å»ºæˆ–åˆ é™¤ç­‰æ“ä½œå¯èƒ½ä¼šç”Ÿæˆå¾…å¤„ç†ä»»åŠ¡ã€‚\n\"number_of_in_flight_fetch\" : 0: ç›®å‰æ­£åœ¨è¿›è¡Œçš„æ•°æ®è·å–è¯·æ±‚çš„æ•°é‡ã€‚\n\"task_max_waiting_in_queue_millis\" : 0: é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚\n\"active_shards_percent_as_number\" : 100.0: æ´»åŠ¨åˆ†ç‰‡çš„ç™¾åˆ†æ¯”ï¼Œä½œä¸ºæ•°å­—è¡¨ç¤ºã€‚åœ¨ â€œgreenâ€ çŠ¶æ€ä¸‹ï¼Œåº”è¯¥æ˜¯100%ï¼Œè¡¨ç¤ºæ‰€æœ‰åˆ†ç‰‡éƒ½æ˜¯æ´»åŠ¨çš„ã€‚\næ€»çš„æ¥è¯´ï¼Œè¿™äº›ä¿¡æ¯æä¾›äº†æœ‰å…³ Elasticsearch é›†ç¾¤çŠ¶æ€å’Œæ€§èƒ½çš„å…³é”®æŒ‡æ ‡ï¼Œå¯ä»¥ç”¨äºç›‘æ§å’Œç®¡ç†é›†ç¾¤ã€‚åœ¨ â€œgreenâ€ çŠ¶æ€ä¸‹ï¼Œé›†ç¾¤æ˜¯å¥åº·çš„ï¼Œæ•°æ®å®Œæ•´æ€§å’Œå¯ç”¨æ€§éƒ½éå¸¸é«˜ã€‚\n2.3.3 elasticseach æ’ä»¶ å®˜æ–¹æä¾›äº†ä¸€äº›æ’ä»¶ä½†å¤§éƒ¨åˆ†æ˜¯æ”¶è´¹çš„ï¼Œå¦å¤–ä¹Ÿæœ‰ä¸€äº›å¼€å‘çˆ±å¥½è€…æä¾›çš„æ’ä»¶ï¼Œå¯ä»¥å®ç°å¯¹ elasticsearch é›†ç¾¤çš„çŠ¶æ€ç›‘æ§ä¸ç®¡ç†é…ç½®ç­‰åŠŸèƒ½ï¼ŒMulti Elasticsearch Head å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚\nå¯ä»¥é€šè¿‡æµè§ˆå™¨çš„åº”ç”¨å•†åº—å®‰è£… ï¼ˆchrome ã€edgeï¼‰\nhttps://chrome.google.com/webstore/detail/multi-elasticsearch-head/cpmmilfkofbeimbmgiclohpodggeheim?utm_source=ext_app_menu\nä¸‰ã€ Logstash éƒ¨ç½² Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œå¯ä»¥æ°´å¹³ä¼¸ç¼©ï¼ŒåŸºäº ruby å¼€å‘ï¼Œè€Œä¸” logstash æ•´ä¸ª ELKå½“ä¸­æ‹¥æœ‰æœ€å¤šæ’ä»¶çš„ä¸€ä¸ªç»„ä»¶ï¼Œå…¶å¯ä»¥æ¥æ”¶æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®å¹¶ç»Ÿä¸€è¾“å‡ºåˆ°æŒ‡å®šçš„ä¸”å¯ä»¥æ˜¯å¤šä¸ªä¸åŒç›®çš„åœ°ã€‚\n3.1 ç¯å¢ƒå‡†å¤‡ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® logstash 10.0.0.15 CentOS 7.6 2U 4G 3.1.2 å…³é—­ä¸éœ€è¦çš„æœåŠ¡ # å…³é—­é˜²ç«å¢™ systemctl disable firewalld --now # å…³é—­ NetworkManager systemctl disable NetworkManager --now # å…³é—­selinux setenforce 0 sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config 3.1.2 é…ç½® Java ç¯å¢ƒ yum install java-1.8.0-openjdk -y java -version 3.2 å®‰è£… logstash [Installing Logstash | Logstash Reference 7.17] | Elastic\n# å¯¼å…¥è¯ä¹¦ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch # é…ç½® yum æº cat \u003e /etc/yum.repos.d/logstash-7.repo \u003c\u003c EOF [logstash-7.x] name=Elastic repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md EOF # å®‰è£…å¹¶å¯åŠ¨æœåŠ¡ yum install -y logstash systemctl start logstash.service 3.3 logstash çš„ä½¿ç”¨ Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œå¯ä»¥æ°´å¹³ä¼¸ç¼©ï¼Œè€Œä¸” logstash æ•´ä¸ª ELK å½“ä¸­æ‹¥æœ‰æœ€å¤šæ’ä»¶çš„ä¸€ä¸ªç»„ä»¶ï¼Œå…¶å¯ä»¥æ¥æ”¶æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®å¹¶ç»Ÿä¸€è¾“å‡ºåˆ°æŒ‡å®šçš„ä¸”å¯ä»¥æ˜¯å¤šä¸ªä¸åŒç›®çš„åœ°ã€‚\n3.3.1 æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º åœ¨Logstashçš„é…ç½®ä¸­ï¼Œâ€œcodecâ€ æ˜¯\"ç¼–è§£ç å™¨\"ï¼ˆCodecï¼‰çš„ç¼©å†™ã€‚ç¼–è§£ç å™¨æ˜¯ä¸€ç§ç”¨äºå°†æ•°æ®ç¼–ç æˆç‰¹å®šæ ¼å¼æˆ–ä»ç‰¹å®šæ ¼å¼è§£ç æ•°æ®çš„ç»„ä»¶ã€‚åœ¨Logstashä¸­ï¼Œå®ƒç”¨äºæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®æ ¼å¼ã€‚\nåœ¨ä½ æä¾›çš„é…ç½®ä¸­ï¼Œä½ ä½¿ç”¨äº†Elasticsearchè¾“å‡ºæ’ä»¶ï¼Œå¹¶æŒ‡å®šäº†\"codec\"é€‰é¡¹ä¸º\"json\"ã€‚è¿™è¡¨ç¤ºä½ å¸Œæœ›å°†Logstashäº‹ä»¶æ•°æ®ç¼–ç ä¸ºJSONæ ¼å¼ï¼Œç„¶åå°†å…¶å‘é€åˆ°Elasticsearchã€‚è¿™æœ‰åŠ©äºç¡®ä¿æ•°æ®ä»¥JSONæ ¼å¼å­˜å‚¨åœ¨Elasticsearchä¸­ï¼Œä»¥ä¾¿åç»­æŸ¥è¯¢å’Œåˆ†æã€‚\nâ€œcodec\"é€‰é¡¹çš„å¸¸è§å€¼åŒ…æ‹¬ï¼š\nâ€œjsonâ€ï¼šå°†äº‹ä»¶æ•°æ®ç¼–ç ä¸ºJSONæ ¼å¼ã€‚\nâ€œplainâ€ï¼šä¸å¯¹äº‹ä»¶æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¿æŒåŸå§‹æ ¼å¼ã€‚\nâ€œjson_linesâ€ï¼šå°†äº‹ä»¶æ•°æ®ç¼–ç ä¸ºä¸€è¡Œä¸€æ¡JSONè®°å½•çš„æ ¼å¼ã€‚\nâ€œmultilineâ€ï¼šç”¨äºå¤„ç†å¤šè¡Œæ—¥å¿—äº‹ä»¶ã€‚\n[root@logstash ~]# /usr/share/logstash/bin/logstash -e 'input{ stdin{} } output{ stdout{ codec=\u003erubydebug }}' ... The stdin plugin is now waiting for input: hello { \"message\" =\u003e \"hello\",\t# æ¶ˆæ¯å†…å®¹ \"host\" =\u003e \"logstash\",\t# ä¸»æœºå \"@timestamp\" =\u003e 2023-09-19T01:16:14.334Z, # äº‹ä»¶å‘ç”Ÿæ—¶é—´ \"@version\" =\u003e \"1\"\t# äº‹ä»¶ç‰ˆæœ¬å·ï¼Œä¸€ä¸ªäº‹ä»¶å°±æ˜¯ä¸€ä¸ª ruby å¯¹è±¡ } ^C 3.3.2 æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶ [root@logstash ~]# /usr/share/logstash/bin/logstash -e 'input { stdin{} } output{ file { path =\u003e \"/tmp/log-%{+YYYY.MM.dd}.txt\"}}' ... The stdin plugin is now waiting for input: [INFO ] 2023-09-19 09:30:28.836 [Agent thread] agent - Pipelines running {:count=\u003e1, :running_pipelines=\u003e[:main], :non_running_pipelines=\u003e[]} hello world ^C # è¾“å‡ºæ–‡æœ¬æ–‡ä»¶ [root@logstash ~]# file /tmp/log-2023.09.19.txt /tmp/log-2023.09.19.txt: ASCII text # æ¶ˆæ¯å†…å®¹å·²è¾“å‡ºåˆ°æ–‡æœ¬ä¸­ï¼Œå¤šæ¡æ¶ˆæ¯ä¼šè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ [root@logstash ~]# cat /tmp/log-2023.09.19.txt {\"message\":\"hello\",\"@version\":\"1\",\"@timestamp\":\"2023-09-19T01:30:40.576Z\",\"host\":\"logstash\"} {\"message\":\"world\",\"host\":\"logstash\",\"@version\":\"1\",\"@timestamp\":\"2023-09-19T01:33:12.308Z\"} 3.3.3 æµ‹è¯•è¾“å‡ºåˆ° elasticsearch [root@logstash ~]# /usr/share/logstash/bin/logstash -e 'input { stdin{} } output{ elasticsearch {hosts =\u003e [\"10.0.0.11:9200\"] index =\u003e\"mytest-%{+YYYY.MM.dd}\" }}' ... WARNING: All illegal access operations will be denied in a future release [INFO ] 2023-09-19 10:07:09.728 [[main]-pipeline-manager] javapipeline - Pipeline started {\"pipeline.id\"=\u003e\"main\"} [INFO ] 2023-09-19 10:07:09.770 [Agent thread] agent - Pipelines running {:count=\u003e1, :running_pipelines=\u003e[:main], :non_running_pipelines=\u003e[]} The stdin plugin is now waiting for input: hello world! åœ¨ elasticsearch-01 æŸ¥çœ‹ç´¢å¼•\n[root@elasticsearch-01 ~]# curl -s -XGET \"http://localhost:9200/_cat/indices?v\" | grep mytest green open mytest-2023.09.19 qti_NT1sRNyBWrJY-T27zg 1 1 1 0 10.8kb 5.4kb ä½¿ç”¨ head æ’ä»¶ æŸ¥çœ‹\nå››ã€Kibana éƒ¨ç½² Kibana æ˜¯ä¸€æ¬¾å¼€æºçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œå®ƒæ˜¯ Elastic Stack æˆå‘˜ä¹‹ä¸€ï¼ŒåŸºäº TypeScript è¯­è¨€å¼€å‘ï¼Œè®¾è®¡ç”¨äºå’Œ Elasticsearch åä½œ,å¯ä»¥ä½¿ç”¨ Kibana å¯¹ Elasticsearch ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œæœç´¢ã€æŸ¥çœ‹ã€äº¤äº’æ“ä½œ, ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ©ç”¨å›¾è¡¨ã€è¡¨æ ¼åŠåœ°å›¾å¯¹æ•°æ®è¿›è¡Œå¤šå…ƒåŒ–çš„åˆ†æå’Œå‘ˆç°ã€‚\nKibana å¯ä»¥ä½¿å¤§æ•°æ®é€šä¿—æ˜“æ‡‚ã€‚å®ƒå¾ˆç®€å•ï¼ŒåŸºäºæµè§ˆå™¨çš„ç•Œé¢ä¾¿äºä½ å¿«é€Ÿåˆ›å»ºå’Œåˆ†äº«åŠ¨æ€æ•°æ®ä»ªè¡¨æ¿æ¥è¿½è¸ª Elasticsearch çš„å®æ—¶æ•°æ®å˜åŒ–ã€‚\n4.1 ç¯å¢ƒå‡†å¤‡ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® kibana 10.0.0.16 CentOS 7.6 1U 2G # å…³é—­é˜²ç«å¢™ systemctl disable firewalld --now # å…³é—­ NetworkManager systemctl disable NetworkManager --now # å…³é—­selinux setenforce 0 sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config 4.2 å®‰è£…kibana [Install Kibana | Kibana Guide 7.17] | Elastic\n[Install Kibana with RPM | Kibana Guide 7.17] | Elastic\nrpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch cat \u003e /etc/yum.repos.d/kibana-7.repo \u003c\u003c EOF [kibana-7.x] name=Kibana repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md EOF yum install -y kibana 4.3 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯ # ä¿®æ”¹é…ç½®æ–‡ä»¶ [root@kibana ~]# cat /etc/kibana/kibana.yml server.port: 5601 server.host: \"0.0.0.0\" elasticsearch.hosts: [\"http://10.0.0.11:9200\"] # å¯åŠ¨æœåŠ¡ [root@kibana ~]# systemctl start kibana # éªŒè¯ç«¯å£åŠæœåŠ¡çŠ¶æ€ [root@kibana ~]# ss -ntl|grep 5601 LISTEN 0 128 *:5601 *:* [root@kibana ~]# curl localhost:5601/status -I HTTP/1.1 200 OK x-content-type-options: nosniff referrer-policy: no-referrer-when-downgrade content-security-policy: script-src 'unsafe-eval' 'self'; worker-src blob: 'self'; style-src 'unsafe-inline' 'self' kbn-name: kibana kbn-license-sig: 476866a5c1f8dfa58158ed8c49315635554443bf0f3ae73994b5dfac2c777125 content-type: text/html; charset=utf-8 cache-control: private, no-cache, no-store, must-revalidate content-length: 144960 vary: accept-encoding Date: Tue, 19 Sep 2023 03:14:15 GMT Connection: keep-alive Keep-Alive: timeout=120 æœåŠ¡å¯åŠ¨æˆåŠŸåå³å¯é€šè¿‡æµè§ˆå™¨ç™»å½• kibana ç®¡ç†ç´¢å¼•å¹¶æŸ¥çœ‹æ—¥å¿—äº†\nè®¿é—®æ–¹å¼ï¼šhttp://10.0.0.16:5601/\nå¯ä»¥åœ¨ Stack Management â€“\u003e Index Management æŸ¥çœ‹åˆ°å·²æ·»åŠ çš„ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åœ¨ Index pattern æ·»åŠ ç´¢å¼•æ¨¡å¼ï¼Œæ–¹ä¾¿åç»­åœ¨ Discover ç•Œé¢æŸ¥çœ‹ã€‚\näº”ã€Logstash æ”¶é›†æ—¥å¿— 5.1 æ”¶é›†å•ä¸ªæ—¥å¿— æ³¨æ„ï¼šlogstash é»˜è®¤ä»¥ logstash ç”¨æˆ·å¯åŠ¨ï¼Œå› ä¸ºéœ€è¦ä¿è¯ logstash ç”¨æˆ·å¯¹æ—¥å¿—æ–‡ä»¶æœ‰å¯¹åº”çš„æƒé™\n5.1.1 å‡†å¤‡é…ç½®æ–‡ä»¶ï¼š [root@logstash ~]# cat /etc/logstash/conf.d/system-log.conf input { file { path =\u003e \"/var/log/messages\" # æ—¥å¿—è·¯å¾„ type =\u003e \"system-log\" # äº‹ä»¶çš„å”¯ä¸€ç±»å‹ start_position =\u003e \"beginning\" # ç¬¬ä¸€æ¬¡æ”¶é›†æ—¥å¿—çš„ä½ç½® stat_interval =\u003e \"3\" # æ—¥å¿—æ”¶é›†çš„é—´éš”æ—¶é—´ } } output { file { path =\u003e \"/tmp/%{type}-%{+YYYY.MM.dd}.log\" } } 5.1.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™ [root@logstash ~]# chmod 644 /var/log/messages 5.1.3 ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³• [root@logstash ~]# /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/system-log.conf -t ... . Config Validation Result: OK. Exiting Logstash # è¯­æ³•æ ¡éªŒé€šè¿‡ 5.1.4 é‡å¯ logstash éªŒè¯ç»“æœ # å†™å…¥ä¸€è¡Œæ—¥å¿— [root@logstash ~]# echo \"test\" \u003e\u003e /var/log/messages # æˆåŠŸè·å–æ”¶é›†åˆ°æ—¥å¿—ä¿¡æ¯ [root@logstash ~]# grep test /tmp/system-log-2023.09.19.log {\"@version\":\"1\",\"host\":\"logstash\",\"type\":\"system-log\",\"@timestamp\":\"2023-09-19T07:02:14.221Z\",\"path\":\"/var/log/messages\",\"message\":\"test\"} 5.2 æ”¶é›†å¤šä¸ªæ—¥å¿— 5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶ [root@logstash ~]# cat /etc/logstash/conf.d/system-log.conf input { file { path =\u003e \"/var/log/messages\" type =\u003e \"system-log\" start_position =\u003e \"beginning\" stat_interval =\u003e \"3\" } file { path =\u003e \"/var/log/secure\" type =\u003e \"secure-log\" start_position =\u003e \"beginning\" stat_interval =\u003e \"3\" } } output { if [type] == \"system-log\" { elasticsearch { hosts=\u003e[\"10.0.0.11:9200\"] index=\u003e\"%{type}-%{+YYYY.MM.dd}\" } } if [type] == \"secure-log\" { elasticsearch { hosts=\u003e[\"10.0.0.11:9200\"] index=\u003e\"%{type}-%{+YYYY.MM.dd}\" } } } 5.2.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™ [root@logstash ~]# chmod 644 /var/log/{messages,secure} 5.2.3 æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡ [root@logstash ~]# /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/system-log.conf -t ... . Config Validation Result: OK. Exiting Logstash 5.2.4 åœ¨ elasticsearch æŸ¥çœ‹ç´¢å¼• [root@elasticsearch-01 ~]# curl -s -XGET \"http://localhost:9200/_cat/indices?v\" | grep log green open secure-log-2023.09.19 fQpud23vSVC7cpFPCITzbw 1 1 2 0 18.3kb 9.1kb green open system-log-2023.09.19 SeqTjpl-SU-n7uXUmmBBKA 1 1 40 0 44.8kb 22.4kb 5.3 åœ¨ kibana æŸ¥çœ‹ç´¢å¼• 5.3.1 æŸ¥çœ‹å·²æœ‰ç´¢å¼• 5.3.2 æ·»åŠ ç´¢å¼•æ¨¡å¼ 5.3.3 æŸ¥çœ‹ç»“æœ 5.4 æ”¶é›† Tomcat æ—¥å¿— 5.4.1 åœ¨ logstash å®‰è£…tomcat yum install -y tomcat 5.4.2 é…ç½® tomcat æ—¥å¿—æ ¼å¼ä¸º json æ ¼å¼ # ä¿®æ”¹ pattern ä¸º json æ ¼å¼ [root@kibana ~]# grep -A 2 localhost_access_log /etc/tomcat/server.xml prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"{\u0026quot;clientip\u0026quot;:\u0026quot;%h\u0026quot;,\u0026quot;ClientUser\u0026quot;:\u0026quot;%l\u0026quot;,\u0026quot;authenticated\u0026quot;:\u0026quot;%u\u0026quot;,\u0026quot;AccessTime\u0026quot;:\u0026quot;%t\u0026quot;,\u0026quot;method\u0026quot;:\u0026quot;%r\u0026quot;,\u0026quot;status\u0026quot;:\u0026quot;%s\u0026quot;,\u0026quot;SendBytes\u0026quot;:\u0026quot;%b\u0026quot;,\u0026quot;Query?string\u0026quot;:\u0026quot;%q\u0026quot;,\u0026quot;partner\u0026quot;:\u0026quot;%{Referer}i\u0026quot;,\u0026quot;AgentVersion\u0026quot;:\u0026quot;%{User-Agent}i\u0026quot;}\"/\u003e é‡å¯æœåŠ¡å¹¶éªŒè¯ tomcat æ—¥å¿—æ ¼å¼\n[root@kibana ~]# systemctl start tomcat # ç”Ÿæˆæ—¥å¿— [root@kibana ~]# curl localhost:8080 # æˆåŠŸå°†æ—¥å¿—ä¿®æ”¹ä¸º json æ ¼å¼ [root@kibana ~]# tail /var/log/tomcat/localhost_access_log.2023-09-19.txt {\"clientip\":\"0:0:0:0:0:0:0:1\",\"ClientUser\":\"-\",\"authenticated\":\"-\",\"AccessTime\":\"[19/Sep/2023:18:17:31 +0800]\",\"method\":\"GET / HTTP/1.1\",\"status\":\"404\",\"SendBytes\":\"-\",\"Query?string\":\"\",\"partner\":\"-\",\"AgentVersion\":\"curl/7.29.0\"} å¯ä»¥é€šè¿‡ JSONåœ¨çº¿ | JSONè§£ææ ¼å¼åŒ–â€”SO JSONåœ¨çº¿å·¥å…· æ ¡éªŒæ—¥å¿—æ ¼å¼\n5.4.3 å‡†å¤‡é…ç½®æ–‡ä»¶ input { file { path =\u003e \"/var/log/tomcat/localhost_access_log.*.txt\" type =\u003e \"tomcat-access-log\" start_position =\u003e \"end\" stat_interval =\u003e \"3\" codec=\u003e \"json\" } } output { if [type] == \"tomcat-access-log\" { elasticsearch { hosts=\u003e[\"10.0.0.11:9200\"] index=\u003e\"%{type}-%{+YYYY.MM.dd}\" } } } 5.4.4 é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿— [root@logstash ~]# chmod +x /var/log/tomcat/ [root@logstash ~]# systemctl restart logstash [root@logstash ~]# curl localhost:8080 5.4.5 æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ 5.5 æ”¶é›† Java æ—¥å¿— æœ¬èŠ‚å†…å®¹ä¸»è¦ä»‹ç» multiline æ’ä»¶å®ç°å¤šè¡ŒåŒ¹é…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å°†å¤šè¡Œè¿›è¡Œåˆå¹¶çš„æ’ä»¶ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼ŒJava åº”ç”¨çš„æ—¥å¿—ä¼šå¾ˆé•¿ï¼Œåœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä»¥å¤šè¡Œçš„æ–¹å¼å‘ˆç°ï¼Œå› æ­¤éœ€è¦ç”¨æ­¤æ’ä»¶æ¥è¿›è¡Œå¤šè¡Œåˆå¹¶ä»¥ä¿è¯æ—¥å¿—çš„å®Œæ•´æ€§å’Œå¯è¯»æ€§ï¼Œæ‰€ä»¥æœ¬èŠ‚å†…å®¹çš„æ“ä½œæ˜¯å¯é€‰çš„è€Œéå¿…é¡»çš„ã€‚\n[Multiline codec plugin | Logstash Reference 8.10] | Elastic\n5.5.1 åœ¨ elasticsearch-01 å®‰è£… logstash è¿™é‡Œæ˜¯ç›´æ¥å–ç”¨ elasticsearch-01çš„ java æ—¥å¿—è¿›è¡Œæ¼”ç¤ºï¼Œå› æ­¤å®‰è£…äº† logstash\n# å¯¼å…¥è¯ä¹¦ rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch # é…ç½® yum æº cat \u003e /etc/yum.repos.d/logstash-7.repo \u003c\u003c EOF [logstash-7.x] name=Elastic repository for 7.x packages baseurl=https://artifacts.elastic.co/packages/7.x/yum gpgcheck=1 gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch enabled=1 autorefresh=1 type=rpm-md EOF # å®‰è£…å¹¶å¯åŠ¨æœåŠ¡ yum install -y logstash 5.5.2 æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ 5.5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶ [root@elasticsearch-01 ~]# cat /etc/logstash/conf.d/test.conf input { stdin { codec =\u003e multiline { pattern =\u003e \"^\\[\" # å½“é‡åˆ°[å¼€å¤´çš„è¡Œæ—¶å€™å°†å¤šè¡Œè¿›è¡Œåˆå¹¶ negate =\u003e true # true ä¸ºåŒ¹é…æˆåŠŸè¿›è¡Œæ“ä½œï¼Œfalse ä¸ºä¸æˆåŠŸè¿›è¡Œæ“ä½œ what =\u003e \"previous\" # ä¸ä»¥å‰çš„è¡Œåˆå¹¶ï¼Œå¦‚æœæ˜¯ä¸‹é¢çš„è¡Œåˆå¹¶å°±æ˜¯ next } } } filter { #æ—¥å¿—è¿‡æ»¤ï¼Œå¦‚æœæ‰€æœ‰çš„æ—¥å¿—éƒ½è¿‡æ»¤å°±å†™è¿™é‡Œï¼Œå¦‚æœåªé’ˆå¯¹æŸä¸€ä¸ªè¿‡æ»¤å°±å†™åœ¨ input é‡Œé¢çš„æ—¥å¿—è¾“å…¥é‡Œé¢ } output { stdout { codec =\u003e rubydebug } } 5.5.5.2 æ£€æŸ¥é…ç½® /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/test.conf -t ... which may change in a future major release of Logstash. To avoid unexpected changes when upgrading Logstash, please explicitly declare your desired ECS Compatibility mode. Configuration OK 5.5.5.3 ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯ [root@elasticsearch-01 ~]# /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/test.conf Using bundled JDK: /usr/share/logstash/jdk ... [INFO ] 2023-09-21 11:59:55.717 [[main]-pipeline-manager] javapipeline - Pipeline started {\"pipeline.id\"=\u003e\"main\"} The stdin plugin is now waiting for input: 5.5.3 æ”¶é›† Java æ—¥å¿— 5.5.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶ [root@elasticsearch-01 ~]# cat /etc/logstash/conf.d/java.conf input { file { path =\u003e \"/apps/elasticsearch/logs/elk-cluster.log\" type =\u003e \"java-log\" start_position =\u003e \"beginning\" codec =\u003e multiline { pattern =\u003e \"^\\[\" negate =\u003e true what =\u003e \"previous\" } } } output { if [type] == \"java-log\" { elasticsearch { hosts =\u003e [\"10.0.0.11:9200\"] index=\u003e\"%{type}-%{+YYYY.MM.dd}\" } } } 5.5.3.2 ç”Ÿæˆ Java æ—¥å¿—æ–‡ä»¶ é‡å¯èŠ‚ç‚¹elasticsearch-02ï¼Œä½¿å¾—é›†ç¾¤äº§ç”Ÿå¤šè¡Œé”™è¯¯æ—¥å¿—ä»¥è§‚å¯Ÿå¤šè¡Œåˆå¹¶å’Œçš„æ•ˆæœ\n[root@elasticsearch-02 ~]# systemctl restart elasticsearch.service ç”Ÿæˆçš„éƒ¨åˆ†é”™è¯¯æ—¥å¿—ï¼š\nless /apps/elasticsearch/logs/elk-cluster.log\n5.5.3.3 æˆåŠŸæ”¶é›†æ—¥å¿— 5.5.3.4 é€šè¿‡ kibana æŸ¥çœ‹ç»“æœ æ·»åŠ ç´¢å¼•æ¨¡å¼ java-log* ååœ¨ Discover é¢æ¿æŸ¥çœ‹åˆå¹¶åçš„æ—¥å¿—\n5.6 æ”¶é›† Nginx æ—¥å¿— nginx çš„æ—¥å¿—æ”¶é›†å’Œ Java ç±»ä¼¼ï¼Œæ ¸å¿ƒç‚¹åœ¨äºå°†æ—¥å¿—æ ¼å¼ä¿®æ”¹ä¸º json æ ¼å¼ï¼Œè¿™é‡Œä»…æ¼”ç¤ºå¦‚ä½•ä¿®æ”¹æ—¥å¿—æ ¼å¼ã€‚\nåœ¨ logstash å®‰è£… nginx\n[root@logstash ~]# yum install -y nginx ä¿®æ”¹ nginx æ—¥å¿—ä¸º json æ ¼å¼\n[root@logstash ~]# grep log_format -A 13 /etc/nginx/nginx.conf log_format main '{\"@timestamp\":\"$time_iso8601\",' '\"host\":\"$server_addr\",' '\"clientip\":\"$remote_addr\",' '\"size\":$body_bytes_sent,' '\"responsetime\":$request_time,' '\"upstreamtime\":\"$upstream_response_time\",' '\"upstreamhost\":\"$upstream_addr\",' '\"http_host\":\"$host\",' '\"url\":\"$uri\",' '\"domain\":\"$host\",' '\"xff\":\"$http_x_forwarded_for\",' '\"referer\":\"$http_referer\",' '\"status\":\"$status\"}'; é‡å¯ nginx ç”Ÿæˆæ—¥å¿—\n[root@logstash ~]# systemctl start nginx [root@logstash ~]# curl localhost [root@logstash ~]# tail /var/log/nginx/access.log {\"@timestamp\":\"2023-09-21T15:37:49+08:00\",\"host\":\"::1\",\"clientip\":\"::1\",\"size\":4833,\"responsetime\":0.000,\"upstreamtime\":\"-\",\"upstreamhost\":\"-\",\"http_host\":\"localhost\",\"url\":\"/index.html\",\"domain\":\"localhost\",\"xff\":\"-\",\"referer\":\"-\",\"status\":\"200\"} æ ¡éªŒæ—¥å¿—æ ¼å¼ JSONåœ¨çº¿ | JSONè§£ææ ¼å¼åŒ–â€”SO JSONåœ¨çº¿å·¥å…·\n5.7 ä½¿ç”¨ Redis ç¼“å­˜æ—¥å¿— ç›®æ ‡ï¼šé€šè¿‡åœ¨ redis å®¢æˆ·ç«¯éƒ¨ç½²çš„ logstash ï¼ˆä¸»æœºå log-clientï¼‰ æ”¶é›†æ—¥å¿—ï¼Œå†™å…¥ redis ï¼ˆç¼“å­˜ä½œç”¨ï¼‰ï¼Œå†é€šè¿‡ä¸“é—¨çš„ä¸€å° logstashï¼ˆä¸»æœºå logstashï¼‰è¯»å– redis ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearchã€‚\n5.7.1 å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨ ä¸»æœºå IP ç³»ç»Ÿ é…ç½® log-client 10.0.0.9 CentOS 7.6 2U 4G # å…³é—­é˜²ç«å¢™ systemctl disable firewalld --now # å…³é—­ NetworkManager systemctl disable NetworkManager --now # å…³é—­selinux setenforce 0 sed -i '/SELINUX/s/enforcing/disabled/' /etc/selinux/config # ä¿®æ”¹æ–‡ä»¶å¥æŸ„æ•°çš„é™åˆ¶ echo \"* soft nofile 65536\" \u003e\u003e /etc/security/limits.conf echo \"* hard nofile 65536\" \u003e\u003e /etc/security/limits.conf å®‰è£… redis\n[root@log-client ~]# yum install -y redis # ä¿®æ”¹é…ç½®æ–‡ä»¶ [root@log-client ~]# cat /etc/redis.conf bind 0.0.0.0 protected-mode yes port 6379 tcp-backlog 511 timeout 0 tcp-keepalive 300 daemonize yes supervised no pidfile /var/run/redis_6379.pid loglevel notice databases 16 requirepass passwd [root@log-client ~]# systemctl start redis ## å®‰è£… logstash [root@log-client ~]# # å¯¼å…¥è¯ä¹¦ [root@log-client ~]# rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch [root@log-client ~]# # é…ç½® yum æº [root@log-client ~]# cat \u003e /etc/yum.repos.d/logstash-7.repo \u003c\u003c EOF \u003e [logstash-7.x] \u003e name=Elastic repository for 7.x packages \u003e baseurl=https://artifacts.elastic.co/packages/7.x/yum \u003e gpgcheck=1 \u003e gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch \u003e enabled=1 \u003e autorefresh=1 \u003e type=rpm-md \u003e EOF [root@log-client ~]# yum install -y logstash 5.7.2 æ”¶é›†æ—¥å¿—å†™å…¥ redis [root@log-client ~]# cat /etc/logstash/conf.d/sys-to-redis.conf input { file { path =\u003e \"/var/log/message\" type =\u003e \"system-log\" start_position =\u003e \"beginning\" stat_interval =\u003e \"2\" } } output { if [type] == \"system-log\" { redis { data_type =\u003e \"list\" key =\u003e \"system-log\" host =\u003e \"10.0.0.9\" port =\u003e \"6379\" db =\u003e \"0\" password =\u003e \"passwd\" } } } root@log-client ~]# chmod +r /var/log/messages [root@log-client ~]# ll /var/log/messages -rw-r--r--. 1 root root 596944 Sep 22 11:39 /var/log/messages [root@log-client ~]# systemctl start logstash.service # æˆåŠŸå†™å…¥æ—¥å¿— [root@log-client ~]# telnet localhost 6379 ... Escape character is '^]'. auth passwd +OK select 0 +OK keys * *1 $10 system-log # ä»¥list æ–¹å¼å­˜å‚¨ LRANGE system-log 0 0 #æŸ¥çœ‹å…¶ä¸­ä¸€æ¡æ¶ˆæ¯ *1 $139 {\"path\":\"/var/log/messages\",\"host\":\"log-client\",\"@timestamp\":\"2023-09-22T03:52:48.547Z\",\"type\":\"system-log\",\"@version\":\"1\",\"message\":\"tet\"} 5.7.3 è¯»å– redis çš„æ—¥å¿—å†™å…¥ elasticsearch å‡†å¤‡é…ç½®æ–‡ä»¶ï¼š\n[root@logstash ~]# cat /etc/logstash/conf.d/redis-to-es.conf input { redis { data_type =\u003e \"list\" key =\u003e \"system-log\" host =\u003e \"10.0.0.9\" port =\u003e \"6379\" db =\u003e \"0\" password =\u003e \"passwd\" } } output { if [type] == \"system-log\" { elasticsearch { hosts =\u003e [\"10.0.0.11:9200\"] index =\u003e \"redis-to-es-%{+YYYY.MM.dd}\" } } } # é‡å¯logstash [root@logstash ~]# systemctl restart logstash éªŒè¯ç»“æœï¼š\nelasticseach æˆåŠŸè·å–åˆ°æ—¥å¿—ä¿¡æ¯\nredis ä¸­çš„æ¶ˆæ¯è¢«æ¶ˆè´¹ï¼š\n5.8 ä½¿ç”¨ Kafka ç¼“å­˜æ—¥å¿— 5.8.1 åœ¨ log-clinet éƒ¨ç½² kafka Kafkaç®€ä»‹ä¸é›†ç¾¤éƒ¨ç½² | WZâ€™s Blog (senmer.github.io)\n5.8.2 å°†æ—¥å¿—å†™å…¥ Kafka [root@log-client ~]# cat /etc/logstash/conf.d/sys-to-kafka.conf input { file { path =\u003e \"/var/log/messages\" type =\u003e \"system-log\" start_position =\u003e \"beginning\" stat_interval =\u003e \"2\" } } output { if [type] == \"system-log\" { kafka { bootstrap_servers =\u003e \"10.0.0.11:9092\" topic_id =\u003e \"system-log\" } } } # é…ç½®åŸŸåè§£æï¼Œkafka è¿æ¥ elasticsearch éœ€è¦ç”¨åˆ° [root@log-client ~]# cat /etc/hosts 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 ::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 10.0.0.11 elasticsearch-01 10.0.0.12 elasticsearch-02 10.0.0.13 elasticsearch-03 # é‡å¯ logstash [root@log-client ~]# systemctl restart logstash 5.8.3 æŸ¥çœ‹ Kafka ä¸­çš„ topic æ³¨æ„ï¼šæœ¬ç¤ºä¾‹ä¸­ Kafkaã€zookeeperã€elasticsearch é›†ç¾¤å‡å®‰è£…åœ¨ï¼ˆ10.0.0.11ã€10.0.0.12ã€10.0.0.13ï¼‰ä¸‰å°ä¸»æœºä¸Š\n[root@elasticsearch-01 kafka]# pwd /usr/local/kafka [root@elasticsearch-01 kafka]# ./bin/kafka-topics.sh --list --zookeeper localhost:2181 OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N __consumer_offsets system-log # æˆåŠŸå†™å…¥æ—¥å¿— 5.8.4 è¯»å– Kafka ä¸­çš„æ—¥å¿—å†™å…¥ Elasticsearch [root@logstash ~]# cat /etc/logstash/conf.d/kafka-to-es.conf input { kafka { bootstrap_servers =\u003e \"10.0.0.11:9092\" topics =\u003e \"system-log\" consumer_threads =\u003e 1 } } output { elasticsearch { hosts =\u003e [\"10.0.0.11:9200\"] index =\u003e \"kafka-to-es-%{+YYYY.MM.dd}\" } } [root@logstash ~]# systemctl restart logstash.service 5.9 ä½¿ç”¨ filebeat æ”¶é›†æ—¥å¿— è¦åœ¨ Filebeat ä¸­ä½¿ç”¨ conf.d/* çš„æ–¹å¼å¯¼å…¥é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ï¼š\nåˆ›å»ºä¸€ä¸ªå­˜æ”¾é¢å¤–é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œé€šå¸¸å‘½åä¸º conf.dï¼Œå¹¶å°†ä½ çš„é¢å¤–é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨è¯¥ç›®å½•ä¸­ã€‚è¿™äº›é…ç½®æ–‡ä»¶å¯ä»¥åŒ…å«ä¸åŒè¾“å…¥ã€è¿‡æ»¤å™¨å’Œè¾“å‡ºçš„å®šä¹‰ã€‚\nç¡®ä¿ Filebeat é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªé…ç½®é¡¹ï¼Œå‘Šè¯‰ Filebeat å»åŠ è½½ conf.d ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥ä½¿ç”¨ filebeat.config.modules æ¥é…ç½®é¢å¤–é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nfilebeat.config.modules: path: ${path.config}/modules.d/*.yml reload.enabled: false filebeat.config.inputs: enabled: true path: ${path.config}/conf.d/*.yml # è¿™é‡ŒæŒ‡å®šé¢å¤–é…ç½®æ–‡ä»¶çš„è·¯å¾„ ç¡®ä¿ä½ çš„é¢å¤–é…ç½®æ–‡ä»¶ï¼ˆä½äº conf.d ç›®å½•ä¸­ï¼‰å…·æœ‰æ­£ç¡®çš„æ ¼å¼å’Œè¯­æ³•ã€‚è¿™äº›é…ç½®æ–‡ä»¶å¯ä»¥åŒ…å«è¾“å…¥ã€è¿‡æ»¤å™¨å’Œè¾“å‡ºçš„å®šä¹‰ï¼Œç±»ä¼¼äºä¸»é…ç½®æ–‡ä»¶ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é¢å¤–é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼ˆconf.d/my-custom-input.ymlï¼‰ï¼š\nfilebeat.inputs: - type: log paths: - /var/log/myapp/*.log fields: log_type: myapp-log ä¿å­˜ä¸»é…ç½®æ–‡ä»¶å’Œé¢å¤–é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯åŠ¨ Filebeat æœåŠ¡ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š sudo systemctl restart filebeat è¿™æ ·ï¼ŒFilebeat å°†åŠ è½½ä¸»é…ç½®æ–‡ä»¶ä»¥åŠä½äº conf.d ç›®å½•ä¸‹çš„æ‰€æœ‰é¢å¤–é…ç½®æ–‡ä»¶ï¼Œå¹¶æ ¹æ®è¿™äº›é…ç½®æ–‡ä»¶æ¥å¤„ç†æ—¥å¿—æ•°æ®ã€‚\nè¯·æ ¹æ®ä½ çš„å®é™…éœ€æ±‚å’Œç¯å¢ƒå¯¹é…ç½®è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¹¶ç¡®ä¿é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚\nhttps://www.elastic.co/guide/en/beats/filebeat/7.17/setup-repositories.html#_yum\n5.9.1 åœ¨ log-client å®‰è£… filebeat [root@log-client ~]# sudo rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch [root@log-client ~]# [root@log-client ~]# cat \u003e /etc/yum.repos.d/filebeat-7.repo \u003c\u003c EOF \u003e [elastic-7.x] \u003e name=Elastic repository for 7.x packages \u003e baseurl=https://artifacts.elastic.co/packages/7.x/yum \u003e gpgcheck=1 \u003e gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch \u003e enabled=1 \u003e autorefresh=1 \u003e type=rpm-md \u003e EOF [root@log-client ~]# sudo yum install filebeat 5.9.2 æ”¶é›†ç³»ç»Ÿæ—¥å¿— 5.9.2.1 æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—ï¼Œå†™å…¥ kafka [root@log-client ~]# cat /etc/filebeat/filebeat.yml lebeat.config.modules: path: ${path.config}/modules.d/*.yml reload.enabled: true filebeat.inputs: - type: log enabled: true paths: - /var/log/*.log - /var/log/messages exclude_lines: [\"^DBG\"] exclude_files: [\".gz$\"] fields_under_root: true fields: document_type: \"system-log\" output.kafka: hosts: [\"10.0.0.11:9092\", \"10.0.0.12:9092\", \"10.0.0.13:9092\"] topic: \"system-log-filebeat\" partition.round_robin: reachable_only: true required_acks: 1 compression: gzip max_message_bytes: 1000000 [root@log-client ~]# systemctl restart filebeat 2.9.2.2 åœ¨ kafka ä¸­æŸ¥çœ‹ topic [root@elasticsearch-01 elasticsearch]# /usr/local/src/kafka_2.12-2.1.0/bin/kafka-topics.sh --list --zookeeper localhost:2181 |grep filebeat ... system-log-filebeat 2.9.2.3 ä½¿ç”¨ logstash å°† kafka ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearch [root@logstash ~]# cat /etc/logstash/conf.d/kafka-to-es.conf input { kafka { bootstrap_servers =\u003e \"10.0.0.11:9092\" topics =\u003e \"system-log-filebeat\" consumer_threads =\u003e 1 } } output { elasticsearch { hosts =\u003e [\"10.0.0.11:9200\"] index =\u003e \"syslog-filebeat-%{+YYYY.MM.dd}\" } } [root@logstash ~]# systemctl restart logstash FAQ elk ä¸­ç”¨ redis å’Œç”¨ kafka ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ« åœ¨ELKï¼ˆElasticsearch, Logstash, Kibanaï¼‰å †æ ˆä¸­ï¼Œä½¿ç”¨Rediså’ŒKafkaæ¥ç¼“å­˜æ—¥å¿—æœ‰ä¸€äº›åŒºåˆ«ï¼Œå®ƒä»¬åˆ†åˆ«é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨æƒ…å¢ƒå’Œéœ€æ±‚ï¼š\nRedisç¼“å­˜æ—¥å¿—ï¼š\nRedisæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œé€šå¸¸ç”¨äºç¼“å­˜å’Œé«˜é€Ÿè¯»å†™æ“ä½œã€‚åœ¨ELKä¸­ï¼ŒRedisé€šå¸¸ç”¨äºç¼“å­˜æ—¥å¿—äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨Logstashå’ŒElasticsearchä¹‹é—´æä¾›å¿«é€Ÿçš„ç¼“å†²æœºåˆ¶ã€‚ ä½¿ç”¨Redisç¼“å­˜æ—¥å¿—çš„ä¼˜ç‚¹åŒ…æ‹¬é«˜é€Ÿçš„å†™å…¥å’Œè¯»å–é€Ÿåº¦ï¼Œä»¥åŠç®€å•çš„è®¾ç½®å’Œé…ç½®ã€‚ ç¼ºç‚¹æ˜¯Redisçš„å­˜å‚¨å®¹é‡å—é™äºå†…å­˜å¤§å°ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„å†…å­˜æ¥ç¼“å­˜å¤§é‡çš„æ—¥å¿—äº‹ä»¶ã€‚æ­¤å¤–ï¼ŒRedisä¸æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†æ—¥å¿—æµçš„å·¥å…·ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½éœ€è¦é¢å¤–çš„å®šåˆ¶ã€‚ Kafkaç¼“å­˜æ—¥å¿—ï¼š\nKafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šå¸¸ç”¨äºé«˜ååé‡çš„æ•°æ®æµå¤„ç†ã€‚åœ¨ELKä¸­ï¼ŒKafkaç”¨äºæ¥æ”¶ã€ç¼“å­˜å’Œåˆ†å‘æ—¥å¿—äº‹ä»¶ï¼Œå……å½“äº†ä¸€ä¸ªæŒä¹…æ€§çš„æ•°æ®ç¼“å†²å±‚ã€‚ ä½¿ç”¨Kafkaçš„ä¼˜ç‚¹åŒ…æ‹¬èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµï¼Œæä¾›æ•°æ®æŒä¹…æ€§ï¼Œä»¥åŠå…·å¤‡é«˜å¯ç”¨æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚ ç¼ºç‚¹æ˜¯Kafkaçš„é…ç½®å’Œç»´æŠ¤å¯èƒ½ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œå®ƒä¸åƒRedisé‚£æ ·é€‚ç”¨äºä½å»¶è¿Ÿè¦æ±‚çš„åœºæ™¯ã€‚ å…³é”®åŒºåˆ«ï¼š\nRedisä¸»è¦ç”¨äºç¬æ—¶æ€§ç¼“å­˜ï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿè¯»å†™æ“ä½œçš„åœºæ™¯ï¼Œä½†ä¸é€‚ç”¨äºé•¿æœŸå­˜å‚¨ã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³Logstashå’ŒElasticsearchä¹‹é—´çš„é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ã€‚ Kafkaæ›´é€‚åˆäºæ•°æ®æµå¤„ç†ï¼Œèƒ½å¤Ÿç¼“å­˜å¤§é‡æ•°æ®å¹¶ç¡®ä¿æŒä¹…æ€§ã€‚å®ƒå…è®¸å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†æ•°æ®ï¼Œå› æ­¤é€‚ç”¨äºå¤§è§„æ¨¡ã€é«˜ååé‡çš„æ—¥å¿—å¤„ç†ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œé€‰æ‹©ä½¿ç”¨Redisè¿˜æ˜¯Kafkaå–å†³äºä½ çš„æ—¥å¿—å¤„ç†éœ€æ±‚å’Œæ¶æ„ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªç®€å•çš„ç¼“å†²å±‚æ¥è§£å†³é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼ŒRediså¯èƒ½æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ã€‚å¦‚æœä½ éœ€è¦å¤„ç†å¤§é‡çš„æ—¥å¿—æ•°æ®ï¼Œéœ€è¦æŒä¹…æ€§å’Œåˆ†å¸ƒå¼å¤„ç†èƒ½åŠ›ï¼Œé‚£ä¹ˆKafkaå¯èƒ½æ›´é€‚åˆã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘å°†å®ƒä»¬ç»“åˆä½¿ç”¨ï¼Œä½¿ç”¨Redisè¿›è¡ŒçŸ­æœŸç¼“å­˜ï¼Œç„¶åå°†æ—¥å¿—äº‹ä»¶å†™å…¥Kafkaä»¥è¿›è¡Œé•¿æœŸå­˜å‚¨å’Œåˆ†å‘ã€‚\nfilebeat å’Œ logstash çš„åŒºåˆ« Filebeatå’ŒLogstashéƒ½æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“çš„å·¥å…·ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼Œä¸»è¦æ¶‰åŠåˆ°å®ƒä»¬çš„ç”¨é€”ã€ç‰¹æ€§å’Œæ€§èƒ½ï¼š\nç”¨é€”ï¼š\nFilebeatï¼šFilebeatæ˜¯è½»é‡çº§çš„æ•°æ®æ”¶é›†å™¨ï¼Œä¸“æ³¨äºä»æ–‡ä»¶å’Œæ—¥å¿—ä½ç½®æ”¶é›†æ•°æ®å¹¶å°†å…¶å‘é€åˆ°ç›®æ ‡ä½ç½®ï¼Œé€šå¸¸æ˜¯Elasticsearchæˆ–Logstashã€‚å®ƒä¸»è¦ç”¨äºæ—¥å¿—æ–‡ä»¶çš„æ”¶é›†å’Œè½¬å‘ã€‚ Logstashï¼šLogstashæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®å¤„ç†å¼•æ“ï¼Œå…·æœ‰æ•°æ®è½¬æ¢ã€è¿‡æ»¤å’Œä¸°å¯ŒåŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨äºæ•°æ®çš„é‡‡é›†ã€è½¬æ¢ã€ä¸°å¯Œã€è¿‡æ»¤å’Œè¾“å‡ºã€‚è™½ç„¶å®ƒä¹Ÿå¯ä»¥ç”¨äºæ—¥å¿—æ”¶é›†ï¼Œä½†å…¶åŠŸèƒ½æ›´ä¸°å¯Œï¼Œå¯ä»¥å¤„ç†å¤šç§æ•°æ®æºå’Œæ ¼å¼ã€‚ å¤„ç†å’Œè½¬æ¢ï¼š\nFilebeatï¼šFilebeaté€šå¸¸ä¸å¯¹æ•°æ®è¿›è¡Œå¤„ç†æˆ–è½¬æ¢ï¼Œå®ƒè´Ÿè´£å°†åŸå§‹æ•°æ®å‘é€åˆ°ç›®æ ‡ä½ç½®ã€‚å®ƒå¯ä»¥å¯¹æ•°æ®è¿›è¡Œç®€å•çš„ç­›é€‰ï¼Œä½†ä¸å…·å¤‡å¤æ‚çš„æ•°æ®å¤„ç†åŠŸèƒ½ã€‚ Logstashï¼šLogstashå…·æœ‰å¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¤æ‚çš„è½¬æ¢ã€è¿‡æ»¤ã€ä¸°å¯Œå’Œæ ‡å‡†åŒ–æ“ä½œã€‚è¿™ä½¿å¾—Logstashåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¤æ‚å¤„ç†çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚ æ’ä»¶å’Œè¾“å‡ºï¼š\nFilebeatï¼šFilebeatçš„ä¸»è¦ç›®æ ‡æ˜¯å°†æ•°æ®å‘é€åˆ°Elasticsearchã€Logstashæˆ–å…¶ä»–ç›®æ ‡ã€‚å®ƒçš„è¾“å‡ºé€‰é¡¹ç›¸å¯¹è¾ƒå°‘ï¼Œä¸»è¦ç”¨äºæ•°æ®çš„ä¼ è¾“ã€‚ Logstashï¼šLogstashæœ‰ä¸°å¯Œçš„æ’ä»¶å’Œè¾“å‡ºé€‰é¡¹ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°å¤šç§ç›®æ ‡ï¼ŒåŒ…æ‹¬Elasticsearchã€Kafkaã€Redisã€æ•°æ®åº“ç­‰ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å„ç§è¾“å…¥æ’ä»¶æ¥æ¥æ”¶æ•°æ®æºã€‚ è½»é‡æ€§å’Œæ€§èƒ½ï¼š\nFilebeatï¼šFilebeatè®¾è®¡ä¸ºè½»é‡çº§ï¼Œå ç”¨è¾ƒå°‘çš„ç³»ç»Ÿèµ„æºï¼Œé€‚ç”¨äºéƒ¨ç½²åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ã€‚å®ƒé€‚åˆå¿«é€Ÿä¼ è¾“æ—¥å¿—æ•°æ®ã€‚ Logstashï¼šLogstashç›¸å¯¹è¾ƒé‡ï¼Œéœ€è¦æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œå¤§è§„æ¨¡æ•°æ®å¤„ç†æ—¶ã€‚å®ƒé€‚åˆå¤„ç†å¤æ‚çš„æ•°æ®å¤„ç†ä»»åŠ¡ã€‚ éƒ¨ç½²åœºæ™¯ï¼š\nFilebeaté€‚ç”¨äºç®€å•çš„æ—¥å¿—ä¼ è¾“å’Œå¿«é€Ÿçš„æ—¥å¿—æ”¶é›†åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è½»é‡çº§è§£å†³æ–¹æ¡ˆçš„æƒ…å†µä¸‹ã€‚ Logstashé€‚ç”¨äºéœ€è¦è¿›è¡Œæ•°æ®å¤„ç†ã€è½¬æ¢å’Œä¸°å¯Œæ“ä½œçš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯å½“éœ€è¦å¤„ç†å¤šç§æ•°æ®æºæˆ–æ•°æ®æ ¼å¼æ—¶ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨Filebeatã€Logstashï¼Œæˆ–è€…å®ƒä»¬çš„ç»„åˆï¼Œä»¥æ„å»ºé€‚åˆä½ çš„æ—¥å¿—æ”¶é›†å’Œå¤„ç†æ¶æ„ã€‚è¦æ ¹æ®ç‰¹å®šéœ€æ±‚è¿›è¡Œé€‰æ‹©ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚\n","wordCount":"9473","inLanguage":"zh","datePublished":"2023-10-08T17:21:41+08:00","dateModified":"2023-10-08T17:21:41+08:00","author":[{"@type":"Person","name":"wz"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/zh/posts/tech/elk/elk%E9%83%A8%E7%BD%B2%E5%92%8C%E4%BD%BF%E7%94%A8/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://senmer.github.io/zh/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/zh/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://senmer.github.io/zh/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://senmer.github.io/zh/posts/tech title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://senmer.github.io/zh/categories/ title="ğŸ§© åˆ†ç±»"><span>ğŸ§© åˆ†ç±»</span></a></li><li><a href=https://senmer.github.io/zh/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://senmer.github.io/zh/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://senmer.github.io/zh/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/zh/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/zh/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/zh/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>ELKéƒ¨ç½²å’Œä½¿ç”¨</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2023-10-08
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>9473å­—
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>19åˆ†é’Ÿ
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>wz
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e4%b8%80elk-%e7%ae%80%e4%bb%8b aria-label="ä¸€ã€ELK ç®€ä»‹">ä¸€ã€ELK ç®€ä»‹</a></li><li><a href=#%e4%ba%8celasticsearch-%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2 aria-label="äºŒã€Elasticsearch é›†ç¾¤éƒ¨ç½²">äºŒã€Elasticsearch é›†ç¾¤éƒ¨ç½²</a><ul><li><a href=#21-%e7%8e%af%e5%a2%83%e5%88%9d%e5%a7%8b%e5%8c%96 aria-label="2.1 ç¯å¢ƒåˆå§‹åŒ–">2.1 ç¯å¢ƒåˆå§‹åŒ–</a><ul><li><a href=#211-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87 aria-label="2.1.1 ç¯å¢ƒå‡†å¤‡">2.1.1 ç¯å¢ƒå‡†å¤‡</a></li><li><a href=#212-%e5%86%85%e6%a0%b8%e5%8f%82%e6%95%b0%e5%8f%8a%e6%9c%8d%e5%8a%a1%e8%b0%83%e6%95%b4 aria-label="2.1.2 å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´">2.1.2 å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´</a></li><li><a href=#213-%e9%85%8d%e7%bd%ae-hosts-%e8%a7%a3%e6%9e%90 aria-label="2.1.3 é…ç½® hosts è§£æ">2.1.3 é…ç½® hosts è§£æ</a></li><li><a href=#214-%e5%ae%89%e8%a3%85%e5%bf%85%e8%a6%81%e7%9a%84%e8%bd%af%e4%bb%b6%e5%b9%b6%e5%90%8c%e6%ad%a5%e6%97%b6%e9%97%b4 aria-label="2.1.4 å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´">2.1.4 å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´</a></li><li><a href=#215-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="2.1.5 é…ç½® java ç¯å¢ƒ">2.1.5 é…ç½® java ç¯å¢ƒ</a></li></ul></li><li><a href=#22-%e5%ae%89%e8%a3%85-elasticsearch aria-label="2.2 å®‰è£… elasticsearch">2.2 å®‰è£… elasticsearch</a><ul><li><a href=#221-yum-%e5%ae%89%e8%a3%85-elasticsearch-717 aria-label="2.2.1 yum å®‰è£… elasticsearch 7.17">2.2.1 yum å®‰è£… elasticsearch 7.17</a></li><li><a href=#222-%e4%bf%ae%e6%94%b9%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="2.2.2 ä¿®æ”¹é…ç½®æ–‡ä»¶">2.2.2 ä¿®æ”¹é…ç½®æ–‡ä»¶</a></li><li><a href=#223-%e4%bf%ae%e6%94%b9%e5%86%85%e5%ad%98%e9%99%90%e5%88%b6 aria-label="2.2.3 ä¿®æ”¹å†…å­˜é™åˆ¶">2.2.3 ä¿®æ”¹å†…å­˜é™åˆ¶</a></li></ul></li><li><a href=#23-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1%e5%b9%b6%e6%9f%a5%e7%9c%8b%e9%9b%86%e7%be%a4%e7%8a%b6%e6%80%81 aria-label="2.3 å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€">2.3 å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</a><ul><li><a href=#231-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label="2.3.1 å¯åŠ¨æœåŠ¡">2.3.1 å¯åŠ¨æœåŠ¡</a></li><li><a href=#232-%e6%9f%a5%e7%9c%8b%e9%9b%86%e7%be%a4%e7%8a%b6%e6%80%81 aria-label="2.3.2 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€">2.3.2 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€</a></li><li><a href=#233-elasticseach-%e6%8f%92%e4%bb%b6 aria-label="2.3.3 elasticseach æ’ä»¶">2.3.3 elasticseach æ’ä»¶</a></li></ul></li></ul></li><li><a href=#%e4%b8%89-logstash-%e9%83%a8%e7%bd%b2 aria-label="ä¸‰ã€ Logstash éƒ¨ç½²">ä¸‰ã€ Logstash éƒ¨ç½²</a><ul><li><a href=#31-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87 aria-label="3.1 ç¯å¢ƒå‡†å¤‡">3.1 ç¯å¢ƒå‡†å¤‡</a><ul><li><a href=#312-%e5%85%b3%e9%97%ad%e4%b8%8d%e9%9c%80%e8%a6%81%e7%9a%84%e6%9c%8d%e5%8a%a1 aria-label="3.1.2 å…³é—­ä¸éœ€è¦çš„æœåŠ¡">3.1.2 å…³é—­ä¸éœ€è¦çš„æœåŠ¡</a></li><li><a href=#312-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="3.1.2 é…ç½® Java ç¯å¢ƒ">3.1.2 é…ç½® Java ç¯å¢ƒ</a></li></ul></li><li><a href=#32-%e5%ae%89%e8%a3%85-logstash aria-label="3.2 å®‰è£… logstash">3.2 å®‰è£… logstash</a></li><li><a href=#33-logstash-%e7%9a%84%e4%bd%bf%e7%94%a8 aria-label="3.3 logstash çš„ä½¿ç”¨">3.3 logstash çš„ä½¿ç”¨</a><ul><li><a href=#331-%e6%b5%8b%e8%af%95%e6%a0%87%e5%87%86%e8%be%93%e5%85%a5%e5%92%8c%e6%a0%87%e5%87%86%e8%be%93%e5%87%ba aria-label="3.3.1 æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º">3.3.1 æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º</a></li><li><a href=#332-%e6%b5%8b%e8%af%95%e8%be%93%e5%87%ba%e5%88%b0%e6%96%87%e4%bb%b6 aria-label="3.3.2 æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶">3.3.2 æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶</a></li><li><a href=#333-%e6%b5%8b%e8%af%95%e8%be%93%e5%87%ba%e5%88%b0-elasticsearch aria-label="3.3.3 æµ‹è¯•è¾“å‡ºåˆ° elasticsearch">3.3.3 æµ‹è¯•è¾“å‡ºåˆ° elasticsearch</a></li></ul></li></ul></li><li><a href=#%e5%9b%9bkibana-%e9%83%a8%e7%bd%b2 aria-label="å››ã€Kibana éƒ¨ç½²">å››ã€Kibana éƒ¨ç½²</a><ul><li><a href=#41-%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87 aria-label="4.1 ç¯å¢ƒå‡†å¤‡">4.1 ç¯å¢ƒå‡†å¤‡</a></li><li><a href=#42-%e5%ae%89%e8%a3%85kibana aria-label="4.2 å®‰è£…kibana">4.2 å®‰è£…kibana</a></li><li><a href=#43-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1%e5%b9%b6%e9%aa%8c%e8%af%81 aria-label="4.3 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯">4.3 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯</a></li></ul></li><li><a href=#%e4%ba%94logstash-%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97 aria-label="äº”ã€Logstash æ”¶é›†æ—¥å¿—">äº”ã€Logstash æ”¶é›†æ—¥å¿—</a><ul><li><a href=#51-%e6%94%b6%e9%9b%86%e5%8d%95%e4%b8%aa%e6%97%a5%e5%bf%97 aria-label="5.1 æ”¶é›†å•ä¸ªæ—¥å¿—">5.1 æ”¶é›†å•ä¸ªæ—¥å¿—</a><ul><li><a href=#511-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="5.1.1 å‡†å¤‡é…ç½®æ–‡ä»¶ï¼š"><strong>5.1.1 å‡†å¤‡é…ç½®æ–‡ä»¶</strong>ï¼š</a></li><li><a href=#512-%e4%bf%ae%e6%94%b9%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90 aria-label="5.1.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™">5.1.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™</a></li><li><a href=#513-%e4%bf%ae%e6%94%b9%e6%a0%a1%e9%aa%8c%e6%96%87%e4%bb%b6%e8%af%ad%e6%b3%95 aria-label="5.1.3 ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³•">5.1.3 ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³•</a></li><li><a href=#514-%e9%87%8d%e5%90%af-logstash-%e9%aa%8c%e8%af%81%e7%bb%93%e6%9e%9c aria-label="5.1.4 é‡å¯ logstash éªŒè¯ç»“æœ">5.1.4 é‡å¯ logstash éªŒè¯ç»“æœ</a></li></ul></li><li><a href=#52-%e6%94%b6%e9%9b%86%e5%a4%9a%e4%b8%aa%e6%97%a5%e5%bf%97 aria-label="5.2 æ”¶é›†å¤šä¸ªæ—¥å¿—">5.2 æ”¶é›†å¤šä¸ªæ—¥å¿—</a><ul><li><a href=#521-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶">5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li><li><a href=#522-%e4%bf%ae%e6%94%b9%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e6%9d%83%e9%99%90 aria-label="5.2.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™">5.2.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™</a></li><li><a href=#523--%e6%a0%a1%e9%aa%8c%e8%af%ad%e6%b3%95%e5%b9%b6%e9%87%8d%e5%90%af%e6%9c%8d%e5%8a%a1 aria-label="5.2.3  æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡">5.2.3 æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡</a></li><li><a href=#524-%e5%9c%a8-elasticsearch-%e6%9f%a5%e7%9c%8b%e7%b4%a2%e5%bc%95 aria-label="5.2.4 åœ¨ elasticsearch æŸ¥çœ‹ç´¢å¼•">5.2.4 åœ¨ elasticsearch æŸ¥çœ‹ç´¢å¼•</a></li></ul></li><li><a href=#53-%e5%9c%a8-kibana-%e6%9f%a5%e7%9c%8b%e7%b4%a2%e5%bc%95 aria-label="5.3 åœ¨ kibana æŸ¥çœ‹ç´¢å¼•">5.3 åœ¨ kibana æŸ¥çœ‹ç´¢å¼•</a><ul><li><a href=#531-%e6%9f%a5%e7%9c%8b%e5%b7%b2%e6%9c%89%e7%b4%a2%e5%bc%95 aria-label="5.3.1 æŸ¥çœ‹å·²æœ‰ç´¢å¼•">5.3.1 æŸ¥çœ‹å·²æœ‰ç´¢å¼•</a></li><li><a href=#532-%e6%b7%bb%e5%8a%a0%e7%b4%a2%e5%bc%95%e6%a8%a1%e5%bc%8f aria-label="5.3.2 æ·»åŠ ç´¢å¼•æ¨¡å¼">5.3.2 æ·»åŠ ç´¢å¼•æ¨¡å¼</a></li><li><a href=#533-%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c aria-label="5.3.3 æŸ¥çœ‹ç»“æœ">5.3.3 æŸ¥çœ‹ç»“æœ</a></li></ul></li><li><a href=#54-%e6%94%b6%e9%9b%86-tomcat-%e6%97%a5%e5%bf%97 aria-label="5.4 æ”¶é›† Tomcat æ—¥å¿—">5.4 æ”¶é›† Tomcat æ—¥å¿—</a><ul><li><a href=#541-%e5%9c%a8-logstash-%e5%ae%89%e8%a3%85tomcat aria-label="5.4.1 åœ¨ logstash å®‰è£…tomcat">5.4.1 åœ¨ logstash å®‰è£…tomcat</a></li><li><a href=#542-%e9%85%8d%e7%bd%ae-tomcat-%e6%97%a5%e5%bf%97%e6%a0%bc%e5%bc%8f%e4%b8%ba-json-%e6%a0%bc%e5%bc%8f aria-label="5.4.2 é…ç½® tomcat æ—¥å¿—æ ¼å¼ä¸º json æ ¼å¼">5.4.2 é…ç½® tomcat æ—¥å¿—æ ¼å¼ä¸º json æ ¼å¼</a></li><li><a href=#543-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="5.4.3 å‡†å¤‡é…ç½®æ–‡ä»¶">5.4.3 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li><li><a href=#544-%e9%87%8d%e5%90%af%e6%9c%8d%e5%8a%a1%e5%b9%b6%e7%94%9f%e6%88%90%e6%97%a5%e5%bf%97 aria-label="5.4.4 é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿—">5.4.4 é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿—</a></li><li><a href=#545-%e6%9f%a5%e7%9c%8b%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e7%bb%93%e6%9e%9c aria-label="5.4.5 æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ">5.4.5 æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ</a></li></ul></li><li><a href=#55-%e6%94%b6%e9%9b%86-java-%e6%97%a5%e5%bf%97 aria-label="5.5 æ”¶é›† Java æ—¥å¿—">5.5 æ”¶é›† Java æ—¥å¿—</a><ul><li><a href=#551-%e5%9c%a8-elasticsearch-01-%e5%ae%89%e8%a3%85-logstash aria-label="5.5.1 åœ¨ elasticsearch-01 å®‰è£… logstash">5.5.1 åœ¨ elasticsearch-01 å®‰è£… logstash</a></li><li><a href=#552-%e6%b5%8b%e8%af%95%e5%a4%9a%e8%a1%8c%e5%90%88%e5%b9%b6%e6%95%88%e6%9e%9c aria-label="5.5.2 æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ">5.5.2 æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ</a><ul><li><a href=#5521-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="5.5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶">5.5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li><li><a href=#5552-%e6%a3%80%e6%9f%a5%e9%85%8d%e7%bd%ae aria-label="5.5.5.2 æ£€æŸ¥é…ç½®">5.5.5.2 æ£€æŸ¥é…ç½®</a></li><li><a href=#5553-%e4%bd%bf%e7%94%a8%e6%a0%87%e5%87%86%e8%be%93%e5%87%ba%e8%bf%9b%e8%a1%8c%e9%aa%8c%e8%af%81 aria-label="5.5.5.3 ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯">5.5.5.3 ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯</a></li></ul></li><li><a href=#553-%e6%94%b6%e9%9b%86-java-%e6%97%a5%e5%bf%97 aria-label="5.5.3 æ”¶é›† Java æ—¥å¿—">5.5.3 æ”¶é›† Java æ—¥å¿—</a><ul><li><a href=#5531-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="5.5.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶">5.5.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶</a></li><li><a href=#5532-%e7%94%9f%e6%88%90-java-%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6 aria-label="5.5.3.2 ç”Ÿæˆ Java æ—¥å¿—æ–‡ä»¶">5.5.3.2 ç”Ÿæˆ Java æ—¥å¿—æ–‡ä»¶</a></li><li><a href=#5533-%e6%88%90%e5%8a%9f%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97 aria-label="5.5.3.3 æˆåŠŸæ”¶é›†æ—¥å¿—">5.5.3.3 æˆåŠŸæ”¶é›†æ—¥å¿—</a></li><li><a href=#5534-%e9%80%9a%e8%bf%87-kibana-%e6%9f%a5%e7%9c%8b%e7%bb%93%e6%9e%9c aria-label="5.5.3.4 é€šè¿‡ kibana æŸ¥çœ‹ç»“æœ">5.5.3.4 é€šè¿‡ kibana æŸ¥çœ‹ç»“æœ</a></li></ul></li></ul></li><li><a href=#56-%e6%94%b6%e9%9b%86-nginx-%e6%97%a5%e5%bf%97 aria-label="5.6 æ”¶é›† Nginx æ—¥å¿—">5.6 æ”¶é›† Nginx æ—¥å¿—</a></li><li><a href=#57-%e4%bd%bf%e7%94%a8-redis-%e7%bc%93%e5%ad%98%e6%97%a5%e5%bf%97 aria-label="5.7 ä½¿ç”¨ Redis ç¼“å­˜æ—¥å¿—">5.7 ä½¿ç”¨ Redis ç¼“å­˜æ—¥å¿—</a><ul><li><a href=#571-%e5%87%86%e5%a4%87%e4%b8%80%e4%b8%aa%e5%ae%a2%e6%88%b7%e7%ab%af%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label="5.7.1 å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨">5.7.1 <strong>å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨</strong></a></li><li><a href=#572-%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-redis aria-label="5.7.2 æ”¶é›†æ—¥å¿—å†™å…¥ redis">5.7.2 æ”¶é›†æ—¥å¿—å†™å…¥ redis</a></li><li><a href=#573-%e8%af%bb%e5%8f%96-redis-%e7%9a%84%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-elasticsearch aria-label="5.7.3 è¯»å– redis çš„æ—¥å¿—å†™å…¥ elasticsearch">5.7.3 è¯»å– redis çš„æ—¥å¿—å†™å…¥ elasticsearch</a></li></ul></li><li><a href=#58-%e4%bd%bf%e7%94%a8-kafka-%e7%bc%93%e5%ad%98%e6%97%a5%e5%bf%97 aria-label="5.8 ä½¿ç”¨ Kafka ç¼“å­˜æ—¥å¿—">5.8 ä½¿ç”¨ Kafka ç¼“å­˜æ—¥å¿—</a><ul><li><a href=#581-%e5%9c%a8-log-clinet-%e9%83%a8%e7%bd%b2-kafka aria-label="5.8.1 åœ¨ log-clinet éƒ¨ç½² kafka">5.8.1 åœ¨ log-clinet éƒ¨ç½² kafka</a></li><li><a href=#582-%e5%b0%86%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-kafka aria-label="5.8.2 å°†æ—¥å¿—å†™å…¥ Kafka">5.8.2 å°†æ—¥å¿—å†™å…¥ Kafka</a></li><li><a href=#583-%e6%9f%a5%e7%9c%8b-kafka-%e4%b8%ad%e7%9a%84-topic aria-label="5.8.3 æŸ¥çœ‹ Kafka ä¸­çš„ topic">5.8.3 æŸ¥çœ‹ Kafka ä¸­çš„ topic</a></li><li><a href=#584-%e8%af%bb%e5%8f%96-kafka-%e4%b8%ad%e7%9a%84%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-elasticsearch aria-label="5.8.4 è¯»å– Kafka ä¸­çš„æ—¥å¿—å†™å…¥ Elasticsearch">5.8.4 è¯»å– Kafka ä¸­çš„æ—¥å¿—å†™å…¥ Elasticsearch</a></li></ul></li><li><a href=#59-%e4%bd%bf%e7%94%a8-filebeat-%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97 aria-label="5.9 ä½¿ç”¨ filebeat æ”¶é›†æ—¥å¿—">5.9 ä½¿ç”¨ filebeat æ”¶é›†æ—¥å¿—</a><ul><li><a href=#591-%e5%9c%a8-log-client-%e5%ae%89%e8%a3%85-filebeat aria-label="5.9.1 åœ¨ log-client å®‰è£… filebeat">5.9.1 <strong>åœ¨ log-client å®‰è£… filebeat</strong></a></li><li><a href=#592-%e6%94%b6%e9%9b%86%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97 aria-label="5.9.2 æ”¶é›†ç³»ç»Ÿæ—¥å¿—">5.9.2 æ”¶é›†ç³»ç»Ÿæ—¥å¿—</a><ul><li><a href=#5921-%e6%94%b6%e9%9b%86%e5%8d%95%e4%b8%aa%e7%b3%bb%e7%bb%9f%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-kafka aria-label="5.9.2.1 æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—ï¼Œå†™å…¥ kafka">5.9.2.1 æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—ï¼Œå†™å…¥ kafka</a></li><li><a href=#2922-%e5%9c%a8-kafka-%e4%b8%ad%e6%9f%a5%e7%9c%8b-topic aria-label="2.9.2.2 åœ¨ kafka ä¸­æŸ¥çœ‹ topic">2.9.2.2 åœ¨ kafka ä¸­æŸ¥çœ‹ topic</a></li><li><a href=#2923-%e4%bd%bf%e7%94%a8-logstash-%e5%b0%86-kafka-%e4%b8%ad%e7%9a%84%e6%97%a5%e5%bf%97%e5%86%99%e5%85%a5-elasticsearch aria-label="2.9.2.3 ä½¿ç”¨ logstash å°† kafka ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearch">2.9.2.3 ä½¿ç”¨ logstash å°† kafka ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearch</a></li></ul></li></ul></li></ul></li><li><a href=#faq aria-label=FAQ>FAQ</a><ul><li><a href=#elk-%e4%b8%ad%e7%94%a8-redis-%e5%92%8c%e7%94%a8-kafka-%e7%bc%93%e5%ad%98%e6%97%a5%e5%bf%97%e6%9c%89%e4%bd%95%e5%8c%ba%e5%88%ab aria-label="elk ä¸­ç”¨ redis å’Œç”¨ kafka ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ«">elk ä¸­ç”¨ redis å’Œç”¨ kafka ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ«</a></li><li><a href=#filebeat-%e5%92%8c-logstash-%e7%9a%84%e5%8c%ba%e5%88%ab aria-label="filebeat å’Œ logstash çš„åŒºåˆ«">filebeat å’Œ logstash çš„åŒºåˆ«</a></li></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=ä¸€elk-ç®€ä»‹>ä¸€ã€ELK ç®€ä»‹<a hidden class=anchor aria-hidden=true href=#ä¸€elk-ç®€ä»‹>#</a></h2><p>ELKæ˜¯ä¸€ä¸ªæµè¡Œçš„å¼€æºæ—¥å¿—ç®¡ç†å’Œåˆ†æå¹³å°ï¼Œå®ƒç”±ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ç»„æˆï¼šElasticsearchã€Logstashå’ŒKibanaã€‚è¿™ä¸‰ä¸ªç»„ä»¶ååŒå·¥ä½œï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ”¶é›†ã€å­˜å‚¨ã€æœç´¢ã€åˆ†æå’Œå¯è§†åŒ–å¤§é‡æ—¥å¿—æ•°æ®ã€‚ELKè¢«å¹¿æ³›ç”¨äºå®æ—¶æ—¥å¿—åˆ†æã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€å®‰å…¨äº‹ä»¶æ£€æµ‹ç­‰é¢†åŸŸã€‚</p><p>ä¸‹é¢æ˜¯æ¯ä¸ªç»„ä»¶çš„ç®€è¦ä»‹ç»ï¼š</p><ol><li><p><strong>Elasticsearchï¼š</strong> Elasticsearchæ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“ã€‚å®ƒç”¨äºå­˜å‚¨å’Œç´¢å¼•å¤§é‡çš„æ•°æ®ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿè¿›è¡Œå…¨æ–‡æœç´¢ã€åˆ†æå’Œèšåˆã€‚Elasticsearchçš„å¼ºå¤§ä¹‹å¤„åœ¨äºå…¶åˆ†å¸ƒå¼æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œå®ƒèƒ½å¤Ÿå¤„ç†æµ·é‡æ•°æ®å¹¶æä¾›é«˜æ•ˆçš„æŸ¥è¯¢å’Œåˆ†æã€‚</p></li><li><p><strong>Logstashï¼š</strong> Logstashæ˜¯ä¸€ä¸ªç”¨äºæ”¶é›†ã€å¤„ç†å’Œè½¬å‘å„ç§ç±»å‹æ•°æ®çš„æ•°æ®æµå¤„ç†å¼•æ“ã€‚å®ƒå¯ä»¥ä»å¤šç§æ¥æºï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ã€æ¶ˆæ¯é˜Ÿåˆ—ã€æ•°æ®åº“ç­‰ï¼‰æ”¶é›†æ•°æ®ï¼Œç»è¿‡å¤„ç†åå°†æ•°æ®å‘é€åˆ°ç›®æ ‡å­˜å‚¨ï¼ˆå¦‚Elasticsearchï¼‰ã€‚Logstashå¯ä»¥ç”¨äºæ•°æ®æ¸…æ´—ã€è½¬æ¢ã€æ ‡å‡†åŒ–ç­‰ï¼Œä»¥ä¾¿å°†æ•°æ®å‡†å¤‡å¥½ä¾›åç»­çš„æœç´¢å’Œåˆ†æã€‚</p></li><li><p><strong>Kibanaï¼š</strong> Kibanaæ˜¯ä¸€ä¸ªç”¨äºæ•°æ®å¯è§†åŒ–å’Œåˆ†æçš„å¼€æºå·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„Webç•Œé¢ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ›å»ºä»ªè¡¨æ¿ã€å›¾è¡¨å’Œåœ°å›¾æ¥å±•ç¤ºElasticsearchä¸­çš„æ•°æ®ã€‚é€šè¿‡Kibanaï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡äº¤äº’å¼çš„ç•Œé¢æ·±å…¥åˆ†ææ•°æ®ã€è§‚å¯Ÿè¶‹åŠ¿ã€æ£€æµ‹å¼‚å¸¸ç­‰ã€‚</p></li></ol><p>ELKçš„å·¥ä½œæµç¨‹é€šå¸¸æ˜¯è¿™æ ·çš„ï¼šLogstashæ”¶é›†å’Œå¤„ç†å„ç§æ•°æ®æºçš„æ—¥å¿—æ•°æ®ï¼Œç„¶åå°†å¤„ç†åçš„æ•°æ®å‘é€åˆ°Elasticsearchè¿›è¡Œç´¢å¼•å’Œå­˜å‚¨ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Kibanaæ¥æŸ¥è¯¢æ•°æ®ã€åˆ›å»ºå¯è§†åŒ–ä»ªè¡¨æ¿ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£æ•°æ®çš„æƒ…å†µã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒElasticsearch åœ¨æ–°ç‰ˆæœ¬ä¸­ä¹Ÿè¢«ç§°ä¸º Elastic Stackï¼Œå› ä¸ºé™¤äº†ä¸Šè¿°ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶å¤–ï¼ŒElastic å…¬å¸è¿˜æä¾›äº†å…¶ä»–ä¸€äº›é™„åŠ å·¥å…·å’ŒåŠŸèƒ½ï¼Œä»¥è¿›ä¸€æ­¥å¢å¼ºæ•°æ®åˆ†æå’Œç®¡ç†çš„èƒ½åŠ›ã€‚</p><h2 id=äºŒelasticsearch-é›†ç¾¤éƒ¨ç½²>äºŒã€Elasticsearch é›†ç¾¤éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#äºŒelasticsearch-é›†ç¾¤éƒ¨ç½²>#</a></h2><h3 id=21-ç¯å¢ƒåˆå§‹åŒ–>2.1 ç¯å¢ƒåˆå§‹åŒ–<a hidden class=anchor aria-hidden=true href=#21-ç¯å¢ƒåˆå§‹åŒ–>#</a></h3><h4 id=211-ç¯å¢ƒå‡†å¤‡>2.1.1 ç¯å¢ƒå‡†å¤‡<a hidden class=anchor aria-hidden=true href=#211-ç¯å¢ƒå‡†å¤‡>#</a></h4><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>elasticsearch-01</td><td>10.0.0.11</td><td>CentOS 7.6</td><td>2U 4G</td></tr><tr><td>elasticsearch-02</td><td>10.0.0.12</td><td>CentOS 7.6</td><td>1U 2G</td></tr><tr><td>elasticsearch-03</td><td>10.0.0.13</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><h4 id=212-å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´>2.1.2 å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´<a hidden class=anchor aria-hidden=true href=#212-å†…æ ¸å‚æ•°åŠæœåŠ¡è°ƒæ•´>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl disable firewalld --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ NetworkManager</span>
</span></span><span style=display:flex><span>systemctl disable NetworkManager --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­selinux</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/selinux/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹æ–‡ä»¶å¥æŸ„æ•°çš„é™åˆ¶</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;* soft nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;* hard nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span></code></pre></div><h4 id=213-é…ç½®-hosts-è§£æ>2.1.3 é…ç½® hosts è§£æ<a hidden class=anchor aria-hidden=true href=#213-é…ç½®-hosts-è§£æ>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cat /etc/hosts</span>
</span></span><span style=display:flex><span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span style=display:flex><span>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span style=display:flex><span>10.0.0.11 elasticsearch-01
</span></span><span style=display:flex><span>10.0.0.12 elasticsearch-02 
</span></span><span style=display:flex><span>10.0.0.13 elasticsearch-03
</span></span></code></pre></div><h4 id=214-å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´>2.1.4 å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´<a hidden class=anchor aria-hidden=true href=#214-å®‰è£…å¿…è¦çš„è½¯ä»¶å¹¶åŒæ­¥æ—¶é—´>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å®‰è£…åŸºç¡€è½¯ä»¶</span>
</span></span><span style=display:flex><span>yum install -y epel-release net-tools vim lrzsz tree screen lsof tcpdump wget ntpdate
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># åŒæ­¥æ—¶é—´</span>
</span></span><span style=display:flex><span>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®šæ—¶åŒæ­¥</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;*/5 * * * * ntpdate time1.aliyun.com &amp;&gt; /dev/null &amp;&amp; hwclock -w&#34;</span> &gt;&gt; /var/spool/cron/root
</span></span><span style=display:flex><span>systemctl restart crond
</span></span></code></pre></div><h4 id=215-é…ç½®-java-ç¯å¢ƒ>2.1.5 é…ç½® java ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#215-é…ç½®-java-ç¯å¢ƒ>#</a></h4><p><a href=https://www.elastic.co/cn/support/matrix#matrix_jvm>æ”¯æŒä¸€è§ˆè¡¨ | Elastic</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install java-1.8.0-openjdk -y
</span></span><span style=display:flex><span>java -version
</span></span></code></pre></div><h3 id=22-å®‰è£…-elasticsearch>2.2 å®‰è£… elasticsearch<a hidden class=anchor aria-hidden=true href=#22-å®‰è£…-elasticsearch>#</a></h3><h4 id=221-yum-å®‰è£…-elasticsearch-717>2.2.1 yum å®‰è£… elasticsearch 7.17<a hidden class=anchor aria-hidden=true href=#221-yum-å®‰è£…-elasticsearch-717>#</a></h4><p><a href=https://www.elastic.co/cn/downloads/elasticsearch>Download Elasticsearch | Elastic</a></p><p>[Install Elasticsearch with RPM | Elasticsearch Guide <a href=https://www.elastic.co/guide/en/elasticsearch/reference/7.17/rpm.html#rpm-repo>7.17] | Elastic</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt; /etc/yum.repos.d/elasticsearch-7.repo <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[elasticsearch]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Elasticsearch repository for 7.x packages
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://artifacts.elastic.co/packages/7.x/yum
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autorefresh=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type=rpm-md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yum install -y --enablerepo<span style=color:#f92672>=</span>elasticsearch elasticsearch
</span></span></code></pre></div><h4 id=222-ä¿®æ”¹é…ç½®æ–‡ä»¶>2.2.2 ä¿®æ”¹é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#222-ä¿®æ”¹é…ç½®æ–‡ä»¶>#</a></h4><p><code># cat /etc/elasticsearch/elasticsearch.yml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cluster.name: elk-cluster
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>node.name: elk-node-01 <span style=color:#75715e># æ¯ä¸ªèŠ‚ç‚¹å”¯ä¸€ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>path.data: /apps/elasticsearch/data <span style=color:#75715e># æ•°æ®å­˜æ”¾ç›®å½•ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»º</span>
</span></span><span style=display:flex><span>path.logs: /apps/elasticsearch/logs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bootstrap.memory_lock: true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>network.host: 0.0.0.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>http.port: <span style=color:#ae81ff>9200</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>discovery.seed_hosts: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.12&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.13&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cluster.initial_master_nodes: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.12&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.13&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gateway.recover_after_nodes: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>action.destructive_requires_name: true
</span></span></code></pre></div><p><strong>å‚æ•°è§£é‡Š</strong></p><ul><li><code>cluster.name: elk-cluster</code>: è®¾ç½®Elasticsearché›†ç¾¤çš„åç§°ä¸º"elk-cluster"ã€‚</li><li><code>node.name: elk-node-01</code>: è®¾ç½®å½“å‰ElasticsearchèŠ‚ç‚¹çš„åç§°ä¸º"elk-node-01"ã€‚</li><li><code>path.data: /apps/elasticsearch/data</code> å’Œ <code>path.logs: /apps/elasticsearch/logs</code>: åˆ†åˆ«æŒ‡å®šElasticsearchæ•°æ®å’Œæ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ã€‚</li><li><code>bootstrap.memory_lock: true</code>: è¿™ä¸ªé…ç½®è¡¨ç¤ºElasticsearchå°†å°è¯•é”å®šå†…å­˜ï¼Œä»¥æé«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚</li><li><code>network.host: 0.0.0.0</code>: å…è®¸Elasticsearchç»‘å®šåˆ°æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œä»¥å…è®¸æ¥è‡ªä»»ä½•IPåœ°å€çš„è¿æ¥ã€‚</li><li><code>http.port: 9200</code>: è®¾ç½®Elasticsearch HTTPæœåŠ¡çš„ç›‘å¬ç«¯å£ä¸º9200ï¼Œè¿™æ˜¯é»˜è®¤çš„HTTP APIç«¯å£ã€‚</li><li><code>discovery.seed_hosts: ["10.0.0.11", "10.0.0.12", "10.0.0.13"]</code>: æŒ‡å®šäº†Elasticsearché›†ç¾¤çš„å‘ç°èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ç”¨äºå¯åŠ¨å’Œå‘ç°é›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹ã€‚</li><li><code>cluster.initial_master_nodes: ["10.0.0.11", "10.0.0.12", "10.0.0.13"]</code>: æŒ‡å®šäº†åˆå§‹çš„ä¸»èŠ‚ç‚¹åˆ—è¡¨ï¼Œç”¨äºåˆå§‹åŒ–é›†ç¾¤ã€‚</li><li><code>gateway.recover_after_nodes: 2</code>: é…ç½®åœ¨è‡³å°‘æœ‰2ä¸ªèŠ‚ç‚¹å¯ç”¨æ—¶æ‰å…è®¸é›†ç¾¤æ¢å¤ã€‚</li><li><code>action.destructive_requires_name: true</code>: è¿™ä¸ªé…ç½®è¦æ±‚åœ¨æ‰§è¡Œç ´åæ€§æ“ä½œï¼ˆå¦‚åˆ é™¤ç´¢å¼•ï¼‰æ—¶éœ€è¦æä¾›åç§°ï¼Œä»¥é˜²æ­¢æ„å¤–çš„æ“ä½œã€‚</li></ul><h4 id=223-ä¿®æ”¹å†…å­˜é™åˆ¶>2.2.3 ä¿®æ”¹å†…å­˜é™åˆ¶<a hidden class=anchor aria-hidden=true href=#223-ä¿®æ”¹å†…å­˜é™åˆ¶>#</a></h4><blockquote><p><code>LimitMEMLOCK=infinity</code> æ˜¯SystemdæœåŠ¡çš„é…ç½®å‚æ•°ä¹‹ä¸€ï¼Œç”¨äºé™åˆ¶è¿›ç¨‹çš„å†…å­˜é”å®šï¼ˆmlockï¼‰èµ„æºã€‚è¿™ä¸ªå‚æ•°çš„å«ä¹‰æ˜¯å°†å†…å­˜é”å®šèµ„æºçš„é™åˆ¶è®¾ç½®ä¸ºæ— é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯å…è®¸è¿›ç¨‹é”å®šä»»æ„æ•°é‡çš„å†…å­˜ã€‚å†…å­˜é”å®šæ˜¯ä¸€ç§æ“ä½œï¼Œç”¨äºå°†å†…å­˜åˆ†é…ç»™è¿›ç¨‹ï¼Œå¹¶é˜²æ­¢æ“ä½œç³»ç»Ÿå°†å…¶äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼Œä»è€Œæé«˜äº†å¯¹å†…å­˜çš„å¿«é€Ÿè®¿é—®ã€‚</p><p>åœ¨æŸäº›åº”ç”¨ç¨‹åºä¸­ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦é«˜æ€§èƒ½å’Œä½å»¶è¿Ÿçš„åº”ç”¨ç¨‹åºï¼Œéœ€è¦å°†ä¸€éƒ¨åˆ†å†…å­˜é”å®šï¼Œä»¥ç¡®ä¿æ•°æ®å§‹ç»ˆä½äºç‰©ç†å†…å­˜ä¸­ï¼Œè€Œä¸ä¼šè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šï¼Œä»¥å‡å°‘è®¿é—®å»¶è¿Ÿã€‚å°†<code>LimitMEMLOCK</code>è®¾ç½®ä¸ºinfinityå…è®¸è¿›ç¨‹é”å®šæ‰€éœ€çš„å†…å­˜è€Œä¸å—é™åˆ¶ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¿®æ”¹æ­¤è®¾ç½®å¯èƒ½ä¼šå½±å“ç³»ç»Ÿçš„æ€§èƒ½å’Œç¨³å®šæ€§ï¼Œå› ä¸ºä¸å—é™åˆ¶çš„å†…å­˜é”å®šå¯èƒ½å¯¼è‡´ç³»ç»Ÿèµ„æºä¸è¶³ï¼Œå› æ­¤åœ¨è¿›è¡Œæ­¤ç±»é…ç½®æ›´æ”¹æ—¶éœ€è¦å°å¿ƒè°¨æ…ï¼Œå¹¶ç¡®ä¿äº†è§£åº”ç”¨ç¨‹åºçš„å†…å­˜ä½¿ç”¨æ¨¡å¼å’Œç³»ç»Ÿèµ„æºé™åˆ¶ã€‚</p><p>æ­¤å¤–ï¼Œä¸Šè¿°é…ç½®ç‰‡æ®µé€šå¸¸å¯ä»¥åœ¨SystemdæœåŠ¡å•å…ƒæ–‡ä»¶ï¼ˆé€šå¸¸ä½äº<code>/etc/systemd/system/</code>æˆ–<code>/lib/systemd/system/</code>ä¸­ï¼‰ä¸­æ‰¾åˆ°ï¼Œå¹¶ç”¨äºè°ƒæ•´ç‰¹å®šæœåŠ¡çš„èµ„æºé™åˆ¶ã€‚å…·ä½“çš„é…ç½®æ–‡ä»¶å¯èƒ½å› ä¸åŒçš„Linuxå‘è¡Œç‰ˆå’Œåº”ç”¨ç¨‹åºè€Œæœ‰æ‰€ä¸åŒã€‚</p></blockquote><p><strong>æ³¨æ„ï¼šè¦åœ¨Service å—ä¸­è®¾ç½®ï¼Œä¸ç„¶ä¸ä¼šç”Ÿæ•ˆ</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># grep LimitMEMLOCK=infinity /usr/lib/systemd/system/elasticsearch.service -B 1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>LimitMEMLOCK<span style=color:#f92672>=</span>infinity
</span></span><span style=display:flex><span><span style=color:#75715e># systemctl daemon-reload</span>
</span></span></code></pre></div><p><strong>ä¿®æ”¹å †å†…å­˜å¤§å°</strong></p><p>[Heap size settings | Elasticsearch Guide <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html>8.9] | Elastic</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># grep Xm /etc/elasticsearch/jvm.options</span>
</span></span><span style=display:flex><span>-Xms1g
</span></span><span style=display:flex><span>-Xmx1g
</span></span></code></pre></div><p><strong>åˆ›å»ºæ•°æ®å­˜æ”¾ç›®å½•</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /apps/elasticsearch/<span style=color:#f92672>{</span>data,logs<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>chown -R elasticsearch.elasticsearch /apps/elasticsearch/
</span></span></code></pre></div><h3 id=23-å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€>2.3 å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€<a hidden class=anchor aria-hidden=true href=#23-å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹é›†ç¾¤çŠ¶æ€>#</a></h3><blockquote><p>Elasticsearch é›†ç¾¤çŠ¶æ€ç”¨äºè¡¨ç¤ºé›†ç¾¤çš„æ•´ä½“å¥åº·çŠ¶å†µã€‚Elasticsearch é›†ç¾¤å¯ä»¥å¤„äºä¸åŒçš„å¥åº·çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€åæ˜ äº†é›†ç¾¤ä¸­æ•°æ®åˆ†ç‰‡çš„å¯ç”¨æ€§å’Œå®Œæ•´æ€§ã€‚ä»¥ä¸‹æ˜¯ Elasticsearch é›†ç¾¤çŠ¶æ€çš„ä¸»è¦ä»‹ç»ï¼š</p><ol><li><strong>Greenï¼ˆç»¿è‰²ï¼‰</strong>:<ul><li>é›†ç¾¤å¤„äºæœ€ä½³çŠ¶æ€ã€‚</li><li>æ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡éƒ½å¯ç”¨ã€‚</li><li>é›†ç¾¤çš„æ•°æ®å®Œæ•´æ€§å’Œå¯ç”¨æ€§éƒ½éå¸¸é«˜ã€‚</li><li>æ‰€æœ‰èŠ‚ç‚¹éƒ½æ­£å¸¸è¿è¡Œï¼Œæ²¡æœ‰æ•…éšœã€‚</li><li>æ€§èƒ½æ­£å¸¸ï¼Œæ²¡æœ‰æ€§èƒ½é—®é¢˜ã€‚</li></ul></li><li><strong>Yellowï¼ˆé»„è‰²ï¼‰</strong>:<ul><li>é›†ç¾¤çŠ¶æ€è¡¨ç¤ºä¸º &ldquo;yellow&rdquo; æ—¶ï¼Œä¸»åˆ†ç‰‡éƒ½å¯ç”¨ï¼Œä½†å¤åˆ¶åˆ†ç‰‡ï¼ˆå‰¯æœ¬ï¼‰å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚</li><li>å¯èƒ½æœ‰ä¸€äº›å‰¯æœ¬åˆ†ç‰‡å°šæœªåˆ†é…åˆ°èŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…æŸäº›èŠ‚ç‚¹ä¸å¯ç”¨ã€‚</li><li>æ•°æ®å®Œæ•´æ€§æœ‰ä¸€å®šç¨‹åº¦çš„é£é™©ï¼Œå› ä¸ºå¤åˆ¶åˆ†ç‰‡çš„å¯ç”¨æ€§å—åˆ°å½±å“ã€‚</li><li>æ€§èƒ½é€šå¸¸è‰¯å¥½ï¼Œä½†éœ€è¦å…³æ³¨é›†ç¾¤å¥åº·çŠ¶æ€ã€‚</li></ul></li><li><strong>Redï¼ˆçº¢è‰²ï¼‰</strong>:<ul><li>é›†ç¾¤çŠ¶æ€è¡¨ç¤ºä¸º &ldquo;red&rdquo; æ—¶ï¼Œæ„å‘³ç€ä¸»åˆ†ç‰‡ä¸å¯ç”¨ã€‚</li><li>è¿™å¯èƒ½æ˜¯ç”±äºä¸»åˆ†ç‰‡ä¸¢å¤±ã€æœªåˆ†é…æˆ–è€…èŠ‚ç‚¹æ•…éšœç­‰é—®é¢˜å¼•èµ·çš„ã€‚</li><li>æ•°æ®çš„å¯ç”¨æ€§å’Œå®Œæ•´æ€§å—åˆ°ä¸¥é‡å¨èƒï¼Œå› ä¸ºä¸»åˆ†ç‰‡æ— æ³•æä¾›æ•°æ®è®¿é—®ã€‚</li><li>æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å½±å“ï¼Œå…·ä½“å–å†³äºç¼ºå¤±çš„ä¸»åˆ†ç‰‡æ•°é‡å’ŒæŸ¥è¯¢çš„æ€§è´¨ã€‚</li></ul></li></ol></blockquote><h4 id=231-å¯åŠ¨æœåŠ¡>2.3.1 å¯åŠ¨æœåŠ¡<a hidden class=anchor aria-hidden=true href=#231-å¯åŠ¨æœåŠ¡>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># systemctl start elasticsearch</span>
</span></span><span style=display:flex><span><span style=color:#75715e># systemctl status elasticsearch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># ss -ntl</span>
</span></span><span style=display:flex><span>State      Recv-Q Send-Q                     Local Address:Port                                    Peer Address:Port              
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                                    *:22                                                 *:*                  
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>100</span>                            127.0.0.1:25                                                 *:*                  
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                                   :::9200   <span style=color:#75715e># æœåŠ¡ç›‘å¬ç«¯å£                                           :::*                  </span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                                   :::9300   <span style=color:#75715e># é›†ç¾¤é€šä¿¡ç«¯å£                                           :::*                  </span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>                                   :::22                                                :::*                  
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>100</span>                                  ::1:25                                                :::* 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost:9200</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;name&#34;</span> : <span style=color:#e6db74>&#34;elk-node-01&#34;</span>,	<span style=color:#75715e># èŠ‚ç‚¹åç§°</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;cluster_name&#34;</span> : <span style=color:#e6db74>&#34;elk-cluster&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;cluster_uuid&#34;</span> : <span style=color:#e6db74>&#34;XXO_Ik9XQo2Y5Uw6UvVS-g&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;version&#34;</span> : <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;number&#34;</span> : <span style=color:#e6db74>&#34;7.17.13&#34;</span>, 	<span style=color:#75715e># elasticsearch ç‰ˆæœ¬å·</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;build_flavor&#34;</span> : <span style=color:#e6db74>&#34;default&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;build_type&#34;</span> : <span style=color:#e6db74>&#34;rpm&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;build_hash&#34;</span> : <span style=color:#e6db74>&#34;2b211dbb8bfdecaf7f5b44d356bdfe54b1050c13&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;build_date&#34;</span> : <span style=color:#e6db74>&#34;2023-08-31T17:33:19.958690787Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;build_snapshot&#34;</span> : false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;lucene_version&#34;</span> : <span style=color:#e6db74>&#34;8.11.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;minimum_wire_compatibility_version&#34;</span> : <span style=color:#e6db74>&#34;6.8.0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;minimum_index_compatibility_version&#34;</span> : <span style=color:#e6db74>&#34;6.0.0-beta1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;tagline&#34;</span> : <span style=color:#e6db74>&#34;You Know, for Search&#34;</span>	<span style=color:#75715e># å®£ä¼ è¯­</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=232-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€>2.3.2 æŸ¥çœ‹é›†ç¾¤çŠ¶æ€<a hidden class=anchor aria-hidden=true href=#232-æŸ¥çœ‹é›†ç¾¤çŠ¶æ€>#</a></h4><blockquote><p>å¯ä»¥åˆ©ç”¨æ­¤æ¥å£å¯¹ elasticseach é›†ç¾¤çŠ¶æ€è¿›è¡Œç›‘æ§</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost:9200/_cluster/health?pretty</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;cluster_name&#34;</span> : <span style=color:#e6db74>&#34;elk-cluster&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;status&#34;</span> : <span style=color:#e6db74>&#34;green&#34;</span>,	<span style=color:#75715e># é›†ç¾¤ç›‘æ§çŠ¶æ€</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;timed_out&#34;</span> : false,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;number_of_nodes&#34;</span> : 3,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;number_of_data_nodes&#34;</span> : 3,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;active_primary_shards&#34;</span> : 3,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;active_shards&#34;</span> : 6,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;relocating_shards&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;initializing_shards&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;unassigned_shards&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;delayed_unassigned_shards&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;number_of_pending_tasks&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;number_of_in_flight_fetch&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;task_max_waiting_in_queue_millis&#34;</span> : 0,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;active_shards_percent_as_number&#34;</span> : 100.0
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯å…¶ä¸­çš„ä¸€äº›å…³é”®å­—æ®µçš„è§£é‡Šï¼š</p><ol><li><p><code>"cluster_name" : "elk-cluster"</code>: é›†ç¾¤çš„åç§°ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„é›†ç¾¤åç§°ä¸º &ldquo;elk-cluster&rdquo;ã€‚</p></li><li><p><code>"status" : "green"</code>: é›†ç¾¤çš„å¥åº·çŠ¶æ€ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­é›†ç¾¤çŠ¶æ€ä¸º &ldquo;green&rdquo;ï¼Œè¡¨ç¤ºé›†ç¾¤å¤„äºæœ€ä½³çŠ¶æ€ã€‚</p></li><li><p><code>"number_of_nodes" : 3</code>: é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ•°é‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰3ä¸ªèŠ‚ç‚¹ã€‚</p></li><li><p><code>"number_of_data_nodes" : 3</code>: é›†ç¾¤ä¸­çš„æ•°æ®èŠ‚ç‚¹æ•°é‡ï¼Œè¿™æ˜¯å®é™…å­˜å‚¨æ•°æ®çš„èŠ‚ç‚¹æ•°ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­ä¹Ÿæ˜¯3ä¸ªã€‚</p></li><li><p><code>"active_primary_shards" : 3</code>: æ´»åŠ¨ä¸»åˆ†ç‰‡çš„æ•°é‡ï¼Œè¿™æ˜¯é›†ç¾¤ä¸­ä¸»è¦è´Ÿè´£å­˜å‚¨æ•°æ®çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰3ä¸ªã€‚</p></li><li><p><code>"active_shards" : 6</code>: æ‰€æœ‰æ´»åŠ¨åˆ†ç‰‡çš„æ•°é‡ï¼ŒåŒ…æ‹¬ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰6ä¸ªã€‚</p></li><li><p><code>"relocating_shards" : 0</code>: æ­£åœ¨è¿ç§»çš„åˆ†ç‰‡æ•°é‡ï¼Œå¦‚æœä½ åœ¨é‡æ–°å¹³è¡¡é›†ç¾¤æˆ–è¿ç§»åˆ†ç‰‡ï¼Œåˆ™è¯¥å€¼å¯èƒ½ä¼šå¢åŠ ã€‚</p></li><li><p><code>"initializing_shards" : 0</code>: æ­£åœ¨åˆå§‹åŒ–çš„åˆ†ç‰‡æ•°é‡ï¼Œé€šå¸¸åœ¨æ–°åˆ†ç‰‡æˆ–èŠ‚ç‚¹åŠ å…¥æ—¶å‡ºç°ã€‚</p></li><li><p><code>"unassigned_shards" : 0</code>: æœªåˆ†é…çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™æ˜¯æŒ‡å°šæœªåˆ†é…åˆ°ä»»ä½•èŠ‚ç‚¹çš„åˆ†ç‰‡æ•°é‡ã€‚åœ¨é›†ç¾¤çŠ¶æ€ä¸º &ldquo;green&rdquo; æ—¶ï¼Œè¿™åº”è¯¥æ˜¯0ã€‚</p></li><li><p><code>"delayed_unassigned_shards" : 0</code>: å»¶è¿Ÿæœªåˆ†é…çš„åˆ†ç‰‡æ•°é‡ï¼Œè¿™æ˜¯æŒ‡å°šæœªåˆ†é…åˆ°èŠ‚ç‚¹ï¼Œä½†ç”±äºä¸€äº›åŸå› è€Œè¢«å»¶è¿Ÿçš„åˆ†ç‰‡æ•°é‡ã€‚</p></li><li><p><code>"number_of_pending_tasks" : 0</code>: é›†ç¾¤ä¸­å¾…å¤„ç†ä»»åŠ¡çš„æ•°é‡ï¼Œä¾‹å¦‚ç´¢å¼•åˆ›å»ºæˆ–åˆ é™¤ç­‰æ“ä½œå¯èƒ½ä¼šç”Ÿæˆå¾…å¤„ç†ä»»åŠ¡ã€‚</p></li><li><p><code>"number_of_in_flight_fetch" : 0</code>: ç›®å‰æ­£åœ¨è¿›è¡Œçš„æ•°æ®è·å–è¯·æ±‚çš„æ•°é‡ã€‚</p></li><li><p><code>"task_max_waiting_in_queue_millis" : 0</code>: é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡çš„æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ã€‚</p></li><li><p><code>"active_shards_percent_as_number" : 100.0</code>: æ´»åŠ¨åˆ†ç‰‡çš„ç™¾åˆ†æ¯”ï¼Œä½œä¸ºæ•°å­—è¡¨ç¤ºã€‚åœ¨ &ldquo;green&rdquo; çŠ¶æ€ä¸‹ï¼Œåº”è¯¥æ˜¯100%ï¼Œè¡¨ç¤ºæ‰€æœ‰åˆ†ç‰‡éƒ½æ˜¯æ´»åŠ¨çš„ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œè¿™äº›ä¿¡æ¯æä¾›äº†æœ‰å…³ Elasticsearch é›†ç¾¤çŠ¶æ€å’Œæ€§èƒ½çš„å…³é”®æŒ‡æ ‡ï¼Œå¯ä»¥ç”¨äºç›‘æ§å’Œç®¡ç†é›†ç¾¤ã€‚åœ¨ &ldquo;green&rdquo; çŠ¶æ€ä¸‹ï¼Œé›†ç¾¤æ˜¯å¥åº·çš„ï¼Œæ•°æ®å®Œæ•´æ€§å’Œå¯ç”¨æ€§éƒ½éå¸¸é«˜ã€‚</p><h4 id=233-elasticseach-æ’ä»¶>2.3.3 elasticseach æ’ä»¶<a hidden class=anchor aria-hidden=true href=#233-elasticseach-æ’ä»¶>#</a></h4><p>å®˜æ–¹æä¾›äº†ä¸€äº›æ’ä»¶ä½†å¤§éƒ¨åˆ†æ˜¯æ”¶è´¹çš„ï¼Œå¦å¤–ä¹Ÿæœ‰ä¸€äº›å¼€å‘çˆ±å¥½è€…æä¾›çš„æ’ä»¶ï¼Œå¯ä»¥å®ç°å¯¹ elasticsearch é›†ç¾¤çš„çŠ¶æ€ç›‘æ§ä¸ç®¡ç†é…ç½®ç­‰åŠŸèƒ½ï¼ŒMulti Elasticsearch Head å°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚</p><p>å¯ä»¥é€šè¿‡æµè§ˆå™¨çš„åº”ç”¨å•†åº—å®‰è£… ï¼ˆchrome ã€edgeï¼‰</p><p><a href="https://chrome.google.com/webstore/detail/multi-elasticsearch-head/cpmmilfkofbeimbmgiclohpodggeheim?utm_source=ext_app_menu">https://chrome.google.com/webstore/detail/multi-elasticsearch-head/cpmmilfkofbeimbmgiclohpodggeheim?utm_source=ext_app_menu</a></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919164446667.png alt=image-20230919164446667></p><h2 id=ä¸‰-logstash-éƒ¨ç½²>ä¸‰ã€ Logstash éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#ä¸‰-logstash-éƒ¨ç½²>#</a></h2><p>Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œå¯ä»¥æ°´å¹³ä¼¸ç¼©ï¼ŒåŸºäº ruby å¼€å‘ï¼Œè€Œä¸” logstash æ•´ä¸ª ELKå½“ä¸­æ‹¥æœ‰æœ€å¤šæ’ä»¶çš„ä¸€ä¸ªç»„ä»¶ï¼Œå…¶å¯ä»¥æ¥æ”¶æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®å¹¶ç»Ÿä¸€è¾“å‡ºåˆ°æŒ‡å®šçš„ä¸”å¯ä»¥æ˜¯å¤šä¸ªä¸åŒç›®çš„åœ°ã€‚</p><h3 id=31-ç¯å¢ƒå‡†å¤‡>3.1 ç¯å¢ƒå‡†å¤‡<a hidden class=anchor aria-hidden=true href=#31-ç¯å¢ƒå‡†å¤‡>#</a></h3><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>logstash</td><td>10.0.0.15</td><td>CentOS 7.6</td><td>2U 4G</td></tr></tbody></table><h4 id=312-å…³é—­ä¸éœ€è¦çš„æœåŠ¡>3.1.2 å…³é—­ä¸éœ€è¦çš„æœåŠ¡<a hidden class=anchor aria-hidden=true href=#312-å…³é—­ä¸éœ€è¦çš„æœåŠ¡>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl disable firewalld --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ NetworkManager</span>
</span></span><span style=display:flex><span>systemctl disable NetworkManager --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­selinux</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/selinux/config
</span></span></code></pre></div><h4 id=312-é…ç½®-java-ç¯å¢ƒ>3.1.2 é…ç½® Java ç¯å¢ƒ<a hidden class=anchor aria-hidden=true href=#312-é…ç½®-java-ç¯å¢ƒ>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install java-1.8.0-openjdk -y
</span></span><span style=display:flex><span>java -version
</span></span></code></pre></div><h3 id=32-å®‰è£…-logstash>3.2 å®‰è£… logstash<a hidden class=anchor aria-hidden=true href=#32-å®‰è£…-logstash>#</a></h3><p>[Installing Logstash | Logstash Reference <a href=https://www.elastic.co/guide/en/logstash/7.17/installing-logstash.html#_yum>7.17] | Elastic</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯¼å…¥è¯ä¹¦</span>
</span></span><span style=display:flex><span>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® yum æº</span>
</span></span><span style=display:flex><span>cat &gt; /etc/yum.repos.d/logstash-7.repo <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[logstash-7.x]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Elastic repository for 7.x packages
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://artifacts.elastic.co/packages/7.x/yum
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autorefresh=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type=rpm-md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…å¹¶å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>yum install -y logstash
</span></span><span style=display:flex><span>systemctl start logstash.service
</span></span></code></pre></div><h3 id=33-logstash-çš„ä½¿ç”¨>3.3 logstash çš„ä½¿ç”¨<a hidden class=anchor aria-hidden=true href=#33-logstash-çš„ä½¿ç”¨>#</a></h3><p>Logstash æ˜¯ä¸€ä¸ªå¼€æºçš„æ•°æ®æ”¶é›†å¼•æ“ï¼Œå¯ä»¥æ°´å¹³ä¼¸ç¼©ï¼Œè€Œä¸” logstash æ•´ä¸ª ELK å½“ä¸­æ‹¥æœ‰æœ€å¤šæ’ä»¶çš„ä¸€ä¸ªç»„ä»¶ï¼Œå…¶å¯ä»¥æ¥æ”¶æ¥è‡ªä¸åŒæ¥æºçš„æ•°æ®å¹¶ç»Ÿä¸€è¾“å‡ºåˆ°æŒ‡å®šçš„ä¸”å¯ä»¥æ˜¯å¤šä¸ªä¸åŒç›®çš„åœ°ã€‚</p><h4 id=331-æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º>3.3.1 æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º<a hidden class=anchor aria-hidden=true href=#331-æµ‹è¯•æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡º>#</a></h4><blockquote><p>åœ¨Logstashçš„é…ç½®ä¸­ï¼Œ&ldquo;codec&rdquo; æ˜¯"ç¼–è§£ç å™¨"ï¼ˆCodecï¼‰çš„ç¼©å†™ã€‚ç¼–è§£ç å™¨æ˜¯ä¸€ç§ç”¨äºå°†æ•°æ®ç¼–ç æˆç‰¹å®šæ ¼å¼æˆ–ä»ç‰¹å®šæ ¼å¼è§£ç æ•°æ®çš„ç»„ä»¶ã€‚åœ¨Logstashä¸­ï¼Œå®ƒç”¨äºæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®æ ¼å¼ã€‚</p><p>åœ¨ä½ æä¾›çš„é…ç½®ä¸­ï¼Œä½ ä½¿ç”¨äº†Elasticsearchè¾“å‡ºæ’ä»¶ï¼Œå¹¶æŒ‡å®šäº†"codec"é€‰é¡¹ä¸º"json"ã€‚è¿™è¡¨ç¤ºä½ å¸Œæœ›å°†Logstashäº‹ä»¶æ•°æ®ç¼–ç ä¸ºJSONæ ¼å¼ï¼Œç„¶åå°†å…¶å‘é€åˆ°Elasticsearchã€‚è¿™æœ‰åŠ©äºç¡®ä¿æ•°æ®ä»¥JSONæ ¼å¼å­˜å‚¨åœ¨Elasticsearchä¸­ï¼Œä»¥ä¾¿åç»­æŸ¥è¯¢å’Œåˆ†æã€‚</p><p>&ldquo;codec"é€‰é¡¹çš„å¸¸è§å€¼åŒ…æ‹¬ï¼š</p><ul><li><p>&ldquo;json&rdquo;ï¼šå°†äº‹ä»¶æ•°æ®ç¼–ç ä¸ºJSONæ ¼å¼ã€‚</p></li><li><p>&ldquo;plain&rdquo;ï¼šä¸å¯¹äº‹ä»¶æ•°æ®è¿›è¡Œç¼–ç ï¼Œä¿æŒåŸå§‹æ ¼å¼ã€‚</p></li><li><p>&ldquo;json_lines&rdquo;ï¼šå°†äº‹ä»¶æ•°æ®ç¼–ç ä¸ºä¸€è¡Œä¸€æ¡JSONè®°å½•çš„æ ¼å¼ã€‚</p></li><li><p>&ldquo;multiline&rdquo;ï¼šç”¨äºå¤„ç†å¤šè¡Œæ—¥å¿—äº‹ä»¶ã€‚</p></li></ul></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># /usr/share/logstash/bin/logstash -e &#39;input{ stdin{} } output{ stdout{ codec=&gt;rubydebug }}&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>The stdin plugin is now waiting <span style=color:#66d9ef>for</span> input:
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;message&#34;</span> <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;hello&#34;</span>,	<span style=color:#75715e># æ¶ˆæ¯å†…å®¹</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;host&#34;</span> <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;logstash&#34;</span>,	<span style=color:#75715e># ä¸»æœºå</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;@timestamp&#34;</span> <span style=color:#f92672>=</span>&gt; 2023-09-19T01:16:14.334Z, <span style=color:#75715e># äº‹ä»¶å‘ç”Ÿæ—¶é—´</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;@version&#34;</span> <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;1&#34;</span>	<span style=color:#75715e># äº‹ä»¶ç‰ˆæœ¬å·ï¼Œä¸€ä¸ªäº‹ä»¶å°±æ˜¯ä¸€ä¸ª ruby å¯¹è±¡</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>^C
</span></span></code></pre></div><h4 id=332-æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶>3.3.2 æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#332-æµ‹è¯•è¾“å‡ºåˆ°æ–‡ä»¶>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e>#  /usr/share/logstash/bin/logstash -e &#39;input { stdin{} } output{ file { path =&gt; &#34;/tmp/log-%{+YYYY.MM.dd}.txt&#34;}}&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>The stdin plugin is now waiting <span style=color:#66d9ef>for</span> input:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO <span style=color:#f92672>]</span> 2023-09-19 09:30:28.836 <span style=color:#f92672>[</span>Agent thread<span style=color:#f92672>]</span> agent - Pipelines running <span style=color:#f92672>{</span>:count<span style=color:#f92672>=</span>&gt;1, :running_pipelines<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[</span>:main<span style=color:#f92672>]</span>, :non_running_pipelines<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[]}</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>world
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span><span style=color:#75715e># è¾“å‡ºæ–‡æœ¬æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># file /tmp/log-2023.09.19.txt </span>
</span></span><span style=display:flex><span>/tmp/log-2023.09.19.txt: ASCII text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æ¶ˆæ¯å†…å®¹å·²è¾“å‡ºåˆ°æ–‡æœ¬ä¸­ï¼Œå¤šæ¡æ¶ˆæ¯ä¼šè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /tmp/log-2023.09.19.txt </span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;hello&#34;</span>,<span style=color:#e6db74>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#e6db74>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2023-09-19T01:30:40.576Z&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;logstash&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;world&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;logstash&#34;</span>,<span style=color:#e6db74>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#e6db74>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2023-09-19T01:33:12.308Z&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=333-æµ‹è¯•è¾“å‡ºåˆ°-elasticsearch>3.3.3 æµ‹è¯•è¾“å‡ºåˆ° elasticsearch<a hidden class=anchor aria-hidden=true href=#333-æµ‹è¯•è¾“å‡ºåˆ°-elasticsearch>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># /usr/share/logstash/bin/logstash -e &#39;input { stdin{} } output{ elasticsearch {hosts =&gt; [&#34;10.0.0.11:9200&#34;] index =&gt;&#34;mytest-%{+YYYY.MM.dd}&#34; }}&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>WARNING: All illegal access operations will be denied in a future release
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO <span style=color:#f92672>]</span> 2023-09-19 10:07:09.728 <span style=color:#f92672>[[</span>main<span style=color:#f92672>]</span>-pipeline-manager<span style=color:#f92672>]</span> javapipeline - Pipeline started <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;pipeline.id&#34;</span><span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;main&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO <span style=color:#f92672>]</span> 2023-09-19 10:07:09.770 <span style=color:#f92672>[</span>Agent thread<span style=color:#f92672>]</span> agent - Pipelines running <span style=color:#f92672>{</span>:count<span style=color:#f92672>=</span>&gt;1, :running_pipelines<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[</span>:main<span style=color:#f92672>]</span>, :non_running_pipelines<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[]}</span>
</span></span><span style=display:flex><span>The stdin plugin is now waiting <span style=color:#66d9ef>for</span> input:
</span></span><span style=display:flex><span>hello world!
</span></span></code></pre></div><p><strong>åœ¨ elasticsearch-01 æŸ¥çœ‹ç´¢å¼•</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># curl -s -XGET &#34;http://localhost:9200/_cat/indices?v&#34; | grep mytest</span>
</span></span><span style=display:flex><span>green  open   mytest-2023.09.19                qti_NT1sRNyBWrJY-T27zg   <span style=color:#ae81ff>1</span>   <span style=color:#ae81ff>1</span>          <span style=color:#ae81ff>1</span>            <span style=color:#ae81ff>0</span>     10.8kb          5.4kb
</span></span></code></pre></div><p><strong>ä½¿ç”¨ head æ’ä»¶ æŸ¥çœ‹</strong></p><h2 id=image-20230919164925784imageselkéƒ¨ç½²å’Œä½¿ç”¨image-20230919164925784png><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919164925784.png alt=image-20230919164925784></h2><h2 id=å››kibana-éƒ¨ç½²>å››ã€Kibana éƒ¨ç½²<a hidden class=anchor aria-hidden=true href=#å››kibana-éƒ¨ç½²>#</a></h2><p>Kibana æ˜¯ä¸€æ¬¾å¼€æºçš„æ•°æ®åˆ†æå’Œå¯è§†åŒ–å¹³å°ï¼Œå®ƒæ˜¯ Elastic Stack æˆå‘˜ä¹‹ä¸€ï¼ŒåŸºäº TypeScript è¯­è¨€å¼€å‘ï¼Œè®¾è®¡ç”¨äºå’Œ Elasticsearch åä½œ,å¯ä»¥ä½¿ç”¨ Kibana å¯¹ Elasticsearch ç´¢å¼•ä¸­çš„æ•°æ®è¿›è¡Œæœç´¢ã€æŸ¥çœ‹ã€äº¤äº’æ“ä½œ, ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ©ç”¨å›¾è¡¨ã€è¡¨æ ¼åŠåœ°å›¾å¯¹æ•°æ®è¿›è¡Œå¤šå…ƒåŒ–çš„åˆ†æå’Œå‘ˆç°ã€‚</p><p>Kibana å¯ä»¥ä½¿å¤§æ•°æ®é€šä¿—æ˜“æ‡‚ã€‚å®ƒå¾ˆç®€å•ï¼ŒåŸºäºæµè§ˆå™¨çš„ç•Œé¢ä¾¿äºä½ å¿«é€Ÿåˆ›å»ºå’Œåˆ†äº«åŠ¨æ€æ•°æ®ä»ªè¡¨æ¿æ¥è¿½è¸ª Elasticsearch çš„å®æ—¶æ•°æ®å˜åŒ–ã€‚</p><h3 id=41-ç¯å¢ƒå‡†å¤‡>4.1 ç¯å¢ƒå‡†å¤‡<a hidden class=anchor aria-hidden=true href=#41-ç¯å¢ƒå‡†å¤‡>#</a></h3><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>kibana</td><td>10.0.0.16</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl disable firewalld --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ NetworkManager</span>
</span></span><span style=display:flex><span>systemctl disable NetworkManager --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­selinux</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/selinux/config
</span></span></code></pre></div><h3 id=42-å®‰è£…kibana>4.2 å®‰è£…kibana<a hidden class=anchor aria-hidden=true href=#42-å®‰è£…kibana>#</a></h3><p>[Install Kibana | Kibana Guide <a href=https://www.elastic.co/guide/en/kibana/7.17/install.html>7.17] | Elastic</a></p><p>[Install Kibana with RPM | Kibana Guide <a href=https://www.elastic.co/guide/en/kibana/7.17/rpm.html>7.17] | Elastic</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &gt; /etc/yum.repos.d/kibana-7.repo <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[kibana-7.x]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Kibana repository for 7.x packages
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://artifacts.elastic.co/packages/7.x/yum
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autorefresh=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type=rpm-md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yum install -y kibana
</span></span></code></pre></div><h3 id=43-å¯åŠ¨æœåŠ¡å¹¶éªŒè¯>4.3 å¯åŠ¨æœåŠ¡å¹¶éªŒè¯<a hidden class=anchor aria-hidden=true href=#43-å¯åŠ¨æœåŠ¡å¹¶éªŒè¯>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/kibana/kibana.yml </span>
</span></span><span style=display:flex><span>server.port: <span style=color:#ae81ff>5601</span>
</span></span><span style=display:flex><span>server.host: <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>
</span></span><span style=display:flex><span>elasticsearch.hosts: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;http://10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl start kibana</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># éªŒè¯ç«¯å£åŠæœåŠ¡çŠ¶æ€</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># ss -ntl|grep 5601</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>128</span>          *:5601                     *:*                  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost:5601/status -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>x-content-type-options: nosniff
</span></span><span style=display:flex><span>referrer-policy: no-referrer-when-downgrade
</span></span><span style=display:flex><span>content-security-policy: script-src <span style=color:#e6db74>&#39;unsafe-eval&#39;</span> <span style=color:#e6db74>&#39;self&#39;</span>; worker-src blob: <span style=color:#e6db74>&#39;self&#39;</span>; style-src <span style=color:#e6db74>&#39;unsafe-inline&#39;</span> <span style=color:#e6db74>&#39;self&#39;</span>
</span></span><span style=display:flex><span>kbn-name: kibana
</span></span><span style=display:flex><span>kbn-license-sig: 476866a5c1f8dfa58158ed8c49315635554443bf0f3ae73994b5dfac2c777125
</span></span><span style=display:flex><span>content-type: text/html; charset<span style=color:#f92672>=</span>utf-8
</span></span><span style=display:flex><span>cache-control: private, no-cache, no-store, must-revalidate
</span></span><span style=display:flex><span>content-length: <span style=color:#ae81ff>144960</span>
</span></span><span style=display:flex><span>vary: accept-encoding
</span></span><span style=display:flex><span>Date: Tue, <span style=color:#ae81ff>19</span> Sep <span style=color:#ae81ff>2023</span> 03:14:15 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>120</span>
</span></span></code></pre></div><p>æœåŠ¡å¯åŠ¨æˆåŠŸåå³å¯é€šè¿‡æµè§ˆå™¨ç™»å½• kibana ç®¡ç†ç´¢å¼•å¹¶æŸ¥çœ‹æ—¥å¿—äº†</p><p>è®¿é—®æ–¹å¼ï¼š<code>http://10.0.0.16:5601/</code></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919163054561.png alt=image-20230919163054561></p><p>å¯ä»¥åœ¨ Stack Management &ndash;> Index Management æŸ¥çœ‹åˆ°å·²æ·»åŠ çš„ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥åœ¨ Index pattern æ·»åŠ ç´¢å¼•æ¨¡å¼ï¼Œæ–¹ä¾¿åç»­åœ¨ Discover ç•Œé¢æŸ¥çœ‹ã€‚</p><h2 id=äº”logstash-æ”¶é›†æ—¥å¿—>äº”ã€Logstash æ”¶é›†æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#äº”logstash-æ”¶é›†æ—¥å¿—>#</a></h2><h3 id=51-æ”¶é›†å•ä¸ªæ—¥å¿—>5.1 æ”¶é›†å•ä¸ªæ—¥å¿—<a hidden class=anchor aria-hidden=true href=#51-æ”¶é›†å•ä¸ªæ—¥å¿—>#</a></h3><p><strong>æ³¨æ„ï¼šlogstash é»˜è®¤ä»¥ logstash ç”¨æˆ·å¯åŠ¨ï¼Œå› ä¸ºéœ€è¦ä¿è¯ logstash ç”¨æˆ·å¯¹æ—¥å¿—æ–‡ä»¶æœ‰å¯¹åº”çš„æƒé™</strong></p><h4 id=511-å‡†å¤‡é…ç½®æ–‡ä»¶><strong>5.1.1 å‡†å¤‡é…ç½®æ–‡ä»¶</strong>ï¼š<a hidden class=anchor aria-hidden=true href=#511-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/system-log.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/messages&#34;</span> <span style=color:#75715e># æ—¥å¿—è·¯å¾„</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span> <span style=color:#75715e># äº‹ä»¶çš„å”¯ä¸€ç±»å‹</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span> <span style=color:#75715e># ç¬¬ä¸€æ¬¡æ”¶é›†æ—¥å¿—çš„ä½ç½®</span>
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;3&#34;</span> <span style=color:#75715e># æ—¥å¿—æ”¶é›†çš„é—´éš”æ—¶é—´</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/tmp/%{type}-%{+YYYY.MM.dd}.log&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=512-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™>5.1.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™<a hidden class=anchor aria-hidden=true href=#512-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># chmod 644 /var/log/messages</span>
</span></span></code></pre></div><h4 id=513-ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³•>5.1.3 ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³•<a hidden class=anchor aria-hidden=true href=#513-ä¿®æ”¹æ ¡éªŒæ–‡ä»¶è¯­æ³•>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/system-log.conf -t</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>. Config Validation Result: OK. Exiting Logstash <span style=color:#75715e># è¯­æ³•æ ¡éªŒé€šè¿‡</span>
</span></span></code></pre></div><h4 id=514-é‡å¯-logstash-éªŒè¯ç»“æœ>5.1.4 é‡å¯ logstash éªŒè¯ç»“æœ<a hidden class=anchor aria-hidden=true href=#514-é‡å¯-logstash-éªŒè¯ç»“æœ>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å†™å…¥ä¸€è¡Œæ—¥å¿—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># echo &#34;test&#34; &gt;&gt; /var/log/messages</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸè·å–æ”¶é›†åˆ°æ—¥å¿—ä¿¡æ¯</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># grep test /tmp/system-log-2023.09.19.log </span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;logstash&#34;</span>,<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;system-log&#34;</span>,<span style=color:#e6db74>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2023-09-19T07:02:14.221Z&#34;</span>,<span style=color:#e6db74>&#34;path&#34;</span>:<span style=color:#e6db74>&#34;/var/log/messages&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=52-æ”¶é›†å¤šä¸ªæ—¥å¿—>5.2 æ”¶é›†å¤šä¸ªæ—¥å¿—<a hidden class=anchor aria-hidden=true href=#52-æ”¶é›†å¤šä¸ªæ—¥å¿—>#</a></h3><h4 id=521-å‡†å¤‡é…ç½®æ–‡ä»¶>5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#521-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/system-log.conf</span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/messages&#34;</span> 
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span> 
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span> 
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/secure&#34;</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;secure-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span>
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;system-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      hosts<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      index<span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;%{type}-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;secure-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      hosts<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      index<span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;%{type}-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=522-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™>5.2.2 ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™<a hidden class=anchor aria-hidden=true href=#522-ä¿®æ”¹æ—¥å¿—æ–‡ä»¶æƒé™>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># chmod 644 /var/log/{messages,secure}</span>
</span></span></code></pre></div><h4 id=523--æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡>5.2.3 æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡<a hidden class=anchor aria-hidden=true href=#523--æ ¡éªŒè¯­æ³•å¹¶é‡å¯æœåŠ¡>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/system-log.conf -t</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>. Config Validation Result: OK. Exiting Logstash
</span></span></code></pre></div><h4 id=524-åœ¨-elasticsearch-æŸ¥çœ‹ç´¢å¼•>5.2.4 åœ¨ elasticsearch æŸ¥çœ‹ç´¢å¼•<a hidden class=anchor aria-hidden=true href=#524-åœ¨-elasticsearch-æŸ¥çœ‹ç´¢å¼•>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># curl -s -XGET &#34;http://localhost:9200/_cat/indices?v&#34; | grep  log</span>
</span></span><span style=display:flex><span>green  open   secure-log-2023.09.19            fQpud23vSVC7cpFPCITzbw   <span style=color:#ae81ff>1</span>   <span style=color:#ae81ff>1</span>          <span style=color:#ae81ff>2</span>            <span style=color:#ae81ff>0</span>     18.3kb          9.1kb
</span></span><span style=display:flex><span>green  open   system-log-2023.09.19            SeqTjpl-SU-n7uXUmmBBKA   <span style=color:#ae81ff>1</span>   <span style=color:#ae81ff>1</span>         <span style=color:#ae81ff>40</span>            <span style=color:#ae81ff>0</span>     44.8kb         22.4kb
</span></span></code></pre></div><h3 id=53-åœ¨-kibana-æŸ¥çœ‹ç´¢å¼•>5.3 åœ¨ kibana æŸ¥çœ‹ç´¢å¼•<a hidden class=anchor aria-hidden=true href=#53-åœ¨-kibana-æŸ¥çœ‹ç´¢å¼•>#</a></h3><h4 id=531-æŸ¥çœ‹å·²æœ‰ç´¢å¼•>5.3.1 æŸ¥çœ‹å·²æœ‰ç´¢å¼•<a hidden class=anchor aria-hidden=true href=#531-æŸ¥çœ‹å·²æœ‰ç´¢å¼•>#</a></h4><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919165931459.png alt=image-20230919165931459></p><h4 id=532-æ·»åŠ ç´¢å¼•æ¨¡å¼>5.3.2 æ·»åŠ ç´¢å¼•æ¨¡å¼<a hidden class=anchor aria-hidden=true href=#532-æ·»åŠ ç´¢å¼•æ¨¡å¼>#</a></h4><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919170325911.png alt=image-20230919170325911></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919170459491.png alt=image-20230919170459491></p><h4 id=533-æŸ¥çœ‹ç»“æœ>5.3.3 æŸ¥çœ‹ç»“æœ<a hidden class=anchor aria-hidden=true href=#533-æŸ¥çœ‹ç»“æœ>#</a></h4><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919170641576.png alt=image-20230919170641576></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230919170751287.png alt=image-20230919170751287></p><h3 id=54-æ”¶é›†-tomcat-æ—¥å¿—>5.4 æ”¶é›† Tomcat æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#54-æ”¶é›†-tomcat-æ—¥å¿—>#</a></h3><h4 id=541-åœ¨-logstash-å®‰è£…tomcat>5.4.1 åœ¨ logstash å®‰è£…tomcat<a hidden class=anchor aria-hidden=true href=#541-åœ¨-logstash-å®‰è£…tomcat>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install -y tomcat 
</span></span></code></pre></div><h4 id=542-é…ç½®-tomcat-æ—¥å¿—æ ¼å¼ä¸º-json-æ ¼å¼>5.4.2 é…ç½® tomcat æ—¥å¿—æ ¼å¼ä¸º json æ ¼å¼<a hidden class=anchor aria-hidden=true href=#542-é…ç½®-tomcat-æ—¥å¿—æ ¼å¼ä¸º-json-æ ¼å¼>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹ pattern ä¸º json æ ¼å¼ </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># grep -A 2 localhost_access_log /etc/tomcat/server.xml </span>
</span></span><span style=display:flex><span>               prefix<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;localhost_access_log.&#34;</span> suffix<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;.txt&#34;</span>
</span></span><span style=display:flex><span>               pattern<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{&amp;quot;clientip&amp;quot;:&amp;quot;%h&amp;quot;,&amp;quot;ClientUser&amp;quot;:&amp;quot;%l&amp;quot;,&amp;quot;authenticated&amp;quot;:&amp;quot;%u&amp;quot;,&amp;quot;AccessTime&amp;quot;:&amp;quot;%t&amp;quot;,&amp;quot;method&amp;quot;:&amp;quot;%r&amp;quot;,&amp;quot;status&amp;quot;:&amp;quot;%s&amp;quot;,&amp;quot;SendBytes&amp;quot;:&amp;quot;%b&amp;quot;,&amp;quot;Query?string&amp;quot;:&amp;quot;%q&amp;quot;,&amp;quot;partner&amp;quot;:&amp;quot;%{Referer}i&amp;quot;,&amp;quot;AgentVersion&amp;quot;:&amp;quot;%{User-Agent}i&amp;quot;}&#34;</span>/&gt;
</span></span></code></pre></div><p>é‡å¯æœåŠ¡å¹¶éªŒè¯ tomcat æ—¥å¿—æ ¼å¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl start tomcat</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ç”Ÿæˆæ—¥å¿—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost:8080 </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸå°†æ—¥å¿—ä¿®æ”¹ä¸º json æ ¼å¼</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@kibana ~<span style=color:#f92672>]</span><span style=color:#75715e># tail /var/log/tomcat/localhost_access_log.2023-09-19.txt </span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;clientip&#34;</span>:<span style=color:#e6db74>&#34;0:0:0:0:0:0:0:1&#34;</span>,<span style=color:#e6db74>&#34;ClientUser&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;authenticated&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;AccessTime&#34;</span>:<span style=color:#e6db74>&#34;[19/Sep/2023:18:17:31 +0800]&#34;</span>,<span style=color:#e6db74>&#34;method&#34;</span>:<span style=color:#e6db74>&#34;GET / HTTP/1.1&#34;</span>,<span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;404&#34;</span>,<span style=color:#e6db74>&#34;SendBytes&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;Query?string&#34;</span>:<span style=color:#e6db74>&#34;&#34;</span>,<span style=color:#e6db74>&#34;partner&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;AgentVersion&#34;</span>:<span style=color:#e6db74>&#34;curl/7.29.0&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>å¯ä»¥é€šè¿‡ <a href=https://www.sojson.com/>JSONåœ¨çº¿ | JSONè§£ææ ¼å¼åŒ–â€”SO JSONåœ¨çº¿å·¥å…·</a> æ ¡éªŒæ—¥å¿—æ ¼å¼</p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230920174042735.png alt=image-20230920174042735></p><h4 id=543-å‡†å¤‡é…ç½®æ–‡ä»¶>5.4.3 å‡†å¤‡é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#543-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/tomcat/localhost_access_log.*.txt&#34;</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;tomcat-access-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;end&#34;</span>
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>    codec<span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;json&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;tomcat-access-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      hosts<span style=color:#f92672>=</span>&gt;<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      index<span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;%{type}-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=544-é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿—>5.4.4 é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿—<a hidden class=anchor aria-hidden=true href=#544-é‡å¯æœåŠ¡å¹¶ç”Ÿæˆæ—¥å¿—>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># chmod +x /var/log/tomcat/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart logstash</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost:8080</span>
</span></span></code></pre></div><h4 id=545-æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ>5.4.5 æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ<a hidden class=anchor aria-hidden=true href=#545-æŸ¥çœ‹æ—¥å¿—æ”¶é›†ç»“æœ>#</a></h4><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921112431405.png alt=image-20230921112431405></p><h3 id=55-æ”¶é›†-java-æ—¥å¿—>5.5 æ”¶é›† Java æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#55-æ”¶é›†-java-æ—¥å¿—>#</a></h3><blockquote><p>æœ¬èŠ‚å†…å®¹ä¸»è¦ä»‹ç» multiline æ’ä»¶å®ç°å¤šè¡ŒåŒ¹é…ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä»¥å°†å¤šè¡Œè¿›è¡Œåˆå¹¶çš„æ’ä»¶ã€‚æœ‰äº›æƒ…å†µä¸‹ï¼ŒJava åº”ç”¨çš„æ—¥å¿—ä¼šå¾ˆé•¿ï¼Œåœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä»¥å¤šè¡Œçš„æ–¹å¼å‘ˆç°ï¼Œå› æ­¤éœ€è¦ç”¨æ­¤æ’ä»¶æ¥è¿›è¡Œå¤šè¡Œåˆå¹¶ä»¥ä¿è¯æ—¥å¿—çš„å®Œæ•´æ€§å’Œå¯è¯»æ€§ï¼Œæ‰€ä»¥æœ¬èŠ‚å†…å®¹çš„æ“ä½œæ˜¯å¯é€‰çš„è€Œéå¿…é¡»çš„ã€‚</p></blockquote><p>[Multiline codec plugin | Logstash Reference <a href=https://www.elastic.co/guide/en/logstash/current/plugins-codecs-multiline.html>8.10] | Elastic</a></p><h4 id=551-åœ¨-elasticsearch-01-å®‰è£…-logstash>5.5.1 åœ¨ elasticsearch-01 å®‰è£… logstash<a hidden class=anchor aria-hidden=true href=#551-åœ¨-elasticsearch-01-å®‰è£…-logstash>#</a></h4><p>è¿™é‡Œæ˜¯ç›´æ¥å–ç”¨ elasticsearch-01çš„ java æ—¥å¿—è¿›è¡Œæ¼”ç¤ºï¼Œå› æ­¤å®‰è£…äº† logstash</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å¯¼å…¥è¯ä¹¦</span>
</span></span><span style=display:flex><span>rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½® yum æº</span>
</span></span><span style=display:flex><span>cat &gt; /etc/yum.repos.d/logstash-7.repo <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[logstash-7.x]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>name=Elastic repository for 7.x packages
</span></span></span><span style=display:flex><span><span style=color:#e6db74>baseurl=https://artifacts.elastic.co/packages/7.x/yum
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span></span><span style=display:flex><span><span style=color:#e6db74>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autorefresh=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>type=rpm-md
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å®‰è£…å¹¶å¯åŠ¨æœåŠ¡</span>
</span></span><span style=display:flex><span>yum install -y logstash
</span></span></code></pre></div><h4 id=552-æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ>5.5.2 æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ<a hidden class=anchor aria-hidden=true href=#552-æµ‹è¯•å¤šè¡Œåˆå¹¶æ•ˆæœ>#</a></h4><h5 id=5521-å‡†å¤‡é…ç½®æ–‡ä»¶>5.5.2.1 å‡†å¤‡é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#5521-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/test.conf</span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  stdin <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    codec <span style=color:#f92672>=</span>&gt; multiline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      pattern <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;^\[&#34;</span> 	 <span style=color:#75715e># å½“é‡åˆ°[å¼€å¤´çš„è¡Œæ—¶å€™å°†å¤šè¡Œè¿›è¡Œåˆå¹¶</span>
</span></span><span style=display:flex><span>      negate <span style=color:#f92672>=</span>&gt; true 	 <span style=color:#75715e># true ä¸ºåŒ¹é…æˆåŠŸè¿›è¡Œæ“ä½œï¼Œfalse ä¸ºä¸æˆåŠŸè¿›è¡Œæ“ä½œ</span>
</span></span><span style=display:flex><span>      what <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;previous&#34;</span> <span style=color:#75715e># ä¸ä»¥å‰çš„è¡Œåˆå¹¶ï¼Œå¦‚æœæ˜¯ä¸‹é¢çš„è¡Œåˆå¹¶å°±æ˜¯ next</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filter <span style=color:#f92672>{</span> <span style=color:#75715e>#æ—¥å¿—è¿‡æ»¤ï¼Œå¦‚æœæ‰€æœ‰çš„æ—¥å¿—éƒ½è¿‡æ»¤å°±å†™è¿™é‡Œï¼Œå¦‚æœåªé’ˆå¯¹æŸä¸€ä¸ªè¿‡æ»¤å°±å†™åœ¨ input é‡Œé¢çš„æ—¥å¿—è¾“å…¥é‡Œé¢</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  stdout <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    codec <span style=color:#f92672>=</span>&gt; rubydebug
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=5552-æ£€æŸ¥é…ç½®>5.5.5.2 æ£€æŸ¥é…ç½®<a hidden class=anchor aria-hidden=true href=#5552-æ£€æŸ¥é…ç½®>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/test.conf -t
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span> which may change in a future major release of Logstash. To avoid unexpected changes when upgrading Logstash, please explicitly declare your desired ECS Compatibility mode.
</span></span><span style=display:flex><span>Configuration OK
</span></span></code></pre></div><h5 id=5553-ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯>5.5.5.3 ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯<a hidden class=anchor aria-hidden=true href=#5553-ä½¿ç”¨æ ‡å‡†è¾“å‡ºè¿›è¡ŒéªŒè¯>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/test.conf </span>
</span></span><span style=display:flex><span>Using bundled JDK: /usr/share/logstash/jdk
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>INFO <span style=color:#f92672>]</span> 2023-09-21 11:59:55.717 <span style=color:#f92672>[[</span>main<span style=color:#f92672>]</span>-pipeline-manager<span style=color:#f92672>]</span> javapipeline - Pipeline started <span style=color:#f92672>{</span><span style=color:#e6db74>&#34;pipeline.id&#34;</span><span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;main&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>The stdin plugin is now waiting <span style=color:#66d9ef>for</span> input:
</span></span></code></pre></div><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921121935966.png alt=image-20230921121935966></p><h4 id=553-æ”¶é›†-java-æ—¥å¿—>5.5.3 æ”¶é›† Java æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#553-æ”¶é›†-java-æ—¥å¿—>#</a></h4><h5 id=5531-å‡†å¤‡é…ç½®æ–‡ä»¶>5.5.3.1 å‡†å¤‡é…ç½®æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#5531-å‡†å¤‡é…ç½®æ–‡ä»¶>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/java.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/apps/elasticsearch/logs/elk-cluster.log&#34;</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;java-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span> 
</span></span><span style=display:flex><span>    codec <span style=color:#f92672>=</span>&gt; multiline <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      pattern <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;^\[&#34;</span> 
</span></span><span style=display:flex><span>      negate <span style=color:#f92672>=</span>&gt; true
</span></span><span style=display:flex><span>      what <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;previous&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;java-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      hosts <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      index<span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;%{type}-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=5532-ç”Ÿæˆ-java-æ—¥å¿—æ–‡ä»¶>5.5.3.2 ç”Ÿæˆ Java æ—¥å¿—æ–‡ä»¶<a hidden class=anchor aria-hidden=true href=#5532-ç”Ÿæˆ-java-æ—¥å¿—æ–‡ä»¶>#</a></h5><p>é‡å¯èŠ‚ç‚¹elasticsearch-02ï¼Œä½¿å¾—é›†ç¾¤äº§ç”Ÿå¤šè¡Œé”™è¯¯æ—¥å¿—ä»¥è§‚å¯Ÿå¤šè¡Œåˆå¹¶å’Œçš„æ•ˆæœ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-02 ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart elasticsearch.service</span>
</span></span></code></pre></div><p>ç”Ÿæˆçš„éƒ¨åˆ†é”™è¯¯æ—¥å¿—ï¼š</p><p><code>less /apps/elasticsearch/logs/elk-cluster.log</code></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921150830839.png alt=image-20230921150830839></p><h5 id=5533-æˆåŠŸæ”¶é›†æ—¥å¿—>5.5.3.3 æˆåŠŸæ”¶é›†æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#5533-æˆåŠŸæ”¶é›†æ—¥å¿—>#</a></h5><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921151058451.png alt=image-20230921151058451></p><h5 id=5534-é€šè¿‡-kibana-æŸ¥çœ‹ç»“æœ>5.5.3.4 é€šè¿‡ kibana æŸ¥çœ‹ç»“æœ<a hidden class=anchor aria-hidden=true href=#5534-é€šè¿‡-kibana-æŸ¥çœ‹ç»“æœ>#</a></h5><p>æ·»åŠ ç´¢å¼•æ¨¡å¼ <code>java-log*</code> ååœ¨ Discover é¢æ¿æŸ¥çœ‹åˆå¹¶åçš„æ—¥å¿—</p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921151839562.png alt=image-20230921151839562></p><h3 id=56-æ”¶é›†-nginx-æ—¥å¿—>5.6 æ”¶é›† Nginx æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#56-æ”¶é›†-nginx-æ—¥å¿—>#</a></h3><p><strong>nginx çš„æ—¥å¿—æ”¶é›†å’Œ Java ç±»ä¼¼ï¼Œæ ¸å¿ƒç‚¹åœ¨äºå°†æ—¥å¿—æ ¼å¼ä¿®æ”¹ä¸º json æ ¼å¼ï¼Œè¿™é‡Œä»…æ¼”ç¤ºå¦‚ä½•ä¿®æ”¹æ—¥å¿—æ ¼å¼ã€‚</strong></p><p><strong>åœ¨ logstash å®‰è£… nginx</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y nginx</span>
</span></span></code></pre></div><p><strong>ä¿®æ”¹ nginx æ—¥å¿—ä¸º json</strong> æ ¼å¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># grep log_format -A 13 /etc/nginx/nginx.conf</span>
</span></span><span style=display:flex><span>    log_format  main  <span style=color:#e6db74>&#39;{&#34;@timestamp&#34;:&#34;$time_iso8601&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;host&#34;:&#34;$server_addr&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;clientip&#34;:&#34;$remote_addr&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;size&#34;:$body_bytes_sent,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;responsetime&#34;:$request_time,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;upstreamtime&#34;:&#34;$upstream_response_time&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;upstreamhost&#34;:&#34;$upstream_addr&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;http_host&#34;:&#34;$host&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;url&#34;:&#34;$uri&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;domain&#34;:&#34;$host&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;xff&#34;:&#34;$http_x_forwarded_for&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;referer&#34;:&#34;$http_referer&#34;,&#39;</span>
</span></span><span style=display:flex><span>		      <span style=color:#e6db74>&#39;&#34;status&#34;:&#34;$status&#34;}&#39;</span>;
</span></span></code></pre></div><p><strong>é‡å¯ nginx ç”Ÿæˆæ—¥å¿—</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl start nginx</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># tail /var/log/nginx/access.log </span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2023-09-21T15:37:49+08:00&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;::1&#34;</span>,<span style=color:#e6db74>&#34;clientip&#34;</span>:<span style=color:#e6db74>&#34;::1&#34;</span>,<span style=color:#e6db74>&#34;size&#34;</span>:4833,<span style=color:#e6db74>&#34;responsetime&#34;</span>:0.000,<span style=color:#e6db74>&#34;upstreamtime&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;upstreamhost&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;http_host&#34;</span>:<span style=color:#e6db74>&#34;localhost&#34;</span>,<span style=color:#e6db74>&#34;url&#34;</span>:<span style=color:#e6db74>&#34;/index.html&#34;</span>,<span style=color:#e6db74>&#34;domain&#34;</span>:<span style=color:#e6db74>&#34;localhost&#34;</span>,<span style=color:#e6db74>&#34;xff&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;referer&#34;</span>:<span style=color:#e6db74>&#34;-&#34;</span>,<span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;200&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>æ ¡éªŒæ—¥å¿—æ ¼å¼</strong> <a href=https://www.sojson.com/>JSONåœ¨çº¿ | JSONè§£ææ ¼å¼åŒ–â€”SO JSONåœ¨çº¿å·¥å…·</a></p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230921154017383.png alt=image-20230921154017383></p><h3 id=57-ä½¿ç”¨-redis-ç¼“å­˜æ—¥å¿—>5.7 ä½¿ç”¨ Redis ç¼“å­˜æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#57-ä½¿ç”¨-redis-ç¼“å­˜æ—¥å¿—>#</a></h3><blockquote><p>ç›®æ ‡ï¼šé€šè¿‡åœ¨ redis å®¢æˆ·ç«¯éƒ¨ç½²çš„ logstash ï¼ˆä¸»æœºå log-clientï¼‰ æ”¶é›†æ—¥å¿—ï¼Œå†™å…¥ redis ï¼ˆç¼“å­˜ä½œç”¨ï¼‰ï¼Œå†é€šè¿‡ä¸“é—¨çš„ä¸€å° logstashï¼ˆä¸»æœºå logstashï¼‰è¯»å– redis ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearchã€‚</p></blockquote><h4 id=571-å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨>5.7.1 <strong>å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨</strong><a hidden class=anchor aria-hidden=true href=#571-å‡†å¤‡ä¸€ä¸ªå®¢æˆ·ç«¯æœåŠ¡å™¨>#</a></h4><table><thead><tr><th>ä¸»æœºå</th><th>IP</th><th>ç³»ç»Ÿ</th><th>é…ç½®</th></tr></thead><tbody><tr><td>log-client</td><td>10.0.0.9</td><td>CentOS 7.6</td><td>2U 4G</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å…³é—­é˜²ç«å¢™</span>
</span></span><span style=display:flex><span>systemctl disable firewalld --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­ NetworkManager</span>
</span></span><span style=display:flex><span>systemctl disable NetworkManager --now
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># å…³é—­selinux</span>
</span></span><span style=display:flex><span>setenforce <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#e6db74>&#39;/SELINUX/s/enforcing/disabled/&#39;</span> /etc/selinux/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹æ–‡ä»¶å¥æŸ„æ•°çš„é™åˆ¶</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;* soft nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;* hard nofile 65536&#34;</span> &gt;&gt; /etc/security/limits.conf
</span></span></code></pre></div><p><strong>å®‰è£… redis</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y redis</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ä¿®æ”¹é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/redis.conf </span>
</span></span><span style=display:flex><span>bind 0.0.0.0
</span></span><span style=display:flex><span>protected-mode yes
</span></span><span style=display:flex><span>port <span style=color:#ae81ff>6379</span>
</span></span><span style=display:flex><span>tcp-backlog <span style=color:#ae81ff>511</span>
</span></span><span style=display:flex><span>timeout <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>tcp-keepalive <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>daemonize yes
</span></span><span style=display:flex><span>supervised no
</span></span><span style=display:flex><span>pidfile /var/run/redis_6379.pid
</span></span><span style=display:flex><span>loglevel notice
</span></span><span style=display:flex><span>databases <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>requirepass passwd 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl start redis</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## å®‰è£… logstash</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># # å¯¼å…¥è¯ä¹¦</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># rpm --import https://artifacts.elastic.co/GPG-KEY-elasticsearch</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># # é…ç½® yum æº</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat &gt; /etc/yum.repos.d/logstash-7.repo &lt;&lt; EOF</span>
</span></span><span style=display:flex><span>&gt; <span style=color:#f92672>[</span>logstash-7.x<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>&gt; name<span style=color:#f92672>=</span>Elastic repository <span style=color:#66d9ef>for</span> 7.x packages
</span></span><span style=display:flex><span>&gt; baseurl<span style=color:#f92672>=</span>https://artifacts.elastic.co/packages/7.x/yum
</span></span><span style=display:flex><span>&gt; gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; gpgkey<span style=color:#f92672>=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span>&gt; enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; autorefresh<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; type<span style=color:#f92672>=</span>rpm-md
</span></span><span style=display:flex><span>&gt; EOF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y logstash</span>
</span></span></code></pre></div><h4 id=572-æ”¶é›†æ—¥å¿—å†™å…¥-redis>5.7.2 æ”¶é›†æ—¥å¿—å†™å…¥ redis<a hidden class=anchor aria-hidden=true href=#572-æ”¶é›†æ—¥å¿—å†™å…¥-redis>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/sys-to-redis.conf</span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/message&#34;</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span>
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;2&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;system-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    redis <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      data_type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;list&#34;</span> 
</span></span><span style=display:flex><span>      key <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span> 
</span></span><span style=display:flex><span>      host <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;10.0.0.9&#34;</span> 
</span></span><span style=display:flex><span>      port <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;6379&#34;</span> 
</span></span><span style=display:flex><span>      db <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;0&#34;</span> 
</span></span><span style=display:flex><span>      password <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;passwd&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># chmod +r /var/log/messages</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># ll /var/log/messages</span>
</span></span><span style=display:flex><span>-rw-r--r--. <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>596944</span> Sep <span style=color:#ae81ff>22</span> 11:39 /var/log/messages
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl start logstash.service </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># æˆåŠŸå†™å…¥æ—¥å¿—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># telnet localhost 6379</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
</span></span><span style=display:flex><span>auth passwd
</span></span><span style=display:flex><span>+OK
</span></span><span style=display:flex><span><span style=color:#66d9ef>select</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>+OK
</span></span><span style=display:flex><span>keys *
</span></span><span style=display:flex><span>*1
</span></span><span style=display:flex><span>$10
</span></span><span style=display:flex><span>system-log <span style=color:#75715e># ä»¥list æ–¹å¼å­˜å‚¨</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LRANGE system-log <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span>   <span style=color:#75715e>#æŸ¥çœ‹å…¶ä¸­ä¸€æ¡æ¶ˆæ¯</span>
</span></span><span style=display:flex><span>*1
</span></span><span style=display:flex><span>$139
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;path&#34;</span>:<span style=color:#e6db74>&#34;/var/log/messages&#34;</span>,<span style=color:#e6db74>&#34;host&#34;</span>:<span style=color:#e6db74>&#34;log-client&#34;</span>,<span style=color:#e6db74>&#34;@timestamp&#34;</span>:<span style=color:#e6db74>&#34;2023-09-22T03:52:48.547Z&#34;</span>,<span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;system-log&#34;</span>,<span style=color:#e6db74>&#34;@version&#34;</span>:<span style=color:#e6db74>&#34;1&#34;</span>,<span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;tet&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=573-è¯»å–-redis-çš„æ—¥å¿—å†™å…¥-elasticsearch>5.7.3 è¯»å– redis çš„æ—¥å¿—å†™å…¥ elasticsearch<a hidden class=anchor aria-hidden=true href=#573-è¯»å–-redis-çš„æ—¥å¿—å†™å…¥-elasticsearch>#</a></h4><p><strong>å‡†å¤‡é…ç½®æ–‡ä»¶ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/redis-to-es.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  redis <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    data_type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;list&#34;</span> 
</span></span><span style=display:flex><span>    key <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span> 
</span></span><span style=display:flex><span>    host <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;10.0.0.9&#34;</span> 
</span></span><span style=display:flex><span>    port <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;6379&#34;</span> 
</span></span><span style=display:flex><span>    db <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;0&#34;</span> 
</span></span><span style=display:flex><span>    password <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;passwd&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;system-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      hosts <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      index <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;redis-to-es-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯logstash</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart logstash</span>
</span></span></code></pre></div><p><strong>éªŒè¯ç»“æœï¼š</strong></p><p>elasticseach æˆåŠŸè·å–åˆ°æ—¥å¿—ä¿¡æ¯</p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230925093137893.png alt=image-20230925093137893></p><p>redis ä¸­çš„æ¶ˆæ¯è¢«æ¶ˆè´¹ï¼š</p><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230925093250415.png alt=image-20230925093250415></p><h3 id=58-ä½¿ç”¨-kafka-ç¼“å­˜æ—¥å¿—>5.8 ä½¿ç”¨ Kafka ç¼“å­˜æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#58-ä½¿ç”¨-kafka-ç¼“å­˜æ—¥å¿—>#</a></h3><h4 id=581-åœ¨-log-clinet-éƒ¨ç½²-kafka>5.8.1 åœ¨ log-clinet éƒ¨ç½² kafka<a hidden class=anchor aria-hidden=true href=#581-åœ¨-log-clinet-éƒ¨ç½²-kafka>#</a></h4><p><a href=https://senmer.github.io/zh/posts/tech/kafka/kafka%E7%AE%80%E4%BB%8B%E4%B8%8E%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/>Kafkaç®€ä»‹ä¸é›†ç¾¤éƒ¨ç½² | WZ&rsquo;s Blog (senmer.github.io)</a></p><h4 id=582-å°†æ—¥å¿—å†™å…¥-kafka>5.8.2 å°†æ—¥å¿—å†™å…¥ Kafka<a hidden class=anchor aria-hidden=true href=#582-å°†æ—¥å¿—å†™å…¥-kafka>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/sys-to-kafka.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  file <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    path <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;/var/log/messages&#34;</span>
</span></span><span style=display:flex><span>    type <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span>
</span></span><span style=display:flex><span>    start_position <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;beginning&#34;</span>
</span></span><span style=display:flex><span>    stat_interval <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;2&#34;</span> 
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span>type<span style=color:#f92672>]</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;system-log&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    kafka <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      bootstrap_servers <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;10.0.0.11:9092&#34;</span> 
</span></span><span style=display:flex><span>      topic_id <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span>   
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é…ç½®åŸŸåè§£æï¼Œkafka è¿æ¥ elasticsearch éœ€è¦ç”¨åˆ°</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/hosts</span>
</span></span><span style=display:flex><span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
</span></span><span style=display:flex><span>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>10.0.0.11 elasticsearch-01 
</span></span><span style=display:flex><span>10.0.0.12 elasticsearch-02 
</span></span><span style=display:flex><span>10.0.0.13 elasticsearch-03
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># é‡å¯ logstash</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart logstash</span>
</span></span></code></pre></div><h4 id=583-æŸ¥çœ‹-kafka-ä¸­çš„-topic>5.8.3 æŸ¥çœ‹ Kafka ä¸­çš„ topic<a hidden class=anchor aria-hidden=true href=#583-æŸ¥çœ‹-kafka-ä¸­çš„-topic>#</a></h4><p>æ³¨æ„ï¼šæœ¬ç¤ºä¾‹ä¸­ Kafkaã€zookeeperã€elasticsearch é›†ç¾¤å‡å®‰è£…åœ¨ï¼ˆ10.0.0.11ã€10.0.0.12ã€10.0.0.13ï¼‰ä¸‰å°ä¸»æœºä¸Š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 kafka<span style=color:#f92672>]</span><span style=color:#75715e># pwd</span>
</span></span><span style=display:flex><span>/usr/local/kafka
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 kafka<span style=color:#f92672>]</span><span style=color:#75715e># ./bin/kafka-topics.sh --list --zookeeper localhost:2181</span>
</span></span><span style=display:flex><span>OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, <span style=color:#66d9ef>then</span> you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads<span style=color:#f92672>=</span>N
</span></span><span style=display:flex><span>__consumer_offsets
</span></span><span style=display:flex><span>system-log <span style=color:#75715e># æˆåŠŸå†™å…¥æ—¥å¿—</span>
</span></span></code></pre></div><h4 id=584-è¯»å–-kafka-ä¸­çš„æ—¥å¿—å†™å…¥-elasticsearch>5.8.4 è¯»å– Kafka ä¸­çš„æ—¥å¿—å†™å…¥ Elasticsearch<a hidden class=anchor aria-hidden=true href=#584-è¯»å–-kafka-ä¸­çš„æ—¥å¿—å†™å…¥-elasticsearch>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/kafka-to-es.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  kafka <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    bootstrap_servers <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;10.0.0.11:9092&#34;</span>
</span></span><span style=display:flex><span>    topics <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log&#34;</span>
</span></span><span style=display:flex><span>    consumer_threads <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    hosts <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;kafka-to-es-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart logstash.service</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20230926110427460.png alt=image-20230926110427460></p><h3 id=59-ä½¿ç”¨-filebeat-æ”¶é›†æ—¥å¿—>5.9 ä½¿ç”¨ filebeat æ”¶é›†æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#59-ä½¿ç”¨-filebeat-æ”¶é›†æ—¥å¿—>#</a></h3><p>è¦åœ¨ Filebeat ä¸­ä½¿ç”¨ <code>conf.d/*</code> çš„æ–¹å¼å¯¼å…¥é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ä½ éœ€è¦æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œé…ç½®ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªå­˜æ”¾é¢å¤–é…ç½®æ–‡ä»¶çš„ç›®å½•ï¼Œé€šå¸¸å‘½åä¸º <code>conf.d</code>ï¼Œå¹¶å°†ä½ çš„é¢å¤–é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨è¯¥ç›®å½•ä¸­ã€‚è¿™äº›é…ç½®æ–‡ä»¶å¯ä»¥åŒ…å«ä¸åŒè¾“å…¥ã€è¿‡æ»¤å™¨å’Œè¾“å‡ºçš„å®šä¹‰ã€‚</p></li><li><p>ç¡®ä¿ Filebeat é…ç½®æ–‡ä»¶ä¸­åŒ…å«ä¸€ä¸ªé…ç½®é¡¹ï¼Œå‘Šè¯‰ Filebeat å»åŠ è½½ <code>conf.d</code> ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚é€šå¸¸ï¼Œä½ å¯ä»¥ä½¿ç”¨ <code>filebeat.config.modules</code> æ¥é…ç½®é¢å¤–é…ç½®æ–‡ä»¶çš„è·¯å¾„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>filebeat.config.modules</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>${path.config}/modules.d/*.yml</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>reload.enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>filebeat.config.inputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>${path.config}/conf.d/*.yml </span> <span style=color:#75715e># è¿™é‡ŒæŒ‡å®šé¢å¤–é…ç½®æ–‡ä»¶çš„è·¯å¾„</span>
</span></span></code></pre></div><ol start=3><li>ç¡®ä¿ä½ çš„é¢å¤–é…ç½®æ–‡ä»¶ï¼ˆä½äº <code>conf.d</code> ç›®å½•ä¸­ï¼‰å…·æœ‰æ­£ç¡®çš„æ ¼å¼å’Œè¯­æ³•ã€‚è¿™äº›é…ç½®æ–‡ä»¶å¯ä»¥åŒ…å«è¾“å…¥ã€è¿‡æ»¤å™¨å’Œè¾“å‡ºçš„å®šä¹‰ï¼Œç±»ä¼¼äºä¸»é…ç½®æ–‡ä»¶ã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é¢å¤–é…ç½®æ–‡ä»¶çš„å†…å®¹ï¼ˆ<code>conf.d/my-custom-input.yml</code>ï¼‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>filebeat.inputs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>log</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/log/myapp/*.log</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>fields</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>log_type</span>: <span style=color:#ae81ff>myapp-log</span>
</span></span></code></pre></div><ol start=4><li>ä¿å­˜ä¸»é…ç½®æ–‡ä»¶å’Œé¢å¤–é…ç½®æ–‡ä»¶ï¼Œå¹¶é‡æ–°å¯åŠ¨ Filebeat æœåŠ¡ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart filebeat
</span></span></code></pre></div><p>è¿™æ ·ï¼ŒFilebeat å°†åŠ è½½ä¸»é…ç½®æ–‡ä»¶ä»¥åŠä½äº <code>conf.d</code> ç›®å½•ä¸‹çš„æ‰€æœ‰é¢å¤–é…ç½®æ–‡ä»¶ï¼Œå¹¶æ ¹æ®è¿™äº›é…ç½®æ–‡ä»¶æ¥å¤„ç†æ—¥å¿—æ•°æ®ã€‚</p><p>è¯·æ ¹æ®ä½ çš„å®é™…éœ€æ±‚å’Œç¯å¢ƒå¯¹é…ç½®è¿›è¡Œè‡ªå®šä¹‰ï¼Œå¹¶ç¡®ä¿é…ç½®æ–‡ä»¶çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚</p><p><a href=https://www.elastic.co/guide/en/beats/filebeat/7.17/setup-repositories.html#_yum>https://www.elastic.co/guide/en/beats/filebeat/7.17/setup-repositories.html#_yum</a></p><h4 id=591-åœ¨-log-client-å®‰è£…-filebeat>5.9.1 <strong>åœ¨ log-client å®‰è£… filebeat</strong><a hidden class=anchor aria-hidden=true href=#591-åœ¨-log-client-å®‰è£…-filebeat>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># sudo rpm --import https://packages.elastic.co/GPG-KEY-elasticsearch</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat &gt; /etc/yum.repos.d/filebeat-7.repo &lt;&lt; EOF</span>
</span></span><span style=display:flex><span>&gt; <span style=color:#f92672>[</span>elastic-7.x<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>&gt; name<span style=color:#f92672>=</span>Elastic repository <span style=color:#66d9ef>for</span> 7.x packages
</span></span><span style=display:flex><span>&gt; baseurl<span style=color:#f92672>=</span>https://artifacts.elastic.co/packages/7.x/yum
</span></span><span style=display:flex><span>&gt; gpgcheck<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; gpgkey<span style=color:#f92672>=</span>https://artifacts.elastic.co/GPG-KEY-elasticsearch
</span></span><span style=display:flex><span>&gt; enabled<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; autorefresh<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>&gt; type<span style=color:#f92672>=</span>rpm-md
</span></span><span style=display:flex><span>&gt; EOF
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># sudo yum install filebeat</span>
</span></span></code></pre></div><h4 id=592-æ”¶é›†ç³»ç»Ÿæ—¥å¿—>5.9.2 æ”¶é›†ç³»ç»Ÿæ—¥å¿—<a hidden class=anchor aria-hidden=true href=#592-æ”¶é›†ç³»ç»Ÿæ—¥å¿—>#</a></h4><h5 id=5921-æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—å†™å…¥-kafka>5.9.2.1 æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—ï¼Œå†™å…¥ kafka<a hidden class=anchor aria-hidden=true href=#5921-æ”¶é›†å•ä¸ªç³»ç»Ÿæ—¥å¿—å†™å…¥-kafka>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/filebeat/filebeat.yml</span>
</span></span><span style=display:flex><span>lebeat.config.modules:
</span></span><span style=display:flex><span>  path: <span style=color:#e6db74>${</span>path.config<span style=color:#e6db74>}</span>/modules.d/*.yml
</span></span><span style=display:flex><span>  reload.enabled: true
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>filebeat.inputs:
</span></span><span style=display:flex><span>  - type: log
</span></span><span style=display:flex><span>    enabled: true
</span></span><span style=display:flex><span>    paths:
</span></span><span style=display:flex><span>      - /var/log/*.log
</span></span><span style=display:flex><span>      - /var/log/messages
</span></span><span style=display:flex><span>    exclude_lines: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;^DBG&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    exclude_files: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;.gz</span>$<span style=color:#e6db74>&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    fields_under_root: true
</span></span><span style=display:flex><span>    fields:
</span></span><span style=display:flex><span>      document_type: <span style=color:#e6db74>&#34;system-log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output.kafka:
</span></span><span style=display:flex><span>  hosts: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9092&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.12:9092&#34;</span>, <span style=color:#e6db74>&#34;10.0.0.13:9092&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  topic: <span style=color:#e6db74>&#34;system-log-filebeat&#34;</span>
</span></span><span style=display:flex><span>  partition.round_robin:
</span></span><span style=display:flex><span>    reachable_only: true
</span></span><span style=display:flex><span>  required_acks: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  compression: gzip
</span></span><span style=display:flex><span>  max_message_bytes: <span style=color:#ae81ff>1000000</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@log-client ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart filebeat</span>
</span></span></code></pre></div><h5 id=2922-åœ¨-kafka-ä¸­æŸ¥çœ‹-topic>2.9.2.2 åœ¨ kafka ä¸­æŸ¥çœ‹ topic<a hidden class=anchor aria-hidden=true href=#2922-åœ¨-kafka-ä¸­æŸ¥çœ‹-topic>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@elasticsearch-01 elasticsearch<span style=color:#f92672>]</span><span style=color:#75715e># /usr/local/src/kafka_2.12-2.1.0/bin/kafka-topics.sh  --list --zookeeper localhost:2181 |grep filebeat</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>system-log-filebeat
</span></span></code></pre></div><h5 id=2923-ä½¿ç”¨-logstash-å°†-kafka-ä¸­çš„æ—¥å¿—å†™å…¥-elasticsearch>2.9.2.3 ä½¿ç”¨ logstash å°† kafka ä¸­çš„æ—¥å¿—å†™å…¥ elasticsearch<a hidden class=anchor aria-hidden=true href=#2923-ä½¿ç”¨-logstash-å°†-kafka-ä¸­çš„æ—¥å¿—å†™å…¥-elasticsearch>#</a></h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/logstash/conf.d/kafka-to-es.conf </span>
</span></span><span style=display:flex><span>input <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  kafka <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    bootstrap_servers <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;10.0.0.11:9092&#34;</span>
</span></span><span style=display:flex><span>    topics <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;system-log-filebeat&#34;</span>
</span></span><span style=display:flex><span>    consumer_threads <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  elasticsearch <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    hosts <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;10.0.0.11:9200&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    index <span style=color:#f92672>=</span>&gt; <span style=color:#e6db74>&#34;syslog-filebeat-%{+YYYY.MM.dd}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@logstash ~<span style=color:#f92672>]</span><span style=color:#75715e># systemctl restart logstash</span>
</span></span></code></pre></div><p><img loading=lazy src=/images/ELK%e9%83%a8%e7%bd%b2%e5%92%8c%e4%bd%bf%e7%94%a8//image-20231007165803012.png alt=image-20231007165803012></p><h2 id=faq>FAQ<a hidden class=anchor aria-hidden=true href=#faq>#</a></h2><h3 id=elk-ä¸­ç”¨-redis-å’Œç”¨-kafka-ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ«>elk ä¸­ç”¨ redis å’Œç”¨ kafka ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#elk-ä¸­ç”¨-redis-å’Œç”¨-kafka-ç¼“å­˜æ—¥å¿—æœ‰ä½•åŒºåˆ«>#</a></h3><p>åœ¨ELKï¼ˆElasticsearch, Logstash, Kibanaï¼‰å †æ ˆä¸­ï¼Œä½¿ç”¨Rediså’ŒKafkaæ¥ç¼“å­˜æ—¥å¿—æœ‰ä¸€äº›åŒºåˆ«ï¼Œå®ƒä»¬åˆ†åˆ«é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨æƒ…å¢ƒå’Œéœ€æ±‚ï¼š</p><ol><li><p>Redisç¼“å­˜æ—¥å¿—ï¼š</p><ul><li>Redisæ˜¯ä¸€ä¸ªå†…å­˜æ•°æ®åº“ï¼Œé€šå¸¸ç”¨äºç¼“å­˜å’Œé«˜é€Ÿè¯»å†™æ“ä½œã€‚åœ¨ELKä¸­ï¼ŒRedisé€šå¸¸ç”¨äºç¼“å­˜æ—¥å¿—äº‹ä»¶ï¼Œä»¥ä¾¿åœ¨Logstashå’ŒElasticsearchä¹‹é—´æä¾›å¿«é€Ÿçš„ç¼“å†²æœºåˆ¶ã€‚</li><li>ä½¿ç”¨Redisç¼“å­˜æ—¥å¿—çš„ä¼˜ç‚¹åŒ…æ‹¬é«˜é€Ÿçš„å†™å…¥å’Œè¯»å–é€Ÿåº¦ï¼Œä»¥åŠç®€å•çš„è®¾ç½®å’Œé…ç½®ã€‚</li><li>ç¼ºç‚¹æ˜¯Redisçš„å­˜å‚¨å®¹é‡å—é™äºå†…å­˜å¤§å°ï¼Œå¯èƒ½éœ€è¦æ›´å¤šçš„å†…å­˜æ¥ç¼“å­˜å¤§é‡çš„æ—¥å¿—äº‹ä»¶ã€‚æ­¤å¤–ï¼ŒRedisä¸æ˜¯ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨äºå¤„ç†æ—¥å¿—æµçš„å·¥å…·ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½éœ€è¦é¢å¤–çš„å®šåˆ¶ã€‚</li></ul></li><li><p>Kafkaç¼“å­˜æ—¥å¿—ï¼š</p><ul><li>Kafkaæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé€šå¸¸ç”¨äºé«˜ååé‡çš„æ•°æ®æµå¤„ç†ã€‚åœ¨ELKä¸­ï¼ŒKafkaç”¨äºæ¥æ”¶ã€ç¼“å­˜å’Œåˆ†å‘æ—¥å¿—äº‹ä»¶ï¼Œå……å½“äº†ä¸€ä¸ªæŒä¹…æ€§çš„æ•°æ®ç¼“å†²å±‚ã€‚</li><li>ä½¿ç”¨Kafkaçš„ä¼˜ç‚¹åŒ…æ‹¬èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡çš„æ•°æ®æµï¼Œæä¾›æ•°æ®æŒä¹…æ€§ï¼Œä»¥åŠå…·å¤‡é«˜å¯ç”¨æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚</li><li>ç¼ºç‚¹æ˜¯Kafkaçš„é…ç½®å’Œç»´æŠ¤å¯èƒ½ç›¸å¯¹å¤æ‚ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œå®ƒä¸åƒRedisé‚£æ ·é€‚ç”¨äºä½å»¶è¿Ÿè¦æ±‚çš„åœºæ™¯ã€‚</li></ul></li></ol><p>å…³é”®åŒºåˆ«ï¼š</p><ul><li>Redisä¸»è¦ç”¨äºç¬æ—¶æ€§ç¼“å­˜ï¼Œé€‚ç”¨äºéœ€è¦å¿«é€Ÿè¯»å†™æ“ä½œçš„åœºæ™¯ï¼Œä½†ä¸é€‚ç”¨äºé•¿æœŸå­˜å‚¨ã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³Logstashå’ŒElasticsearchä¹‹é—´çš„é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜ã€‚</li><li>Kafkaæ›´é€‚åˆäºæ•°æ®æµå¤„ç†ï¼Œèƒ½å¤Ÿç¼“å­˜å¤§é‡æ•°æ®å¹¶ç¡®ä¿æŒä¹…æ€§ã€‚å®ƒå…è®¸å¤šä¸ªæ¶ˆè´¹è€…å¹¶è¡Œå¤„ç†æ•°æ®ï¼Œå› æ­¤é€‚ç”¨äºå¤§è§„æ¨¡ã€é«˜ååé‡çš„æ—¥å¿—å¤„ç†ã€‚</li></ul><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œé€‰æ‹©ä½¿ç”¨Redisè¿˜æ˜¯Kafkaå–å†³äºä½ çš„æ—¥å¿—å¤„ç†éœ€æ±‚å’Œæ¶æ„ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªç®€å•çš„ç¼“å†²å±‚æ¥è§£å†³é€Ÿåº¦ä¸åŒ¹é…çš„é—®é¢˜ï¼ŒRediså¯èƒ½æ˜¯æ›´åˆé€‚çš„é€‰æ‹©ã€‚å¦‚æœä½ éœ€è¦å¤„ç†å¤§é‡çš„æ—¥å¿—æ•°æ®ï¼Œéœ€è¦æŒä¹…æ€§å’Œåˆ†å¸ƒå¼å¤„ç†èƒ½åŠ›ï¼Œé‚£ä¹ˆKafkaå¯èƒ½æ›´é€‚åˆã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘å°†å®ƒä»¬ç»“åˆä½¿ç”¨ï¼Œä½¿ç”¨Redisè¿›è¡ŒçŸ­æœŸç¼“å­˜ï¼Œç„¶åå°†æ—¥å¿—äº‹ä»¶å†™å…¥Kafkaä»¥è¿›è¡Œé•¿æœŸå­˜å‚¨å’Œåˆ†å‘ã€‚</p><h3 id=filebeat-å’Œ-logstash-çš„åŒºåˆ«>filebeat å’Œ logstash çš„åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#filebeat-å’Œ-logstash-çš„åŒºåˆ«>#</a></h3><p>Filebeatå’ŒLogstashéƒ½æ˜¯ç”¨äºæ—¥å¿—æ”¶é›†å’Œä¼ è¾“çš„å·¥å…·ï¼Œä½†å®ƒä»¬æœ‰ä¸€äº›å…³é”®åŒºåˆ«ï¼Œä¸»è¦æ¶‰åŠåˆ°å®ƒä»¬çš„ç”¨é€”ã€ç‰¹æ€§å’Œæ€§èƒ½ï¼š</p><ol><li><p>ç”¨é€”ï¼š</p><ul><li>Filebeatï¼šFilebeatæ˜¯è½»é‡çº§çš„æ•°æ®æ”¶é›†å™¨ï¼Œä¸“æ³¨äºä»æ–‡ä»¶å’Œæ—¥å¿—ä½ç½®æ”¶é›†æ•°æ®å¹¶å°†å…¶å‘é€åˆ°ç›®æ ‡ä½ç½®ï¼Œé€šå¸¸æ˜¯Elasticsearchæˆ–Logstashã€‚å®ƒä¸»è¦ç”¨äºæ—¥å¿—æ–‡ä»¶çš„æ”¶é›†å’Œè½¬å‘ã€‚</li><li>Logstashï¼šLogstashæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®å¤„ç†å¼•æ“ï¼Œå…·æœ‰æ•°æ®è½¬æ¢ã€è¿‡æ»¤å’Œä¸°å¯ŒåŠŸèƒ½ã€‚å®ƒå¯ä»¥ç”¨äºæ•°æ®çš„é‡‡é›†ã€è½¬æ¢ã€ä¸°å¯Œã€è¿‡æ»¤å’Œè¾“å‡ºã€‚è™½ç„¶å®ƒä¹Ÿå¯ä»¥ç”¨äºæ—¥å¿—æ”¶é›†ï¼Œä½†å…¶åŠŸèƒ½æ›´ä¸°å¯Œï¼Œå¯ä»¥å¤„ç†å¤šç§æ•°æ®æºå’Œæ ¼å¼ã€‚</li></ul></li><li><p>å¤„ç†å’Œè½¬æ¢ï¼š</p><ul><li>Filebeatï¼šFilebeaté€šå¸¸ä¸å¯¹æ•°æ®è¿›è¡Œå¤„ç†æˆ–è½¬æ¢ï¼Œå®ƒè´Ÿè´£å°†åŸå§‹æ•°æ®å‘é€åˆ°ç›®æ ‡ä½ç½®ã€‚å®ƒå¯ä»¥å¯¹æ•°æ®è¿›è¡Œç®€å•çš„ç­›é€‰ï¼Œä½†ä¸å…·å¤‡å¤æ‚çš„æ•°æ®å¤„ç†åŠŸèƒ½ã€‚</li><li>Logstashï¼šLogstashå…·æœ‰å¼ºå¤§çš„æ•°æ®å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œå¤æ‚çš„è½¬æ¢ã€è¿‡æ»¤ã€ä¸°å¯Œå’Œæ ‡å‡†åŒ–æ“ä½œã€‚è¿™ä½¿å¾—Logstashåœ¨éœ€è¦å¯¹æ•°æ®è¿›è¡Œå¤æ‚å¤„ç†çš„æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</li></ul></li><li><p>æ’ä»¶å’Œè¾“å‡ºï¼š</p><ul><li>Filebeatï¼šFilebeatçš„ä¸»è¦ç›®æ ‡æ˜¯å°†æ•°æ®å‘é€åˆ°Elasticsearchã€Logstashæˆ–å…¶ä»–ç›®æ ‡ã€‚å®ƒçš„è¾“å‡ºé€‰é¡¹ç›¸å¯¹è¾ƒå°‘ï¼Œä¸»è¦ç”¨äºæ•°æ®çš„ä¼ è¾“ã€‚</li><li>Logstashï¼šLogstashæœ‰ä¸°å¯Œçš„æ’ä»¶å’Œè¾“å‡ºé€‰é¡¹ï¼Œå¯ä»¥å°†æ•°æ®å‘é€åˆ°å¤šç§ç›®æ ‡ï¼ŒåŒ…æ‹¬Elasticsearchã€Kafkaã€Redisã€æ•°æ®åº“ç­‰ï¼ŒåŒæ—¶å¯ä»¥ä½¿ç”¨å„ç§è¾“å…¥æ’ä»¶æ¥æ¥æ”¶æ•°æ®æºã€‚</li></ul></li><li><p>è½»é‡æ€§å’Œæ€§èƒ½ï¼š</p><ul><li>Filebeatï¼šFilebeatè®¾è®¡ä¸ºè½»é‡çº§ï¼Œå ç”¨è¾ƒå°‘çš„ç³»ç»Ÿèµ„æºï¼Œé€‚ç”¨äºéƒ¨ç½²åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­ã€‚å®ƒé€‚åˆå¿«é€Ÿä¼ è¾“æ—¥å¿—æ•°æ®ã€‚</li><li>Logstashï¼šLogstashç›¸å¯¹è¾ƒé‡ï¼Œéœ€è¦æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œå¤§è§„æ¨¡æ•°æ®å¤„ç†æ—¶ã€‚å®ƒé€‚åˆå¤„ç†å¤æ‚çš„æ•°æ®å¤„ç†ä»»åŠ¡ã€‚</li></ul></li><li><p>éƒ¨ç½²åœºæ™¯ï¼š</p><ul><li>Filebeaté€‚ç”¨äºç®€å•çš„æ—¥å¿—ä¼ è¾“å’Œå¿«é€Ÿçš„æ—¥å¿—æ”¶é›†åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦è½»é‡çº§è§£å†³æ–¹æ¡ˆçš„æƒ…å†µä¸‹ã€‚</li><li>Logstashé€‚ç”¨äºéœ€è¦è¿›è¡Œæ•°æ®å¤„ç†ã€è½¬æ¢å’Œä¸°å¯Œæ“ä½œçš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯å½“éœ€è¦å¤„ç†å¤šç§æ•°æ®æºæˆ–æ•°æ®æ ¼å¼æ—¶ã€‚</li></ul></li></ol><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚æ¥é€‰æ‹©ä½¿ç”¨Filebeatã€Logstashï¼Œæˆ–è€…å®ƒä»¬çš„ç»„åˆï¼Œä»¥æ„å»ºé€‚åˆä½ çš„æ—¥å¿—æ”¶é›†å’Œå¤„ç†æ¶æ„ã€‚è¦æ ¹æ®ç‰¹å®šéœ€æ±‚è¿›è¡Œé€‰æ‹©ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://senmer.github.io/img/wechat_pay.png alt=wechat_pay></a><p>å¾®ä¿¡</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://senmer.github.io/img/alipay.png alt=alipay></a><p>æ”¯ä»˜å®</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>ğŸ§§ é¼“åŠ±</span></button></div></div><footer class=post-footer><nav class=paginav><a class=next href=https://senmer.github.io/zh/posts/tech/vpn/openvpn%E5%90%AF%E7%94%A8ldap+googleauthenticator%E8%AE%A4%E8%AF%81/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>OpenVPNå¯ç”¨LDAP+GoogleAuthenticatorè®¤è¯</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'ğŸ‘‰å±•å¼€è¯„è®º';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'ğŸ‘‡å…³é—­è¯„è®º';color:var(--content)}</style><div><details class=comments_details open><summary style=display:none></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>