<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Nginxæ ¸å¿ƒé…ç½® | WZ's Blog</title><meta name=keywords content="Nginx"><meta name=description content="ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶"><meta name=author content="nier"><link rel=canonical href=https://senmer.github.io/posts/tech/nginx/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script>
<script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Nginxæ ¸å¿ƒé…ç½®"><meta property="og:description" content="ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/posts/tech/nginx/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-25T14:36:53+00:00"><meta property="article:modified_time" content="2022-07-25T14:36:53+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nginxæ ¸å¿ƒé…ç½®"><meta name=twitter:description content="ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"ğŸ“šæ–‡ç« ","item":"https://senmer.github.io/posts/"},{"@type":"ListItem","position":2,"name":"ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯","item":"https://senmer.github.io/posts/tech/"},{"@type":"ListItem","position":3,"name":"Nginxæ ¸å¿ƒé…ç½®","item":"https://senmer.github.io/posts/tech/nginx/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Nginxæ ¸å¿ƒé…ç½®","name":"Nginxæ ¸å¿ƒé…ç½®","description":"ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶\n","keywords":["Nginx"],"articleBody":"ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶\né…ç½®æ–‡ä»¶è¯´æ˜ nginx å®˜æ–¹æ–‡æ¡£ï¼šhttp://nginx.org/en/docs/\nnginx é…ç½®æ–‡ä»¶ç»„æˆï¼š ä¸»é…ç½®æ–‡ä»¶ï¼š nginx.conf å­é…ç½®æ–‡ä»¶ï¼š conf.d/*.conf fastcgi,ï¼Œ uwsgiï¼Œscgi ç­‰åè®®çš„ç›¸å…³é…ç½®æ–‡ä»¶ mime.typesï¼šæ”¯æŒçš„mimeç±»å‹ï¼ŒMIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ï¼ŒMIMEæ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ï¼Œæ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“å¸¦æœ‰æŸç§æ‰©å±•åçš„æ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ‰“å¼€ï¼ˆæ¯”å¦‚ï¼šåº”ç”¨ç¨‹åºä¼šè¢«ä¸‹è½½ï¼Œæ–‡æœ¬æ–‡ä»¶ä¼šç›´æ¥æ˜¾ç¤ºå†…å®¹ï¼‰ã€‚ç®€å•æ¥è¯´ï¼ŒMIMEå°±æ˜¯åˆ©ç”¨æ‰©å±•åæ ‡è¯†æ–‡ä»¶ç±»å‹ï¼Œç„¶åæ ¹æ®æ–‡ä»¶çš„ç±»å‹åšå“åº”çš„å¤„ç†ã€‚MIME å‚è€ƒæ–‡æ¡£ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types nginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜ï¼š é…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤å’ŒæŒ‡ä»¤å—æ„æˆ æ¯æ¡æŒ‡ä»¤ä»¥åˆ†å·ï¼›ç»“æŸï¼ŒæŒ‡ä»¤å’Œå€¼ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš” å¤šæ¡æŒ‡ä»¤å¯ä»¥æ”¾åœ¨åŒä¸€è¡Œï¼Œä»¥åˆ†å·åˆ†éš”ã€‚ä½†å¯è¯»æ€§å·®ï¼Œä¸æ¨èè¿™æ ·é…ç½® æŒ‡ä»¤å—ä»¥{ } æ‹¬å·ä½œä¸ºå¼€å§‹å’Œç»“æŸçš„æ ‡è¯†ï¼Œå°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä¸”æ”¯æŒåµŒå¥— å¯é€šè¿‡includeå¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹ï¼Œæå‡é…ç½®æ–‡ä»¶çš„å¯ç»´æŠ¤æ€§ï¼ˆå¦‚å­é…ç½®æ–‡ä»¶conf.d/*.conf) é…ç½®æ–‡ä»¶ä½¿ç”¨# ä½œä¸ºæ³¨é‡Šç¬¦ï¼Œä½¿ç”¨$å¼•ç”¨å˜é‡ éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ nginx ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼ï¼š directive value [value1 ...]; è¯´æ˜ï¼š 1ã€æŒ‡ä»¤å¿…é¡»ä»¥åˆ†å·ï¼›ç»“æŸ 2ã€æ”¯æŒå˜é‡ï¼š 1ï¼‰å†…å»ºå˜é‡ï¼šç”±Nginxæ¨¡å—å¼•å…¥ï¼Œå¯ç›´æ¥å¼•ç”¨ 2ï¼‰è‡ªå®šä¹‰å˜é‡ï¼šç”±ç”¨æˆ·ä½¿ç”¨setæŒ‡å®šå®šä¹‰ï¼Œæ ¼å¼ï¼š set variable_name value; 3) å¼•ç”¨å˜é‡çš„æ–¹å¼ï¼š$variable_name ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ† main blockï¼šä¸»é…ç½®æ®µï¼Œå³å…¨å±€é…ç½®æ®µï¼Œå¯¹http,mailéƒ½æœ‰æ•ˆ #äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½® event { ... } #http/https åè®®ç›¸å…³é…ç½®æ®µ http { ... } #é»˜è®¤é…ç½®æ–‡ä»¶ä¸åŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªå— #mail åè®®ç›¸å…³é…ç½®æ®µ mail { ... } #stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ stream { ... } é»˜è®¤çš„nginx.conf é…ç½®æ–‡ä»¶è¯´æ˜\n##å…¨å±€é…ç½®å—ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆã€‚ä¸»è¦è®¾ç½®nginxçš„å¯åŠ¨ç”¨æˆ·/ç»„ï¼Œå¯åŠ¨çš„å·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œå·¥ä½œæ¨¡å¼ï¼Œnginxçš„pidæ–‡ä»¶è·¯å¾„ç­‰ã€‚ user nginx nginx; worker_processes 1; #å¯åŠ¨å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬ä¸CPUæ ¸å¿ƒæ•°ä¸€è‡´ ##eventså—ï¼Œä¸»è¦å½±å“nginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œä½¿ç”¨å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹æœ€å¤§æ”¯æŒå¹¶å‘è¿æ¥æ•°ï¼Œæ˜¯å¦å¼€å¯å¯¹å¤šå·¥ä½œè¿›ç¨‹ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ç­‰ã€‚ events { worker_connections 1024; #å•ä¸ªworkerè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚ä½œä¸ºwebæœåŠ¡å™¨æ—¶ï¼Œnginxçš„æœ€å¤§å¹¶å‘æ•°ä¸ºï¼šworker_connections * worker_processesã€‚ä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™ä¸ºï¼ˆworker_connections * worker_processesï¼‰/2 } ##httpå—æ˜¯nginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç¼“å­˜ã€ä»£ç†å’Œæ—¥å¿—æ ¼å¼å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—éƒ½åœ¨è¿™é‡Œé…ç½®ã€‚httpå—å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œè€Œä¸€ä¸ªserverå—åˆå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ï¼Œserverå—å¯ä»¥é…ç½®æ–‡ä»¶å¼•å…¥ã€MIME-Typeå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€æ˜¯å¦å¯ç”¨sendfileã€è¿æ¥è¶…æ—¶æ—¶é—´å’Œå•ä¸ªé“¾æ¥çš„è¯·æ±‚ä¸Šé™ç­‰ã€‚ http { include\tmime.types; default_type application/ostet-stream; sendfile\ton; #ä½œä¸ºwebæœåŠ¡å™¨æ—¶æ‰“å¼€sendfileåŠ å¿«é™æ€æ–‡ä»¶ä¼ è¾“ï¼ŒæŒ‡å®šæ˜¯å¦ä½¿ç”¨sendfileç³»ç»Ÿè°ƒç”¨ä¼ è¾“æ–‡ä»¶ã€‚sendfileç³»ç»Ÿè°ƒç”¨åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ é€’æ•°æ®ï¼ˆå®Œå…¨åœ¨å†…æ ¸ç©ºé—´è¿›ç¨‹ï¼‰ï¼Œä»è€Œé¿å…äº†æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œæ˜¯é›¶æ‹·è´æŠ€æœ¯çš„ä¸€ç§ã€‚ keepalive_timeout 65; #é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’ ##serverå—å¯ç”¨äºé…ç½®è™šæ‹Ÿä¸»æœºï¼Œæœ‰è‡ªå·±çš„å…¨å±€é…ç½®ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ã€‚å¯é…ç½®æœ¬è™šæ‹Ÿæœºç›‘å¬çš„ç«¯å£ï¼Œè®¾ç½®è™šæ‹Ÿæœºåç§°ï¼Œå¤šä¸ªserverç›‘å¬åŒä¸€ä¸ªç«¯å£ã€‚ server { listen 80; #ç›‘å¬ç«¯å£ server_name;\tlocalhost; #serverçš„åŸŸåï¼Œé…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºæ—¶ç”¨åˆ° location / { root\thtml; index\tindex.html index.htm; #ç½‘ç«™é»˜è®¤ä¸»é¡µ } error_page 500 502 503 504 /50x.html; #é”™è¯¯é¡µé¢ ##locationå¤„ç†å¯¹åº”çš„ä¸åŒé”™è¯¯ç çš„é¡µé¢å®šä¹‰åˆ°50x.htmlï¼ŒæŒ‡ç¤ºäº†50.htmlæ–‡ä»¶æ‰€åœ¨ç›®å½• location = /50x.html { root\thtml; #é”™è¯¯é¡µé¢æ–‡ä»¶æ‰€åœ¨ç›®å½• } } ##å’Œé‚®ä»¶ç›¸å…³çš„é…ç½® #mail { # ... #} mail åè®®ç›¸å…³é…ç½®æ®µ #tcpä»£ç†é…ç½®ï¼Œ1.9ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ #stream { # ... #} stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ #å¯¼å…¥å…¶ä»–è·¯å¾„çš„é…ç½®æ–‡ä»¶ #include /apps/nginx/conf.d/*.conf } å…¨å±€é…ç½® main å…¨å±€é…ç½®å—å¸¸è§çš„é…ç½®æŒ‡ä»¤åˆ†ç±»\næ­£å¸¸è¿è¡Œå¿…å¤‡çš„é…ç½® ä¼˜åŒ–æ€§èƒ½ç›¸å…³çš„é…ç½® ç”¨äºè°ƒè¯•å®šä½é—®é¢˜ç›¸å…³çš„é…ç½® äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½® å…¨å±€é…ç½®è¯´æ˜ user\tnginx nginx; #å¯åŠ¨nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç»„ worker_processes [number | auto]; #å¯åŠ¨nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬å’ŒCPUæ ¸å¿ƒæ•°ç›¸åŒ worker_cpu_affinity 00000001 00000010 00000100 00001000; #å°†Nginxå·¥ä½œè¿›ç¨‹ç»‘å®šåˆ°æŒ‡å®šçš„CPUæ ¸å¿ƒï¼Œé»˜è®¤Nginxæ˜¯ä¸è¿›è¡Œè¿›ç¨‹ç»‘å®šçš„ï¼Œç»‘å®šå¹¶ä¸æ˜¯æ„å‘³ç€å½“å‰nginxè¿›ç¨‹ç‹¬å ä»¥ä¸€æ ¸å¿ƒCPUï¼Œä½†æ˜¯å¯ä»¥ä¿è¯æ­¤è¿›ç¨‹ä¸ä¼šè¿è¡Œåœ¨å…¶ä»–æ ¸å¿ƒä¸Šï¼Œè¿™å°±æå¤§å‡å°‘äº†nginxçš„å·¥ä½œè¿›ç¨‹åœ¨ä¸åŒçš„cpuæ ¸å¿ƒä¸Šçš„æ¥å›è·³è½¬ï¼Œå‡å°‘äº†CPUå¯¹è¿›ç¨‹çš„èµ„æºåˆ†é…ä¸å›æ”¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆçš„æå‡nginxæœåŠ¡å™¨çš„æ€§èƒ½ã€‚ CPU MASK: 00000001ï¼š0å·CPU 00000010ï¼š1å·CPU 10000000ï¼š7å·CPU ##ç¤ºä¾‹: [root@test conf]# egrep \"processes|affinity\" nginx.conf worker_processes 4;\t#å¯åŠ¨å››ä¸ªworkerè¿›ç¨‹ worker_cpu_affinity 0001 0010; #å°†workrè¿›ç¨‹ç»‘å®šåˆ° 0å·CPUå’Œ1å·CPU [root@test conf]# lscpu | grep CPU\\(s\\) # CPUæ ¸æ•°ä¸º2 CPU(s): 2 On-line CPU(s) list: 0,1 NUMA node0 CPU(s): 0,1 [root@test conf]# nginx -t #è¯­æ³•æ£€æŸ¥å‡ºç°è­¦å‘Šï¼Œå› ä¸ºworkerè¿›ç¨‹æ•°æ¯”CPUæ ¸å¿ƒæ•°å¤šã€‚å¤šå‡ºçš„workerè¿›ç¨‹å°†ç»‘å®šåœ¨â€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€˜ä¹Ÿå³0010ä¸Šã€‚å¯¹äºâ€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€™ï¼ˆlast mask for remaining workerï¼‰çš„è§£é‡Šï¼š processesï¼šnginxåˆ†åˆ«å°†workerè¿›ç¨‹ç»‘å®šåˆ°worker_cpu_affinity æŒ‡å®šçš„CPUæ ¸å¿ƒä¸Šï¼ˆä»å·¦è‡³å³çš„é¡ºåºï¼‰ï¼Œè€Œä»ç¬¬ä¸‰ä¸ªworkè¿›ç¨‹èµ·å¹¶æœªæŒ‡å®šå¯¹åº”çš„CPUæ ¸å¿ƒï¼Œå› æ­¤å…¨éƒ¨ç»‘å®šåˆ°â€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€™ 0010è¿™ä¸ªCPUæ ¸å¿ƒã€‚ nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok nginx: [warn] the number of \"worker_processes\" is not equal to the number of \"worker_cpu_affinity\" masks, using last mask for remaining worker processes nginx: configuration file /apps/nginx/conf/nginx.conf test is successful [root@test conf]# ps axo pid,cmd,psr | grep nginx 827 nginx: master process /apps 0 1226 nginx: worker process 0 1227 nginx: worker process 1 1228 nginx: worker process 1 1229 nginx: worker process 1 1249 grep --color=auto nginx 0 #å°†workerè¿›ç¨‹æ•°é‡æ”¹ä¸º2 [root@test conf]# vim nginx.conf [root@test conf]# egrep \"processes|affinity\" nginx.conf worker_processes 2; worker_cpu_affinity 0001 0010; #è¯­æ³•æ£€æŸ¥ä¸å†è­¦å‘Š [root@test conf]# nginx -s reload [root@test conf]# nginx -t nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok nginx: configuration file /apps/nginx/conf/nginx.conf test is successful [root@test conf]# ps axo pid,cmd,psr | grep nginx 827 nginx: master process /apps 1 1261 nginx: worker process 0 1262 nginx: worker process 1 1265 grep --color=auto nginx 1 #é”™è¯¯æ—¥å¿—è®°å½•é…ç½®ï¼Œè¯­æ³•ï¼šerror_log file [debug | info | notice | warn | error | crit | alert | emerg] #æ‹¬å·å†…ä¸ºæ—¥å¿—è®°å½•è¯¦ç»†çº§åˆ«ï¼ˆä»å·¦è‡³å³é€æ¸æé«˜ï¼‰ ##ç¤ºä¾‹é…ç½® #error_log logs/error.log; #error_log logs/error.log notice; error_log /apps/nginx/logs/error.log error; #pidæ–‡ä»¶ä¿å­˜è·¯å¾„ pid /apps/nginx/logs/nginx.pid; worker_priority 0; #å·¥ä½œè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œ-20~20(19) worker_rlimit_nofile 65536; #æ‰€æœ‰workerè¿›ç¨‹èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ä¸Šé™,åŒ…æ‹¬:Nginxçš„æ‰€æœ‰è¿æ¥ï¼ˆä¾‹å¦‚ä¸ä»£ç†æœåŠ¡å™¨çš„è¿æ¥ç­‰ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚è¯¥å€¼æœ€å¥½ä¸ulimit -n æˆ–è€…limits.confçš„å€¼ä¿æŒä¸€è‡´, #é€šè¿‡pamé™åˆ¶æ–‡ä»¶æ‰“å¼€æ•°é‡ä¸Šé™ [root@centos8 ~]#cat /etc/security/limits.conf * soft nofile 1000000 * hard nofile 1000000 #workerè¿›ç¨‹ä¼˜å…ˆçº§ [root@test conf]# grep priority nginx.conf worker_priority 0; [root@test conf]# ps -axo pid,cmd,nice | grep nginx 827 nginx: master process /apps 0 1391 nginx: worker process 0 1392 nginx: worker process 0 1449 grep --color=auto nginx 0 daemon off; #å‰å°è¿è¡ŒNginxæœåŠ¡ï¼Œé€šå¸¸åœ¨æµ‹è¯•ç¯å¢ƒæˆ–è€…dockerç¯å¢ƒä¸­ä½¿ç”¨ master_process off|on; #æ˜¯å¦å¼€å¯Nginxçš„master-workerå·¥ä½œæ¨¡å¼ï¼Œä»…ç”¨äºå¼€å‘è°ƒè¯•åœºæ™¯,é»˜è®¤ä¸ºon events { worker_connections 65536; #è®¾ç½®å•ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•° use epoll; #ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨ï¼ŒNginxæ”¯æŒä¼—å¤šçš„äº‹ä»¶é©±åŠ¨ï¼Œæ¯”å¦‚:selectã€pollã€epollï¼Œåªèƒ½è®¾ç½®åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚ accept_mutex on; #onä¸ºåŒä¸€æ—¶åˆ»ä¸€ä¸ªè¯·æ±‚è½®æµç”±workè¿›ç¨‹å¤„ç†,è€Œé˜²æ­¢è¢«åŒæ—¶å”¤é†’æ‰€æœ‰worker,é¿å…å¤šä¸ªç¡çœ è¿›ç¨‹è¢«å”¤é†’çš„è®¾ç½®ï¼Œé»˜è®¤ä¸ºoffï¼Œæ–°è¯·æ±‚ä¼šå”¤é†’æ‰€æœ‰workerè¿›ç¨‹,æ­¤è¿‡ç¨‹ä¹Ÿç§°ä¸º\"æƒŠç¾¤\"ï¼Œå› æ­¤nginxåˆšå®‰è£…å®Œä»¥åè¦è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ã€‚å»ºè®®è®¾ç½®ä¸ºon multi_accept on; #onæ—¶NginxæœåŠ¡å™¨çš„æ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—å¤šä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ­¤æŒ‡ä»¤é»˜è®¤ä¸ºoffï¼Œå³é»˜è®¤ä¸ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½ä¸€æ¬¡æ¥å—ä¸€ä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ‰“å¼€åå‡ ä¸ªåŒæ—¶æ¥å—å¤šä¸ªã€‚å»ºè®®è®¾ç½®ä¸ºon } èŒƒä¾‹ï¼šå®ç°nginxçš„é«˜å¹¶å‘é…ç½®\n[root@localhost conf]# ulimit -n 10 [root@localhost conf]# cat /apps/nginx/conf/nginx.conf | grep rlimit worker_rlimit_nofile 100; #é»˜è®¤é…ç½®ä¸æ”¯æŒé«˜å¹¶å‘ï¼Œå½“worker_rlimit_nofileè®¾ç½®çš„å€¼å¤§äºulimit -nçš„å€¼,ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯æ—¥å¿— [root@localhost conf]# ab -c 5000 -n 10000 http://127.0.0.1/ This is ApacheBench, Version 2.3 \u003c$Revision: 1430300 $\u003e Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking 127.0.0.1 (be patient) socket: Too many open files (24) #æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¿‡å¤š http é…ç½®å— http åè®®ç›¸å…³çš„é…ç½®ç»“æ„\nhttp { ... ... server { #æ¯ä¸ªserverç”¨äºå®šä¹‰ä¸€ä¸ªè™šæ‹Ÿä¸»æœº,ç¬¬ä¸€ä¸ªserverä¸ºé»˜è®¤è™šæ‹ŸæœåŠ¡å™¨ ... } server { ... server_name #è™šæ‹Ÿä¸»æœºå root #ä¸»ç›®å½• alias #è·¯å¾„åˆ«å location [OPERATOR] URL { #æŒ‡å®šURLçš„ç‰¹æ€§ ... if CONDITION { ... } } } } http åè®®é…ç½®è¯´æ˜\nhttp { include mime.types; #å¯¼å…¥æ”¯æŒçš„æ–‡ä»¶ç±»å‹,æ˜¯ç›¸å¯¹äº/apps/nginx/confç›®å½• default_type application/octet-stream; #é™¤mime.typesä¸­æ–‡ä»¶ç±»å‹å¤–,è®¾ç½®å…¶å®ƒæ–‡ä»¶é»˜è®¤ç±»å‹ï¼Œè®¿é—®å…¶å®ƒç±»å‹æ—¶ä¼šæç¤ºä¸‹è½½ä¸åŒ¹é…çš„ç±»å‹æ–‡ä»¶ #æ—¥å¿—é…ç½®éƒ¨åˆ† #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; #access_log logs/access.log main; #è‡ªå®šä¹‰ä¼˜åŒ–å‚æ•° sendfile on; #tcp_nopush on; #åœ¨å¼€å¯äº†sendfileçš„æƒ…å†µä¸‹ï¼Œåˆå¹¶è¯·æ±‚åç»Ÿä¸€å‘é€ç»™å®¢æˆ·ç«¯,å¿…é¡»å¼€å¯sendfile #tcp_nodelay off; #åœ¨å¼€å¯äº†keepalivedæ¨¡å¼ä¸‹çš„è¿æ¥æ˜¯å¦å¯ç”¨TCP_NODELAYé€‰é¡¹ï¼Œå½“ä¸ºoffæ—¶ï¼Œå»¶è¿Ÿ0.2så‘é€ï¼Œé»˜è®¤Onæ—¶ï¼Œä¸å»¶è¿Ÿå‘é€ï¼Œç«‹å³å‘é€ç”¨æˆ·å“åº”æŠ¥æ–‡ã€‚ #keepalive_timeout 0; keepalive_timeout 65 66; #è®¾ç½®ä¼šè¯ä¿æŒæ—¶é—´,ç¬¬äºŒä¸ªå€¼ä¸ºå“åº”é¦–éƒ¨:keep-Alived:timeout=65,å¯ä»¥å’Œç¬¬ä¸€ä¸ªå€¼ä¸åŒ #gzip on; #å¼€å¯æ–‡ä»¶å‹ç¼© server { listen 80; #è®¾ç½®ç›‘å¬åœ°å€å’Œç«¯å£ server_name localhost; #è®¾ç½®server nameï¼Œå¯ä»¥ä»¥ç©ºæ ¼éš”å¼€å†™å¤šä¸ªå¹¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚:*.magedu.com www.magedu.* ~^www\\d+\\.magedu\\.com$ default_server #charset koi8-r; #è®¾ç½®ç¼–ç æ ¼å¼ï¼Œé»˜è®¤æ˜¯ä¿„è¯­æ ¼å¼ï¼Œå»ºè®®æ”¹ä¸ºutf-8 #access_log logs/host.access.log main; location / { root html; index index.html index.htm; } #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; #å®šä¹‰é”™è¯¯é¡µé¢ location = /50x.html { root html; } # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ { #ä»¥httpçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°æŒ‡å®šwebæœåŠ¡å™¨ # proxy_pass http://127.0.0.1; #} # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ { #ä»¥fastcgiçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°phpå¤„ç† # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #} # deny access to .htaccess files, if Apache's document root # concurs with nginx's one # #location ~ /\\.ht { #æ‹’ç»webå½¢å¼è®¿é—®æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯é€šè¿‡.htaccessæ–‡ä»¶æ¥æ”¹å˜è‡ªå·±çš„é‡å®šå‘ç­‰åŠŸèƒ½ã€‚ # deny all; #} location ~ /passwd.html { deny all; } } # another virtual host using mix of IP-, name-, and port-based configuration # #server { #è‡ªå®šä¹‰è™šæ‹Ÿserver # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / { # root html; # index index.html index.htm; #æŒ‡å®šé»˜è®¤ç½‘é¡µæ–‡ä»¶ï¼Œæ­¤æŒ‡ä»¤ç”±ngx_http_index_moduleæ¨¡å—æä¾› # } #} # HTTPS server # #server { #httpsæœåŠ¡å™¨é…ç½® # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / { # root html; # index index.html index.htm; # } #} MIME MIMEå‚è€ƒæ–‡æ¡£ï¼š https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types\n#åœ¨å“åº”æŠ¥æ–‡ä¸­å°†æŒ‡å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„è‡³MIMEå¯¹åº”çš„ç±»å‹ include mime.types; default_type application/octet-stream;#é™¤mime.typesä¸­çš„ç±»å‹å¤–ï¼ŒæŒ‡å®šå…¶å®ƒæ–‡ä»¶çš„é»˜è®¤MIMEç±»å‹ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šæç¤ºä¸‹è½½ types { text/html html; image/gif gif; image/jpeg jpg; } èŒƒä¾‹ï¼š\n#æœªå®šä¹‰mime.typesç±»å‹ [root@localhost nginx]# ll html/mime.types ls: cannot access html/mime.types: No such file or directory [root@localhost nginx]# curl localhost/test.php -I HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Thu, 28 Jul 2022 11:23:54 GMT Content-Type: application/octet-stream #mimeæœªå®šä¹‰çš„ç±»å‹é»˜è®¤è§†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨è®¿é—®ï¼Œåˆ™ä¼šä¸‹è½½test.phpæ–‡ä»¶ï¼‰ Content-Length: 20 Last-Modified: Thu, 28 Jul 2022 11:19:48 GMT Connection: keep-alive Keep-Alive: timeout=66 #é•¿è¿æ¥æ˜¾ç¤ºçš„æ—¶é•¿ï¼Œç”±keepalive_timeout 65 66; é…ç½® ETag: \"62e270d4-14\" Accept-Ranges: bytes #ä¿®æ”¹é»˜è®¤æ–‡ä»¶ç±»å‹ [root@localhost nginx]# cat conf/nginx.conf | grep default_type default_type text/html; [root@localhost nginx]# nginx -s reload [root@localhost nginx]# curl localhost/test.php -I HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Thu, 28 Jul 2022 11:32:15 GMT Content-Type: text/html #å°†test.phpè¯†åˆ«ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨è®¿é—®ï¼Œç›´æ¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼‰ Content-Length: 20 Last-Modified: Thu, 28 Jul 2022 11:19:48 GMT Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e270d4-14\" Accept-Ranges: bytes æŒ‡å®šå“åº”æŠ¥æ–‡ #æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡ä¸­çš„Content-Typeæ˜¾ç¤ºæŒ‡å®šçš„å­—ç¬¦é›†ï¼Œé»˜è®¤offä¸æ˜¾ç¤º charset charset | off; #ç¤ºä¾‹ charset utf-8; #æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡çš„Serveré¦–éƒ¨æ˜¾ç¤ºnginxç‰ˆæœ¬ server_tokens on | off | build | string; èŒƒä¾‹ï¼šæºç ä¿®æ”¹serverå­—æ®µ\n#å¦‚æœæƒ³è‡ªå®šä¹‰å“åº”æŠ¥æ–‡çš„nginxç‰ˆæœ¬ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æºç æ–‡ä»¶ï¼Œé‡æ–°ç¼–è¯‘ #å¦‚æœserver_tokens onï¼Œä¿®æ”¹ src/core/nginx.h ä¿®æ”¹ç¬¬13-14è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ #define NGINX_VERSION \"1.68.9\" #define NGINX_VER \"mynginx/\" NGINX_VERSION #å¦‚æœserver_tokens offï¼Œä¿®æ”¹ src/http/ngx_http_header_filter_module.c ç¬¬49è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š static char ngx_http_server_string[] = \"Server: nginx\" CRLF; #æŠŠå…¶ä¸­çš„nginxæ”¹ä¸ºè‡ªå·±æƒ³è¦çš„æ–‡å­—å³å¯,å¦‚ï¼šmynginx æ ¸å¿ƒé…ç½®ç¤ºä¾‹ è™šæ‹Ÿä¸»æœºçš„å®ç° åŸºäºä¸åŒçš„IPã€ä¸åŒçš„ç«¯å£ä»¥åŠä¸ç”¨åŸŸåå®ç°ä¸åŒçš„è™šæ‹Ÿä¸»æœºï¼Œä¾èµ–äºæ ¸å¿ƒæ¨¡å—ngx_http_core_moduleå®ç°ã€‚\næ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº # æ·»åŠ åŸŸåè§£æ [root@localhost conf.d]# cat /etc/hosts |grep test 172.16.16.88 pc.test.org mobile.test.org ## å¼€å§‹æ–°å»ºè™šæ‹Ÿä¸»æœº root@localhost nginx]# mkdir /apps/nginx/conf/conf.d [root@localhost nginx]# cd /apps/nginx/conf/conf.d/ [root@localhost conf.d]# vim /apps/nginx/conf/nginx.conf ...... include /apps/nginx/conf.d/*.conf; #åœ¨é…ç½®æ–‡ä»¶çš„æœ€åé¢æ·»åŠ æ­¤è¡Œ,æ³¨æ„ä¸è¦æ”¾åœ¨æœ€å‰é¢,ä¼šå¯¼è‡´å‰é¢çš„é…ç½®æ— æ³•ç”Ÿæ•ˆï¼ˆæ–‡ä»¶é…ç½®ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ç”Ÿæ•ˆï¼‰ [root@localhost conf.d]# cat pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } } [root@localhost conf.d]# mkdir /apps/nginx/html/pc [root@localhost conf.d]# echo pc_page \u003e /apps/nginx/html/pc/index.html [root@localhost conf.d]# nginx -s reload [root@localhost conf.d]# curl pc.test.org #è™šæ‹Ÿä¸»æœºpc pc_page [root@localhost conf.d]# cat mobile.conf server { listen 80; server_name mobile.test.org; location / { root html/mobile; } } [root@localhost conf.d]# mkdir /apps/nginx/html/mobile #è™šæ‹Ÿä¸»æœºmobile [root@localhost conf.d]# echo mobile_page \u003e /apps/nginx/html/mobile/index.html mobile_page root ä¸ alias çš„åŒºåˆ« rootï¼šæŒ‡å®šwebçš„å®¶ç›®å½•ï¼Œåœ¨å®šä¹‰locationçš„æ—¶å€™ï¼Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ç­‰äº root+location\nèŒƒä¾‹:\n[root@localhost conf.d]# cat pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } location /about { root /opt/html; #å®é™…è·¯å¾„ä¸º/opt/html/about/index.html } } [root@localhost conf.d]# ll /opt/html/about/ total 4 -rw-r--r-- 1 root root 11 Jul 28 23:24 index.html [root@localhost conf.d]# cat /opt/html/about/index.html about_page [root@localhost conf.d]# nginx -s reload [root@localhost conf.d]# curl pc.test.org/about/ about_page aliasï¼šå®šä¹‰è·¯å¾„åˆ«åï¼Œä¼šæŠŠè®¿é—®çš„è·¯å¾„é‡æ–°å®šä¹‰åˆ°å…¶æŒ‡å®šçš„è·¯å¾„,æ–‡æ¡£æ˜ å°„çš„å¦ä¸€ç§æœºåˆ¶;ä»…èƒ½ç”¨äºlocationä¸Šä¸‹æ–‡,æ­¤æŒ‡ä»¤ä½¿ç”¨è¾ƒå°‘\nèŒƒä¾‹ï¼š\n[root@localhost conf.d]# cat pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } location /about { alias /opt/html; #å®é™…è·¯å¾„ä¸º/opt/html/index.html } } [root@localhost conf.d]# cat /opt/html/index.html about_page [root@localhost conf.d]# nginx -s reload [root@localhost conf.d]# curl pc.test.org/about/ about_page localtion çš„åŒ¹é…è§„åˆ™ åœ¨ä¸€ä¸ªserverä¸­locationé…ç½®æ®µå¯å­˜åœ¨å¤šä¸ªï¼Œç”¨äºå®ç°ä»uriåˆ°æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„æ˜ å°„ï¼›ngnixä¼šæ ¹æ®ç”¨æˆ·è¯·\næ±‚çš„URIæ¥æ£€æŸ¥å®šä¹‰çš„æ‰€æœ‰locationï¼ŒæŒ‰ä¸€å®šçš„ä¼˜å…ˆçº§æ‰¾å‡ºä¸€ä¸ªæœ€ä½³åŒ¹é…ï¼Œè€Œåè¿›è¡Œå¤„ç†ã€‚\nlocation å®˜æ–¹å¸®åŠ©: http://nginx.org/en/docs/http/ngx_http_core_module.html#location\n#è¯­æ³•è§„åˆ™ï¼š location [ = | ~ | ~* | ^~ ] uri { ... } = #ç”¨äºæ ‡å‡†uriå‰ï¼Œéœ€è¦è¯·æ±‚å­—ä¸²ä¸uriç²¾ç¡®åŒ¹é…ï¼Œå¤§å°æ•æ„Ÿ,å¦‚æœåŒ¹é…æˆåŠŸå°±åœæ­¢å‘ä¸‹åŒ¹é…å¹¶ç«‹å³å¤„ç†è¯·æ±‚ ^~ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒ¹é…ä»¥æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼å¼€å¤´,å¯¹URIçš„æœ€å·¦è¾¹éƒ¨åˆ†åšåŒ¹é…æ£€æŸ¥ï¼Œä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™ ~ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒºåˆ†å¤§å°å†™ ~* #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ ä¸å¸¦ç¬¦å· #åŒ¹é…èµ·å§‹äºæ­¤uriçš„æ‰€æœ‰çš„uri \\ #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸”è½¬ä¹‰å­—ç¬¦ã€‚å¯ä»¥å°† . * ?ç­‰è½¬ä¹‰ä¸ºæ™®é€šç¬¦å· #åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š =, ^~, ~/~*, ä¸å¸¦ç¬¦å· å®˜æ–¹èŒƒä¾‹\nlocation = / { [ configuration A ] } location / { [ configuration B ] } location /documents/ { [ configuration C ] } location ^~ /images/ { [ configuration D ] } location ~* \\.(gif|jpg|jpeg)$ { [ configuration E ] } The â€œ/â€ request will match configuration A(?), the â€œ/index.htmlâ€ request will match configuration B, the â€œ/documents/document.htmlâ€ request will match configuration C, the â€œ/images/1.gifâ€ request will match configuration D, and the â€œ/documents/1.jpgâ€ request will match configuration E. åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é… åœ¨serveréƒ¨åˆ†ä½¿ç”¨locationé…ç½®ä¸€ä¸ªwebç•Œé¢ï¼Œä¾‹å¦‚ï¼šå½“è®¿é—®nginxæœåŠ¡å™¨çš„/logo.jpgçš„æ—¶å€™è¦æ˜¾ç¤ºæŒ‡å®šhtmlæ–‡ä»¶çš„å†…å®¹\nç²¾ç¡®åŒ¹é…ä¸€èˆ¬ç”¨äºåŒ¹é…ç½‘ç«™logoç­‰ç›¸å¯¹å›ºå®šçš„URL\nèŒƒä¾‹ï¼šç²¾ç¡®åŒ¹é…\n[root@localhost images]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } location /logo.jpg { root html/images; } } [root@localhost images]# ll /apps/nginx/html/images/logo.jpg -rw-r--r-- 1 root root 13110 Jul 29 15:11 /apps/nginx/html/images/logo.jpg #è®¿é—®æˆåŠŸ [root@localhost images]# curl pc.test.org/logo.jpg -I HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 15:17:35 GMT Content-Type: image/jpeg Content-Length: 13110 Last-Modified: Fri, 29 Jul 2022 07:11:49 GMT Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e38835-3336\" Accept-Ranges: bytes åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™ ~ å®ç°åŒºåˆ†å¤§å°å†™çš„æ¨¡ç³ŠåŒ¹é…\n[root@localhost images]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } location ~ /A.?\\.jpg { #åŒ¹é…å­—æ¯Aå¼€å¤´çš„jpgå›¾ç‰‡ï¼Œåé¢?è¡¨ç¤ºAåé¢é›¶æ¬¡æˆ–ä¸€ä¸ªå­—ç¬¦ root html/images; } } #ç¡®ä¿èµ„æºå­˜åœ¨ [root@localhost images]# ll /apps/nginx/html/images/A.jpg -rw-r--r-- 1 root root 13110 Jul 29 15:11 /apps/nginx/html/images/A.jpg [root@localhost images]# nginx -s reload #ä»¥å¤§å†™URIè®¿é—®æˆåŠŸ [root@localhost images]# curl -I pc.test.org/A.jpg HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 15:27:52 GMT Content-Type: image/jpeg Content-Length: 13110 Last-Modified: Fri, 29 Jul 2022 07:11:49 GMT Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e38835-3336\" Accept-Ranges: bytes #ä»¥å°å†™URIè®¿é—®å¤±è´¥ [root@localhost images]# curl -I pc.test.org/a.jpg HTTP/1.1 404 Not Found Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 15:27:55 GMT Content-Type: text/html Content-Length: 153 Connection: keep-alive Keep-Alive: timeout=66 åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™ ~* ç”¨æ¥å¯¹ç”¨æˆ·è¯·æ±‚çš„uriåšæ¨¡ç³ŠåŒ¹é…ã€‚\næ³¨æ„ï¼šå°½ç®¡åŒ¹é…æ—¶ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†å®é™…è¯·æ±‚æ˜¯ä»ä¼šä»¥ç”¨æˆ·è¯·æ±‚çš„uriå»å¯»æ‰¾ç›¸åº”çš„ç£ç›˜æ–‡ä»¶ï¼Œå¦‚ç”¨æˆ·è®¿é—®uriä¸º/A.jpgï¼Œåœ¨locationæ¡ä»¶é€šè¿‡åå°±åœ¨å¯¹åº”è·¯å¾„ä¸‹å¯»æ‰¾ç£ç›˜ä¸­çš„A.jpgæ–‡ä»¶ï¼Œå¦‚æœç£ç›˜ä¸Šæ˜¯a.jpgï¼Œåˆ™è¯·æ±‚æ˜¯å¤±è´¥çš„ï¼ˆåœ¨windowç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åä¸åŒºåˆ†å¤§å°å†™ï¼Œè¯¥è¯·æ±‚ä¼šæˆåŠŸâ€”â€”å—æ–‡ä»¶ç³»ç»Ÿå½±å“ï¼‰ã€‚\n[root@localhost images]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location / { root html/pc; } location ~* /A.?\\.jpg { #åŒ¹é…è§„åˆ™ä¸åŒºåˆ†å¤§å°å†™ root html/images; } } [root@localhost images]# ll /apps/nginx/html/images/a.jpg #ç£ç›˜ä¸­ä»…å­˜åœ¨a.jpgæ–‡ä»¶ -rw-r--r-- 1 root root 13110 Jul 29 15:11 /apps/nginx/html/images/a.jpg [root@localhost images]# nginx -s reload #è®¿é—®/a.jpgæˆåŠŸ [root@localhost images]# curl -I pc.test.org/a.jpg HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 15:41:25 GMT Content-Type: image/jpeg Content-Length: 13110 Last-Modified: Fri, 29 Jul 2022 07:11:49 GMT Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e38835-3336\" Accept-Ranges: bytes #è®¿é—®/A.jpgå¤±è´¥ã€‚locationåŒ¹é…æˆåŠŸï¼Œä½†ç£ç›˜ä¸Šå¹¶æ— A.jpgæ–‡ä»¶ [root@localhost images]# curl -I pc.test.org/A.jpg HTTP/1.1 404 Not Found Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 15:41:48 GMT Content-Type: text/html Content-Length: 153 Connection: keep-alive Keep-Alive: timeout=66 nginx å››å±‚è®¿é—®æ§åˆ¶ è®¿é—®æ§åˆ¶åŸºäºæ¨¡å—ngx_http_access_moduleå®ç°ï¼Œå¯ä»¥é€šè¿‡åŒ¹é…å®¢æˆ·ç«¯æºIPåœ°å€è¿›è¡Œé™åˆ¶\næ³¨æ„: å¦‚æœèƒ½åœ¨é˜²ç«å¢™è®¾å¤‡æ§åˆ¶, æœ€å¥½å°±ä¸è¦åœ¨nginxä¸Šé…ç½®,å¯ä»¥æ›´å¥½çš„èŠ‚çº¦èµ„æº\nå®˜æ–¹å¸®åŠ©: http://nginx.org/en/docs/http/ngx_http_access_module.html\nèŒƒä¾‹ï¼š\n## åŒ¹é…æ—¶æŒ‰ä»ä¸Šè‡³ä¸‹çš„è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…åˆ°ç›¸åº”è§„åˆ™å³åœæ­¢â€”â€”â€”ä¸é˜²ç«å¢™çš„åŒ¹é…è§„åˆ™ç±»ä¼¼ #å¦‚ï¼šæœ‰å®¢æˆ·ç«¯ï¼ˆIPï¼š10.1.1.0ï¼‰è®¿é—®é…ç½®äº†ä»¥ä¸‹è§„åˆ™çš„webæœåŠ¡å™¨æ—¶(è®¿é—®URI:/about)ï¼Œè§¦å‘location /aboutè¯­å¥å—ï¼ŒåŒ¹é…åˆ°allow 10.1.1.0/16ï¼Œè®¿é—®æ§åˆ¶ç”Ÿæ•ˆï¼Œè®¿é—®æˆåŠŸã€‚ location = /login/ { root /data/nginx/html/pc; allow 10.0.0.0/24; deny all; } location /about { alias /data/nginx/html/pc; index index.html; deny 192.168.1.1; allow 192.168.1.0/24; allow 10.1.1.0/16; allow 2001:0db8::/32; deny all; #æŒ‰å…ˆå°èŒƒå›´åˆ°å¤§èŒƒå›´æ’åº } nginx è´¦æˆ·è®¤è¯åŠŸèƒ½ ç”± ngx_http_auth_basic_module æ¨¡å—æä¾›æ­¤åŠŸèƒ½\nå®˜æ–¹å¸®åŠ©ï¼šhttp://nginx.org/en/docs/http/ngx_http_auth_basic_module.html\nèŒƒä¾‹ï¼š\n#CentOSå®‰è£…åŒ… [root@centos8 ~]#yum -y install httpd-tools #Ubuntuå®‰è£…åŒ… [root@Ubuntu ~]#apt -y install apache2-utils #åˆ›å»ºç”¨æˆ· #-b éäº¤äº’å¼æ–¹å¼æäº¤å¯†ç  #-c é‡æ–°ç”Ÿæˆæ–‡ä»¶ï¼Œè¦†ç›–å·²æœ‰æ–‡ä»¶ã€‚é¦–æ¬¡åˆ›å»ºæ—¶ä½¿ç”¨ [root@localhost html]# htpasswd -bc /apps/nginx/conf/.htpasswd user1 passwd1 Adding password for user user1 [root@localhost html]# htpasswd -b /apps/nginx/conf/.htpasswd user2 passwd2 Adding password for user user2 #ç”Ÿæˆäº†å¸¦æœ‰ä¸¤ä¸ªç”¨æˆ·çš„éªŒè¯æ–‡ä»¶ [root@localhost html]# tail /apps/nginx/conf/.htpasswd user1:$apr1$vzRe30iJ$jF8BZbra6pI8O0JBqlmiP/ user2:$apr1$i2ON7LYs$pxzkeH.xxCdgj670m5cSW/ #ç½‘ç«™ç™»å½•é¡µé¢é…ç½® [root@localhost html]# cat /apps/nginx/html/index.html hello [root@localhost html]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location /login { alias html/; index index.html; auth_basic \"login password\"; #æŒ‡å®šæç¤ºæ–‡æœ¬ä¿¡æ¯ auth_basic_user_file /apps/nginx/conf/.htpasswd; #æŒ‡å®šä½¿ç”¨çš„éªŒè¯æ–‡ä»¶ } } #ç›´æ¥è®¿é—®ç™»å½•é¡µï¼Œå¤±è´¥ã€‚æœªé€šè¿‡éªŒè¯ [root@localhost html]# curl pc.test.org/login/ 401 Authorization Required 401 Authorization Required nginx/1.18.0 ##åˆ†åˆ«ä½¿ç”¨ä¸¤ç§æ–¹å¼è¾“å…¥ç”¨æˆ·åå’Œå¯†ç éªŒè¯ [root@localhost html]# curl http://user1:passwd1@pc.test.org/login/ hello [root@localhost html]# curl -u user2:passwd2 pc.test.org/login/ hello è‡ªå®šä¹‰é”™è¯¯é¡µé¢ è‡ªå®šä¹‰é”™è¯¯é¡µï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æŒ‡å®šçš„å“åº”çŠ¶æ€ç è¿›è¡Œå“åº”, å¯åœ¨å¦‚ä¸‹è¯­å¥å—é…ç½®ï¼šhttp, server, location, if in\nlocation\næ ¼å¼ï¼š\nerror_page code ... [=[response]] uri; èŒƒä¾‹ï¼š\n# å‡†å¤‡ç«™ç‚¹é…ç½® [root@localhost html]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; error_page 404 400 /error.html; #è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢ï¼Œå‘ç”Ÿ404é”™è¯¯ï¼Œè¿”å›error.htmlé”™è¯¯é¡µé¢ location /error.html { root html/; } } #å‡†å¤‡é”™è¯¯é¡µé¢ [root@localhost html]# cat /apps/nginx/html/error.html error-page [root@localhost html]# nginx -s reload #è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢ï¼Œè§¦å‘404æŠ¥é”™ [root@localhost html]# curl -I pc.test.org/dd HTTP/1.1 404 Not Found #æŸ¥çœ‹é”™è¯¯ç  Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 17:02:12 GMT Content-Type: text/html Content-Length: 11 Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e411d9-b\" #è§¦å‘404é”™è¯¯ï¼Œè¿”å›é”™è¯¯é¡µé¢ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨æµ‹è¯•ï¼Œå»ºè®®ç”¨googleï¼‰ [root@localhost html]# curl pc.test.org/dd error-page èŒƒä¾‹ï¼šå¦‚æœå‘ç”Ÿ404 ï¼Œå°†é”™è¯¯ç å®šä¹‰ä¸º502ï¼Œä¸”è·³è½¬åˆ°ä¸»é¡µ/index.html\n#ç«™ç‚¹é…ç½® [root@localhost html]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; error_page 404 =502 /index.html; location /index.html { root html/; } } #ä¸»é¡µé…ç½® [root@localhost html]# cat /apps/nginx/html/index.html hello [root@localhost html]# nginx -s reload [root@localhost html]# curl pc.test.org/dd/ hello #éªŒè¯é”™è¯¯ç  [root@localhost html]# curl pc.test.org/dd/ -I HTTP/1.1 502 Bad Gateway #é”™è¯¯ç ä¸ºè‡ªå®šä¹‰çš„502 Server: nginx/1.18.0 Date: Fri, 29 Jul 2022 17:31:49 GMT Content-Type: text/html Content-Length: 6 Connection: keep-alive Keep-Alive: timeout=66 ETag: \"62e40fa4-6\" #é‡å®šå‘æˆåŠŸ [root@localhost html]# cat /apps/nginx/html/index.html hello è‡ªå®šä¹‰é”™è¯¯æ—¥å¿— é”™è¯¯æ—¥å¿—æ ¼å¼\nSyntax: error_log file [level]; #æ ¼å¼ Default: #é»˜è®¤å€¼ error_log logs/error.log error; Context: main, http, mail, stream, server, location #å¯é…ç½®çš„è¯­å¥å— level: debug, info, notice, warn, error, crit, alert, emerg #æ—¥å¿—è®°å½•ç­‰çº§ èŒƒä¾‹ï¼š\n#ç«™ç‚¹é…ç½® [root@localhost html]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; error_page 404 400 /error.html; access_log /apps/nginx/logs/test-access.log; #è‡ªå®šä¹‰æ­£å¸¸è®¿é—®æ—¥å¿— error_log /apps/nginx/logs/test-error.log; #è‡ªå®šä¹‰é”™è¯¯æ—¥å¿— location /error.html { root html/; } } #å½“å‰å·²æœ‰æ—¥å¿—æ–‡ä»¶ [root@localhost html]# ls /apps/nginx/logs/ access.log error.log nginx.pid #é‡å¯nginxåç”Ÿæˆè‡ªå®šä¹‰çš„é”™è¯¯æ—¥å¿— [root@localhost html]# nginx -s reload [root@localhost html]# ls /apps/nginx/logs/ access.log error.log nginx.pid test-access.log test-error.log #è®¿é—®ç«™ç‚¹ [root@localhost html]# curl pc.test.org hello #æ—¥å¿—æˆåŠŸè®°å½• [root@localhost html]# tail /apps/nginx/logs/{test-access,test-error}.log ==\u003e /apps/nginx/logs/test-access.log \u003c== 172.16.16.88 - - [30/Jul/2022:01:17:55 +0800] \"GET / HTTP/1.1\" 200 6 \"-\" \"curl/7.29.0\" ==\u003e /apps/nginx/logs/test-error.log \u003c== æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨ try_filesä¼šæŒ‰é¡ºåºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼ˆç»“å°¾åŠ æ–œçº¿è¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ï¼‰ï¼Œå¦‚\næœæ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹éƒ½æ‰¾ä¸åˆ°ï¼Œä¼šè¿›è¡Œä¸€ä¸ªå†…éƒ¨é‡å®šå‘åˆ°æœ€åä¸€ä¸ªå‚æ•°ã€‚åªæœ‰æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥å¼•èµ·ä¸€\nä¸ªå†…éƒ¨é‡å®šå‘ï¼Œä¹‹å‰çš„å‚æ•°åªè®¾ç½®å†…éƒ¨URIçš„æŒ‡å‘ã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›é€€URIä¸”å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå‡ºç°å†…\néƒ¨500é”™è¯¯ã€‚\nSyntax: try_files file ... uri; try_files file ... =code; Default: â€” Context: server, location èŒƒä¾‹: å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢\n#å‡†å¤‡ç«™ç‚¹é…ç½® [root@localhost html]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location / { root html/; index index.html; try_files $uri $uri.html $uri/index.html /about/default.html; } } #å‡†å¤‡é»˜è®¤é¡µé¢ [root@localhost html]# cat /apps/nginx/html/default.html default #è®¿é—®æµ‹è¯• [root@localhost ~]# cat /apps/nginx/html/about/default.html about_page [root@localhost ~]# curl pc.test.org/xx/ about_page [root@localhost ~]# curl pc.test.org/xx.html about_page ##è‡ªå®šä¹‰å“åº”ç  [root@localhost ~]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location / { root html/; index index.html; try_files $uri $uri.html $uri/index.html =555; #è‡ªå®šä¹‰å“åº”ç ä¸º555 } } #éªŒè¯ç»“æœ [root@localhost ~]# curl pc.test.org/xx.html -I HTTP/1.1 555 #å“åº”ç ä¸º555 Server: nginx/1.18.0 Date: Mon, 01 Aug 2022 10:00:03 GMT Content-Length: 0 Connection: keep-alive Keep-Alive: timeout=66 é•¿è¿æ¥é…ç½® keepalive_timeout timeout [header_timeout]; #è®¾å®šä¿æŒè¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œ0è¡¨ç¤ºç¦æ­¢é•¿è¿æ¥ï¼Œé»˜è®¤ä¸º75sï¼Œé€šå¸¸é…ç½®åœ¨httpå­—æ®µä½œä¸ºç«™ç‚¹å…¨å±€é…ç½® keepalive_requests number; #åœ¨ä¸€æ¬¡é•¿è¿æ¥ä¸Šæ‰€å…è®¸è¯·æ±‚çš„èµ„æºçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º100æ¬¡,å»ºè®®é€‚ å½“è°ƒå¤§,æ¯”å¦‚:500 èŒƒä¾‹ï¼š\n#ç«™ç‚¹ä¸»é…ç½®é¡¹ [root@localhost ~]# cat /apps/nginx/conf/nginx.conf | grep keepalive keepalive_requests 3; keepalive_timeout 65 60; [root@localhost ~]# cat /apps/nginx/html/index.html hello #é•¿è¿æ¥æµ‹è¯• [root@localhost ~]# telnet localhost 80 Trying ::1... telnet: connect to address ::1: Connection refused Trying 127.0.0.1... Connected to localhost. Escape character is '^]'. GET / HTTP/1.1 #å‘èµ·getè¯·æ±‚ï¼Œé‡å¤ä¸‰æ¬¡æˆ–è€…æ—¶é—´åˆ°è¾¾65ç§’åï¼Œæœ¬æ¬¡é“¾æ¥è‡ªåŠ¨ç»ˆæ­¢ HOST: localhost #åŸŸåä¸ºlocalhost HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Mon, 01 Aug 2022 11:03:09 GMT Content-Type: text/html Content-Length: 6 Last-Modified: Fri, 29 Jul 2022 16:49:40 GMT Connection: keep-alive Keep-Alive: timeout=60 #æ˜¾ç¤ºçš„è¶…æ—¶æ—¶é—´ ETag: \"62e40fa4-6\" Accept-Ranges: bytes hello #è¿”å›çš„é¡µé¢å†…å®¹ ä½œä¸ºä¸‹è½½æœåŠ¡å™¨ ngx_http_autoindex_module æ¨¡å—å¤„ç†ä»¥æ–œæ å­—ç¬¦ â€œ/â€ ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨,å¯ä»¥åšä¸ºä¸‹è½½æœåŠ¡\né…ç½®ä½¿ç”¨\nå®˜æ–¹é“¾æ¥ï¼šhttp://nginx.org/en/docs/http/ngx_http_autoindex_module.html\nç›¸å…³æŒ‡ä»¤\nautoindex on | off; #è‡ªåŠ¨æ–‡ä»¶ç´¢å¼•åŠŸèƒ½ï¼Œé»˜ä¸ºoff autoindex_exact_size on | off; #è®¡ç®—æ–‡ä»¶ç²¾ç¡®å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œoff æ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½Kã€M)ï¼Œé»˜è®¤on autoindex_localtime on | off ; #æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´ï¼Œé»˜è®¤off autoindex_format html | xml | json | jsonp; #æ˜¾ç¤ºç´¢å¼•çš„é¡µé¢æ–‡ä»¶é£æ ¼ï¼Œé»˜è®¤html limit_rate rate; #é™åˆ¶å“åº”å®¢æˆ·ç«¯ä¼ è¾“é€Ÿç‡(é™¤GETå’ŒHEADä»¥å¤–çš„æ‰€æœ‰æ–¹æ³•)ï¼Œå•ä½B/s,å³bytes/secondï¼Œé»˜è®¤å€¼0,è¡¨ç¤ºæ— é™åˆ¶,æ­¤æŒ‡ä»¤ç”±ngx_http_core_moduleæä¾› set $limit_rate 4k; #ä¹Ÿå¯ä»¥é€šå˜é‡é™é€Ÿ,å•ä½B/s,åŒæ—¶è®¾ç½®,æ­¤é¡¹ä¼˜çº§é«˜äºlimit_rate ###Rate limit can also be set in the $limit_rate variable, however, since version 1.17.0, this method is not recommended: èŒƒä¾‹ï¼šå°†nginxä½œä¸ºä¸‹è½½æœåŠ¡å™¨\n#æ³¨æ„:downloadä¸éœ€è¦index.htmlæ–‡ä»¶ [root@centos8 ~]# mkdir -p /data/nginx/html/pc/download [root@localhost ~]# touch /apps/nginx/html/download/{t1,t2,t3}.txt [root@localhost ~]# mkdir /apps/nginx/html/download/{d1,d2,d3} [root@localhost ~]# tree /apps/nginx/html/download /apps/nginx/html/download â”œâ”€â”€ d1 â”œâ”€â”€ d2 â”œâ”€â”€ d3 â”œâ”€â”€ t1.txt â”œâ”€â”€ t2.txt â””â”€â”€ t3.txt 3 directories, 3 files [root@centos8 ~]# cat /apps/nginx/conf.d/pc.conf location /download { autoindex on; #è‡ªåŠ¨ç´¢å¼•åŠŸèƒ½ autoindex_exact_size off; #è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,offåªæ˜¾ç¤ºå¤§æ¦‚å¤§ å°ï¼ˆå•ä½kbã€mbã€gbï¼‰ autoindex_localtime off; #onè¡¨ç¤ºæ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´,é»˜ä¸ºä¸ºoffæ˜¾ç¤ºGMT æ—¶é—´ limit_rate 1024k; #é™é€Ÿ,é»˜è®¤ä¸é™é€Ÿ root html/; } ç»“æœéªŒè¯\nä½œä¸ºä¸Šä¼ æœåŠ¡å™¨ ç›¸å…³æŒ‡ä»¤\nclient_max_body_size 1m; #è®¾ç½®å…è®¸å®¢æˆ·ç«¯ä¸Šä¼ å•ä¸ªæ–‡ä»¶å¤§å°çš„ä¸Šé™å€¼ï¼Œé»˜è®¤å€¼ä¸º1m,ä¸Šä¼ æ–‡ä»¶è¶…è¿‡æ­¤å€¼ä¼šå‡º413é”™è¯¯ client_body_buffer_size size; #ç”¨äºæ¥æ”¶æ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡çš„bodyéƒ¨åˆ†çš„ç¼“å†²åŒºå¤§å°;é»˜è®¤16k;è¶…å‡ºæ­¤å¤§å°æ—¶ï¼Œå…¶å°†è¢«æš‚å­˜åˆ°ç£ç›˜ä¸Šçš„ç”±client_body_temp_pathæŒ‡ä»¤æ‰€å®šä¹‰çš„ä½ç½® client_body_temp_path path [level1 [level2 [level3]]]; #è®¾å®šå­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡çš„bodyéƒ¨åˆ†çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„åŠå­ç›®å½•ç»“æ„å’Œæ•°é‡ï¼Œç›®å½•åä¸º16è¿›åˆ¶çš„æ•°å­—ï¼Œä½¿ç”¨hashä¹‹åçš„å€¼ä»åå¾€å‰æˆªå–1ä½ã€2ä½ã€2ä½ä½œä¸ºç›®å½•å [root@centos8 ~]# md5sum /data/nginx/html/pc/index.html 95f6f65f498c74938064851b1bb 96 3d 4 /data/nginx/html/pc/index.html 1çº§ç›®å½•å 1ä½16è¿›åˆ¶ï¼Œå³2^4=16ä¸ªç›®å½• 0-f 2çº§ç›®å½•å 2ä½16è¿›åˆ¶ï¼Œå³2^8=256ä¸ªç›®å½• 00-ff 3çº§ç›®å½•å 2ä½16è¿›åˆ¶ï¼Œå³2^8=256ä¸ªç›®å½• 00-ff #é…ç½®ç¤ºä¾‹ï¼š client_max_body_size 100m; #å¦‚æœå¤ªå¤§ï¼Œä¸Šä¼ æ—¶ä¼šå‡ºç°413é”™è¯¯ã€‚æ³¨æ„:å¦‚æœphpä¸Šä¼ ï¼ˆå¦‚WordPressï¼‰,è¿˜éœ€è¦ä¿®æ”¹/etc/php.iniçš„ç›¸å…³é…ç½® client_body_buffer_size 1024k; client_body_temp_path /apps/nginx/client_body_temp/ 1 2 2; #ä¸Šä¼ æ—¶,Nginxä¼šè‡ªåŠ¨åˆ›å»ºç›¸å…³ç›®å½• ##ä¸Šä¼ æ–‡ä»¶å,ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å…³ç›®å½• [root@wang-liyun-pc ~]# tree /apps/nginx/client_body_temp/ /apps/nginx/client_body_temp/ â”œâ”€â”€ 5 â”‚Â â””â”€â”€ 00 â”‚Â â””â”€â”€ 00 â””â”€â”€ 6 â””â”€â”€ 00 â””â”€â”€ 00 å…¶ä»–é…ç½® keepalive_disable none | browser ...; #å¯¹å“ªç§æµè§ˆå™¨ç¦ç”¨é•¿è¿æ¥ limit_except method ... { ... } #ä»…ç”¨äºlocationè¯­å¥å—ï¼Œç¦æ­¢å®¢æˆ·ç«¯ä½¿ç”¨é™¤äº†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•, å¦‚æœä½¿ç”¨ä¼šå‡ºç°403é”™è¯¯ method:GET, HEAD, POST, PUT, DELETEï¼ŒMKCOL, COPY, MOVE, OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH ##ç¤ºä¾‹ï¼šé™¤äº†GETä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•ä»…å…è®¸172.16.16.0/24ç½‘æ®µä¸»æœºä½¿ç”¨ [root@localhost ~]# hostname -I #æœ¬æœºIP 172.16.16.88 [root@localhost ~]# ll /apps/nginx/html/upload/ #æ–°å»ºuploadç›®å½•ç”¨äºå­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶ total 0 [root@localhost ~]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location /upload { root html/; index index.html; limit_except GET { allow 172.16.16.88; deny all; } } } [root@localhost ~]# nginx -s reload [root@localhost ~]# curl -XPUT /etc/issue pc.test.org/upload curl: (3) malformed 405 Not Allowed #PUTæ–¹æ³•å…·æœ‰è®¿é—®æƒé™ï¼Œä½†æ˜¯ç¨‹åºæœ¬èº«ä¸æ”¯æŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ 405 Not Allowed nginx/1.18.0 [root@localhost ~]# cat /apps/nginx/conf.d/pc.conf server { listen 80; server_name pc.test.org; location /upload { root html/; index index.html; limit_except GET { #allow 172.16.16.88; #ç¦æ­¢æ‰€æœ‰ä¸»æœºä½¿ç”¨GETä»¥å¤–çš„æ–¹æ³• deny all; } } } [root@localhost ~]# curl -XPUT /etc/issue pc.test.org/upload curl: (3) malformed 403 Forbidden #å†æ¬¡è®¿é—®æµ‹è¯•ï¼Œnginxæ‹’ç»è®¿é—® 403 Forbidden nginx/1.18.0 aio on | off #æ˜¯å¦å¯ç”¨asynchronous file I/O(AIO)åŠŸèƒ½ï¼Œéœ€è¦ç¼–è¯‘æ—¶æ·»åŠ å‚æ•°å¼€å¯ --with-file-aio #linux 2.6ä»¥ä¸Šå†…æ ¸æä¾›ä»¥ä¸‹å‡ ä¸ªç³»ç»Ÿè°ƒç”¨æ¥æ”¯æŒaioï¼š 1ã€SYS_io_setupï¼šå»ºç«‹aio çš„context 2ã€SYS_io_submit: æäº¤I/Oæ“ä½œè¯·æ±‚ 3ã€SYS_io_geteventsï¼šè·å–å·²å®Œæˆçš„I/Oäº‹ä»¶ 4ã€SYS_io_cancelï¼šå–æ¶ˆI/Oæ“ä½œè¯·æ±‚ 5ã€SYS_io_destroyï¼šæ¯é”€aioçš„context directio size | off; #æ“ä½œå®Œå…¨å’Œaioç›¸åï¼Œaioæ˜¯è¯»å–æ–‡ä»¶è€Œdirectioæ˜¯å†™æ–‡ä»¶åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸ºå…³é—­ï¼Œå½“æ–‡ä»¶å¤§äºç­‰äºç»™å®šå¤§å°æ—¶ï¼Œä¾‹å¦‚:directio 4mï¼ŒåŒæ­¥ï¼ˆç›´æ¥ï¼‰å†™ç£ç›˜ï¼Œè€Œéå†™ç¼“å­˜ã€‚ open_file_cache off; #æ˜¯å¦ç¼“å­˜æ‰“å¼€è¿‡çš„æ–‡ä»¶ä¿¡æ¯ open_file_cache max=N [inactive=time]; #nginxå¯ä»¥ç¼“å­˜ä»¥ä¸‹ä¸‰ç§ä¿¡æ¯ï¼š (1) æ–‡ä»¶å…ƒæ•°æ®ï¼šæ–‡ä»¶çš„æè¿°ç¬¦ã€æ–‡ä»¶å¤§å°å’Œæœ€è¿‘ä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´ (2) æ‰“å¼€çš„ç›®å½•ç»“æ„ (3) æ²¡æœ‰æ‰¾åˆ°çš„æˆ–è€…æ²¡æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ max=Nï¼š#å¯ç¼“å­˜çš„ç¼“å­˜é¡¹ä¸Šé™æ•°é‡;è¾¾åˆ°ä¸Šé™åä¼šä½¿ç”¨LRU(Least recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨)ç®—æ³•å®ç°ç®¡ç† inactive=timeï¼š#ç¼“å­˜é¡¹çš„éæ´»åŠ¨æ—¶é•¿ï¼Œåœ¨æ­¤å¤„æŒ‡å®šçš„æ—¶é•¿å†…æœªè¢«å‘½ä¸­çš„æˆ–å‘½ä¸­çš„æ¬¡æ•°å°‘äº open_file_cache_min_uses #æŒ‡ä»¤æ‰€æŒ‡å®šçš„æ¬¡æ•°çš„ç¼“å­˜é¡¹å³ä¸ºéæ´»åŠ¨é¡¹ï¼Œå°†è¢«åˆ é™¤ open_file_cache_valid time; #ç¼“å­˜é¡¹æœ‰æ•ˆæ€§çš„æ£€æŸ¥éªŒè¯é¢‘ç‡ï¼Œé»˜è®¤å€¼ä¸º60s open_file_cache_errors on | off; #æ˜¯å¦ç¼“å­˜æŸ¥æ‰¾æ—¶å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶ä¸€ç±»çš„ä¿¡æ¯,é»˜è®¤å€¼ä¸ºoff open_file_cache_min_uses number; #open_file_cacheæŒ‡ä»¤çš„inactiveå‚æ•°æŒ‡å®šçš„æ—¶é•¿å†…ï¼Œè‡³å°‘è¢«å‘½ä¸­æ­¤å¤„æŒ‡å®šçš„æ¬¡æ•°æ–¹å¯è¢«å½’ç±»ä¸ºæ´»åŠ¨é¡¹,é»˜è®¤å€¼ä¸º1 èŒƒä¾‹ï¼š\nopen_file_cache max=10000 inactive=60s; #æœ€å¤§ç¼“å­˜10000ä¸ªæ–‡ä»¶ï¼Œéæ´»åŠ¨æ•°æ®è¶…æ—¶æ—¶é•¿60s open_file_cache_valid 60s; #æ¯é—´éš”60sæ£€æŸ¥ä¸€ä¸‹ç¼“å­˜æ•°æ®æœ‰æ•ˆæ€§ open_file_cache_min_uses 5; #60ç§’å†…è‡³å°‘è¢«å‘½ä¸­è®¿é—®5æ¬¡æ‰è¢«æ ‡è®°ä¸ºæ´»åŠ¨æ•°æ® open_file_cache_errors on; #ç¼“å­˜é”™è¯¯ä¿¡æ¯ ","wordCount":"10564","inLanguage":"zh","datePublished":"2022-07-25T14:36:53Z","dateModified":"2022-07-25T14:36:53Z","author":{"@type":"Person","name":"nier"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/posts/tech/nginx/nginx%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><a href=https://senmer.github.io/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/search title="ğŸ” æœç´¢ (Alt + /)" accesskey=/><span>ğŸ” æœç´¢</span></a></li><li><a href=https://senmer.github.io/ title="ğŸ  ä¸»é¡µ"><span>ğŸ  ä¸»é¡µ</span></a></li><li><a href=https://senmer.github.io/posts/tech title="ğŸ“š æ–‡ç« "><span>ğŸ“š æ–‡ç« </span></a></li><li><a href=https://senmer.github.io/categories/ title="ğŸ§© åˆ†ç±»"><span>ğŸ§© åˆ†ç±»</span></a></li><li><a href=https://senmer.github.io/archives/ title="â±ï¸ æ—¶é—´è½´"><span>â±ï¸ æ—¶é—´è½´</span></a></li><li><a href=https://senmer.github.io/about title="ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº"><span>ğŸ™‹ğŸ»â€â™‚ï¸ å…³äº</span></a></li><li><a href=https://senmer.github.io/links title="ğŸ¤ å‹é“¾"><span>ğŸ¤ å‹é“¾</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/>ğŸ  ä¸»é¡µ</a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/posts/>ğŸ“šæ–‡ç« </a>&nbsp;Â»&nbsp;<a href=https://senmer.github.io/posts/tech/>ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯</a></div><h1 class=post-title>Nginxæ ¸å¿ƒé…ç½®</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2022-07-25
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>10564å­—
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>22åˆ†é’Ÿ
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>nier
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta><a href=https://senmer.github.io/tags/nginx/ style=color:var(--secondary)!important>Nginx</a></span></span></span></span>
<span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;</span></span>
<span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script>
<script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><ul><li><a href=#%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e8%af%b4%e6%98%8e aria-label=é…ç½®æ–‡ä»¶è¯´æ˜>é…ç½®æ–‡ä»¶è¯´æ˜</a><ul><li><a href=#nginx-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%bb%84%e6%88%90 aria-label="nginx é…ç½®æ–‡ä»¶ç»„æˆï¼š">nginx é…ç½®æ–‡ä»¶ç»„æˆï¼š</a></li><li><a href=#nginx-%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e8%af%b4%e6%98%8e aria-label="nginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜ï¼š">nginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜ï¼š</a></li><li><a href=#nginx-%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%8c%87%e4%bb%a4%e6%a0%bc%e5%bc%8f aria-label="nginx ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼ï¼š">nginx ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼ï¼š</a></li><li><a href=#%e4%b8%bb%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e7%bb%93%e6%9e%84%e5%9b%9b%e9%83%a8%e5%88%86 aria-label=ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ†>ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ†</a></li></ul></li><li><a href=#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae aria-label=å…¨å±€é…ç½®>å…¨å±€é…ç½®</a><ul><li><a href=#%e5%85%a8%e5%b1%80%e9%85%8d%e7%bd%ae%e8%af%b4%e6%98%8e aria-label=å…¨å±€é…ç½®è¯´æ˜>å…¨å±€é…ç½®è¯´æ˜</a></li></ul></li><li><a href=#http-%e9%85%8d%e7%bd%ae%e5%9d%97 aria-label="http é…ç½®å—">http é…ç½®å—</a><ul><ul><li><a href=#mime aria-label=MIME>MIME</a></li><li><a href=#%e6%8c%87%e5%ae%9a%e5%93%8d%e5%ba%94%e6%8a%a5%e6%96%87 aria-label=æŒ‡å®šå“åº”æŠ¥æ–‡>æŒ‡å®šå“åº”æŠ¥æ–‡</a></li></ul></ul></li><li><a href=#%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae%e7%a4%ba%e4%be%8b aria-label=æ ¸å¿ƒé…ç½®ç¤ºä¾‹>æ ¸å¿ƒé…ç½®ç¤ºä¾‹</a><ul><ul><li><a href=#%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba%e7%9a%84%e5%ae%9e%e7%8e%b0 aria-label=è™šæ‹Ÿä¸»æœºçš„å®ç°>è™šæ‹Ÿä¸»æœºçš„å®ç°</a><ul><li><a href=#%e6%96%b0%e5%bb%ba%e4%b8%a4%e4%b8%aa%e8%99%9a%e6%8b%9f%e4%b8%bb%e6%9c%ba aria-label=æ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº>æ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº</a></li><li><a href=#root-%e4%b8%8e-alias-%e7%9a%84%e5%8c%ba%e5%88%ab aria-label="root ä¸ alias çš„åŒºåˆ«">root ä¸ alias çš„åŒºåˆ«</a></li></ul></li><li><a href=#localtion-%e7%9a%84%e5%8c%b9%e9%85%8d%e8%a7%84%e5%88%99 aria-label="localtion çš„åŒ¹é…è§„åˆ™">localtion çš„åŒ¹é…è§„åˆ™</a></li><li><a href=#%e5%8c%b9%e9%85%8d%e6%a1%88%e4%be%8b-%e7%b2%be%e7%a1%ae%e5%8c%b9%e9%85%8d aria-label=åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é…>åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é…</a></li><li><a href=#%e5%8c%b9%e9%85%8d%e6%a1%88%e4%be%8b-%e5%8c%ba%e5%88%86%e5%a4%a7%e5%b0%8f%e5%86%99 aria-label=åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™>åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™</a></li><li><a href=#%e5%8c%b9%e9%85%8d%e6%a1%88%e4%be%8b-%e4%b8%8d%e5%8c%ba%e5%88%86%e5%a4%a7%e5%b0%8f%e5%86%99 aria-label=åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™>åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™</a></li><li><a href=#nginx-%e5%9b%9b%e5%b1%82%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6 aria-label="nginx å››å±‚è®¿é—®æ§åˆ¶">nginx å››å±‚è®¿é—®æ§åˆ¶</a></li><li><a href=#nginx-%e8%b4%a6%e6%88%b7%e8%ae%a4%e8%af%81%e5%8a%9f%e8%83%bd aria-label="nginx è´¦æˆ·è®¤è¯åŠŸèƒ½">nginx è´¦æˆ·è®¤è¯åŠŸèƒ½</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e9%a1%b5%e9%9d%a2 aria-label=è‡ªå®šä¹‰é”™è¯¯é¡µé¢>è‡ªå®šä¹‰é”™è¯¯é¡µé¢</a></li><li><a href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e9%94%99%e8%af%af%e6%97%a5%e5%bf%97 aria-label=è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—>è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—</a></li><li><a href=#%e6%a3%80%e6%b5%8b%e6%96%87%e4%bb%b6%e6%98%af%e5%90%a6%e5%ad%98%e5%9c%a8 aria-label=æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨</a></li><li><a href=#%e9%95%bf%e8%bf%9e%e6%8e%a5%e9%85%8d%e7%bd%ae aria-label=é•¿è¿æ¥é…ç½®>é•¿è¿æ¥é…ç½®</a></li><li><a href=#%e4%bd%9c%e4%b8%ba%e4%b8%8b%e8%bd%bd%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=ä½œä¸ºä¸‹è½½æœåŠ¡å™¨>ä½œä¸ºä¸‹è½½æœåŠ¡å™¨</a></li><li><a href=#%e4%bd%9c%e4%b8%ba%e4%b8%8a%e4%bc%a0%e6%9c%8d%e5%8a%a1%e5%99%a8 aria-label=ä½œä¸ºä¸Šä¼ æœåŠ¡å™¨>ä½œä¸ºä¸Šä¼ æœåŠ¡å™¨</a></li><li><a href=#%e5%85%b6%e4%bb%96%e9%85%8d%e7%bd%ae aria-label=å…¶ä»–é…ç½®>å…¶ä»–é…ç½®</a></li></ul></ul></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>ä¸»è¦ä»‹ç»Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶</p><h1 id=é…ç½®æ–‡ä»¶è¯´æ˜>é…ç½®æ–‡ä»¶è¯´æ˜<a hidden class=anchor aria-hidden=true href=#é…ç½®æ–‡ä»¶è¯´æ˜>#</a></h1><p>nginx å®˜æ–¹æ–‡æ¡£ï¼šhttp://nginx.org/en/docs/</p><h2 id=nginx-é…ç½®æ–‡ä»¶ç»„æˆ>nginx é…ç½®æ–‡ä»¶ç»„æˆï¼š<a hidden class=anchor aria-hidden=true href=#nginx-é…ç½®æ–‡ä»¶ç»„æˆ>#</a></h2><ul><li>ä¸»é…ç½®æ–‡ä»¶ï¼š nginx.conf</li><li>å­é…ç½®æ–‡ä»¶ï¼š conf.d/*.conf</li><li>fastcgi,ï¼Œ uwsgiï¼Œscgi ç­‰åè®®çš„ç›¸å…³é…ç½®æ–‡ä»¶</li><li>mime.typesï¼šæ”¯æŒçš„mimeç±»å‹ï¼ŒMIMEï¼ˆMultipurpose Internet Mail Extensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ï¼ŒMIMEæ¶ˆæ¯èƒ½åŒ…å«æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘ä»¥åŠå…¶ä»–åº”ç”¨ç¨‹åºä¸“ç”¨çš„æ•°æ®ï¼Œæ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“å¸¦æœ‰æŸç§æ‰©å±•åçš„æ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ‰“å¼€ï¼ˆæ¯”å¦‚ï¼šåº”ç”¨ç¨‹åºä¼šè¢«ä¸‹è½½ï¼Œæ–‡æœ¬æ–‡ä»¶ä¼šç›´æ¥æ˜¾ç¤ºå†…å®¹ï¼‰ã€‚ç®€å•æ¥è¯´ï¼ŒMIMEå°±æ˜¯åˆ©ç”¨æ‰©å±•åæ ‡è¯†æ–‡ä»¶ç±»å‹ï¼Œç„¶åæ ¹æ®æ–‡ä»¶çš„ç±»å‹åšå“åº”çš„å¤„ç†ã€‚MIME å‚è€ƒæ–‡æ¡£ï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types</li></ul><h2 id=nginx-é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜>nginx é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜ï¼š<a hidden class=anchor aria-hidden=true href=#nginx-é…ç½®æ–‡ä»¶æ ¼å¼è¯´æ˜>#</a></h2><ul><li>é…ç½®æ–‡ä»¶ç”±æŒ‡ä»¤å’ŒæŒ‡ä»¤å—æ„æˆ</li><li>æ¯æ¡æŒ‡ä»¤ä»¥åˆ†å·ï¼›ç»“æŸï¼ŒæŒ‡ä»¤å’Œå€¼ä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”</li><li>å¤šæ¡æŒ‡ä»¤å¯ä»¥æ”¾åœ¨åŒä¸€è¡Œï¼Œä»¥åˆ†å·åˆ†éš”ã€‚ä½†å¯è¯»æ€§å·®ï¼Œä¸æ¨èè¿™æ ·é…ç½®</li><li>æŒ‡ä»¤å—ä»¥{ } æ‹¬å·ä½œä¸ºå¼€å§‹å’Œç»“æŸçš„æ ‡è¯†ï¼Œå°†å¤šæ¡æŒ‡ä»¤ç»„ç»‡åœ¨ä¸€èµ·ï¼Œä¸”æ”¯æŒåµŒå¥—</li><li>å¯é€šè¿‡includeå¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶å†…å®¹ï¼Œæå‡é…ç½®æ–‡ä»¶çš„å¯ç»´æŠ¤æ€§ï¼ˆå¦‚å­é…ç½®æ–‡ä»¶conf.d/*.conf)</li><li>é…ç½®æ–‡ä»¶ä½¿ç”¨# ä½œä¸ºæ³¨é‡Šç¬¦ï¼Œä½¿ç”¨$å¼•ç”¨å˜é‡</li><li>éƒ¨åˆ†æŒ‡ä»¤çš„å‚æ•°æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼</li></ul><h2 id=nginx-ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼>nginx ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼ï¼š<a hidden class=anchor aria-hidden=true href=#nginx-ä¸»é…ç½®æ–‡ä»¶æŒ‡ä»¤æ ¼å¼>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>directive value [value1 ...];
</span></span><span style=display:flex><span>è¯´æ˜ï¼š
</span></span><span style=display:flex><span>1ã€æŒ‡ä»¤å¿…é¡»ä»¥åˆ†å·ï¼›ç»“æŸ
</span></span><span style=display:flex><span>2ã€æ”¯æŒå˜é‡ï¼š
</span></span><span style=display:flex><span>   1ï¼‰å†…å»ºå˜é‡ï¼šç”±Nginxæ¨¡å—å¼•å…¥ï¼Œå¯ç›´æ¥å¼•ç”¨
</span></span><span style=display:flex><span>   2ï¼‰è‡ªå®šä¹‰å˜é‡ï¼šç”±ç”¨æˆ·ä½¿ç”¨setæŒ‡å®šå®šä¹‰ï¼Œæ ¼å¼ï¼š set  variable_name value;
</span></span><span style=display:flex><span>   3) å¼•ç”¨å˜é‡çš„æ–¹å¼ï¼š<span style=color:#e6db74>$</span>variable_name
</span></span></code></pre></div><h2 id=ä¸»é…ç½®æ–‡ä»¶ç»“æ„å››éƒ¨åˆ†>ä¸»é…ç½®æ–‡ä»¶ç»“æ„ï¼šå››éƒ¨åˆ†<a hidden class=anchor aria-hidden=true href=#ä¸»é…ç½®æ–‡ä»¶ç»“æ„å››éƒ¨åˆ†>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>main blockï¼šä¸»é…ç½®æ®µï¼Œå³å…¨å±€é…ç½®æ®µï¼Œå¯¹http,mailéƒ½æœ‰æ•ˆ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½®
</span></span><span style=display:flex><span>event {
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span>} Â  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#http/https åè®®ç›¸å…³é…ç½®æ®µ
</span></span><span style=display:flex><span>http {
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span>} Â  Â  Â 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#é»˜è®¤é…ç½®æ–‡ä»¶ä¸åŒ…æ‹¬ä¸‹é¢ä¸¤ä¸ªå—
</span></span><span style=display:flex><span>#mail åè®®ç›¸å…³é…ç½®æ®µ
</span></span><span style=display:flex><span>mail {
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span>} Â  Â 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>#stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ
</span></span><span style=display:flex><span>stream {
</span></span><span style=display:flex><span> ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>é»˜è®¤çš„nginx.conf é…ç½®æ–‡ä»¶è¯´æ˜</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>##å…¨å±€é…ç½®å—ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆã€‚ä¸»è¦è®¾ç½®nginxçš„å¯åŠ¨ç”¨æˆ·/ç»„ï¼Œå¯åŠ¨çš„å·¥ä½œè¿›ç¨‹æ•°é‡ï¼Œå·¥ä½œæ¨¡å¼ï¼Œnginxçš„pidæ–‡ä»¶è·¯å¾„ç­‰ã€‚</span>
</span></span><span style=display:flex><span>user nginx nginx;
</span></span><span style=display:flex><span>worker_processes 1; <span style=color:#75715e>#å¯åŠ¨å·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬ä¸CPUæ ¸å¿ƒæ•°ä¸€è‡´</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##eventså—ï¼Œä¸»è¦å½±å“nginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ï¼Œæ¯”å¦‚æ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œä½¿ç”¨å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹æœ€å¤§æ”¯æŒå¹¶å‘è¿æ¥æ•°ï¼Œæ˜¯å¦å¼€å¯å¯¹å¤šå·¥ä½œè¿›ç¨‹ä¸‹çš„ç½‘ç»œè¿æ¥è¿›è¡Œåºåˆ—åŒ–ç­‰ã€‚</span>
</span></span><span style=display:flex><span>events <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	worker_connections 1024; <span style=color:#75715e>#å•ä¸ªworkerè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°ã€‚ä½œä¸ºwebæœåŠ¡å™¨æ—¶ï¼Œnginxçš„æœ€å¤§å¹¶å‘æ•°ä¸ºï¼šworker_connections * worker_processesã€‚ä½œä¸ºåå‘ä»£ç†çš„æ—¶å€™ä¸ºï¼ˆworker_connections * worker_processesï¼‰/2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##httpå—æ˜¯nginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç¼“å­˜ã€ä»£ç†å’Œæ—¥å¿—æ ¼å¼å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—éƒ½åœ¨è¿™é‡Œé…ç½®ã€‚httpå—å¯ä»¥åŒ…å«å¤šä¸ªserverå—ï¼Œè€Œä¸€ä¸ªserverå—åˆå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ï¼Œserverå—å¯ä»¥é…ç½®æ–‡ä»¶å¼•å…¥ã€MIME-Typeå®šä¹‰ã€æ—¥å¿—è‡ªå®šä¹‰ã€æ˜¯å¦å¯ç”¨sendfileã€è¿æ¥è¶…æ—¶æ—¶é—´å’Œå•ä¸ªé“¾æ¥çš„è¯·æ±‚ä¸Šé™ç­‰ã€‚</span>
</span></span><span style=display:flex><span>http <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	include			mime.types;
</span></span><span style=display:flex><span>	default_type 	application/ostet-stream;
</span></span><span style=display:flex><span>	sendfile		on; 	<span style=color:#75715e>#ä½œä¸ºwebæœåŠ¡å™¨æ—¶æ‰“å¼€sendfileåŠ å¿«é™æ€æ–‡ä»¶ä¼ è¾“ï¼ŒæŒ‡å®šæ˜¯å¦ä½¿ç”¨sendfileç³»ç»Ÿè°ƒç”¨ä¼ è¾“æ–‡ä»¶ã€‚sendfileç³»ç»Ÿè°ƒç”¨åœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ é€’æ•°æ®ï¼ˆå®Œå…¨åœ¨å†…æ ¸ç©ºé—´è¿›ç¨‹ï¼‰ï¼Œä»è€Œé¿å…äº†æ•°æ®åœ¨å†…æ ¸ç¼“å†²åŒºå’Œç”¨æˆ·ç¼“å†²åŒºä¹‹é—´çš„æ‹·è´ï¼Œæ•ˆç‡å¾ˆé«˜ï¼Œæ˜¯é›¶æ‹·è´æŠ€æœ¯çš„ä¸€ç§ã€‚</span>
</span></span><span style=display:flex><span>	keepalive_timeout 65; 	<span style=color:#75715e>#é•¿è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ï¼šç§’</span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>##serverå—å¯ç”¨äºé…ç½®è™šæ‹Ÿä¸»æœºï¼Œæœ‰è‡ªå·±çš„å…¨å±€é…ç½®ï¼Œå¯ä»¥åŒ…å«å¤šä¸ªlocationå—ã€‚å¯é…ç½®æœ¬è™šæ‹Ÿæœºç›‘å¬çš„ç«¯å£ï¼Œè®¾ç½®è™šæ‹Ÿæœºåç§°ï¼Œå¤šä¸ªserverç›‘å¬åŒä¸€ä¸ªç«¯å£ã€‚</span>
</span></span><span style=display:flex><span>	server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>		listen 			80; <span style=color:#75715e>#ç›‘å¬ç«¯å£</span>
</span></span><span style=display:flex><span>		server_name;	localhost; <span style=color:#75715e>#serverçš„åŸŸåï¼Œé…ç½®å¤šä¸ªè™šæ‹Ÿä¸»æœºæ—¶ç”¨åˆ°</span>
</span></span><span style=display:flex><span>		location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>			root	html;
</span></span><span style=display:flex><span>			index	index.html index.htm; <span style=color:#75715e>#ç½‘ç«™é»˜è®¤ä¸»é¡µ</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>		error_page <span style=color:#ae81ff>500</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>503</span> <span style=color:#ae81ff>504</span> /50x.html; <span style=color:#75715e>#é”™è¯¯é¡µé¢</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>##locationå¤„ç†å¯¹åº”çš„ä¸åŒé”™è¯¯ç çš„é¡µé¢å®šä¹‰åˆ°50x.htmlï¼ŒæŒ‡ç¤ºäº†50.htmlæ–‡ä»¶æ‰€åœ¨ç›®å½•</span>
</span></span><span style=display:flex><span>		location <span style=color:#f92672>=</span> /50x.html <span style=color:#f92672>{</span> 	
</span></span><span style=display:flex><span>        	root	html;   <span style=color:#75715e>#é”™è¯¯é¡µé¢æ–‡ä»¶æ‰€åœ¨ç›®å½•</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>##å’Œé‚®ä»¶ç›¸å…³çš„é…ç½®</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#mail {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Â  Â  Â  Â  Â  Â  Â  ...</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#} Â  Â  Â  Â  mail åè®®ç›¸å…³é…ç½®æ®µ</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#tcpä»£ç†é…ç½®ï¼Œ1.9ç‰ˆæœ¬ä»¥ä¸Šæ”¯æŒ</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#stream {</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Â  Â  Â  Â  Â  Â  Â  ...</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#} Â  Â  Â  stream æœåŠ¡å™¨ç›¸å…³é…ç½®æ®µ</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#å¯¼å…¥å…¶ä»–è·¯å¾„çš„é…ç½®æ–‡ä»¶</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#include /apps/nginx/conf.d/*.conf</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h1 id=å…¨å±€é…ç½®>å…¨å±€é…ç½®<a hidden class=anchor aria-hidden=true href=#å…¨å±€é…ç½®>#</a></h1><p>main å…¨å±€é…ç½®å—å¸¸è§çš„é…ç½®æŒ‡ä»¤åˆ†ç±»</p><ul><li>æ­£å¸¸è¿è¡Œå¿…å¤‡çš„é…ç½®</li><li>ä¼˜åŒ–æ€§èƒ½ç›¸å…³çš„é…ç½®</li><li>ç”¨äºè°ƒè¯•å®šä½é—®é¢˜ç›¸å…³çš„é…ç½®</li><li>äº‹ä»¶é©±åŠ¨ç›¸å…³çš„é…ç½®</li></ul><h2 id=å…¨å±€é…ç½®è¯´æ˜>å…¨å±€é…ç½®è¯´æ˜<a hidden class=anchor aria-hidden=true href=#å…¨å±€é…ç½®è¯´æ˜>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user	nginx nginx; <span style=color:#75715e>#å¯åŠ¨nginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç»„</span>
</span></span><span style=display:flex><span>worker_processes <span style=color:#f92672>[</span>number | auto<span style=color:#f92672>]</span>; <span style=color:#75715e>#å¯åŠ¨nginxå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œä¸€èˆ¬å’ŒCPUæ ¸å¿ƒæ•°ç›¸åŒ</span>
</span></span><span style=display:flex><span>worker_cpu_affinity <span style=color:#ae81ff>00000001</span> <span style=color:#ae81ff>00000010</span> <span style=color:#ae81ff>00000100</span> 00001000; <span style=color:#75715e>#å°†Nginxå·¥ä½œè¿›ç¨‹ç»‘å®šåˆ°æŒ‡å®šçš„CPUæ ¸å¿ƒï¼Œé»˜è®¤Nginxæ˜¯ä¸è¿›è¡Œè¿›ç¨‹ç»‘å®šçš„ï¼Œç»‘å®šå¹¶ä¸æ˜¯æ„å‘³ç€å½“å‰nginxè¿›ç¨‹ç‹¬å ä»¥ä¸€æ ¸å¿ƒCPUï¼Œä½†æ˜¯å¯ä»¥ä¿è¯æ­¤è¿›ç¨‹ä¸ä¼šè¿è¡Œåœ¨å…¶ä»–æ ¸å¿ƒä¸Šï¼Œè¿™å°±æå¤§å‡å°‘äº†nginxçš„å·¥ä½œè¿›ç¨‹åœ¨ä¸åŒçš„cpuæ ¸å¿ƒä¸Šçš„æ¥å›è·³è½¬ï¼Œå‡å°‘äº†CPUå¯¹è¿›ç¨‹çš„èµ„æºåˆ†é…ä¸å›æ”¶ä»¥åŠå†…å­˜ç®¡ç†ç­‰ï¼Œå› æ­¤å¯ä»¥æœ‰æ•ˆçš„æå‡nginxæœåŠ¡å™¨çš„æ€§èƒ½ã€‚</span>
</span></span><span style=display:flex><span>CPU MASK: 00000001ï¼š0å·CPU
</span></span><span style=display:flex><span> Â  Â  Â  Â  Â 00000010ï¼š1å·CPU
</span></span><span style=display:flex><span> Â 		  10000000ï¼š7å·CPU
</span></span><span style=display:flex><span> Â 		  
</span></span><span style=display:flex><span><span style=color:#75715e>##ç¤ºä¾‹:</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># egrep &#34;processes|affinity&#34; nginx.conf</span>
</span></span><span style=display:flex><span>worker_processes 4;	 <span style=color:#75715e>#å¯åŠ¨å››ä¸ªworkerè¿›ç¨‹</span>
</span></span><span style=display:flex><span>worker_cpu_affinity <span style=color:#ae81ff>0001</span> 0010;   <span style=color:#75715e>#å°†workrè¿›ç¨‹ç»‘å®šåˆ° 0å·CPUå’Œ1å·CPU</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># lscpu | grep CPU\(s\)   # CPUæ ¸æ•°ä¸º2</span>
</span></span><span style=display:flex><span>CPU<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>:                <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>On-line CPU<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> list:   0,1
</span></span><span style=display:flex><span>NUMA node0 CPU<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>:     0,1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># nginx -t  #è¯­æ³•æ£€æŸ¥å‡ºç°è­¦å‘Šï¼Œå› ä¸ºworkerè¿›ç¨‹æ•°æ¯”CPUæ ¸å¿ƒæ•°å¤šã€‚å¤šå‡ºçš„workerè¿›ç¨‹å°†ç»‘å®šåœ¨â€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€˜ä¹Ÿå³0010ä¸Šã€‚å¯¹äºâ€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€™ï¼ˆlast mask for remaining workerï¼‰çš„è§£é‡Šï¼š processesï¼šnginxåˆ†åˆ«å°†workerè¿›ç¨‹ç»‘å®šåˆ°worker_cpu_affinity æŒ‡å®šçš„CPUæ ¸å¿ƒä¸Šï¼ˆä»å·¦è‡³å³çš„é¡ºåºï¼‰ï¼Œè€Œä»ç¬¬ä¸‰ä¸ªworkè¿›ç¨‹èµ·å¹¶æœªæŒ‡å®šå¯¹åº”çš„CPUæ ¸å¿ƒï¼Œå› æ­¤å…¨éƒ¨ç»‘å®šåˆ°â€˜ä¸Šä¸€ä¸ªCPUæ ¸å¿ƒâ€™ 0010è¿™ä¸ªCPUæ ¸å¿ƒã€‚</span>
</span></span><span style=display:flex><span>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok
</span></span><span style=display:flex><span>nginx: <span style=color:#f92672>[</span>warn<span style=color:#f92672>]</span> the number of <span style=color:#e6db74>&#34;worker_processes&#34;</span> is not equal to the number of <span style=color:#e6db74>&#34;worker_cpu_affinity&#34;</span> masks, using last mask <span style=color:#66d9ef>for</span> remaining worker processes
</span></span><span style=display:flex><span>nginx: configuration file /apps/nginx/conf/nginx.conf test is successful
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># ps axo pid,cmd,psr | grep nginx</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>827</span> nginx: master process /apps   <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1226</span> nginx: worker process         <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1227</span> nginx: worker process         <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1228</span> nginx: worker process         <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1229</span> nginx: worker process         <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1249</span> grep --color<span style=color:#f92672>=</span>auto nginx       <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å°†workerè¿›ç¨‹æ•°é‡æ”¹ä¸º2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># vim nginx.conf</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># egrep &#34;processes|affinity&#34; nginx.conf</span>
</span></span><span style=display:flex><span>worker_processes 2;
</span></span><span style=display:flex><span>worker_cpu_affinity <span style=color:#ae81ff>0001</span> 0010;
</span></span><span style=display:flex><span><span style=color:#75715e>#è¯­æ³•æ£€æŸ¥ä¸å†è­¦å‘Š</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># nginx -t</span>
</span></span><span style=display:flex><span>nginx: the configuration file /apps/nginx/conf/nginx.conf syntax is ok
</span></span><span style=display:flex><span>nginx: configuration file /apps/nginx/conf/nginx.conf test is successful
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># ps axo pid,cmd,psr | grep nginx</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>827</span> nginx: master process /apps   <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1261</span> nginx: worker process         <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1262</span> nginx: worker process         <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1265</span> grep --color<span style=color:#f92672>=</span>auto nginx       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e>#é”™è¯¯æ—¥å¿—è®°å½•é…ç½®ï¼Œè¯­æ³•ï¼šerror_log file [debug | info | notice | warn | error | crit | alert | emerg]  #æ‹¬å·å†…ä¸ºæ—¥å¿—è®°å½•è¯¦ç»†çº§åˆ«ï¼ˆä»å·¦è‡³å³é€æ¸æé«˜ï¼‰</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##ç¤ºä¾‹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#error_log logs/error.log;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#error_log logs/error.log notice;</span>
</span></span><span style=display:flex><span>error_log /apps/nginx/logs/error.log error;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#pidæ–‡ä»¶ä¿å­˜è·¯å¾„</span>
</span></span><span style=display:flex><span>pid Â  Â  Â  /apps/nginx/logs/nginx.pid;
</span></span><span style=display:flex><span>worker_priority 0; <span style=color:#75715e>#å·¥ä½œè¿›ç¨‹ä¼˜å…ˆçº§ï¼Œ-20~20(19)</span>
</span></span><span style=display:flex><span>worker_rlimit_nofile 65536; <span style=color:#75715e>#æ‰€æœ‰workerè¿›ç¨‹èƒ½æ‰“å¼€çš„æ–‡ä»¶æ•°é‡ä¸Šé™,åŒ…æ‹¬:Nginxçš„æ‰€æœ‰è¿æ¥ï¼ˆä¾‹å¦‚ä¸ä»£ç†æœåŠ¡å™¨çš„è¿æ¥ç­‰ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚è¯¥å€¼æœ€å¥½ä¸ulimit -n æˆ–è€…limits.confçš„å€¼ä¿æŒä¸€è‡´,</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é€šè¿‡pamé™åˆ¶æ–‡ä»¶æ‰“å¼€æ•°é‡ä¸Šé™</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@centos8 ~<span style=color:#f92672>]</span><span style=color:#75715e>#cat /etc/security/limits.conf</span>
</span></span><span style=display:flex><span>* Â  Â  Â  Â  Â  Â  Â  soft Â  nofile Â  Â  Â  Â  Â 1000000
</span></span><span style=display:flex><span>* Â  Â  Â  Â  Â  Â  Â  hard Â  nofile Â  Â  Â  Â  Â 1000000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#workerè¿›ç¨‹ä¼˜å…ˆçº§</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># grep priority nginx.conf</span>
</span></span><span style=display:flex><span>worker_priority 0;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@test conf<span style=color:#f92672>]</span><span style=color:#75715e># ps -axo pid,cmd,nice | grep nginx</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>827</span> nginx: master process /apps   <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1391</span> nginx: worker process         <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1392</span> nginx: worker process         <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1449</span> grep --color<span style=color:#f92672>=</span>auto nginx       <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>daemon off; Â #å‰å°è¿è¡ŒNginxæœåŠ¡ï¼Œé€šå¸¸åœ¨æµ‹è¯•ç¯å¢ƒæˆ–è€…dockerç¯å¢ƒä¸­ä½¿ç”¨
</span></span><span style=display:flex><span>master_process off|on; <span style=color:#75715e>#æ˜¯å¦å¼€å¯Nginxçš„master-workerå·¥ä½œæ¨¡å¼ï¼Œä»…ç”¨äºå¼€å‘è°ƒè¯•åœºæ™¯,é»˜è®¤ä¸ºon</span>
</span></span><span style=display:flex><span>events <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  worker_connections Â 65536; Â #è®¾ç½®å•ä¸ªå·¥ä½œè¿›ç¨‹çš„æœ€å¤§å¹¶å‘è¿æ¥æ•°
</span></span><span style=display:flex><span> Â  use epoll; <span style=color:#75715e>#ä½¿ç”¨epolläº‹ä»¶é©±åŠ¨ï¼ŒNginxæ”¯æŒä¼—å¤šçš„äº‹ä»¶é©±åŠ¨ï¼Œæ¯”å¦‚:selectã€pollã€epollï¼Œåªèƒ½è®¾ç½®åœ¨eventsæ¨¡å—ä¸­è®¾ç½®ã€‚</span>
</span></span><span style=display:flex><span> Â  accept_mutex on; <span style=color:#75715e>#onä¸ºåŒä¸€æ—¶åˆ»ä¸€ä¸ªè¯·æ±‚è½®æµç”±workè¿›ç¨‹å¤„ç†,è€Œé˜²æ­¢è¢«åŒæ—¶å”¤é†’æ‰€æœ‰worker,é¿å…å¤šä¸ªç¡çœ è¿›ç¨‹è¢«å”¤é†’çš„è®¾ç½®ï¼Œé»˜è®¤ä¸ºoffï¼Œæ–°è¯·æ±‚ä¼šå”¤é†’æ‰€æœ‰workerè¿›ç¨‹,æ­¤è¿‡ç¨‹ä¹Ÿç§°ä¸º&#34;æƒŠç¾¤&#34;ï¼Œå› æ­¤nginxåˆšå®‰è£…å®Œä»¥åè¦è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ã€‚å»ºè®®è®¾ç½®ä¸ºon</span>
</span></span><span style=display:flex><span> Â  multi_accept on; <span style=color:#75715e>#onæ—¶NginxæœåŠ¡å™¨çš„æ¯ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—å¤šä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ­¤æŒ‡ä»¤é»˜è®¤ä¸ºoffï¼Œå³é»˜è®¤ä¸ºä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½ä¸€æ¬¡æ¥å—ä¸€ä¸ªæ–°çš„ç½‘ç»œè¿æ¥ï¼Œæ‰“å¼€åå‡ ä¸ªåŒæ—¶æ¥å—å¤šä¸ªã€‚å»ºè®®è®¾ç½®ä¸ºon</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå®ç°nginxçš„é«˜å¹¶å‘é…ç½®</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf<span style=color:#f92672>]</span><span style=color:#75715e># ulimit -n </span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf/nginx.conf | grep rlimit</span>
</span></span><span style=display:flex><span>worker_rlimit_nofile 100;
</span></span><span style=display:flex><span><span style=color:#75715e>#é»˜è®¤é…ç½®ä¸æ”¯æŒé«˜å¹¶å‘ï¼Œå½“worker_rlimit_nofileè®¾ç½®çš„å€¼å¤§äºulimit -nçš„å€¼,ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯æ—¥å¿—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf<span style=color:#f92672>]</span><span style=color:#75715e># ab -c 5000 -n 10000 http://127.0.0.1/</span>
</span></span><span style=display:flex><span>This is ApacheBench, Version 2.3 &lt;$Revision: <span style=color:#ae81ff>1430300</span> $&gt;
</span></span><span style=display:flex><span>Copyright <span style=color:#ae81ff>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
</span></span><span style=display:flex><span>Licensed to The Apache Software Foundation, http://www.apache.org/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Benchmarking 127.0.0.1 <span style=color:#f92672>(</span>be patient<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>socket: Too many open files <span style=color:#f92672>(</span>24<span style=color:#f92672>)</span>     <span style=color:#75715e>#æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦è¿‡å¤š</span>
</span></span></code></pre></div><h1 id=http-é…ç½®å—>http é…ç½®å—<a hidden class=anchor aria-hidden=true href=#http-é…ç½®å—>#</a></h1><p>http åè®®ç›¸å…³çš„é…ç½®ç»“æ„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	...
</span></span><span style=display:flex><span> 	... Â 
</span></span><span style=display:flex><span> 	server <span style=color:#f92672>{</span> Â  Â #æ¯ä¸ªserverç”¨äºå®šä¹‰ä¸€ä¸ªè™šæ‹Ÿä¸»æœº,ç¬¬ä¸€ä¸ªserverä¸ºé»˜è®¤è™šæ‹ŸæœåŠ¡å™¨
</span></span><span style=display:flex><span> 		...
</span></span><span style=display:flex><span>	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> 	server <span style=color:#f92672>{</span> Â  Â  
</span></span><span style=display:flex><span> 		...
</span></span><span style=display:flex><span> 		server_name Â  <span style=color:#75715e>#è™šæ‹Ÿä¸»æœºå</span>
</span></span><span style=display:flex><span>        root Â  Â  <span style=color:#75715e>#ä¸»ç›®å½•</span>
</span></span><span style=display:flex><span>        alias Â  Â  <span style=color:#75715e>#è·¯å¾„åˆ«å</span>
</span></span><span style=display:flex><span>        location <span style=color:#f92672>[</span>OPERATOR<span style=color:#f92672>]</span> URL <span style=color:#f92672>{</span> Â  Â  <span style=color:#75715e>#æŒ‡å®šURLçš„ç‰¹æ€§</span>
</span></span><span style=display:flex><span>         	...
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> CONDITION <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ...
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> 		<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> 	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>http åè®®é…ç½®è¯´æ˜</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>http <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  include Â  Â  Â  mime.types; <span style=color:#75715e>#å¯¼å…¥æ”¯æŒçš„æ–‡ä»¶ç±»å‹,æ˜¯ç›¸å¯¹äº/apps/nginx/confç›®å½•</span>
</span></span><span style=display:flex><span> Â  default_type  application/octet-stream; <span style=color:#75715e>#é™¤mime.typesä¸­æ–‡ä»¶ç±»å‹å¤–,è®¾ç½®å…¶å®ƒæ–‡ä»¶é»˜è®¤ç±»å‹ï¼Œè®¿é—®å…¶å®ƒç±»å‹æ—¶ä¼šæç¤ºä¸‹è½½ä¸åŒ¹é…çš„ç±»å‹æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#æ—¥å¿—é…ç½®éƒ¨åˆ†</span>
</span></span><span style=display:flex><span> Â  Â #log_format main  <span style=color:#e6db74>&#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  Â  Â  Â  Â  Â  <span style=color:#e6db74>&#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  Â  Â  Â  Â  Â  <span style=color:#e6db74>&#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span>;
</span></span><span style=display:flex><span> Â  Â #access_log logs/access.log main;
</span></span><span style=display:flex><span><span style=color:#75715e>#è‡ªå®šä¹‰ä¼˜åŒ–å‚æ•°</span>
</span></span><span style=display:flex><span> Â  	sendfile Â  Â  Â  on; 
</span></span><span style=display:flex><span> Â  Â #tcp_nopush Â  Â on; <span style=color:#75715e>#åœ¨å¼€å¯äº†sendfileçš„æƒ…å†µä¸‹ï¼Œåˆå¹¶è¯·æ±‚åç»Ÿä¸€å‘é€ç»™å®¢æˆ·ç«¯,å¿…é¡»å¼€å¯sendfile</span>
</span></span><span style=display:flex><span> Â  Â #tcp_nodelay Â  off; <span style=color:#75715e>#åœ¨å¼€å¯äº†keepalivedæ¨¡å¼ä¸‹çš„è¿æ¥æ˜¯å¦å¯ç”¨TCP_NODELAYé€‰é¡¹ï¼Œå½“ä¸ºoffæ—¶ï¼Œå»¶è¿Ÿ0.2så‘é€ï¼Œé»˜è®¤Onæ—¶ï¼Œä¸å»¶è¿Ÿå‘é€ï¼Œç«‹å³å‘é€ç”¨æˆ·å“åº”æŠ¥æ–‡ã€‚</span>
</span></span><span style=display:flex><span> Â  Â #keepalive_timeout 0;
</span></span><span style=display:flex><span> Â 	keepalive_timeout Â 65 66; <span style=color:#75715e>#è®¾ç½®ä¼šè¯ä¿æŒæ—¶é—´,ç¬¬äºŒä¸ªå€¼ä¸ºå“åº”é¦–éƒ¨:keep-Alived:timeout=65,å¯ä»¥å’Œç¬¬ä¸€ä¸ªå€¼ä¸åŒ</span>
</span></span><span style=display:flex><span> Â  Â #gzip on; <span style=color:#75715e>#å¼€å¯æ–‡ä»¶å‹ç¼©</span>
</span></span><span style=display:flex><span> Â  Â server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  Â 	listen Â  Â  Â  80; <span style=color:#75715e>#è®¾ç½®ç›‘å¬åœ°å€å’Œç«¯å£</span>
</span></span><span style=display:flex><span> Â  Â  Â  	server_name localhost; <span style=color:#75715e>#è®¾ç½®server nameï¼Œå¯ä»¥ä»¥ç©ºæ ¼éš”å¼€å†™å¤šä¸ªå¹¶æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¦‚:*.magedu.com www.magedu.* ~^www\d+\.magedu\.com$ default_server </span>
</span></span><span style=display:flex><span> Â  Â  Â  	<span style=color:#75715e>#charset koi8-r; #è®¾ç½®ç¼–ç æ ¼å¼ï¼Œé»˜è®¤æ˜¯ä¿„è¯­æ ¼å¼ï¼Œå»ºè®®æ”¹ä¸ºutf-8</span>
</span></span><span style=display:flex><span> Â  Â  Â  	<span style=color:#75715e>#access_log logs/host.access.log main;</span>
</span></span><span style=display:flex><span> Â  Â  Â   location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â  Â  root Â  html;
</span></span><span style=display:flex><span> Â  Â  Â  Â  Â  index index.html index.htm;
</span></span><span style=display:flex><span> Â  Â  Â   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â #error_page <span style=color:#ae81ff>404</span> Â  Â  Â  Â  Â  Â  /404.html;
</span></span><span style=display:flex><span> Â  Â  Â  Â # redirect server error pages to the static page /50x.html
</span></span><span style=display:flex><span> Â  Â  Â  Â #
</span></span><span style=display:flex><span> Â  Â  Â   error_page Â  <span style=color:#ae81ff>500</span> <span style=color:#ae81ff>502</span> <span style=color:#ae81ff>503</span> <span style=color:#ae81ff>504</span> /50x.html; <span style=color:#75715e>#å®šä¹‰é”™è¯¯é¡µé¢</span>
</span></span><span style=display:flex><span> Â  Â  Â   location <span style=color:#f92672>=</span> /50x.html <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â  Â  root Â  html;
</span></span><span style=display:flex><span> Â  Â  Â   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # proxy the PHP scripts to Apache listening on 127.0.0.1:80
</span></span><span style=display:flex><span> Â  Â  Â  Â #
</span></span><span style=display:flex><span> Â  Â  Â  Â #location ~ <span style=color:#ae81ff>\.</span>php$ <span style=color:#f92672>{</span> <span style=color:#75715e>#ä»¥httpçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°æŒ‡å®šwebæœåŠ¡å™¨</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  proxy_pass Â  http://127.0.0.1;
</span></span><span style=display:flex><span> Â  Â  Â  Â #<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
</span></span><span style=display:flex><span> Â  Â  Â  Â #
</span></span><span style=display:flex><span> Â  Â  Â  Â #location ~ <span style=color:#ae81ff>\.</span>php$ <span style=color:#f92672>{</span> <span style=color:#75715e>#ä»¥fastcgiçš„æ–¹å¼è½¬å‘phpè¯·æ±‚åˆ°phpå¤„ç†</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  root Â  Â  Â  Â  Â  html;
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  fastcgi_pass Â  127.0.0.1:9000;
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  fastcgi_index index.php;
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name;
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  include Â  Â  Â  fastcgi_params;
</span></span><span style=display:flex><span> Â  Â  Â  Â #<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # deny access to .htaccess files, <span style=color:#66d9ef>if</span> Apache<span style=color:#e6db74>&#39;s document root
</span></span></span><span style=display:flex><span><span style=color:#e6db74> Â  Â  Â  Â # concurs with nginx&#39;</span>s one
</span></span><span style=display:flex><span> Â  Â  Â  Â #
</span></span><span style=display:flex><span> Â  Â  Â  Â #location ~ /<span style=color:#ae81ff>\.</span>ht <span style=color:#f92672>{</span> <span style=color:#75715e>#æ‹’ç»webå½¢å¼è®¿é—®æŒ‡å®šæ–‡ä»¶ï¼Œå¦‚å¾ˆå¤šçš„ç½‘ç«™éƒ½æ˜¯é€šè¿‡.htaccessæ–‡ä»¶æ¥æ”¹å˜è‡ªå·±çš„é‡å®šå‘ç­‰åŠŸèƒ½ã€‚</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â # Â  deny all;
</span></span><span style=display:flex><span> Â  Â  Â  Â #<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â  Â  location ~ /passwd.html <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  Â  Â  Â  Â  deny all;
</span></span><span style=display:flex><span> Â  Â  Â  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â # another virtual host using mix of IP-, name-, and port-based configuration
</span></span><span style=display:flex><span> Â  Â #
</span></span><span style=display:flex><span> Â  Â #server <span style=color:#f92672>{</span> <span style=color:#75715e>#è‡ªå®šä¹‰è™šæ‹Ÿserver</span>
</span></span><span style=display:flex><span> Â  Â # Â  listen Â  Â  Â  8000;
</span></span><span style=display:flex><span> Â  Â # Â  listen Â  Â  Â  somename:8080;
</span></span><span style=display:flex><span> Â  Â # Â  server_name somename alias another.alias;
</span></span><span style=display:flex><span> Â  Â # Â  location / <span style=color:#f92672>{</span> 
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  root Â  html;
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  index index.html index.htm; <span style=color:#75715e>#æŒ‡å®šé»˜è®¤ç½‘é¡µæ–‡ä»¶ï¼Œæ­¤æŒ‡ä»¤ç”±ngx_http_index_moduleæ¨¡å—æä¾›</span>
</span></span><span style=display:flex><span> Â  Â # Â  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â #<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â # HTTPS server
</span></span><span style=display:flex><span> Â  Â #
</span></span><span style=display:flex><span> Â  Â #server <span style=color:#f92672>{</span> <span style=color:#75715e>#httpsæœåŠ¡å™¨é…ç½®</span>
</span></span><span style=display:flex><span> Â  Â # Â  listen Â  Â  Â  <span style=color:#ae81ff>443</span> ssl;
</span></span><span style=display:flex><span> Â  Â # Â  server_name localhost;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_certificate Â  Â  cert.pem;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_certificate_key cert.key;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_session_cache Â  shared:SSL:1m;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_session_timeout 5m;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_ciphers HIGH:!aNULL:!MD5;
</span></span><span style=display:flex><span> Â  Â # Â  ssl_prefer_server_ciphers on;
</span></span><span style=display:flex><span> Â  Â # Â  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  root Â  html;
</span></span><span style=display:flex><span> Â  Â # Â  Â  Â  index index.html index.htm;
</span></span><span style=display:flex><span> Â  Â # Â  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span> Â  Â #<span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=mime>MIME<a hidden class=anchor aria-hidden=true href=#mime>#</a></h3><p>MIMEå‚è€ƒæ–‡æ¡£ï¼š
<a href=https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types>https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_Types</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#åœ¨å“åº”æŠ¥æ–‡ä¸­å°†æŒ‡å®šçš„æ–‡ä»¶æ‰©å±•åæ˜ å°„è‡³MIMEå¯¹åº”çš„ç±»å‹</span>
</span></span><span style=display:flex><span>include Â  Â  Â  Â  Â mime.types;
</span></span><span style=display:flex><span>default_type Â  Â  application/octet-stream;<span style=color:#75715e>#é™¤mime.typesä¸­çš„ç±»å‹å¤–ï¼ŒæŒ‡å®šå…¶å®ƒæ–‡ä»¶çš„é»˜è®¤MIMEç±»å‹ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šæç¤ºä¸‹è½½</span>
</span></span><span style=display:flex><span>types <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>	text/html html;
</span></span><span style=display:flex><span> Â   image/gif gif;
</span></span><span style=display:flex><span> Â   image/jpeg jpg;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#æœªå®šä¹‰mime.typesç±»å‹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># ll html/mime.types</span>
</span></span><span style=display:flex><span>ls: cannot access html/mime.types: No such file or directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost/test.php -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Thu, <span style=color:#ae81ff>28</span> Jul <span style=color:#ae81ff>2022</span> 11:23:54 GMT
</span></span><span style=display:flex><span>Content-Type: application/octet-stream  <span style=color:#75715e>#mimeæœªå®šä¹‰çš„ç±»å‹é»˜è®¤è§†ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶å¤„ç†ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨è®¿é—®ï¼Œåˆ™ä¼šä¸‹è½½test.phpæ–‡ä»¶ï¼‰</span>
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Last-Modified: Thu, <span style=color:#ae81ff>28</span> Jul <span style=color:#ae81ff>2022</span> 11:19:48 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>  <span style=color:#75715e>#é•¿è¿æ¥æ˜¾ç¤ºçš„æ—¶é•¿ï¼Œç”±keepalive_timeout Â 65 66; é…ç½®</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e270d4-14&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ä¿®æ”¹é»˜è®¤æ–‡ä»¶ç±»å‹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># cat conf/nginx.conf | grep default_type</span>
</span></span><span style=display:flex><span>    default_type  text/html;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># curl localhost/test.php -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Thu, <span style=color:#ae81ff>28</span> Jul <span style=color:#ae81ff>2022</span> 11:32:15 GMT
</span></span><span style=display:flex><span>Content-Type: text/html     <span style=color:#75715e>#å°†test.phpè¯†åˆ«ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨è®¿é—®ï¼Œç›´æ¥æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ï¼‰</span>
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Last-Modified: Thu, <span style=color:#ae81ff>28</span> Jul <span style=color:#ae81ff>2022</span> 11:19:48 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e270d4-14&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span></code></pre></div><h3 id=æŒ‡å®šå“åº”æŠ¥æ–‡>æŒ‡å®šå“åº”æŠ¥æ–‡<a hidden class=anchor aria-hidden=true href=#æŒ‡å®šå“åº”æŠ¥æ–‡>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡ä¸­çš„Content-Typeæ˜¾ç¤ºæŒ‡å®šçš„å­—ç¬¦é›†ï¼Œé»˜è®¤offä¸æ˜¾ç¤º</span>
</span></span><span style=display:flex><span>charset charset | off;
</span></span><span style=display:flex><span><span style=color:#75715e>#ç¤ºä¾‹</span>
</span></span><span style=display:flex><span>charset utf-8;
</span></span><span style=display:flex><span><span style=color:#75715e>#æ˜¯å¦åœ¨å“åº”æŠ¥æ–‡çš„Serveré¦–éƒ¨æ˜¾ç¤ºnginxç‰ˆæœ¬</span>
</span></span><span style=display:flex><span>server_tokens on | off | build | string;
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šæºç ä¿®æ”¹serverå­—æ®µ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#å¦‚æœæƒ³è‡ªå®šä¹‰å“åº”æŠ¥æ–‡çš„nginxç‰ˆæœ¬ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹æºç æ–‡ä»¶ï¼Œé‡æ–°ç¼–è¯‘</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å¦‚æœserver_tokens onï¼Œä¿®æ”¹ src/core/nginx.h ä¿®æ”¹ç¬¬13-14è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define NGINX_VERSION Â  Â  &#34;1.68.9&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#define NGINX_VER Â  Â  Â  Â  &#34;mynginx/&#34; NGINX_VERSION</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å¦‚æœserver_tokens offï¼Œä¿®æ”¹ src/http/ngx_http_header_filter_module.c ç¬¬49è¡Œï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š</span>
</span></span><span style=display:flex><span>static char ngx_http_server_string<span style=color:#f92672>[]</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Server: nginx&#34;</span> CRLF;
</span></span><span style=display:flex><span><span style=color:#75715e>#æŠŠå…¶ä¸­çš„nginxæ”¹ä¸ºè‡ªå·±æƒ³è¦çš„æ–‡å­—å³å¯,å¦‚ï¼šmynginx</span>
</span></span></code></pre></div><h1 id=æ ¸å¿ƒé…ç½®ç¤ºä¾‹>æ ¸å¿ƒé…ç½®ç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#æ ¸å¿ƒé…ç½®ç¤ºä¾‹>#</a></h1><h3 id=è™šæ‹Ÿä¸»æœºçš„å®ç°>è™šæ‹Ÿä¸»æœºçš„å®ç°<a hidden class=anchor aria-hidden=true href=#è™šæ‹Ÿä¸»æœºçš„å®ç°>#</a></h3><p>åŸºäºä¸åŒçš„IPã€ä¸åŒçš„ç«¯å£ä»¥åŠä¸ç”¨åŸŸåå®ç°ä¸åŒçš„è™šæ‹Ÿä¸»æœºï¼Œä¾èµ–äºæ ¸å¿ƒæ¨¡å—ngx_http_core_moduleå®ç°ã€‚</p><h4 id=æ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº>æ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº<a hidden class=anchor aria-hidden=true href=#æ–°å»ºä¸¤ä¸ªè™šæ‹Ÿä¸»æœº>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># æ·»åŠ åŸŸåè§£æ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat /etc/hosts |grep test</span>
</span></span><span style=display:flex><span>172.16.16.88   pc.test.org  mobile.test.org
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## å¼€å§‹æ–°å»ºè™šæ‹Ÿä¸»æœº</span>
</span></span><span style=display:flex><span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># mkdir /apps/nginx/conf/conf.d</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost nginx<span style=color:#f92672>]</span><span style=color:#75715e># cd /apps/nginx/conf/conf.d/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># vim /apps/nginx/conf/nginx.conf</span>
</span></span><span style=display:flex><span>   ......
</span></span><span style=display:flex><span>   include /apps/nginx/conf.d/*.conf; <span style=color:#75715e>#åœ¨é…ç½®æ–‡ä»¶çš„æœ€åé¢æ·»åŠ æ­¤è¡Œ,æ³¨æ„ä¸è¦æ”¾åœ¨æœ€å‰é¢,ä¼šå¯¼è‡´å‰é¢çš„é…ç½®æ— æ³•ç”Ÿæ•ˆï¼ˆæ–‡ä»¶é…ç½®ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡ç”Ÿæ•ˆï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># mkdir /apps/nginx/html/pc</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># echo pc_page &gt; /apps/nginx/html/pc/index.html</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org   #è™šæ‹Ÿä¸»æœºpc</span>
</span></span><span style=display:flex><span>pc_page
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat mobile.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name mobile.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/mobile;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># mkdir /apps/nginx/html/mobile  #è™šæ‹Ÿä¸»æœºmobile</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># echo mobile_page &gt; /apps/nginx/html/mobile/index.html</span>
</span></span><span style=display:flex><span>mobile_page
</span></span></code></pre></div><h4 id=root-ä¸-alias-çš„åŒºåˆ«>root ä¸ alias çš„åŒºåˆ«<a hidden class=anchor aria-hidden=true href=#root-ä¸-alias-çš„åŒºåˆ«>#</a></h4><p>rootï¼šæŒ‡å®šwebçš„å®¶ç›®å½•ï¼Œåœ¨å®šä¹‰locationçš„æ—¶å€™ï¼Œæ–‡ä»¶çš„ç»å¯¹è·¯å¾„ç­‰äº root+location</p><p>èŒƒä¾‹:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  location /about <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root /opt/html;   <span style=color:#75715e>#å®é™…è·¯å¾„ä¸º/opt/html/about/index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># ll /opt/html/about/</span>
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>11</span> Jul <span style=color:#ae81ff>28</span> 23:24 index.html
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat /opt/html/about/index.html </span>
</span></span><span style=display:flex><span>about_page
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/about/</span>
</span></span><span style=display:flex><span>about_page
</span></span></code></pre></div><p>aliasï¼šå®šä¹‰è·¯å¾„åˆ«åï¼Œä¼šæŠŠè®¿é—®çš„è·¯å¾„é‡æ–°å®šä¹‰åˆ°å…¶æŒ‡å®šçš„è·¯å¾„,æ–‡æ¡£æ˜ å°„çš„å¦ä¸€ç§æœºåˆ¶;ä»…èƒ½ç”¨äºlocationä¸Šä¸‹æ–‡,æ­¤æŒ‡ä»¤ä½¿ç”¨è¾ƒå°‘</p><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  location /about <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>     alias /opt/html;  <span style=color:#75715e>#å®é™…è·¯å¾„ä¸º/opt/html/index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># cat /opt/html/index.html </span>
</span></span><span style=display:flex><span>about_page
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost conf.d<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/about/</span>
</span></span><span style=display:flex><span>about_page
</span></span></code></pre></div><h3 id=localtion-çš„åŒ¹é…è§„åˆ™>localtion çš„åŒ¹é…è§„åˆ™<a hidden class=anchor aria-hidden=true href=#localtion-çš„åŒ¹é…è§„åˆ™>#</a></h3><p>åœ¨ä¸€ä¸ªserverä¸­locationé…ç½®æ®µå¯å­˜åœ¨å¤šä¸ªï¼Œç”¨äºå®ç°ä»uriåˆ°æ–‡ä»¶ç³»ç»Ÿçš„è·¯å¾„æ˜ å°„ï¼›ngnixä¼šæ ¹æ®ç”¨æˆ·è¯·</p><p>æ±‚çš„URIæ¥æ£€æŸ¥å®šä¹‰çš„æ‰€æœ‰locationï¼ŒæŒ‰ä¸€å®šçš„ä¼˜å…ˆçº§æ‰¾å‡ºä¸€ä¸ªæœ€ä½³åŒ¹é…ï¼Œè€Œåè¿›è¡Œå¤„ç†ã€‚</p><p>location å®˜æ–¹å¸®åŠ©: <a href=http://nginx.org/en/docs/http/ngx_http_core_module.html#location>http://nginx.org/en/docs/http/ngx_http_core_module.html#location</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#è¯­æ³•è§„åˆ™ï¼š</span>
</span></span><span style=display:flex><span>location <span style=color:#f92672>[</span> <span style=color:#f92672>=</span> | ~ | ~* | ^~ <span style=color:#f92672>]</span> uri <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=</span> Â  <span style=color:#75715e>#ç”¨äºæ ‡å‡†uriå‰ï¼Œéœ€è¦è¯·æ±‚å­—ä¸²ä¸uriç²¾ç¡®åŒ¹é…ï¼Œå¤§å°æ•æ„Ÿ,å¦‚æœåŒ¹é…æˆåŠŸå°±åœæ­¢å‘ä¸‹åŒ¹é…å¹¶ç«‹å³å¤„ç†è¯·æ±‚</span>
</span></span><span style=display:flex><span>^~ Â #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒ¹é…ä»¥æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼å¼€å¤´,å¯¹URIçš„æœ€å·¦è¾¹éƒ¨åˆ†åšåŒ¹é…æ£€æŸ¥ï¼Œä¸åŒºåˆ†å­—ç¬¦å¤§å°å†™
</span></span><span style=display:flex><span>~ Â  <span style=color:#75715e>#ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”åŒºåˆ†å¤§å°å†™</span>
</span></span><span style=display:flex><span>~* Â #ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼,å¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™
</span></span><span style=display:flex><span>ä¸å¸¦ç¬¦å· <span style=color:#75715e>#åŒ¹é…èµ·å§‹äºæ­¤uriçš„æ‰€æœ‰çš„uri</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>\ </span>Â  <span style=color:#75715e>#ç”¨äºæ ‡å‡†uriå‰ï¼Œè¡¨ç¤ºåŒ…å«æ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸”è½¬ä¹‰å­—ç¬¦ã€‚å¯ä»¥å°† . * ?ç­‰è½¬ä¹‰ä¸ºæ™®é€šç¬¦å·</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#åŒ¹é…ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š</span>
</span></span><span style=display:flex><span><span style=color:#f92672>=</span>, ^~, ~/~*, ä¸å¸¦ç¬¦å·
</span></span></code></pre></div><p>å®˜æ–¹èŒƒä¾‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>location = / {
</span></span><span style=display:flex><span> Â  [ configuration A ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>location / {
</span></span><span style=display:flex><span> Â  [ configuration B ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>location /documents/ {
</span></span><span style=display:flex><span> Â  [ configuration C ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>location ^~ /images/ {
</span></span><span style=display:flex><span> Â  [ configuration D ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>location ~* \.(gif|jpg|jpeg)$ {
</span></span><span style=display:flex><span> Â  [ configuration E ]
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>The â€œ/â€ request will match configuration A(?), the â€œ/index.htmlâ€ request will 
</span></span><span style=display:flex><span>match configuration B,
</span></span><span style=display:flex><span>the â€œ/documents/document.htmlâ€ request will match configuration C, the 
</span></span><span style=display:flex><span>â€œ/images/1.gifâ€ request will match configuration D, and the â€œ/documents/1.jpgâ€ 
</span></span><span style=display:flex><span>request will match configuration E.
</span></span></code></pre></div><h3 id=åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é…>åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é…<a hidden class=anchor aria-hidden=true href=#åŒ¹é…æ¡ˆä¾‹-ç²¾ç¡®åŒ¹é…>#</a></h3><p>åœ¨serveréƒ¨åˆ†ä½¿ç”¨locationé…ç½®ä¸€ä¸ªwebç•Œé¢ï¼Œä¾‹å¦‚ï¼šå½“è®¿é—®nginxæœåŠ¡å™¨çš„/logo.jpgçš„æ—¶å€™è¦æ˜¾ç¤ºæŒ‡å®šhtmlæ–‡ä»¶çš„å†…å®¹</p><p>ç²¾ç¡®åŒ¹é…ä¸€èˆ¬ç”¨äºåŒ¹é…ç½‘ç«™logoç­‰ç›¸å¯¹å›ºå®šçš„URL</p><p>èŒƒä¾‹ï¼šç²¾ç¡®åŒ¹é…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  location /logo.jpg <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>     root html/images;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># ll /apps/nginx/html/images/logo.jpg </span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>13110</span> Jul <span style=color:#ae81ff>29</span> 15:11 /apps/nginx/html/images/logo.jpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®æˆåŠŸ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/logo.jpg -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 15:17:35 GMT
</span></span><span style=display:flex><span>Content-Type: image/jpeg
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>13110</span>
</span></span><span style=display:flex><span>Last-Modified: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 07:11:49 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e38835-3336&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span></code></pre></div><h3 id=åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™>åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™<a hidden class=anchor aria-hidden=true href=#åŒ¹é…æ¡ˆä¾‹-åŒºåˆ†å¤§å°å†™>#</a></h3><p>~ å®ç°åŒºåˆ†å¤§å°å†™çš„æ¨¡ç³ŠåŒ¹é…</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  location ~ /A.?<span style=color:#ae81ff>\.</span>jpg <span style=color:#f92672>{</span>   <span style=color:#75715e>#åŒ¹é…å­—æ¯Aå¼€å¤´çš„jpgå›¾ç‰‡ï¼Œåé¢?è¡¨ç¤ºAåé¢é›¶æ¬¡æˆ–ä¸€ä¸ªå­—ç¬¦</span>
</span></span><span style=display:flex><span>     root html/images;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ç¡®ä¿èµ„æºå­˜åœ¨</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># ll /apps/nginx/html/images/A.jpg </span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>13110</span> Jul <span style=color:#ae81ff>29</span> 15:11 /apps/nginx/html/images/A.jpg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ä»¥å¤§å†™URIè®¿é—®æˆåŠŸ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># curl -I pc.test.org/A.jpg</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 15:27:52 GMT
</span></span><span style=display:flex><span>Content-Type: image/jpeg
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>13110</span>
</span></span><span style=display:flex><span>Last-Modified: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 07:11:49 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e38835-3336&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ä»¥å°å†™URIè®¿é—®å¤±è´¥</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># curl -I pc.test.org/a.jpg</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>404</span> Not Found
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 15:27:55 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>153</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span></code></pre></div><h3 id=åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™>åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™<a hidden class=anchor aria-hidden=true href=#åŒ¹é…æ¡ˆä¾‹-ä¸åŒºåˆ†å¤§å°å†™>#</a></h3><p>~* ç”¨æ¥å¯¹ç”¨æˆ·è¯·æ±‚çš„uriåšæ¨¡ç³ŠåŒ¹é…ã€‚</p><p>æ³¨æ„ï¼šå°½ç®¡åŒ¹é…æ—¶ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†å®é™…è¯·æ±‚æ˜¯ä»ä¼šä»¥ç”¨æˆ·è¯·æ±‚çš„uriå»å¯»æ‰¾ç›¸åº”çš„ç£ç›˜æ–‡ä»¶ï¼Œå¦‚ç”¨æˆ·è®¿é—®uriä¸º/A.jpgï¼Œåœ¨locationæ¡ä»¶é€šè¿‡åå°±åœ¨å¯¹åº”è·¯å¾„ä¸‹å¯»æ‰¾ç£ç›˜ä¸­çš„A.jpgæ–‡ä»¶ï¼Œå¦‚æœç£ç›˜ä¸Šæ˜¯a.jpgï¼Œåˆ™è¯·æ±‚æ˜¯å¤±è´¥çš„ï¼ˆåœ¨windowç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åä¸åŒºåˆ†å¤§å°å†™ï¼Œè¯¥è¯·æ±‚ä¼šæˆåŠŸâ€”â€”å—æ–‡ä»¶ç³»ç»Ÿå½±å“ï¼‰ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/pc;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  location ~* /A.?<span style=color:#ae81ff>\.</span>jpg <span style=color:#f92672>{</span>  <span style=color:#75715e>#åŒ¹é…è§„åˆ™ä¸åŒºåˆ†å¤§å°å†™</span>
</span></span><span style=display:flex><span>     root html/images;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># ll /apps/nginx/html/images/a.jpg  #ç£ç›˜ä¸­ä»…å­˜åœ¨a.jpgæ–‡ä»¶</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>13110</span> Jul <span style=color:#ae81ff>29</span> 15:11 /apps/nginx/html/images/a.jpg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®/a.jpgæˆåŠŸ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># curl -I pc.test.org/a.jpg</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 15:41:25 GMT
</span></span><span style=display:flex><span>Content-Type: image/jpeg
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>13110</span>
</span></span><span style=display:flex><span>Last-Modified: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 07:11:49 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e38835-3336&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®/A.jpgå¤±è´¥ã€‚locationåŒ¹é…æˆåŠŸï¼Œä½†ç£ç›˜ä¸Šå¹¶æ— A.jpgæ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost images<span style=color:#f92672>]</span><span style=color:#75715e># curl -I pc.test.org/A.jpg</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>404</span> Not Found
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 15:41:48 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>153</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span></code></pre></div><h3 id=nginx-å››å±‚è®¿é—®æ§åˆ¶>nginx å››å±‚è®¿é—®æ§åˆ¶<a hidden class=anchor aria-hidden=true href=#nginx-å››å±‚è®¿é—®æ§åˆ¶>#</a></h3><p>è®¿é—®æ§åˆ¶åŸºäºæ¨¡å—ngx_http_access_moduleå®ç°ï¼Œå¯ä»¥é€šè¿‡åŒ¹é…å®¢æˆ·ç«¯æºIPåœ°å€è¿›è¡Œé™åˆ¶</p><p>æ³¨æ„: å¦‚æœèƒ½åœ¨é˜²ç«å¢™è®¾å¤‡æ§åˆ¶, æœ€å¥½å°±ä¸è¦åœ¨nginxä¸Šé…ç½®,å¯ä»¥æ›´å¥½çš„èŠ‚çº¦èµ„æº</p><p>å®˜æ–¹å¸®åŠ©: <a href=http://nginx.org/en/docs/http/ngx_http_access_module.html>http://nginx.org/en/docs/http/ngx_http_access_module.html</a></p><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>## åŒ¹é…æ—¶æŒ‰ä»ä¸Šè‡³ä¸‹çš„è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…åˆ°ç›¸åº”è§„åˆ™å³åœæ­¢â€”â€”â€”ä¸é˜²ç«å¢™çš„åŒ¹é…è§„åˆ™ç±»ä¼¼</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å¦‚ï¼šæœ‰å®¢æˆ·ç«¯ï¼ˆIPï¼š10.1.1.0ï¼‰è®¿é—®é…ç½®äº†ä»¥ä¸‹è§„åˆ™çš„webæœåŠ¡å™¨æ—¶(è®¿é—®URI:/about)ï¼Œè§¦å‘location /aboutè¯­å¥å—ï¼ŒåŒ¹é…åˆ°allow 10.1.1.0/16ï¼Œè®¿é—®æ§åˆ¶ç”Ÿæ•ˆï¼Œè®¿é—®æˆåŠŸã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>location <span style=color:#f92672>=</span> /login/ <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  root /data/nginx/html/pc;
</span></span><span style=display:flex><span> Â  allow 10.0.0.0/24;
</span></span><span style=display:flex><span> Â  deny all;
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>location /about <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  alias /data/nginx/html/pc;
</span></span><span style=display:flex><span> Â  index index.html;
</span></span><span style=display:flex><span> Â  deny Â 192.168.1.1;
</span></span><span style=display:flex><span> Â  allow 192.168.1.0/24;
</span></span><span style=display:flex><span> Â  allow 10.1.1.0/16;
</span></span><span style=display:flex><span> Â  allow 2001:0db8::/32;
</span></span><span style=display:flex><span> Â  deny all; Â #æŒ‰å…ˆå°èŒƒå›´åˆ°å¤§èŒƒå›´æ’åº
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=nginx-è´¦æˆ·è®¤è¯åŠŸèƒ½>nginx è´¦æˆ·è®¤è¯åŠŸèƒ½<a hidden class=anchor aria-hidden=true href=#nginx-è´¦æˆ·è®¤è¯åŠŸèƒ½>#</a></h3><p>ç”± ngx_http_auth_basic_module æ¨¡å—æä¾›æ­¤åŠŸèƒ½</p><p>å®˜æ–¹å¸®åŠ©ï¼šhttp://nginx.org/en/docs/http/ngx_http_auth_basic_module.html</p><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#CentOSå®‰è£…åŒ…</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@centos8 ~<span style=color:#f92672>]</span><span style=color:#75715e>#yum -y install httpd-tools</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Ubuntuå®‰è£…åŒ…</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@Ubuntu ~<span style=color:#f92672>]</span><span style=color:#75715e>#apt -y install apache2-utils</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#åˆ›å»ºç”¨æˆ·</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#-b éäº¤äº’å¼æ–¹å¼æäº¤å¯†ç </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#-c é‡æ–°ç”Ÿæˆæ–‡ä»¶ï¼Œè¦†ç›–å·²æœ‰æ–‡ä»¶ã€‚é¦–æ¬¡åˆ›å»ºæ—¶ä½¿ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># htpasswd -bc /apps/nginx/conf/.htpasswd user1 passwd1</span>
</span></span><span style=display:flex><span>Adding password <span style=color:#66d9ef>for</span> user user1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># htpasswd -b /apps/nginx/conf/.htpasswd user2 passwd2</span>
</span></span><span style=display:flex><span>Adding password <span style=color:#66d9ef>for</span> user user2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ç”Ÿæˆäº†å¸¦æœ‰ä¸¤ä¸ªç”¨æˆ·çš„éªŒè¯æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># tail /apps/nginx/conf/.htpasswd </span>
</span></span><span style=display:flex><span>user1:$apr1$vzRe30iJ$jF8BZbra6pI8O0JBqlmiP/
</span></span><span style=display:flex><span>user2:$apr1$i2ON7LYs$pxzkeH.xxCdgj670m5cSW/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ç½‘ç«™ç™»å½•é¡µé¢é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/index.html </span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location /login <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    alias html/;
</span></span><span style=display:flex><span>    index index.html;
</span></span><span style=display:flex><span>    auth_basic <span style=color:#e6db74>&#34;login password&#34;</span>;  <span style=color:#75715e>#æŒ‡å®šæç¤ºæ–‡æœ¬ä¿¡æ¯</span>
</span></span><span style=display:flex><span>    auth_basic_user_file /apps/nginx/conf/.htpasswd;  <span style=color:#75715e>#æŒ‡å®šä½¿ç”¨çš„éªŒè¯æ–‡ä»¶</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ç›´æ¥è®¿é—®ç™»å½•é¡µï¼Œå¤±è´¥ã€‚æœªé€šè¿‡éªŒè¯</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/login/</span>
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>&lt;head&gt;&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##åˆ†åˆ«ä½¿ç”¨ä¸¤ç§æ–¹å¼è¾“å…¥ç”¨æˆ·åå’Œå¯†ç éªŒè¯</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl http://user1:passwd1@pc.test.org/login/</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl -u user2:passwd2 pc.test.org/login/</span>
</span></span><span style=display:flex><span>hello
</span></span></code></pre></div><h3 id=è‡ªå®šä¹‰é”™è¯¯é¡µé¢>è‡ªå®šä¹‰é”™è¯¯é¡µé¢<a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰é”™è¯¯é¡µé¢>#</a></h3><p>è‡ªå®šä¹‰é”™è¯¯é¡µï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æŒ‡å®šçš„å“åº”çŠ¶æ€ç è¿›è¡Œå“åº”, å¯åœ¨å¦‚ä¸‹è¯­å¥å—é…ç½®ï¼šhttp, server, location, if in</p><p>location</p><p>æ ¼å¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>error_page code ... [=[response]] uri;
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># å‡†å¤‡ç«™ç‚¹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  error_page <span style=color:#ae81ff>404</span> <span style=color:#ae81ff>400</span>  /error.html;   <span style=color:#75715e>#è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢ï¼Œå‘ç”Ÿ404é”™è¯¯ï¼Œè¿”å›error.htmlé”™è¯¯é¡µé¢</span>
</span></span><span style=display:flex><span>  location /error.html <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å‡†å¤‡é”™è¯¯é¡µé¢</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/error.html </span>
</span></span><span style=display:flex><span>error-page
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®ä¸å­˜åœ¨çš„é¡µé¢ï¼Œè§¦å‘404æŠ¥é”™</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl -I pc.test.org/dd</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>404</span> Not Found   <span style=color:#75715e>#æŸ¥çœ‹é”™è¯¯ç </span>
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 17:02:12 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>11</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e411d9-b&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è§¦å‘404é”™è¯¯ï¼Œè¿”å›é”™è¯¯é¡µé¢ï¼ˆå¦‚æœæ˜¯æµè§ˆå™¨æµ‹è¯•ï¼Œå»ºè®®ç”¨googleï¼‰</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/dd</span>
</span></span><span style=display:flex><span>error-page
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå¦‚æœå‘ç”Ÿ404 ï¼Œå°†é”™è¯¯ç å®šä¹‰ä¸º502ï¼Œä¸”è·³è½¬åˆ°ä¸»é¡µ/index.html</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#ç«™ç‚¹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  error_page 404 <span style=color:#f92672>=</span><span style=color:#ae81ff>502</span>  /index.html;
</span></span><span style=display:flex><span>  location /index.html <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#ä¸»é¡µé…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/index.html </span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/dd/</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#éªŒè¯é”™è¯¯ç </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/dd/ -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>502</span> Bad Gateway  <span style=color:#75715e>#é”™è¯¯ç ä¸ºè‡ªå®šä¹‰çš„502</span>
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 17:31:49 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e40fa4-6&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é‡å®šå‘æˆåŠŸ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/index.html </span>
</span></span><span style=display:flex><span>hello
</span></span></code></pre></div><h3 id=è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—>è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—<a hidden class=anchor aria-hidden=true href=#è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—>#</a></h3><p>é”™è¯¯æ—¥å¿—æ ¼å¼</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Syntax: error_log file <span style=color:#f92672>[</span>level<span style=color:#f92672>]</span>;  <span style=color:#75715e>#æ ¼å¼</span>
</span></span><span style=display:flex><span>Default: 	<span style=color:#75715e>#é»˜è®¤å€¼</span>
</span></span><span style=display:flex><span>error_log logs/error.log error;  
</span></span><span style=display:flex><span>Context: main, http, mail, stream, server, location  <span style=color:#75715e>#å¯é…ç½®çš„è¯­å¥å—</span>
</span></span><span style=display:flex><span>level: debug, info, notice, warn, error, crit, alert, emerg  <span style=color:#75715e>#æ—¥å¿—è®°å½•ç­‰çº§</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#ç«™ç‚¹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  error_page <span style=color:#ae81ff>404</span> <span style=color:#ae81ff>400</span>  /error.html;
</span></span><span style=display:flex><span>  access_log /apps/nginx/logs/test-access.log;  <span style=color:#75715e>#è‡ªå®šä¹‰æ­£å¸¸è®¿é—®æ—¥å¿—</span>
</span></span><span style=display:flex><span>  error_log /apps/nginx/logs/test-error.log;   <span style=color:#75715e>#è‡ªå®šä¹‰é”™è¯¯æ—¥å¿—</span>
</span></span><span style=display:flex><span>  location /error.html <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    root html/;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å½“å‰å·²æœ‰æ—¥å¿—æ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># ls /apps/nginx/logs/</span>
</span></span><span style=display:flex><span>access.log  error.log  nginx.pid
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é‡å¯nginxåç”Ÿæˆè‡ªå®šä¹‰çš„é”™è¯¯æ—¥å¿—</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># ls /apps/nginx/logs/</span>
</span></span><span style=display:flex><span>access.log  error.log  nginx.pid  test-access.log  test-error.log
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®ç«™ç‚¹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#æ—¥å¿—æˆåŠŸè®°å½•</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># tail /apps/nginx/logs/{test-access,test-error}.log</span>
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; /apps/nginx/logs/test-access.log &lt;<span style=color:#f92672>==</span>
</span></span><span style=display:flex><span>172.16.16.88 - - <span style=color:#f92672>[</span>30/Jul/2022:01:17:55 +0800<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET / HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> <span style=color:#ae81ff>6</span> <span style=color:#e6db74>&#34;-&#34;</span> <span style=color:#e6db74>&#34;curl/7.29.0&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>==</span>&gt; /apps/nginx/logs/test-error.log &lt;<span style=color:#f92672>==</span>
</span></span></code></pre></div><h3 id=æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨>æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨<a hidden class=anchor aria-hidden=true href=#æ£€æµ‹æ–‡ä»¶æ˜¯å¦å­˜åœ¨>#</a></h3><p>try_filesä¼šæŒ‰é¡ºåºæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œè¿”å›ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ï¼ˆç»“å°¾åŠ æ–œçº¿è¡¨ç¤ºä¸ºæ–‡ä»¶å¤¹ï¼‰ï¼Œå¦‚</p><p>æœæ‰€æœ‰æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹éƒ½æ‰¾ä¸åˆ°ï¼Œä¼šè¿›è¡Œä¸€ä¸ªå†…éƒ¨é‡å®šå‘åˆ°æœ€åä¸€ä¸ªå‚æ•°ã€‚åªæœ‰æœ€åä¸€ä¸ªå‚æ•°å¯ä»¥å¼•èµ·ä¸€</p><p>ä¸ªå†…éƒ¨é‡å®šå‘ï¼Œä¹‹å‰çš„å‚æ•°åªè®¾ç½®å†…éƒ¨URIçš„æŒ‡å‘ã€‚æœ€åä¸€ä¸ªå‚æ•°æ˜¯å›é€€URIä¸”å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ä¼šå‡ºç°å†…</p><p>éƒ¨500é”™è¯¯ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Syntax: try_files file ... uri;
</span></span><span style=display:flex><span>try_files file ... <span style=color:#f92672>=</span>code;
</span></span><span style=display:flex><span>Default: â€”
</span></span><span style=display:flex><span>Context: server, location
</span></span></code></pre></div><p>èŒƒä¾‹: å¦‚æœä¸å­˜åœ¨é¡µé¢, å°±è½¬åˆ°default.htmlé¡µé¢</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#å‡†å¤‡ç«™ç‚¹é…ç½®</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      root html/;
</span></span><span style=display:flex><span>      index index.html;
</span></span><span style=display:flex><span>      try_files $uri $uri.html $uri/index.html /about/default.html;
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#å‡†å¤‡é»˜è®¤é¡µé¢</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost html<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/default.html </span>
</span></span><span style=display:flex><span>default
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¿é—®æµ‹è¯•</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/about/default.html </span>
</span></span><span style=display:flex><span>about_page
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/xx/</span>
</span></span><span style=display:flex><span>about_page
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/xx.html</span>
</span></span><span style=display:flex><span>about_page
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##è‡ªå®šä¹‰å“åº”ç </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      root html/;
</span></span><span style=display:flex><span>      index index.html;
</span></span><span style=display:flex><span>      try_files $uri $uri.html $uri/index.html <span style=color:#f92672>=</span>555;  <span style=color:#75715e>#è‡ªå®šä¹‰å“åº”ç ä¸º555</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#éªŒè¯ç»“æœ</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># curl pc.test.org/xx.html -I</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>555</span>   <span style=color:#75715e>#å“åº”ç ä¸º555</span>
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#ae81ff>01</span> Aug <span style=color:#ae81ff>2022</span> 10:00:03 GMT
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>66</span>
</span></span></code></pre></div><h3 id=é•¿è¿æ¥é…ç½®>é•¿è¿æ¥é…ç½®<a hidden class=anchor aria-hidden=true href=#é•¿è¿æ¥é…ç½®>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tex data-lang=tex><span style=display:flex><span>keepalive_timeout timeout [header_timeout]; Â #è®¾å®šä¿æŒè¿æ¥è¶…æ—¶æ—¶é•¿ï¼Œ0è¡¨ç¤ºç¦æ­¢é•¿è¿æ¥ï¼Œé»˜è®¤ä¸º75sï¼Œé€šå¸¸é…ç½®åœ¨httpå­—æ®µä½œä¸ºç«™ç‚¹å…¨å±€é…ç½®
</span></span><span style=display:flex><span>keepalive_requests number; Â #åœ¨ä¸€æ¬¡é•¿è¿æ¥ä¸Šæ‰€å…è®¸è¯·æ±‚çš„èµ„æºçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º100æ¬¡,å»ºè®®é€‚
</span></span><span style=display:flex><span>å½“è°ƒå¤§,æ¯”å¦‚:500
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#ç«™ç‚¹ä¸»é…ç½®é¡¹</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf/nginx.conf | grep keepalive</span>
</span></span><span style=display:flex><span>    keepalive_requests 3;
</span></span><span style=display:flex><span>    keepalive_timeout <span style=color:#ae81ff>65</span> 60;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/html/index.html </span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#é•¿è¿æ¥æµ‹è¯•</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># telnet localhost 80</span>
</span></span><span style=display:flex><span>Trying ::1...
</span></span><span style=display:flex><span>telnet: connect to address ::1: Connection refused
</span></span><span style=display:flex><span>Trying 127.0.0.1...
</span></span><span style=display:flex><span>Connected to localhost.
</span></span><span style=display:flex><span>Escape character is <span style=color:#e6db74>&#39;^]&#39;</span>.
</span></span><span style=display:flex><span>GET / HTTP/1.1      <span style=color:#75715e>#å‘èµ·getè¯·æ±‚ï¼Œé‡å¤ä¸‰æ¬¡æˆ–è€…æ—¶é—´åˆ°è¾¾65ç§’åï¼Œæœ¬æ¬¡é“¾æ¥è‡ªåŠ¨ç»ˆæ­¢</span>
</span></span><span style=display:flex><span>HOST: localhost     <span style=color:#75715e>#åŸŸåä¸ºlocalhost</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#ae81ff>01</span> Aug <span style=color:#ae81ff>2022</span> 11:03:09 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span>Last-Modified: Fri, <span style=color:#ae81ff>29</span> Jul <span style=color:#ae81ff>2022</span> 16:49:40 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Keep-Alive: timeout<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>  <span style=color:#75715e>#æ˜¾ç¤ºçš„è¶…æ—¶æ—¶é—´</span>
</span></span><span style=display:flex><span>ETag: <span style=color:#e6db74>&#34;62e40fa4-6&#34;</span>
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hello    <span style=color:#75715e>#è¿”å›çš„é¡µé¢å†…å®¹    </span>
</span></span></code></pre></div><h3 id=ä½œä¸ºä¸‹è½½æœåŠ¡å™¨>ä½œä¸ºä¸‹è½½æœåŠ¡å™¨<a hidden class=anchor aria-hidden=true href=#ä½œä¸ºä¸‹è½½æœåŠ¡å™¨>#</a></h3><p>ngx_http_autoindex_module æ¨¡å—å¤„ç†ä»¥æ–œæ å­—ç¬¦ &ldquo;/&rdquo; ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨,å¯ä»¥åšä¸ºä¸‹è½½æœåŠ¡</p><p>é…ç½®ä½¿ç”¨</p><p>å®˜æ–¹é“¾æ¥ï¼šhttp://nginx.org/en/docs/http/ngx_http_autoindex_module.html</p><p>ç›¸å…³æŒ‡ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>autoindex on | off; <span style=color:#75715e>#è‡ªåŠ¨æ–‡ä»¶ç´¢å¼•åŠŸèƒ½ï¼Œé»˜ä¸ºoff</span>
</span></span><span style=display:flex><span>autoindex_exact_size on | off; Â #è®¡ç®—æ–‡ä»¶ç²¾ç¡®å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œoff æ˜¾ç¤ºå¤§æ¦‚å¤§å°ï¼ˆå•ä½Kã€M<span style=color:#f92672>)</span>ï¼Œé»˜è®¤on
</span></span><span style=display:flex><span>autoindex_localtime on | off ; <span style=color:#75715e>#æ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´ï¼Œé»˜è®¤off</span>
</span></span><span style=display:flex><span>autoindex_format html | xml | json | jsonp; <span style=color:#75715e>#æ˜¾ç¤ºç´¢å¼•çš„é¡µé¢æ–‡ä»¶é£æ ¼ï¼Œé»˜è®¤html</span>
</span></span><span style=display:flex><span>limit_rate rate; <span style=color:#75715e>#é™åˆ¶å“åº”å®¢æˆ·ç«¯ä¼ è¾“é€Ÿç‡(é™¤GETå’ŒHEADä»¥å¤–çš„æ‰€æœ‰æ–¹æ³•)ï¼Œå•ä½B/s,å³bytes/secondï¼Œé»˜è®¤å€¼0,è¡¨ç¤ºæ— é™åˆ¶,æ­¤æŒ‡ä»¤ç”±ngx_http_core_moduleæä¾›</span>
</span></span><span style=display:flex><span>set $limit_rate 4k; <span style=color:#75715e>#ä¹Ÿå¯ä»¥é€šå˜é‡é™é€Ÿ,å•ä½B/s,åŒæ—¶è®¾ç½®,æ­¤é¡¹ä¼˜çº§é«˜äºlimit_rate</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>###Rate limit can also be set in the $limit_rate variable, however, since version 1.17.0, this method is not recommended:</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼šå°†nginxä½œä¸ºä¸‹è½½æœåŠ¡å™¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#æ³¨æ„:downloadä¸éœ€è¦index.htmlæ–‡ä»¶</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@centos8 ~<span style=color:#f92672>]</span><span style=color:#75715e># mkdir -p /data/nginx/html/pc/download</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># touch /apps/nginx/html/download/{t1,t2,t3}.txt</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># mkdir /apps/nginx/html/download/{d1,d2,d3}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># tree /apps/nginx/html/download</span>
</span></span><span style=display:flex><span>/apps/nginx/html/download
</span></span><span style=display:flex><span>â”œâ”€â”€ d1
</span></span><span style=display:flex><span>â”œâ”€â”€ d2
</span></span><span style=display:flex><span>â”œâ”€â”€ d3
</span></span><span style=display:flex><span>â”œâ”€â”€ t1.txt
</span></span><span style=display:flex><span>â”œâ”€â”€ t2.txt
</span></span><span style=display:flex><span>â””â”€â”€ t3.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>3</span> directories, <span style=color:#ae81ff>3</span> files
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@centos8 ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf</span>
</span></span><span style=display:flex><span> location /download <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span> Â  autoindex on; Â  Â #è‡ªåŠ¨ç´¢å¼•åŠŸèƒ½
</span></span><span style=display:flex><span> Â  autoindex_exact_size Â  off; <span style=color:#75715e>#è®¡ç®—æ–‡ä»¶ç¡®åˆ‡å¤§å°ï¼ˆå•ä½bytesï¼‰ï¼Œæ­¤ä¸ºé»˜è®¤å€¼,offåªæ˜¾ç¤ºå¤§æ¦‚å¤§</span>
</span></span><span style=display:flex><span>å°ï¼ˆå•ä½kbã€mbã€gbï¼‰ Â 
</span></span><span style=display:flex><span> Â  autoindex_localtime Â  off; <span style=color:#75715e>#onè¡¨ç¤ºæ˜¾ç¤ºæœ¬æœºæ—¶é—´è€ŒéGMT(æ ¼æ—å¨æ²»)æ—¶é—´,é»˜ä¸ºä¸ºoffæ˜¾ç¤ºGMT</span>
</span></span><span style=display:flex><span>æ—¶é—´
</span></span><span style=display:flex><span> Â  limit_rate 1024k; Â  <span style=color:#75715e>#é™é€Ÿ,é»˜è®¤ä¸é™é€Ÿ</span>
</span></span><span style=display:flex><span>   root html/;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>ç»“æœéªŒè¯</strong></p><p><img loading=lazy src=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae/image-20220801113728007.png alt=image-20220801113728007></p><h3 id=ä½œä¸ºä¸Šä¼ æœåŠ¡å™¨>ä½œä¸ºä¸Šä¼ æœåŠ¡å™¨<a hidden class=anchor aria-hidden=true href=#ä½œä¸ºä¸Šä¼ æœåŠ¡å™¨>#</a></h3><p>ç›¸å…³æŒ‡ä»¤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>client_max_body_size 1m; <span style=color:#75715e>#è®¾ç½®å…è®¸å®¢æˆ·ç«¯ä¸Šä¼ å•ä¸ªæ–‡ä»¶å¤§å°çš„ä¸Šé™å€¼ï¼Œé»˜è®¤å€¼ä¸º1m,ä¸Šä¼ æ–‡ä»¶è¶…è¿‡æ­¤å€¼ä¼šå‡º413é”™è¯¯</span>
</span></span><span style=display:flex><span>client_body_buffer_size size; <span style=color:#75715e>#ç”¨äºæ¥æ”¶æ¯ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡çš„bodyéƒ¨åˆ†çš„ç¼“å†²åŒºå¤§å°;é»˜è®¤16k;è¶…å‡ºæ­¤å¤§å°æ—¶ï¼Œå…¶å°†è¢«æš‚å­˜åˆ°ç£ç›˜ä¸Šçš„ç”±client_body_temp_pathæŒ‡ä»¤æ‰€å®šä¹‰çš„ä½ç½®</span>
</span></span><span style=display:flex><span>client_body_temp_path path <span style=color:#f92672>[</span>level1 <span style=color:#f92672>[</span>level2 <span style=color:#f92672>[</span>level3<span style=color:#f92672>]]]</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>#è®¾å®šå­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚æŠ¥æ–‡çš„bodyéƒ¨åˆ†çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„åŠå­ç›®å½•ç»“æ„å’Œæ•°é‡ï¼Œç›®å½•åä¸º16è¿›åˆ¶çš„æ•°å­—ï¼Œä½¿ç”¨hashä¹‹åçš„å€¼ä»åå¾€å‰æˆªå–1ä½ã€2ä½ã€2ä½ä½œä¸ºç›®å½•å</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@centos8 ~<span style=color:#f92672>]</span><span style=color:#75715e># md5sum /data/nginx/html/pc/index.html </span>
</span></span><span style=display:flex><span>95f6f65f498c74938064851b1bb <span style=color:#ae81ff>96</span> 3d <span style=color:#ae81ff>4</span> /data/nginx/html/pc/index.html
</span></span><span style=display:flex><span>1çº§ç›®å½•å 1ä½16è¿›åˆ¶ï¼Œå³2^4<span style=color:#f92672>=</span>16ä¸ªç›®å½• Â 0-f
</span></span><span style=display:flex><span>2çº§ç›®å½•å 2ä½16è¿›åˆ¶ï¼Œå³2^8<span style=color:#f92672>=</span>256ä¸ªç›®å½• 00-ff
</span></span><span style=display:flex><span>3çº§ç›®å½•å 2ä½16è¿›åˆ¶ï¼Œå³2^8<span style=color:#f92672>=</span>256ä¸ªç›®å½• 00-ff
</span></span><span style=display:flex><span><span style=color:#75715e>#é…ç½®ç¤ºä¾‹ï¼š</span>
</span></span><span style=display:flex><span>client_max_body_size 100m; <span style=color:#75715e>#å¦‚æœå¤ªå¤§ï¼Œä¸Šä¼ æ—¶ä¼šå‡ºç°413é”™è¯¯ã€‚æ³¨æ„:å¦‚æœphpä¸Šä¼ ï¼ˆå¦‚WordPressï¼‰,è¿˜éœ€è¦ä¿®æ”¹/etc/php.iniçš„ç›¸å…³é…ç½®</span>
</span></span><span style=display:flex><span>client_body_buffer_size 1024k;
</span></span><span style=display:flex><span>client_body_temp_path Â  /apps/nginx/client_body_temp/ <span style=color:#ae81ff>1</span> <span style=color:#ae81ff>2</span> 2; <span style=color:#75715e>#ä¸Šä¼ æ—¶,Nginxä¼šè‡ªåŠ¨åˆ›å»ºç›¸å…³ç›®å½•</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##ä¸Šä¼ æ–‡ä»¶å,ä¼šè‡ªåŠ¨ç”Ÿæˆç›¸å…³ç›®å½•</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@wang-liyun-pc ~<span style=color:#f92672>]</span><span style=color:#75715e># tree /apps/nginx/client_body_temp/</span>
</span></span><span style=display:flex><span>/apps/nginx/client_body_temp/
</span></span><span style=display:flex><span>â”œâ”€â”€ <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>â”‚Â Â  Â  Â  â””â”€â”€ <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>â””â”€â”€ <span style=color:#ae81ff>6</span>
</span></span><span style=display:flex><span> Â  â””â”€â”€ <span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span> Â  Â  Â  â””â”€â”€ <span style=color:#ae81ff>00</span>
</span></span></code></pre></div><h3 id=å…¶ä»–é…ç½®>å…¶ä»–é…ç½®<a hidden class=anchor aria-hidden=true href=#å…¶ä»–é…ç½®>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>keepalive_disable none | browser ...; Â #å¯¹å“ªç§æµè§ˆå™¨ç¦ç”¨é•¿è¿æ¥
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>limit_except method ... <span style=color:#f92672>{</span> ... <span style=color:#f92672>}</span> <span style=color:#75715e>#ä»…ç”¨äºlocationè¯­å¥å—ï¼Œç¦æ­¢å®¢æˆ·ç«¯ä½¿ç”¨é™¤äº†æŒ‡å®šçš„è¯·æ±‚æ–¹æ³•ä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•, å¦‚æœä½¿ç”¨ä¼šå‡ºç°403é”™è¯¯</span>
</span></span><span style=display:flex><span>method:GET, HEAD, POST, PUT, DELETEï¼ŒMKCOL, COPY, MOVE, OPTIONS, PROPFIND, PROPPATCH, LOCK, UNLOCK, PATCH
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##ç¤ºä¾‹ï¼šé™¤äº†GETä¹‹å¤–çš„å…¶å®ƒæ–¹æ³•ä»…å…è®¸172.16.16.0/24ç½‘æ®µä¸»æœºä½¿ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># hostname -I  #æœ¬æœºIP</span>
</span></span><span style=display:flex><span>172.16.16.88 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># ll /apps/nginx/html/upload/  #æ–°å»ºuploadç›®å½•ç”¨äºå­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶</span>
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  location /upload <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      root html/;
</span></span><span style=display:flex><span>	  index index.html;
</span></span><span style=display:flex><span> 	  limit_except GET <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      	  allow 172.16.16.88;
</span></span><span style=display:flex><span>	      deny all;
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># nginx -s reload</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># curl -XPUT /etc/issue pc.test.org/upload</span>
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> &lt;url&gt; malformed
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>&lt;head&gt;&lt;title&gt;405 Not Allowed&lt;/title&gt;&lt;/head&gt;  <span style=color:#75715e>#PUTæ–¹æ³•å…·æœ‰è®¿é—®æƒé™ï¼Œä½†æ˜¯ç¨‹åºæœ¬èº«ä¸æ”¯æŒæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</span>
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;h1&gt;405 Not Allowed&lt;/h1&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># cat /apps/nginx/conf.d/pc.conf </span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  listen 80;
</span></span><span style=display:flex><span>  server_name pc.test.org;
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  location /upload <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        root html/;
</span></span><span style=display:flex><span>	index index.html;
</span></span><span style=display:flex><span> 	limit_except GET <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>#allow 172.16.16.88;  #ç¦æ­¢æ‰€æœ‰ä¸»æœºä½¿ç”¨GETä»¥å¤–çš„æ–¹æ³•</span>
</span></span><span style=display:flex><span>	    deny all;
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@localhost ~<span style=color:#f92672>]</span><span style=color:#75715e># curl -XPUT /etc/issue pc.test.org/upload</span>
</span></span><span style=display:flex><span>curl: <span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> &lt;url&gt; malformed
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt; <span style=color:#75715e>#å†æ¬¡è®¿é—®æµ‹è¯•ï¼Œnginxæ‹’ç»è®¿é—®</span>
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;center&gt;&lt;h1&gt;403 Forbidden&lt;/h1&gt;&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;&lt;center&gt;nginx/1.18.0&lt;/center&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aio on | off Â #æ˜¯å¦å¯ç”¨asynchronous file I/O<span style=color:#f92672>(</span>AIO<span style=color:#f92672>)</span>åŠŸèƒ½ï¼Œéœ€è¦ç¼–è¯‘æ—¶æ·»åŠ å‚æ•°å¼€å¯ --with-file-aio
</span></span><span style=display:flex><span><span style=color:#75715e>#linux 2.6ä»¥ä¸Šå†…æ ¸æä¾›ä»¥ä¸‹å‡ ä¸ªç³»ç»Ÿè°ƒç”¨æ¥æ”¯æŒaioï¼š 1ã€SYS_io_setupï¼šå»ºç«‹aio çš„context</span>
</span></span><span style=display:flex><span>2ã€SYS_io_submit: æäº¤I/Oæ“ä½œè¯·æ±‚
</span></span><span style=display:flex><span>3ã€SYS_io_geteventsï¼šè·å–å·²å®Œæˆçš„I/Oäº‹ä»¶
</span></span><span style=display:flex><span>4ã€SYS_io_cancelï¼šå–æ¶ˆI/Oæ“ä½œè¯·æ±‚
</span></span><span style=display:flex><span>5ã€SYS_io_destroyï¼šæ¯é”€aioçš„context
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>directio size | off; <span style=color:#75715e>#æ“ä½œå®Œå…¨å’Œaioç›¸åï¼Œaioæ˜¯è¯»å–æ–‡ä»¶è€Œdirectioæ˜¯å†™æ–‡ä»¶åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸ºå…³é—­ï¼Œå½“æ–‡ä»¶å¤§äºç­‰äºç»™å®šå¤§å°æ—¶ï¼Œä¾‹å¦‚:directio 4mï¼ŒåŒæ­¥ï¼ˆç›´æ¥ï¼‰å†™ç£ç›˜ï¼Œè€Œéå†™ç¼“å­˜ã€‚</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>open_file_cache off; Â #æ˜¯å¦ç¼“å­˜æ‰“å¼€è¿‡çš„æ–‡ä»¶ä¿¡æ¯
</span></span><span style=display:flex><span>open_file_cache max<span style=color:#f92672>=</span>N <span style=color:#f92672>[</span>inactive<span style=color:#f92672>=</span>time<span style=color:#f92672>]</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#nginxå¯ä»¥ç¼“å­˜ä»¥ä¸‹ä¸‰ç§ä¿¡æ¯ï¼š</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>1<span style=color:#f92672>)</span> æ–‡ä»¶å…ƒæ•°æ®ï¼šæ–‡ä»¶çš„æè¿°ç¬¦ã€æ–‡ä»¶å¤§å°å’Œæœ€è¿‘ä¸€æ¬¡çš„ä¿®æ”¹æ—¶é—´
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>2<span style=color:#f92672>)</span> æ‰“å¼€çš„ç›®å½•ç»“æ„
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>3<span style=color:#f92672>)</span> æ²¡æœ‰æ‰¾åˆ°çš„æˆ–è€…æ²¡æœ‰æƒé™è®¿é—®çš„æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>max<span style=color:#f92672>=</span>Nï¼š#å¯ç¼“å­˜çš„ç¼“å­˜é¡¹ä¸Šé™æ•°é‡;è¾¾åˆ°ä¸Šé™åä¼šä½¿ç”¨LRU<span style=color:#f92672>(</span>Least recently usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨<span style=color:#f92672>)</span>ç®—æ³•å®ç°ç®¡ç†
</span></span><span style=display:flex><span>inactive<span style=color:#f92672>=</span>timeï¼š#ç¼“å­˜é¡¹çš„éæ´»åŠ¨æ—¶é•¿ï¼Œåœ¨æ­¤å¤„æŒ‡å®šçš„æ—¶é•¿å†…æœªè¢«å‘½ä¸­çš„æˆ–å‘½ä¸­çš„æ¬¡æ•°å°‘äº
</span></span><span style=display:flex><span>open_file_cache_min_uses <span style=color:#75715e>#æŒ‡ä»¤æ‰€æŒ‡å®šçš„æ¬¡æ•°çš„ç¼“å­˜é¡¹å³ä¸ºéæ´»åŠ¨é¡¹ï¼Œå°†è¢«åˆ é™¤</span>
</span></span><span style=display:flex><span>open_file_cache_valid time; <span style=color:#75715e>#ç¼“å­˜é¡¹æœ‰æ•ˆæ€§çš„æ£€æŸ¥éªŒè¯é¢‘ç‡ï¼Œé»˜è®¤å€¼ä¸º60s </span>
</span></span><span style=display:flex><span>open_file_cache_errors on | off; <span style=color:#75715e>#æ˜¯å¦ç¼“å­˜æŸ¥æ‰¾æ—¶å‘ç”Ÿé”™è¯¯çš„æ–‡ä»¶ä¸€ç±»çš„ä¿¡æ¯,é»˜è®¤å€¼ä¸ºoff</span>
</span></span><span style=display:flex><span>open_file_cache_min_uses number; <span style=color:#75715e>#open_file_cacheæŒ‡ä»¤çš„inactiveå‚æ•°æŒ‡å®šçš„æ—¶é•¿å†…ï¼Œè‡³å°‘è¢«å‘½ä¸­æ­¤å¤„æŒ‡å®šçš„æ¬¡æ•°æ–¹å¯è¢«å½’ç±»ä¸ºæ´»åŠ¨é¡¹,é»˜è®¤å€¼ä¸º1</span>
</span></span></code></pre></div><p>èŒƒä¾‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>open_file_cache max<span style=color:#f92672>=</span><span style=color:#ae81ff>10000</span> inactive<span style=color:#f92672>=</span>60s; <span style=color:#75715e>#æœ€å¤§ç¼“å­˜10000ä¸ªæ–‡ä»¶ï¼Œéæ´»åŠ¨æ•°æ®è¶…æ—¶æ—¶é•¿60s</span>
</span></span><span style=display:flex><span>open_file_cache_valid Â  60s; Â #æ¯é—´éš”60sæ£€æŸ¥ä¸€ä¸‹ç¼“å­˜æ•°æ®æœ‰æ•ˆæ€§
</span></span><span style=display:flex><span>open_file_cache_min_uses 5; <span style=color:#75715e>#60ç§’å†…è‡³å°‘è¢«å‘½ä¸­è®¿é—®5æ¬¡æ‰è¢«æ ‡è®°ä¸ºæ´»åŠ¨æ•°æ®</span>
</span></span><span style=display:flex><span>open_file_cache_errors Â  on; <span style=color:#75715e>#ç¼“å­˜é”™è¯¯ä¿¡æ¯</span>
</span></span></code></pre></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://senmer.github.io/posts/tech/nginx/nginx%E9%AB%98%E7%BA%A7%E9%85%8D%E7%BD%AE/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>Nginxé«˜çº§é…ç½®</span></a>
<a class=next href=https://senmer.github.io/posts/tech/nginx/nginx%E5%B9%B3%E6%BB%91%E5%8D%87%E7%BA%A7/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>Nginxå¹³æ»‘å‡çº§å’Œå›æ»š</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on twitter" href="https://twitter.com/intent/tweet/?text=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f&amp;hashtags=Nginx"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f&amp;title=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae&amp;summary=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae&amp;source=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f&title=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on whatsapp" href="https://api.whatsapp.com/send?text=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae%20-%20https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Nginxæ ¸å¿ƒé…ç½® on telegram" href="https://telegram.me/share/url?text=Nginx%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae&amp;url=https%3a%2f%2fsenmer.github.io%2fposts%2ftech%2fnginx%2fnginx%25E6%25A0%25B8%25E5%25BF%2583%25E9%2585%258D%25E7%25BD%25AE%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></div><style>.comments_details summary::marker{font-size:20px;content:'ğŸ‘‰å±•å¼€è¯„è®º';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'ğŸ‘‡å…³é—­è¯„è®º';color:var(--content)}</style><div><details class=comments_details><summary style="cursor:pointer;margin:50px 0 20px;width:130px"><span style=font-size:20px;color:var(--content)>...</span></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# å¡«å†™è‡ªå·±çš„twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><footer class=footer><span>Copyright
&copy;
2020-2023
<a href=https://senmer.github.io/ style=color:#939393>WZ's Blog</a>
All Rights Reserved</span>
<a href=https://beian.miit.gov.cn/ target=_blank style=color:#939393></a>&nbsp;
<span><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null" style=display:inline-block;text-decoration:none;height:20px;color:#939393><img src style="float:left;margin:0 5px 0 0"></a></span>
<span id=busuanzi_container><span class="fa fa-user"></span> <span id=busuanzi_value_site_uv></span>
<span class="fa fa-eye"></span> <span id=busuanzi_value_site_pv></span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span></span></a>
<script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒWZ's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href,s=window.getSelection().toString()+`

â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒWZ's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="å¤åˆ¶";function i(){t.innerText="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerText="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent+`
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€ŒWZ's Blogã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚
åŸæ–‡é“¾æ¥ï¼š`+location.href;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script><script>$("code[class^=language] ").on("mouseover",function(){this.clientWidth<this.scrollWidth&&($(this).css("width","135%"),$(this).css("border-top-right-radius","var(--radius)"))}).on("mouseout",function(){$(this).css("width","100%"),$(this).css("border-top-right-radius","unset")})</script></body></html>