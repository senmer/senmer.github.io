<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Zookeeper | WZ's Blog</title>
<meta name=keywords content><meta name=description content="一、Zookeeper 简介： Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和"><meta name=author content="wz"><link rel=canonical href=https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/><link crossorigin=anonymous href=/assets/css/stylesheet.5a2b6d77cc78ad18bcb4914c5c639c7ce5ab55e956c461d4310747892b3f50c2.css integrity="sha256-Wittd8x4rRi8tJFMXGOcfOWrVelWxGHUMQdHiSs/UMI=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://senmer.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://senmer.github.io/img/Q.gif><link rel=apple-touch-icon href=https://senmer.github.io/img/Q.gif><link rel=mask-icon href=https://senmer.github.io/img/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer src=https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><script src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?4d7c4710a089d70b71310f0e1ec7681b",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script><meta property="og:title" content="Zookeeper"><meta property="og:description" content="一、Zookeeper 简介： Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和"><meta property="og:type" content="article"><meta property="og:url" content="https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-29T12:09:35+08:00"><meta property="article:modified_time" content="2023-08-29T12:09:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Zookeeper"><meta name=twitter:description content="一、Zookeeper 简介： Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"📚文章","item":"https://senmer.github.io/zh/posts/"},{"@type":"ListItem","position":2,"name":"👨🏻‍💻 技术","item":"https://senmer.github.io/zh/posts/tech/"},{"@type":"ListItem","position":3,"name":"Zookeeper","item":"https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Zookeeper","name":"Zookeeper","description":"一、Zookeeper 简介： Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和","keywords":[""],"articleBody":"一、Zookeeper 简介： Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和通知机制，以便在分布式环境中实现高可用性、一致性和可靠性。\nZooKeeper 主要特点包括：\n分布式协调： ZooKeeper 提供了分布式应用程序中的共享配置和状态信息的集中式存储，从而实现了分布式系统的协调。\n高可用性： ZooKeeper 的设计着重于高可用性，通过将数据复制到多个节点上以实现容错和故障恢复。\n一致性： ZooKeeper 提供了强一致性模型，确保在分布式系统中的不同节点之间保持一致的视图。\n顺序访问： ZooKeeper 为分布式系统中的事件引入了顺序性，使得事件在分布式环境中能够按照顺序进行处理。\n通知机制： ZooKeeper 允许客户端注册监听器以获取有关节点状态变化的通知，从而实现了分布式事件通知。\n二、Zookeeper 使用场景： 分布式协调：ZooKeeper 是最常见的用于分布式系统中协调任务的工具之一。它可以用来实现分布式锁、分布式队列、分布式选举等，确保不同节点之间的有序操作。\n配置管理：ZooKeeper 可以用于管理分布式系统的配置信息，如数据库连接信息、服务地址等。应用程序可以通过监听 ZooKeeper 上的配置节点来实现动态配置更新。\n命名服务：ZooKeeper 可以用作分布式命名服务，类似于 DNS，用于将逻辑名称映射到实际服务地址，以便在分布式系统中轻松查找服务。\n分布式锁：ZooKeeper 提供了分布式锁的实现，用于协调不同节点对共享资源的访问，确保在同一时刻只有一个节点可以访问该资源。\n分布式队列：ZooKeeper 可以用于创建分布式队列，用于在不同节点之间传递消息或任务，确保任务的有序执行。\n分布式通知：ZooKeeper 允许应用程序监听特定的节点，以获取关于集群状态变化的通知，从而实现及时响应和处理。\n分布式协调服务：ZooKeeper 本身就是一个分布式协调服务，可以用于管理和维护分布式系统中的一致性、状态同步等。\nLeader 选举：ZooKeeper 可以用于在分布式系统中选择一个节点作为领导者（Leader），以确保在节点故障时能够快速选举新的领导者。\n总的来说，ZooKeeper 在构建分布式系统时起到了关键的协调和管理作用，帮助开发人员处理分布式环境中的复杂性和挑战。然而，随着技术的发展，一些替代方案如 etcd、Consul 等也出现，可以用来实现类似的分布式协调和管理功能。\n三、Zookeeper 单机部署 3.1 实验环境 主机名 IP 系统 配置 zookeeper 10.0.0.10 CentOS 7.6 1U 2G 3.2 配置 java 环境 软件依赖：ZooKeeper: Because Coordinating Distributed Systems is a Zoo (apache.org)\n安装 openjdk\n[root@zookeeper ~]# yum install -y java-1.8.0-openjdk 查看结果\n[root@zookeeper ~]# java -version openjdk version \"1.8.0_382\" OpenJDK Runtime Environment (build 1.8.0_382-b05) OpenJDK 64-Bit Server VM (build 25.382-b05, mixed mode) 3.3 部署 zookeeper 3.3.1 下载并解压软件包 下载地址：Index of /dist/zookeeper (apache.org)\ncd /usr/local/src wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz tar xf zookeeper-3.4.13.tar.gz ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper 3.3.2 准备配置文件 这里保持默认配置，不做修改\n[root@zookeeper src]# cd zookeeper/conf/ [root@zookeeper conf]# cp zoo_sample.cfg zoo.cfg [root@zookeeper conf]# ls configuration.xsl log4j.properties zoo.cfg zoo_sample.cfg [root@zookeeper conf]# grep -v ^# zoo.cfg tickTime=2000 initLimit=10 syncLimit=5 dataDir=/tmp/zookeeper clientPort=2181 3.4 启动 zookeeper 服务 3.4.1 启动服务 [root@zookeeper conf]# cd /usr/local/zookeeper/ [root@zookeeper zookeeper]# bin/zkServer.sh start ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Starting zookeeper ... STARTED 3.4.2 查看服务状态 [root@zookeeper zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: standalone # 单机模式 3.4.3 查看进程信息 [root@zookeeper zookeeper-3.4.13]# ps -ef | grep zookeeper root 8452 1 2 17:48 pts/0 00:00:00 java -Dzookeeper.log.dir=. -Dzookeeper.root.logger=INFO,CONSOLE -cp /usr/local/src/zookeeper-3.4.13/bin/../build/classes:/usr/local/src/zookeeper-3.4.13/bin/../build/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/usr/local/src/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/usr/local/src/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../conf: -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=false org.apache.zookeeper.server.quorum.QuorumPeerMain /usr/local/src/zookeeper-3.4.13/bin/../conf/zoo.cfg root 8498 8326 0 17:49 pts/0 00:00:00 grep --color=auto zookeeper 四、Zookeeper 集群部署 4.1 实验环境 主机名 IP 系统 配置 zookeeper-01 10.0.0.11 CentOS 7.6 1U 2G zookeeper-02 10.0.0.12 CentOS 7.6 1U 2G zookeeper-03 10.0.0.13 CentOS 7.6 1U 2G 4.2 配置 Java 环境 所有节点执行：\nyum install java-1.8.0-openjdk -y java -version 4.3 下载并解压安装包 所有节点执行：\ncd /usr/local/src wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz tar xf zookeeper-3.4.13.tar.gz ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper mkdir /usr/local/zookeeper/data # 数据存放目录，如果不存在会自动创建 cd /usr/local/zookeeper/conf cp zoo_sample.cfg zoo.cfg\t# 根据需要修改配置文件 cat \u003e zoo.cfg \u003c\u003c EOF tickTime=2000 initLimit=10 syncLimit=5 dataDir=/usr/local/zookeeper/data clientPort=2181 maxClientCnxns=4096 autopurge.snapRetainCount=128 autopurge.purgeInterval=1 server.1=10.0.0.11:2888:3888 server.2=10.0.0.12:2888:3888 server.3=10.0.0.13:2888:3888 EOF 参数解释：\ntickTime=2000 #服务器与服务器之间的单次心跳检测时间间隔，单位为毫秒 initLimit=10 #集群中 leader 服务器与 follower 服务器初始连接心跳次数，即多少个 2000 毫秒 syncLimit=5 # leader 与 follower 之间连接完成之后，后期检测发送和应答的心跳次数，如果该 follower 在设置的时间内(5*2000)不能与 leader 进行通信，那么此follower 将被视为不可用。 dataDir=/usr/local/zookeeper/data #自定义的 zookeeper 保存数据的目录 clientPort=2181 #客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求 maxClientCnxns=128 #单个客户端 IP 可以和 zookeeper 保持的连接数 autopurge.snapRetainCount=3 #3.4.0 中的新增功能：启用后，ZooKeeper 自动清除功能会将最新快照和相应的事务日志分别保留在 dataDir 和 dataLogDir 中，并删除其余部分，默认值为 3。最小值为 3。 autopurge.purgeInterval=1 # 3.4.0 及之后版本，ZK 提供了自动清理日志和快照文件的功能，这个参数指定了清理频率，单位是小时，需要配置一个 1 或更大的整数，默认是 0，表示不开启自动清理功能 server.1=10.0.0.11:2888:3888 # server.服务器编号=服务器IP:数据同步端口:选举端口 server.2=10.0.0.12:2888:3888 server.3=10.0.0.13:2888:3888 4.4 修改集群配置 zookeeper-01 执行：\n# 配置集群 ID echo 1 \u003e /usr/local/zookeeper/data/myid zookeeper-02 执行：\necho 2 \u003e /usr/local/zookeeper/data/myid zookeeper-03 执行：\necho 3 \u003e /usr/local/zookeeper/data/myid 4.5 启动服务 zookeeper-01 执行：\n# 启动服务 cd /usr/local/zookeeper/ bin/zkServer.sh start #查看集群角色 [root@zookeeper-01 zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: follower zookeeper-02 执行：\n# 启动服务 cd /usr/local/zookeeper/ bin/zkServer.sh start [root@zookeeper-02 zookeeper]# ./bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: leader # leader 额外开启一个 2888 端口用于同步数据 [root@zookeeper-03 zookeeper]# ss -ntl|grep 2888 LISTEN 0 50 ::ffff:10.0.0.13:2888 :::* zookeeper-03 执行：\n# 启动服务 cd /usr/local/zookeeper/ bin/zkServer.sh start [root@zookeeper-03 zookeeper]# bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg Mode: follower 五、Zookeeper 数据增删改查 Zookeeper 是一个分布式的开源协调服务，常用于管理和维护分布式系统中的配置信息、命名服务、分布式锁等。它提供了一个层次化的命名空间（类似于文件系统），通过树状结构来存储数据。下面是一些基本的 Zookeeper 命令示例，用于增删改查 Zookeeper 中的数据节点：\n可用的客户端工具：zzhang5/zooinspector: An improved zookeeper inspector (github.com)\n5.1 语法简介 连接到 Zookeeper：\n在终端中运行以下命令以连接到 Zookeeper 服务器：\nzkCli.sh -server : 其中， 是 Zookeeper 服务器的地址， 是 Zookeeper 服务器的端口，默认为 2181。\n创建节点：\n在 Zookeeper 中，可以使用 create 命令来创建一个新的节点。\ncreate /mynode \"Hello, Zookeeper!\" 获取节点数据：\n使用 get 命令可以获取节点的数据。\nget /mynode 更新节点数据：\n使用 set 命令来更新节点的数据。\nset /mynode \"Updated data\" 列出子节点：\n使用 ls 命令列出节点的子节点。\nls /path/to/parent_node 删除节点：\n使用 delete 命令来删除节点。\ndelete /path/to/node 5.2 实例演示 连接集群中的任意节点，这里选择 zookeeper-01\n[root@zookeeper-01 zookeeper]# bin/zkCli.sh -server 10.0.0.11 [zk: 10.0.0.11(CONNECTED) 2] help # help 查看帮助 ZooKeeper -server host:port cmd args stat path [watch] set path data [version] ls path [watch] delquota [-n|-b] path ls2 path [watch] setAcl path acl setquota -n|-b val path history redo cmdno printwatches on|off delete path [version] sync path listquota path rmr path get path [watch] create [-s] [-e] path data acl addauth scheme auth quit getAcl path close connect host:port [zk: 10.0.0.11(CONNECTED) 0] create /test \"hello\" # 创建节点 Created /test [zk: 10.0.0.11(CONNECTED) 1] get /test\t# 查看节点内容 hello cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000004 mtime = Wed Aug 30 18:08:30 CST 2023 pZxid = 0x800000004 cversion = 0 dataVersion = 0 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 0 [zk: 10.0.0.11(CONNECTING) 0] ls /test # 查看节点 [] [zk: 10.0.0.11(CONNECTED) 1] create /test/app1 # 创建节点，但未给出值 [zk: 10.0.0.11(CONNECTED) 2] ls /test/app1 # 实际未创建成功 Node does not exist: /test/app1 [zk: 10.0.0.11(CONNECTED) 3] create /test/app1 \"my first app\" # 再次创建子节点并赋值 Node already exists: /test/app1 [zk: 10.0.0.11(CONNECTED) 4] ls /test/app1 # 创建成功 [] [zk: 10.0.0.11(CONNECTED) 5] ls /test/app1/ # 查看节点，末尾不能带 '/' Command failed: java.lang.IllegalArgumentException: Path must not end with / character [zk: 10.0.0.11(CONNECTED) 6] set /test \"world\" # 更新节点的值 cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000010 mtime = Wed Aug 30 18:28:38 CST 2023 pZxid = 0x80000000d cversion = 1 dataVersion = 1 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 1 [zk: 10.0.0.11(CONNECTED) 7] get /test # 再次查看，更新成功 world cZxid = 0x800000004 ctime = Wed Aug 30 18:08:30 CST 2023 mZxid = 0x800000012 mtime = Wed Aug 30 18:28:38 CST 2023 pZxid = 0x80000000d cversion = 1 dataVersion = 3 aclVersion = 0 ephemeralOwner = 0x0 dataLength = 5 numChildren = 1 [zk: 10.0.0.11(CONNECTED) 8] delete /test # 删除节点，因为存在字节的，所以删除失败 Node not empty: /test [zk: 10.0.0.11(CONNECTED) 9] delete /test/app1 # 先删除子节点 [zk: 10.0.0.11(CONNECTED) 10] delete /test # 再次删除父节点成功 附录 可能是把 ZooKeeper 概念讲的最清楚的一篇文章 | 断念梦 (desistdaydream.github.io)\nZooKeeper的十二连问，你顶得了嘛？ - Jay_huaxiao - 博客园 (cnblogs.com)\nZookeeper:新增、查看、修改、删除节点 - 秋风飒飒吹 - 博客园 (cnblogs.com)\n一篇文章搞懂 ZooKeeper 的选举机制 - 掘金 (juejin.cn)\n3. zookeeper 选举机制 - 简书 (jianshu.com)\nZookeeper选举算法原理（摘选） - 简书 (jianshu.com)\n【Zookeeper】Zookeeper的Leader选举流程 - 周二鸭 - 博客园 (cnblogs.com)\nZookeeper：Zookeeper的主从选举机制-腾讯云开发者社区-腾讯云 (tencent.com)\n","wordCount":"3053","inLanguage":"zh","datePublished":"2023-08-29T12:09:35+08:00","dateModified":"2023-08-29T12:09:35+08:00","author":[{"@type":"Person","name":"wz"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://senmer.github.io/zh/posts/tech/zookeeper/zookeeper/"},"publisher":{"@type":"Organization","name":"WZ's Blog","logo":{"@type":"ImageObject","url":"https://senmer.github.io/img/Q.gif"}}}</script></head><body id=top><script>(function(){let e,t=new RegExp("(^| )change-themes=([^;]*)(;|$)");(e=document.cookie.match(t))||((new Date).getHours()>=19||(new Date).getHours()<6?(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark")):(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")))})(),localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://senmer.github.io/zh/ accesskey=h title="WZ's Blog (Alt + H)"><img src=https://senmer.github.io/img/Q.gif alt=logo aria-label=logo height=35>WZ's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://senmer.github.io/zh/search title="🔍 搜索 (Alt + /)" accesskey=/><span>🔍 搜索</span></a></li><li><a href=https://senmer.github.io/zh/ title="🏠 主页"><span>🏠 主页</span></a></li><li><a href=https://senmer.github.io/zh/posts/tech title="📚 文章"><span>📚 文章</span></a></li><li><a href=https://senmer.github.io/zh/categories/ title="🧩 分类"><span>🧩 分类</span></a></li><li><a href=https://senmer.github.io/zh/archives/ title="⏱️ 时间轴"><span>⏱️ 时间轴</span></a></li><li><a href=https://senmer.github.io/zh/about title="🙋🏻‍♂️ 关于"><span>🙋🏻‍♂️ 关于</span></a></li><li><a href=https://senmer.github.io/zh/links title="🤝 友链"><span>🤝 友链</span></a></li></ul></nav></header><main class="main page"><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}</style><article class=post-single><div id=single-content><header class=post-header><div class=breadcrumbs><a href=https://senmer.github.io/zh/>🏠 主页</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/zh/posts/>📚文章</a>&nbsp;»&nbsp;<a href=https://senmer.github.io/zh/posts/tech/>👨🏻‍💻 技术</a></div><h1 class=post-title>Zookeeper</h1><div class=post-meta><style>i[id*=post_meta_style]{display:flex;align-items:center;margin:0 0 10px}.parent-post-meta{display:flex;flex-wrap:wrap;opacity:.8}</style><span class=parent-post-meta><span id=post_meta_style_1><span class="fa fa-calendar-check-o"></span>
<span>2023-08-29
&nbsp;&nbsp;
</span></span><span id=post_meta_style_3><span class="fa fa-file-word-o"></span>
<span>3053字
&nbsp;&nbsp;
</span></span><span id=post_meta_style_4><span class="fa fa-clock-o"></span>
<span>7分钟
&nbsp;&nbsp;
</span></span><span id=post_meta_style_5><span class="fa fa-user-o"></span>
<span>wz
&nbsp;&nbsp;
</span></span><span id=post_meta_style_6><span class="fa fa-tags" style=opacity:.8></span>
<span><span class=post-tags-meta></span></span></span></span><span style=opacity:.8><span id=post_meta_style_7>&nbsp;&nbsp;
<span class="fa fa-eye"></span>
<span><span id=busuanzi_container_page_pv><span id=busuanzi_value_page_pv></span></span>
&nbsp;&nbsp;
</span></span><span id=post_meta_style_8><span class="fa fa-commenting-o"></span>
<span><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>let url=document.documentURI,dnsUrl="https://senmer.github.io/",urlSplit=url.split(dnsUrl),finalUrl=urlSplit[1];finalUrl[0]!=="/"&&(finalUrl="/"+finalUrl),twikoo.getCommentsCount({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",region:null,urls:[finalUrl],includeReply:!1}).then(function(e){let t=e[0].count;const n=document.getElementById("comment_count");n.innerText=t}).catch(function(e){console.error(e)})</script><span id=comment_count></span></span></span></span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e4%b8%80zookeeper-%e7%ae%80%e4%bb%8b aria-label="一、Zookeeper 简介：">一、Zookeeper 简介：</a></li><li><a href=#%e4%ba%8czookeeper-%e4%bd%bf%e7%94%a8%e5%9c%ba%e6%99%af aria-label="二、Zookeeper 使用场景：">二、Zookeeper 使用场景：</a></li><li><a href=#%e4%b8%89zookeeper-%e5%8d%95%e6%9c%ba%e9%83%a8%e7%bd%b2 aria-label="三、Zookeeper 单机部署">三、Zookeeper 单机部署</a><ul><li><a href=#31-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83 aria-label="3.1 实验环境">3.1 <strong>实验环境</strong></a></li><li><a href=#32-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="3.2 配置 java 环境">3.2 配置 java 环境</a></li><li><a href=#33-%e9%83%a8%e7%bd%b2-zookeeper aria-label="3.3 部署 zookeeper">3.3 部署 zookeeper</a><ul><li><a href=#331-%e4%b8%8b%e8%bd%bd%e5%b9%b6%e8%a7%a3%e5%8e%8b%e8%bd%af%e4%bb%b6%e5%8c%85 aria-label="3.3.1 下载并解压软件包">3.3.1 下载并解压软件包</a></li><li><a href=#332-%e5%87%86%e5%a4%87%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6 aria-label="3.3.2 准备配置文件">3.3.2 准备配置文件</a></li></ul></li><li><a href=#34-%e5%90%af%e5%8a%a8-zookeeper-%e6%9c%8d%e5%8a%a1 aria-label="3.4 启动 zookeeper 服务">3.4 启动 zookeeper 服务</a><ul><li><a href=#341-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label="3.4.1 启动服务">3.4.1 启动服务</a></li><li><a href=#342-%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81 aria-label="3.4.2 查看服务状态">3.4.2 查看服务状态</a></li><li><a href=#343-%e6%9f%a5%e7%9c%8b%e8%bf%9b%e7%a8%8b%e4%bf%a1%e6%81%af aria-label="3.4.3 查看进程信息">3.4.3 查看进程信息</a></li></ul></li></ul></li><li><a href=#%e5%9b%9bzookeeper-%e9%9b%86%e7%be%a4%e9%83%a8%e7%bd%b2 aria-label="四、Zookeeper 集群部署">四、Zookeeper 集群部署</a><ul><li><a href=#41-%e5%ae%9e%e9%aa%8c%e7%8e%af%e5%a2%83 aria-label="4.1 实验环境">4.1 实验环境</a></li><li><a href=#42-%e9%85%8d%e7%bd%ae-java-%e7%8e%af%e5%a2%83 aria-label="4.2 配置 Java 环境">4.2 配置 Java 环境</a></li><li><a href=#43-%e4%b8%8b%e8%bd%bd%e5%b9%b6%e8%a7%a3%e5%8e%8b%e5%ae%89%e8%a3%85%e5%8c%85 aria-label="4.3 下载并解压安装包">4.3 下载并解压安装包</a></li><li><a href=#44-%e4%bf%ae%e6%94%b9%e9%9b%86%e7%be%a4%e9%85%8d%e7%bd%ae aria-label="4.4 修改集群配置">4.4 修改集群配置</a></li><li><a href=#45-%e5%90%af%e5%8a%a8%e6%9c%8d%e5%8a%a1 aria-label="4.5 启动服务">4.5 启动服务</a></li></ul></li><li><a href=#%e4%ba%94zookeeper-%e6%95%b0%e6%8d%ae%e5%a2%9e%e5%88%a0%e6%94%b9%e6%9f%a5 aria-label="五、Zookeeper 数据增删改查">五、Zookeeper 数据增删改查</a><ul><li><a href=#51-%e8%af%ad%e6%b3%95%e7%ae%80%e4%bb%8b aria-label="5.1 语法简介">5.1 语法简介</a></li><li><a href=#52-%e5%ae%9e%e4%be%8b%e6%bc%94%e7%a4%ba aria-label="5.2 实例演示">5.2 实例演示</a></li></ul></li><li><a href=#%e9%99%84%e5%bd%95 aria-label=附录>附录</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=一zookeeper-简介>一、Zookeeper 简介：<a hidden class=anchor aria-hidden=true href=#一zookeeper-简介>#</a></h2><p>Apache ZooKeeper 是一个分布式的开源协调服务，旨在帮助构建分布式应用程序和服务。它提供了一个高度可靠的、层次化的命名空间，类似于文件系统，用于存储和管理分布式应用程序中的配置信息、状态信息、命名服务等。ZooKeeper 的设计目标是为分布式系统提供强大的协调、同步和通知机制，以便在分布式环境中实现高可用性、一致性和可靠性。</p><p>ZooKeeper 主要特点包括：</p><ol><li><p><strong>分布式协调：</strong> ZooKeeper 提供了分布式应用程序中的共享配置和状态信息的集中式存储，从而实现了分布式系统的协调。</p></li><li><p><strong>高可用性：</strong> ZooKeeper 的设计着重于高可用性，通过将数据复制到多个节点上以实现容错和故障恢复。</p></li><li><p><strong>一致性：</strong> ZooKeeper 提供了强一致性模型，确保在分布式系统中的不同节点之间保持一致的视图。</p></li><li><p><strong>顺序访问：</strong> ZooKeeper 为分布式系统中的事件引入了顺序性，使得事件在分布式环境中能够按照顺序进行处理。</p></li><li><p><strong>通知机制：</strong> ZooKeeper 允许客户端注册监听器以获取有关节点状态变化的通知，从而实现了分布式事件通知。</p></li></ol><h2 id=二zookeeper-使用场景>二、Zookeeper 使用场景：<a hidden class=anchor aria-hidden=true href=#二zookeeper-使用场景>#</a></h2><ol><li><p><strong>分布式协调</strong>：ZooKeeper 是最常见的用于分布式系统中协调任务的工具之一。它可以用来实现分布式锁、分布式队列、分布式选举等，确保不同节点之间的有序操作。</p></li><li><p><strong>配置管理</strong>：ZooKeeper 可以用于管理分布式系统的配置信息，如数据库连接信息、服务地址等。应用程序可以通过监听 ZooKeeper 上的配置节点来实现动态配置更新。</p></li><li><p><strong>命名服务</strong>：ZooKeeper 可以用作分布式命名服务，类似于 DNS，用于将逻辑名称映射到实际服务地址，以便在分布式系统中轻松查找服务。</p></li><li><p><strong>分布式锁</strong>：ZooKeeper 提供了分布式锁的实现，用于协调不同节点对共享资源的访问，确保在同一时刻只有一个节点可以访问该资源。</p></li><li><p><strong>分布式队列</strong>：ZooKeeper 可以用于创建分布式队列，用于在不同节点之间传递消息或任务，确保任务的有序执行。</p></li><li><p><strong>分布式通知</strong>：ZooKeeper 允许应用程序监听特定的节点，以获取关于集群状态变化的通知，从而实现及时响应和处理。</p></li><li><p><strong>分布式协调服务</strong>：ZooKeeper 本身就是一个分布式协调服务，可以用于管理和维护分布式系统中的一致性、状态同步等。</p></li><li><p><strong>Leader 选举</strong>：ZooKeeper 可以用于在分布式系统中选择一个节点作为领导者（Leader），以确保在节点故障时能够快速选举新的领导者。</p></li></ol><p>总的来说，ZooKeeper 在构建分布式系统时起到了关键的协调和管理作用，帮助开发人员处理分布式环境中的复杂性和挑战。然而，随着技术的发展，一些替代方案如 etcd、Consul 等也出现，可以用来实现类似的分布式协调和管理功能。</p><h2 id=三zookeeper-单机部署>三、Zookeeper 单机部署<a hidden class=anchor aria-hidden=true href=#三zookeeper-单机部署>#</a></h2><h3 id=31-实验环境>3.1 <strong>实验环境</strong><a hidden class=anchor aria-hidden=true href=#31-实验环境>#</a></h3><table><thead><tr><th>主机名</th><th>IP</th><th>系统</th><th>配置</th></tr></thead><tbody><tr><td>zookeeper</td><td>10.0.0.10</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><h3 id=32-配置-java-环境>3.2 配置 java 环境<a hidden class=anchor aria-hidden=true href=#32-配置-java-环境>#</a></h3><p>软件依赖：<a href=https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_requiredSoftw>ZooKeeper: Because Coordinating Distributed Systems is a Zoo (apache.org)</a></p><p>安装 openjdk</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper ~<span style=color:#f92672>]</span><span style=color:#75715e># yum install -y java-1.8.0-openjdk</span>
</span></span></code></pre></div><p>查看结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper ~<span style=color:#f92672>]</span><span style=color:#75715e># java -version</span>
</span></span><span style=display:flex><span>openjdk version <span style=color:#e6db74>&#34;1.8.0_382&#34;</span>
</span></span><span style=display:flex><span>OpenJDK Runtime Environment <span style=color:#f92672>(</span>build 1.8.0_382-b05<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>OpenJDK 64-Bit Server VM <span style=color:#f92672>(</span>build 25.382-b05, mixed mode<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=33-部署-zookeeper>3.3 部署 zookeeper<a hidden class=anchor aria-hidden=true href=#33-部署-zookeeper>#</a></h3><h4 id=331-下载并解压软件包>3.3.1 下载并解压软件包<a hidden class=anchor aria-hidden=true href=#331-下载并解压软件包>#</a></h4><p>下载地址：<a href=https://archive.apache.org/dist/zookeeper/>Index of /dist/zookeeper (apache.org)</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /usr/local/src
</span></span><span style=display:flex><span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>tar xf zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper
</span></span></code></pre></div><h4 id=332-准备配置文件>3.3.2 准备配置文件<a hidden class=anchor aria-hidden=true href=#332-准备配置文件>#</a></h4><p>这里保持默认配置，不做修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper src<span style=color:#f92672>]</span><span style=color:#75715e># cd zookeeper/conf/</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># cp zoo_sample.cfg zoo.cfg</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># ls</span>
</span></span><span style=display:flex><span>configuration.xsl  log4j.properties  zoo.cfg  zoo_sample.cfg
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># grep -v ^# zoo.cfg </span>
</span></span><span style=display:flex><span>tickTime<span style=color:#f92672>=</span><span style=color:#ae81ff>2000</span>
</span></span><span style=display:flex><span>initLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>syncLimit<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>dataDir<span style=color:#f92672>=</span>/tmp/zookeeper
</span></span><span style=display:flex><span>clientPort<span style=color:#f92672>=</span><span style=color:#ae81ff>2181</span>
</span></span></code></pre></div><h3 id=34-启动-zookeeper-服务>3.4 启动 zookeeper 服务<a hidden class=anchor aria-hidden=true href=#34-启动-zookeeper-服务>#</a></h3><h4 id=341-启动服务>3.4.1 启动服务<a hidden class=anchor aria-hidden=true href=#341-启动服务>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper conf<span style=color:#f92672>]</span><span style=color:#75715e># cd /usr/local/zookeeper/   </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh start</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Starting zookeeper ... STARTED
</span></span></code></pre></div><h4 id=342-查看服务状态>3.4.2 查看服务状态<a hidden class=anchor aria-hidden=true href=#342-查看服务状态>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: standalone <span style=color:#75715e># 单机模式</span>
</span></span></code></pre></div><h4 id=343-查看进程信息>3.4.3 查看进程信息<a hidden class=anchor aria-hidden=true href=#343-查看进程信息>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper zookeeper-3.4.13<span style=color:#f92672>]</span><span style=color:#75715e># ps -ef | grep zookeeper</span>
</span></span><span style=display:flex><span>root       <span style=color:#ae81ff>8452</span>      <span style=color:#ae81ff>1</span>  <span style=color:#ae81ff>2</span> 17:48 pts/0    00:00:00 java -Dzookeeper.log.dir<span style=color:#f92672>=</span>. -Dzookeeper.root.logger<span style=color:#f92672>=</span>INFO,CONSOLE -cp /usr/local/src/zookeeper-3.4.13/bin/../build/classes:/usr/local/src/zookeeper-3.4.13/bin/../build/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/usr/local/src/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/usr/local/src/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/usr/local/src/zookeeper-3.4.13/bin/../src/java/lib/*.jar:/usr/local/src/zookeeper-3.4.13/bin/../conf: -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only<span style=color:#f92672>=</span>false org.apache.zookeeper.server.quorum.QuorumPeerMain /usr/local/src/zookeeper-3.4.13/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>root       <span style=color:#ae81ff>8498</span>   <span style=color:#ae81ff>8326</span>  <span style=color:#ae81ff>0</span> 17:49 pts/0    00:00:00 grep --color<span style=color:#f92672>=</span>auto zookeeper
</span></span></code></pre></div><h2 id=四zookeeper-集群部署>四、Zookeeper 集群部署<a hidden class=anchor aria-hidden=true href=#四zookeeper-集群部署>#</a></h2><h3 id=41-实验环境>4.1 实验环境<a hidden class=anchor aria-hidden=true href=#41-实验环境>#</a></h3><table><thead><tr><th>主机名</th><th>IP</th><th>系统</th><th>配置</th></tr></thead><tbody><tr><td>zookeeper-01</td><td>10.0.0.11</td><td>CentOS 7.6</td><td>1U 2G</td></tr><tr><td>zookeeper-02</td><td>10.0.0.12</td><td>CentOS 7.6</td><td>1U 2G</td></tr><tr><td>zookeeper-03</td><td>10.0.0.13</td><td>CentOS 7.6</td><td>1U 2G</td></tr></tbody></table><h3 id=42-配置-java-环境>4.2 配置 Java 环境<a hidden class=anchor aria-hidden=true href=#42-配置-java-环境>#</a></h3><p><strong>所有节点执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>yum install java-1.8.0-openjdk -y
</span></span><span style=display:flex><span>java -version
</span></span></code></pre></div><h3 id=43-下载并解压安装包>4.3 下载并解压安装包<a hidden class=anchor aria-hidden=true href=#43-下载并解压安装包>#</a></h3><p><strong>所有节点执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd /usr/local/src
</span></span><span style=display:flex><span>wget https://archive.apache.org/dist/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>tar xf zookeeper-3.4.13.tar.gz
</span></span><span style=display:flex><span>ln -sv /usr/local/src/zookeeper-3.4.13 /usr/local/zookeeper
</span></span><span style=display:flex><span>mkdir /usr/local/zookeeper/data <span style=color:#75715e># 数据存放目录，如果不存在会自动创建</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/conf
</span></span><span style=display:flex><span>cp zoo_sample.cfg zoo.cfg	
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 根据需要修改配置文件</span>
</span></span><span style=display:flex><span>cat &gt; zoo.cfg <span style=color:#e6db74>&lt;&lt; EOF
</span></span></span><span style=display:flex><span><span style=color:#e6db74>tickTime=2000
</span></span></span><span style=display:flex><span><span style=color:#e6db74>initLimit=10
</span></span></span><span style=display:flex><span><span style=color:#e6db74>syncLimit=5
</span></span></span><span style=display:flex><span><span style=color:#e6db74>dataDir=/usr/local/zookeeper/data
</span></span></span><span style=display:flex><span><span style=color:#e6db74>clientPort=2181
</span></span></span><span style=display:flex><span><span style=color:#e6db74>maxClientCnxns=4096
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autopurge.snapRetainCount=128
</span></span></span><span style=display:flex><span><span style=color:#e6db74>autopurge.purgeInterval=1
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.1=10.0.0.11:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.2=10.0.0.12:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>server.3=10.0.0.13:2888:3888
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span></code></pre></div><p>参数解释：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>tickTime</span><span style=color:#f92672>=</span><span style=color:#e6db74>2000 	#服务器与服务器之间的单次心跳检测时间间隔，单位为毫秒</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>initLimit</span><span style=color:#f92672>=</span><span style=color:#e6db74>10 	#集群中 leader 服务器与 follower 服务器初始连接心跳次数，即多少个 2000 毫秒</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>syncLimit</span><span style=color:#f92672>=</span><span style=color:#e6db74>5 	# leader 与 follower 之间连接完成之后，后期检测发送和应答的心跳次数，如果该 follower 在设置的时间内(5*2000)不能与 leader 进行通信，那么此follower 将被视为不可用。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dataDir</span><span style=color:#f92672>=</span><span style=color:#e6db74>/usr/local/zookeeper/data #自定义的 zookeeper 保存数据的目录</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>clientPort</span><span style=color:#f92672>=</span><span style=color:#e6db74>2181 #客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>maxClientCnxns</span><span style=color:#f92672>=</span><span style=color:#e6db74>128 	#单个客户端 IP 可以和 zookeeper 保持的连接数</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autopurge.snapRetainCount</span><span style=color:#f92672>=</span><span style=color:#e6db74>3 #3.4.0 中的新增功能：启用后，ZooKeeper 自动清除功能会将最新快照和相应的事务日志分别保留在 dataDir 和 dataLogDir 中，并删除其余部分，默认值为 3。最小值为 3。</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>autopurge.purgeInterval</span><span style=color:#f92672>=</span><span style=color:#e6db74>1 # 3.4.0 及之后版本，ZK 提供了自动清理日志和快照文件的功能，这个参数指定了清理频率，单位是小时，需要配置一个 1 或更大的整数，默认是 0，表示不开启自动清理功能</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.1</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.11:2888:3888 # server.服务器编号=服务器IP:数据同步端口:选举端口</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.2</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.12:2888:3888</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.3</span><span style=color:#f92672>=</span><span style=color:#e6db74>10.0.0.13:2888:3888</span>
</span></span></code></pre></div><h3 id=44-修改集群配置>4.4 修改集群配置<a hidden class=anchor aria-hidden=true href=#44-修改集群配置>#</a></h3><p><strong>zookeeper-01 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 配置集群 ID</span>
</span></span><span style=display:flex><span>echo <span style=color:#ae81ff>1</span> &gt; /usr/local/zookeeper/data/myid 
</span></span></code></pre></div><p><strong>zookeeper-02 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>2</span> &gt; /usr/local/zookeeper/data/myid
</span></span></code></pre></div><p><strong>zookeeper-03 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo <span style=color:#ae81ff>3</span> &gt; /usr/local/zookeeper/data/myid
</span></span></code></pre></div><h3 id=45-启动服务>4.5 启动服务<a hidden class=anchor aria-hidden=true href=#45-启动服务>#</a></h3><p><strong>zookeeper-01 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启动服务</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#查看集群角色</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-01 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: follower
</span></span></code></pre></div><p><strong>zookeeper-02 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启动服务</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-02 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># ./bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: leader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># leader 额外开启一个 2888 端口用于同步数据</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-03 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># ss -ntl|grep 2888</span>
</span></span><span style=display:flex><span>LISTEN     <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>50</span>        ::ffff:10.0.0.13:2888                    :::*
</span></span></code></pre></div><p><strong>zookeeper-03 执行：</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># 启动服务</span>
</span></span><span style=display:flex><span>cd /usr/local/zookeeper/
</span></span><span style=display:flex><span>bin/zkServer.sh start
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-03 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkServer.sh status</span>
</span></span><span style=display:flex><span>ZooKeeper JMX enabled by default
</span></span><span style=display:flex><span>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg
</span></span><span style=display:flex><span>Mode: follower
</span></span></code></pre></div><h2 id=五zookeeper-数据增删改查>五、Zookeeper 数据增删改查<a hidden class=anchor aria-hidden=true href=#五zookeeper-数据增删改查>#</a></h2><p>Zookeeper 是一个分布式的开源协调服务，常用于管理和维护分布式系统中的配置信息、命名服务、分布式锁等。它提供了一个层次化的命名空间（类似于文件系统），通过树状结构来存储数据。下面是一些基本的 Zookeeper 命令示例，用于增删改查 Zookeeper 中的数据节点：</p><p><strong>可用的客户端工具</strong>：<a href=https://github.com/zzhang5/zooinspector>zzhang5/zooinspector: An improved zookeeper inspector (github.com)</a></p><h3 id=51-语法简介>5.1 语法简介<a hidden class=anchor aria-hidden=true href=#51-语法简介>#</a></h3><ol><li><p><strong>连接到 Zookeeper：</strong></p><p>在终端中运行以下命令以连接到 Zookeeper 服务器：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>zkCli.sh -server &lt;ZOOKEEPER_SERVER&gt;:&lt;PORT&gt;
</span></span></code></pre></div><p>其中，<code>&lt;ZOOKEEPER_SERVER></code> 是 Zookeeper 服务器的地址，<code>&lt;PORT></code> 是 Zookeeper 服务器的端口，默认为 2181。</p></li><li><p><strong>创建节点：</strong></p><p>在 Zookeeper 中，可以使用 <code>create</code> 命令来创建一个新的节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>create /mynode <span style=color:#e6db74>&#34;Hello, Zookeeper!&#34;</span>
</span></span></code></pre></div></li><li><p><strong>获取节点数据：</strong></p><p>使用 <code>get</code> 命令可以获取节点的数据。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>get /mynode
</span></span></code></pre></div></li><li><p><strong>更新节点数据：</strong></p><p>使用 <code>set</code> 命令来更新节点的数据。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>set /mynode <span style=color:#e6db74>&#34;Updated data&#34;</span>
</span></span></code></pre></div></li><li><p><strong>列出子节点：</strong></p><p>使用 <code>ls</code> 命令列出节点的子节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>ls /path/to/parent_node
</span></span></code></pre></div></li><li><p><strong>删除节点：</strong></p><p>使用 <code>delete</code> 命令来删除节点。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>delete /path/to/node
</span></span></code></pre></div></li></ol><h3 id=52-实例演示>5.2 实例演示<a hidden class=anchor aria-hidden=true href=#52-实例演示>#</a></h3><p><strong>连接集群中的任意节点，这里选择 zookeeper-01</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[</span>root@zookeeper-01 zookeeper<span style=color:#f92672>]</span><span style=color:#75715e># bin/zkCli.sh -server 10.0.0.11</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 2<span style=color:#f92672>]</span> help  <span style=color:#75715e># help 查看帮助</span>
</span></span><span style=display:flex><span>ZooKeeper -server host:port cmd args
</span></span><span style=display:flex><span>	stat path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	set path data <span style=color:#f92672>[</span>version<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	ls path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	delquota <span style=color:#f92672>[</span>-n|-b<span style=color:#f92672>]</span> path
</span></span><span style=display:flex><span>	ls2 path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	setAcl path acl
</span></span><span style=display:flex><span>	setquota -n|-b val path
</span></span><span style=display:flex><span>	history 
</span></span><span style=display:flex><span>	redo cmdno
</span></span><span style=display:flex><span>	printwatches on|off
</span></span><span style=display:flex><span>	delete path <span style=color:#f92672>[</span>version<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	sync path
</span></span><span style=display:flex><span>	listquota path
</span></span><span style=display:flex><span>	rmr path
</span></span><span style=display:flex><span>	get path <span style=color:#f92672>[</span>watch<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>	create <span style=color:#f92672>[</span>-s<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>-e<span style=color:#f92672>]</span> path data acl
</span></span><span style=display:flex><span>	addauth scheme auth
</span></span><span style=display:flex><span>	quit 
</span></span><span style=display:flex><span>	getAcl path
</span></span><span style=display:flex><span>	close 
</span></span><span style=display:flex><span>	connect host:port
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> create /test <span style=color:#e6db74>&#34;hello&#34;</span>  <span style=color:#75715e># 创建节点</span>
</span></span><span style=display:flex><span>Created /test
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> get /test	<span style=color:#75715e># 查看节点内容</span>
</span></span><span style=display:flex><span>hello
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTING<span style=color:#f92672>)</span> 0<span style=color:#f92672>]</span> ls /test <span style=color:#75715e># 查看节点</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 1<span style=color:#f92672>]</span> create /test/app1 <span style=color:#75715e># 创建节点，但未给出值</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 2<span style=color:#f92672>]</span> ls /test/app1 <span style=color:#75715e># 实际未创建成功</span>
</span></span><span style=display:flex><span>Node does not exist: /test/app1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 3<span style=color:#f92672>]</span> create /test/app1 <span style=color:#e6db74>&#34;my first app&#34;</span> <span style=color:#75715e># 再次创建子节点并赋值</span>
</span></span><span style=display:flex><span>Node already exists: /test/app1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 4<span style=color:#f92672>]</span> ls /test/app1 <span style=color:#75715e># 创建成功                  </span>
</span></span><span style=display:flex><span><span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 5<span style=color:#f92672>]</span> ls /test/app1/ <span style=color:#75715e># 查看节点，末尾不能带 &#39;/&#39;</span>
</span></span><span style=display:flex><span>Command failed: java.lang.IllegalArgumentException: Path must not end with / character
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 6<span style=color:#f92672>]</span> set /test <span style=color:#e6db74>&#34;world&#34;</span> <span style=color:#75715e># 更新节点的值</span>
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000010
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:28:38 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x80000000d
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 7<span style=color:#f92672>]</span> get /test <span style=color:#75715e># 再次查看，更新成功</span>
</span></span><span style=display:flex><span>world
</span></span><span style=display:flex><span>cZxid <span style=color:#f92672>=</span> 0x800000004
</span></span><span style=display:flex><span>ctime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:08:30 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>mZxid <span style=color:#f92672>=</span> 0x800000012
</span></span><span style=display:flex><span>mtime <span style=color:#f92672>=</span> Wed Aug <span style=color:#ae81ff>30</span> 18:28:38 CST <span style=color:#ae81ff>2023</span>
</span></span><span style=display:flex><span>pZxid <span style=color:#f92672>=</span> 0x80000000d
</span></span><span style=display:flex><span>cversion <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>dataVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>aclVersion <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>ephemeralOwner <span style=color:#f92672>=</span> 0x0
</span></span><span style=display:flex><span>dataLength <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>numChildren <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 8<span style=color:#f92672>]</span> delete /test <span style=color:#75715e># 删除节点，因为存在字节的，所以删除失败</span>
</span></span><span style=display:flex><span>Node not empty: /test
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 9<span style=color:#f92672>]</span> delete /test/app1 <span style=color:#75715e># 先删除子节点</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>zk: 10.0.0.11<span style=color:#f92672>(</span>CONNECTED<span style=color:#f92672>)</span> 10<span style=color:#f92672>]</span> delete /test <span style=color:#75715e># 再次删除父节点成功</span>
</span></span></code></pre></div><h2 id=附录>附录<a hidden class=anchor aria-hidden=true href=#附录>#</a></h2><p><a href=https://desistdaydream.github.io/docs/3.%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/%E5%8F%AF%E8%83%BD%E6%98%AF%E6%8A%8A-ZooKeeper-%E6%A6%82%E5%BF%B5%E8%AE%B2%E7%9A%84%E6%9C%80%E6%B8%85%E6%A5%9A%E7%9A%84%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/>可能是把 ZooKeeper 概念讲的最清楚的一篇文章 | 断念梦 (desistdaydream.github.io)</a></p><p><a href=https://www.cnblogs.com/jay-huaxiao/p/13599519.html>ZooKeeper的十二连问，你顶得了嘛？ - Jay_huaxiao - 博客园 (cnblogs.com)</a></p><p><a href=https://www.cnblogs.com/wwjj4811/p/12929807.html>Zookeeper:新增、查看、修改、删除节点 - 秋风飒飒吹 - 博客园 (cnblogs.com)</a></p><p><a href=https://juejin.cn/post/6996657348802510878>一篇文章搞懂 ZooKeeper 的选举机制 - 掘金 (juejin.cn)</a></p><p><a href=https://www.jianshu.com/p/4ae3bb8fd71c>3. zookeeper 选举机制 - 简书 (jianshu.com)</a></p><p><a href=https://www.jianshu.com/p/c2ced54736aa>Zookeeper选举算法原理（摘选） - 简书 (jianshu.com)</a></p><p><a href=https://www.cnblogs.com/jojop/p/14319464.html>【Zookeeper】Zookeeper的Leader选举流程 - 周二鸭 - 博客园 (cnblogs.com)</a></p><p><a href=https://cloud.tencent.com/developer/article/2183968>Zookeeper：Zookeeper的主从选举机制-腾讯云开发者社区-腾讯云 (tencent.com)</a></p></div><div class=post-reward><div style=padding:0;margin:0;width:100%;font-size:16px;text-align:center><div id=QR style=opacity:0><div id=wechat style=display:inline-block><a class=fancybox rel=group><img id=wechat_qr src=https://senmer.github.io/img/wechat_pay.png alt=wechat_pay></a><p>微信</p></div><div id=alipay style=display:inline-block><a class=fancybox rel=group><img id=alipay_qr src=https://senmer.github.io/img/alipay.png alt=alipay></a><p>支付宝</p></div></div><button id=rewardButton onclick='var qr=document.getElementById("QR");qr.style.opacity==="0"?qr.style.opacity="1":qr.style.opacity="0"'>
<span>🧧 鼓励</span></button></div></div><footer class=post-footer><nav class=paginav><a class=prev href=https://senmer.github.io/zh/posts/tech/kafka/kafka%E7%AE%80%E4%BB%8B%E4%B8%8E%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2/><span class=title>« 上一页</span><br><span>Kafka简介与集群部署</span>
</a><a class=next href=https://senmer.github.io/zh/posts/tech/ansible/ansible/><span class=title>下一页 »</span><br><span>Ansible</span></a></nav></footer></div><style>.comments_details summary::marker{font-size:20px;content:'👉展开评论';color:var(--content)}.comments_details[open] summary::marker{font-size:20px;content:'👇关闭评论';color:var(--content)}</style><div><details class=comments_details open><summary style=display:none></summary><div id=tcomment></div></details><script src=https://cdn.staticfile.org/twikoo/1.6.16/twikoo.all.min.js></script><script>twikoo.init({envId:"https://hugo-api-khaki.vercel.app/# 填写自己的twikoo id",el:"#tcomment",lang:"zh-CN",region:null,path:window.TWIKOO_MAGIC_PATH||window.location.pathname})</script></div></article></main><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><span class=topInner><svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg><span id=read_progress></span>
</span></a><script>document.addEventListener("scroll",function(){const t=document.getElementById("read_progress"),n=document.documentElement.scrollHeight,s=document.documentElement.clientHeight,o=document.documentElement.scrollTop||document.body.scrollTop;t.innerText=((o/(n-s)).toFixed(2)*100).toFixed(0)})</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>let mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>200||document.documentElement.scrollTop>200?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{(function(){document.cookie="change-themes="+escape("false")})(),document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.body.addEventListener("copy",function(e){if(window.getSelection().toString()&&window.getSelection().toString().length>50){let t=e.clipboardData||window.clipboardData;if(t){e.preventDefault();let n=window.getSelection().toString(),s=window.getSelection().toString();t.setData("text/html",n),t.setData("text/plain",s)}}})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="复制";function i(){t.innerText="已复制！",setTimeout(()=>{t.innerText="复制"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){let t=e.textContent;navigator.clipboard.writeText(t),i();return}const n=document.createRange();n.selectNodeContents(e);const s=window.getSelection();s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy"),i()}catch{}s.removeRange(n)});let l=e.className.replaceAll("language-",""),n=document.createElement("div"),a=document.createElement("div"),r=document.createElement("div"),c=document.createElement("div"),o=document.createElement("div");o.innerText=l,n.setAttribute("class","mac-tool"),a.setAttribute("class","mac bb1"),r.setAttribute("class","mac bb2"),c.setAttribute("class","mac bb3"),o.setAttribute("class","language-type"),n.appendChild(a),n.appendChild(r),n.appendChild(c),n.appendChild(o),s.classList.contains("highlight")?(s.appendChild(t),s.appendChild(n)):s.parentNode.firstChild==s||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?(e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t),s.appendChild(n)):(e.parentNode.appendChild(t),s.appendChild(n)))})</script></body></html>